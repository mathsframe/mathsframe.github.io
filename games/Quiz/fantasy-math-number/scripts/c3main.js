// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__require=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__copyProps=(t,r,i,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let e of __getOwnPropNames(r))__hasOwnProp.call(t,e)||e===i||__defProp(t,e,{get:()=>r[e],enumerable:!(s=__getOwnPropDesc(r,e))||s.enumerable});return t},__toESM=(e,t,r)=>(r=null!=e?__create(__getProtoOf(e)):{},__copyProps(!t&&e&&e.__esModule?r:__defProp(r,"default",{value:e,enumerable:!0}),e)),require_c3runtime=__commonJS({"file-map:scripts/c3runtime.js"(exports,module){{let setMatrixArrayType2=function(e){ARRAY_TYPE=e},toRadian2=function(e){return e*degree},equals$92=function(e,t){return Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$82=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone$82=function(e){var t=new ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy$82=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity$52=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues$82=function(e,t,r,i){var s=new ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},set$82=function(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e},transpose$22=function(e,t){var r;return e===t?(r=t[1],e[1]=t[2],e[2]=r):(e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3]),e},invert$52=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=r*t-s*i;return a?(e[0]=t*(a=1/a),e[1]=-i*a,e[2]=-s*a,e[3]=r*a,e):null},adjoint$22=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant$32=function(e){return e[0]*e[3]-e[2]*e[1]},multiply$82=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=r[0],o=r[1],l=r[2],r=r[3];return e[0]=i*n+a*o,e[1]=s*n+t*o,e[2]=i*l+a*r,e[3]=s*l+t*r,e},rotate$42=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=Math.sin(r),r=Math.cos(r);return e[0]=i*r+a*n,e[1]=s*r+t*n,e[2]=i*-n+a*r,e[3]=s*-n+t*r,e},scale$82=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=r[0],r=r[1];return e[0]=i*n,e[1]=s*n,e[2]=a*r,e[3]=t*r,e},fromRotation$42=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=-r,e[3]=t,e},fromScaling$32=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str$82=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob$32=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU2=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add$82=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract$62=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},exactEquals$82=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals$82=function(e,t){var r=e[0],i=e[1],s=e[2],e=e[3],a=t[0],n=t[1],o=t[2],t=t[3];return Math.abs(r-a)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-n)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(s-o)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},multiplyScalar$32=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd$32=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},create$72=function(){var e=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone$72=function(e){var t=new ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy$72=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity$42=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues$72=function(e,t,r,i,s,a){var n=new ARRAY_TYPE(6);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n[4]=s,n[5]=a,n},set$72=function(e,t,r,i,s,a,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=a,e[5]=n,e},invert$42=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],t=t[5],o=r*a-i*s;return o?(e[0]=a*(o=1/o),e[1]=-i*o,e[2]=-s*o,e[3]=r*o,e[4]=(s*t-a*n)*o,e[5]=(i*n-r*t)*o,e):null},determinant$22=function(e){return e[0]*e[3]-e[1]*e[2]},multiply$72=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],t=t[5],l=r[0],h=r[1],u=r[2],c=r[3],_=r[4],r=r[5];return e[0]=i*l+a*h,e[1]=s*l+n*h,e[2]=i*u+a*c,e[3]=s*u+n*c,e[4]=i*_+a*r+o,e[5]=s*_+n*r+t,e},rotate$32=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],t=t[5],l=Math.sin(r),r=Math.cos(r);return e[0]=i*r+a*l,e[1]=s*r+n*l,e[2]=i*-l+a*r,e[3]=s*-l+n*r,e[4]=o,e[5]=t,e},scale$72=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],t=t[5],l=r[0],r=r[1];return e[0]=i*l,e[1]=s*l,e[2]=a*r,e[3]=n*r,e[4]=o,e[5]=t,e},translate$32=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],t=t[5],l=r[0],r=r[1];return e[0]=i,e[1]=s,e[2]=a,e[3]=n,e[4]=i*l+a*r+o,e[5]=s*l+n*r+t,e},fromRotation$32=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=-r,e[3]=t,e[4]=0,e[5]=0,e},fromScaling$22=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation$32=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str$72=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob$22=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add$72=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract$52=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e},multiplyScalar$22=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd$22=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},exactEquals$72=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals$72=function(e,t){var r=e[0],i=e[1],s=e[2],a=e[3],n=e[4],e=e[5],o=t[0],l=t[1],h=t[2],u=t[3],c=t[4],t=t[5];return Math.abs(r-o)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-l)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-h)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-u)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(n-c)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$62=function(){var e=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},fromMat4$12=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone$62=function(e){var t=new ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy$62=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues$62=function(e,t,r,i,s,a,n,o,l){var h=new ARRAY_TYPE(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=i,h[4]=s,h[5]=a,h[6]=n,h[7]=o,h[8]=l,h},set$62=function(e,t,r,i,s,a,n,o,l,h){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=a,e[5]=n,e[6]=o,e[7]=l,e[8]=h,e},identity$32=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose$12=function(e,t){var r,i,s;return e===t?(r=t[1],i=t[2],s=t[5],e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},invert$32=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],h=t[7],t=t[8],u=t*n-o*h,c=-t*a+o*l,_=h*a-n*l,d=r*u+i*c+s*_;return d?(e[0]=u*(d=1/d),e[1]=(-t*i+s*h)*d,e[2]=(o*i-s*n)*d,e[3]=c*d,e[4]=(t*r-s*l)*d,e[5]=(-o*r+s*a)*d,e[6]=_*d,e[7]=(-h*r+i*l)*d,e[8]=(n*r-i*a)*d,e):null},adjoint$12=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],h=t[7],t=t[8];return e[0]=n*t-o*h,e[1]=s*h-i*t,e[2]=i*o-s*n,e[3]=o*l-a*t,e[4]=r*t-s*l,e[5]=s*a-r*o,e[6]=a*h-n*l,e[7]=i*l-r*h,e[8]=r*n-i*a,e},determinant$12=function(e){var t=e[0],r=e[3],i=e[4],s=e[5],a=e[6],n=e[7],o=e[8];return t*(o*i-s*n)+e[1]*(-o*r+s*a)+e[2]*(n*r-i*a)},multiply$62=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],t=t[8],c=r[0],_=r[1],d=r[2],p=r[3],m=r[4],g=r[5],f=r[6],S=r[7],r=r[8];return e[0]=c*i+_*n+d*h,e[1]=c*s+_*o+d*u,e[2]=c*a+_*l+d*t,e[3]=p*i+m*n+g*h,e[4]=p*s+m*o+g*u,e[5]=p*a+m*l+g*t,e[6]=f*i+S*n+r*h,e[7]=f*s+S*o+r*u,e[8]=f*a+S*l+r*t,e},translate$22=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],t=t[8],c=r[0],r=r[1];return e[0]=i,e[1]=s,e[2]=a,e[3]=n,e[4]=o,e[5]=l,e[6]=c*i+r*n+h,e[7]=c*s+r*o+u,e[8]=c*a+r*l+t,e},rotate$22=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],t=t[8],c=Math.sin(r),r=Math.cos(r);return e[0]=r*i+c*n,e[1]=r*s+c*o,e[2]=r*a+c*l,e[3]=r*n-c*i,e[4]=r*o-c*s,e[5]=r*l-c*a,e[6]=h,e[7]=u,e[8]=t,e},scale$62=function(e,t,r){var i=r[0],r=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation$22=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation$22=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=0,e[3]=-r,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling$12=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat$12=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=r+r,n=i+i,o=s+s,r=r*a,l=i*a,i=i*n,h=s*a,u=s*n,s=s*o,a=t*a,n=t*n,t=t*o;return e[0]=1-i-s,e[3]=l-t,e[6]=h+n,e[1]=l+t,e[4]=1-r-s,e[7]=u-a,e[2]=h-n,e[5]=u+a,e[8]=1-r-i,e},normalFromMat42=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=t[9],_=t[10],d=t[11],p=t[12],m=t[13],g=t[14],t=t[15],f=r*o-i*n,S=r*l-s*n,C=r*h-a*n,y=i*l-s*o,G=i*h-a*o,I=s*h-a*l,T=u*m-c*p,v=u*g-_*p,u=u*t-d*p,A=c*g-_*m,c=c*t-d*m,_=_*t-d*g,d=f*_-S*c+C*A+y*u-G*v+I*T;return d?(e[0]=(o*_-l*c+h*A)*(d=1/d),e[1]=(l*u-n*_-h*v)*d,e[2]=(n*c-o*u+h*T)*d,e[3]=(s*c-i*_-a*A)*d,e[4]=(r*_-s*u+a*v)*d,e[5]=(i*u-r*c-a*T)*d,e[6]=(m*I-g*G+t*y)*d,e[7]=(g*C-p*I-t*S)*d,e[8]=(p*G-m*C+t*f)*d,e):null},projection2=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str$62=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob$12=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add$62=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract$42=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e},multiplyScalar$12=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd$12=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},exactEquals$62=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals$62=function(e,t){var r=e[0],i=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],e=e[8],u=t[0],c=t[1],_=t[2],d=t[3],p=t[4],m=t[5],g=t[6],f=t[7],t=t[8];return Math.abs(r-u)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-_)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-d)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(n-p)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-m)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-g)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-f)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(f))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$52=function(){var e=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone$52=function(e){var t=new ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy$52=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues$52=function(e,t,r,i,s,a,n,o,l,h,u,c,_,d,p,m){var g=new ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=i,g[4]=s,g[5]=a,g[6]=n,g[7]=o,g[8]=l,g[9]=h,g[10]=u,g[11]=c,g[12]=_,g[13]=d,g[14]=p,g[15]=m,g},set$52=function(e,t,r,i,s,a,n,o,l,h,u,c,_,d,p,m,g){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=a,e[5]=n,e[6]=o,e[7]=l,e[8]=h,e[9]=u,e[10]=c,e[11]=_,e[12]=d,e[13]=p,e[14]=m,e[15]=g,e},identity$22=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose2=function(e,t){var r,i,s,a,n,o;return e===t?(r=t[1],i=t[2],s=t[3],a=t[6],n=t[7],o=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=s,e[13]=n,e[14]=o):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e},invert$22=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=t[9],_=t[10],d=t[11],p=t[12],m=t[13],g=t[14],t=t[15],f=r*o-i*n,S=r*l-s*n,C=r*h-a*n,y=i*l-s*o,G=i*h-a*o,I=s*h-a*l,T=u*m-c*p,v=u*g-_*p,A=u*t-d*p,b=c*g-_*m,R=c*t-d*m,P=_*t-d*g,E=f*P-S*R+C*b+y*A-G*v+I*T;return E?(e[0]=(o*P-l*R+h*b)*(E=1/E),e[1]=(s*R-i*P-a*b)*E,e[2]=(m*I-g*G+t*y)*E,e[3]=(_*G-c*I-d*y)*E,e[4]=(l*A-n*P-h*v)*E,e[5]=(r*P-s*A+a*v)*E,e[6]=(g*C-p*I-t*S)*E,e[7]=(u*I-_*C+d*S)*E,e[8]=(n*R-o*A+h*T)*E,e[9]=(i*A-r*R-a*T)*E,e[10]=(p*G-m*C+t*f)*E,e[11]=(c*C-u*G-d*f)*E,e[12]=(o*v-n*b-l*T)*E,e[13]=(r*b-i*v+s*T)*E,e[14]=(m*S-p*y-g*f)*E,e[15]=(u*y-c*S+_*f)*E,e):null},adjoint2=function(e,t){var r=t[0],i=t[1],s=t[2],a=t[3],n=t[4],o=t[5],l=t[6],h=t[7],u=t[8],c=t[9],_=t[10],d=t[11],p=t[12],m=t[13],g=t[14],t=t[15],f=r*o-i*n,S=r*l-s*n,C=r*h-a*n,y=i*l-s*o,G=i*h-a*o,I=s*h-a*l,T=u*m-c*p,v=u*g-_*p,A=u*t-d*p,b=c*g-_*m,R=c*t-d*m,P=_*t-d*g;return e[0]=o*P-l*R+h*b,e[1]=s*R-i*P-a*b,e[2]=m*I-g*G+t*y,e[3]=_*G-c*I-d*y,e[4]=l*A-n*P-h*v,e[5]=r*P-s*A+a*v,e[6]=g*C-p*I-t*S,e[7]=u*I-_*C+d*S,e[8]=n*R-o*A+h*T,e[9]=i*A-r*R-a*T,e[10]=p*G-m*C+t*f,e[11]=c*C-u*G-d*f,e[12]=o*v-n*b-l*T,e[13]=r*b-i*v+s*T,e[14]=m*S-p*y-g*f,e[15]=u*y-c*S+_*f,e},determinant2=function(e){var t=e[0],r=e[1],i=e[2],s=e[4],a=e[5],n=e[6],o=e[8],l=e[9],h=e[10],u=e[12],c=e[13],_=e[14],d=t*a-r*s,p=t*n-i*s,m=r*n-i*a,g=o*c-l*u,f=o*_-h*u,S=l*_-h*c;return e[7]*(t*S-r*f+i*g)-e[3]*(s*S-a*f+n*g)+e[15]*(o*m-l*p+h*d)-e[11]*(u*m-c*p+_*d)},multiply$52=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],_=t[9],d=t[10],p=t[11],m=t[12],g=t[13],f=t[14],t=t[15],S=r[0],C=r[1],y=r[2],G=r[3];return e[0]=S*i+C*o+y*c+G*m,e[1]=S*s+C*l+y*_+G*g,e[2]=S*a+C*h+y*d+G*f,e[3]=S*n+C*u+y*p+G*t,e[4]=(S=r[4])*i+(C=r[5])*o+(y=r[6])*c+(G=r[7])*m,e[5]=S*s+C*l+y*_+G*g,e[6]=S*a+C*h+y*d+G*f,e[7]=S*n+C*u+y*p+G*t,e[8]=(S=r[8])*i+(C=r[9])*o+(y=r[10])*c+(G=r[11])*m,e[9]=S*s+C*l+y*_+G*g,e[10]=S*a+C*h+y*d+G*f,e[11]=S*n+C*u+y*p+G*t,e[12]=(S=r[12])*i+(C=r[13])*o+(y=r[14])*c+(G=r[15])*m,e[13]=S*s+C*l+y*_+G*g,e[14]=S*a+C*h+y*d+G*f,e[15]=S*n+C*u+y*p+G*t,e},translate$12=function(e,t,r){var i,s,a,n,o,l,h,u,c,_,d,p,m=r[0],g=r[1],r=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*r+t[12],e[13]=t[1]*m+t[5]*g+t[9]*r+t[13],e[14]=t[2]*m+t[6]*g+t[10]*r+t[14],e[15]=t[3]*m+t[7]*g+t[11]*r+t[15]):(i=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=t[8],_=t[9],d=t[10],p=t[11],e[0]=i,e[1]=s,e[2]=a,e[3]=n,e[4]=o,e[5]=l,e[6]=h,e[7]=u,e[8]=c,e[9]=_,e[10]=d,e[11]=p,e[12]=i*m+o*g+c*r+t[12],e[13]=s*m+l*g+_*r+t[13],e[14]=a*m+h*g+d*r+t[14],e[15]=n*m+u*g+p*r+t[15]),e},scale$52=function(e,t,r){var i=r[0],s=r[1],r=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate$12=function(e,t,r,i){var s,a,n,o,l,h,u,c,_,d,p,m,g,f,S,C,y,G,I,T,v=i[0],A=i[1],i=i[2],b=Math.hypot(v,A,i);return b<EPSILON?null:(v*=b=1/b,A*=b,i*=b,b=Math.sin(r),r=Math.cos(r),a=t[0],n=t[1],o=t[2],l=t[3],u=t[5],c=t[6],_=t[7],p=t[9],m=t[10],g=t[11],S=v*A*(s=1-r)-i*b,C=A*A*s+r,y=i*A*s+v*b,G=v*i*s+A*b,I=A*i*s-v*b,T=i*i*s+r,e[0]=a*(r=v*v*s+r)+(h=t[4])*(f=A*v*s+i*b)+(d=t[8])*(i=i*v*s-A*b),e[1]=n*r+u*f+p*i,e[2]=o*r+c*f+m*i,e[3]=l*r+_*f+g*i,e[4]=a*S+h*C+d*y,e[5]=n*S+u*C+p*y,e[6]=o*S+c*C+m*y,e[7]=l*S+_*C+g*y,e[8]=a*G+h*I+d*T,e[9]=n*G+u*I+p*T,e[10]=o*G+c*I+m*T,e[11]=l*G+_*I+g*T,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX$32=function(e,t,r){var i=Math.sin(r),r=Math.cos(r),s=t[4],a=t[5],n=t[6],o=t[7],l=t[8],h=t[9],u=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+l*i,e[5]=a*r+h*i,e[6]=n*r+u*i,e[7]=o*r+c*i,e[8]=l*r-s*i,e[9]=h*r-a*i,e[10]=u*r-n*i,e[11]=c*r-o*i,e},rotateY$32=function(e,t,r){var i=Math.sin(r),r=Math.cos(r),s=t[0],a=t[1],n=t[2],o=t[3],l=t[8],h=t[9],u=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-l*i,e[1]=a*r-h*i,e[2]=n*r-u*i,e[3]=o*r-c*i,e[8]=s*i+l*r,e[9]=a*i+h*r,e[10]=n*i+u*r,e[11]=o*i+c*r,e},rotateZ$32=function(e,t,r){var i=Math.sin(r),r=Math.cos(r),s=t[0],a=t[1],n=t[2],o=t[3],l=t[4],h=t[5],u=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+l*i,e[1]=a*r+h*i,e[2]=n*r+u*i,e[3]=o*r+c*i,e[4]=l*r-s*i,e[5]=h*r-a*i,e[6]=u*r-n*i,e[7]=c*r-o*i,e},fromTranslation$12=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling2=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation$12=function(e,t,r){var i,s=r[0],a=r[1],r=r[2],n=Math.hypot(s,a,r);return n<EPSILON?null:(s*=n=1/n,a*=n,r*=n,n=Math.sin(t),t=Math.cos(t),e[0]=s*s*(i=1-t)+t,e[1]=a*s*i+r*n,e[2]=r*s*i-a*n,e[3]=0,e[4]=s*a*i-r*n,e[5]=a*a*i+t,e[6]=r*a*i+s*n,e[7]=0,e[8]=s*r*i+a*n,e[9]=a*r*i-s*n,e[10]=r*r*i+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation2=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation2=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation2=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation$12=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=i+i,o=s+s,l=a+a,h=i*n,u=i*o,i=i*l,c=s*o,s=s*l,a=a*l,n=t*n,o=t*o,t=t*l;return e[0]=1-(c+a),e[1]=u+t,e[2]=i-o,e[3]=0,e[4]=u-t,e[5]=1-(h+a),e[6]=s+n,e[7]=0,e[8]=i+o,e[9]=s-n,e[10]=1-(h+c),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromQuat22=function(e,t){var r=new ARRAY_TYPE(3),i=-t[0],s=-t[1],a=-t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=i*i+s*s+a*a+n*n;return 0<c?(r[0]=2*(o*n+u*i+l*a-h*s)/c,r[1]=2*(l*n+u*s+h*i-o*a)/c,r[2]=2*(h*n+u*a+o*s-l*i)/c):(r[0]=2*(o*n+u*i+l*a-h*s),r[1]=2*(l*n+u*s+h*i-o*a),r[2]=2*(h*n+u*a+o*s-l*i)),fromRotationTranslation$12(e,t,r),e},getTranslation$12=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling2=function(e,t){var r=t[0],i=t[4],s=t[5],a=t[6],n=t[8],o=t[9],l=t[10];return e[0]=Math.hypot(r,t[1],t[2]),e[1]=Math.hypot(i,s,a),e[2]=Math.hypot(n,o,l),e},getRotation2=function(e,t){var r=new ARRAY_TYPE(3),i=(getScaling2(r,t),1/r[0]),s=1/r[1],r=1/r[2],a=t[0]*i,n=t[1]*s,o=t[2]*r,l=t[4]*i,h=t[5]*s,u=t[6]*r,i=t[8]*i,s=t[9]*s,t=t[10]*r,r=a+h+t,c=0;return 0<r?(c=2*Math.sqrt(1+r),e[3]=.25*c,e[0]=(u-s)/c,e[1]=(i-o)/c,e[2]=(n-l)/c):h<a&&t<a?(c=2*Math.sqrt(1+a-h-t),e[3]=(u-s)/c,e[0]=.25*c,e[1]=(n+l)/c,e[2]=(i+o)/c):t<h?(c=2*Math.sqrt(1+h-a-t),e[3]=(i-o)/c,e[0]=(n+l)/c,e[1]=.25*c,e[2]=(u+s)/c):(c=2*Math.sqrt(1+t-a-h),e[3]=(n-l)/c,e[0]=(i+o)/c,e[1]=(u+s)/c,e[2]=.25*c),e},decompose2=function(e,t,r,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];var t=i[0],s=i[1],a=i[2],n=i[4],o=i[5],l=i[6],h=i[8],u=i[9],i=i[10],c=(r[0]=Math.hypot(t,s,a),r[1]=Math.hypot(n,o,l),r[2]=Math.hypot(h,u,i),1/r[0]),_=1/r[1],r=1/r[2],t=t*c,s=s*_,a=a*r,n=n*c,o=o*_,l=l*r,h=h*c,c=u*_,u=i*r,_=t+o+u,i=0;return 0<_?(i=2*Math.sqrt(1+_),e[3]=.25*i,e[0]=(l-c)/i,e[1]=(h-a)/i,e[2]=(s-n)/i):o<t&&u<t?(i=2*Math.sqrt(1+t-o-u),e[3]=(l-c)/i,e[0]=.25*i,e[1]=(s+n)/i,e[2]=(h+a)/i):u<o?(i=2*Math.sqrt(1+o-t-u),e[3]=(h-a)/i,e[0]=(s+n)/i,e[1]=.25*i,e[2]=(l+c)/i):(i=2*Math.sqrt(1+u-t-o),e[3]=(s-n)/i,e[0]=(h+a)/i,e[1]=(l+c)/i,e[2]=.25*i),e},fromRotationTranslationScale2=function(e,t,r,i){var s=t[0],a=t[1],n=t[2],t=t[3],o=s+s,l=a+a,h=n+n,u=s*o,c=s*l,s=s*h,_=a*l,a=a*h,n=n*h,o=t*o,l=t*l,t=t*h,h=i[0],d=i[1],i=i[2];return e[0]=(1-(_+n))*h,e[1]=(c+t)*h,e[2]=(s-l)*h,e[3]=0,e[4]=(c-t)*d,e[5]=(1-(u+n))*d,e[6]=(a+o)*d,e[7]=0,e[8]=(s+l)*i,e[9]=(a-o)*i,e[10]=(1-(u+_))*i,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin2=function(e,t,r,i,s){var a=t[0],n=t[1],o=t[2],t=t[3],l=a+a,h=n+n,u=o+o,c=a*l,_=a*h,a=a*u,d=n*h,n=n*u,o=o*u,l=t*l,h=t*h,t=t*u,u=i[0],p=i[1],i=i[2],m=s[0],g=s[1],s=s[2],f=(1-(d+o))*u,S=(_+t)*u,u=(a-h)*u,_=(_-t)*p,t=(1-(c+o))*p,o=(n+l)*p,p=(a+h)*i,a=(n-l)*i,h=(1-(c+d))*i;return e[0]=f,e[1]=S,e[2]=u,e[3]=0,e[4]=_,e[5]=t,e[6]=o,e[7]=0,e[8]=p,e[9]=a,e[10]=h,e[11]=0,e[12]=r[0]+m-(f*m+_*g+p*s),e[13]=r[1]+g-(S*m+t*g+a*s),e[14]=r[2]+s-(u*m+o*g+h*s),e[15]=1,e},fromQuat3=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=r+r,n=i+i,o=s+s,r=r*a,l=i*a,i=i*n,h=s*a,u=s*n,s=s*o,a=t*a,n=t*n,t=t*o;return e[0]=1-i-s,e[1]=l+t,e[2]=h-n,e[3]=0,e[4]=l-t,e[5]=1-r-s,e[6]=u+a,e[7]=0,e[8]=h+n,e[9]=u-a,e[10]=1-r-i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum2=function(e,t,r,i,s,a,n){var o=1/(r-t),l=1/(s-i),h=1/(a-n);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(s+i)*l,e[10]=(n+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=n*a*2*h,e[15]=0,e},perspectiveNO2=function(e,t,r,i,s){t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(e[10]=(s+i)*(r=1/(i-s)),e[14]=2*s*i*r):(e[10]=-1,e[14]=-2*i),e},perspectiveZO2=function(e,t,r,i,s){t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(e[10]=s*(r=1/(i-s)),e[14]=s*i*r):(e[10]=-1,e[14]=-i),e},perspectiveFromFieldOfView2=function(e,t,r,i){var s=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),n=Math.tan(t.leftDegrees*Math.PI/180),t=Math.tan(t.rightDegrees*Math.PI/180),o=2/(n+t),l=2/(s+a);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(n-t)*o*.5,e[9]=(s-a)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},orthoNO2=function(e,t,r,i,s,a,n){var o=1/(t-r),l=1/(i-s),h=1/(a-n);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(s+i)*l,e[14]=(n+a)*h,e[15]=1,e},orthoZO2=function(e,t,r,i,s,a,n){var o=1/(t-r),l=1/(i-s),n=1/(a-n);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n,e[11]=0,e[12]=(t+r)*o,e[13]=(s+i)*l,e[14]=a*n,e[15]=1,e},lookAt2=function(e,t,r,i){var s,a,n,o,l=t[0],h=t[1],t=t[2],u=i[0],c=i[1],i=i[2],_=r[0],d=r[1],r=r[2];return Math.abs(l-_)<EPSILON&&Math.abs(h-d)<EPSILON&&Math.abs(t-r)<EPSILON?identity$22(e):(_=l-_,d=h-d,r=t-r,s=c*(r*=o=1/Math.hypot(_,d,r))-i*(d*=o),i=i*(_*=o)-u*r,u=u*d-c*_,(o=Math.hypot(s,i,u))?(s*=o=1/o,i*=o,u*=o):u=i=s=0,c=d*u-r*i,a=r*s-_*u,n=_*i-d*s,(o=Math.hypot(c,a,n))?(c*=o=1/o,a*=o,n*=o):n=a=c=0,e[0]=s,e[1]=c,e[2]=_,e[3]=0,e[4]=i,e[5]=a,e[6]=d,e[7]=0,e[8]=u,e[9]=n,e[10]=r,e[11]=0,e[12]=-(s*l+i*h+u*t),e[13]=-(c*l+a*h+n*t),e[14]=-(_*l+d*h+r*t),e[15]=1,e)},targetTo2=function(e,t,r,i){var s=t[0],a=t[1],t=t[2],n=i[0],o=i[1],i=i[2],l=s-r[0],h=a-r[1],r=t-r[2],u=l*l+h*h+r*r,c=(0<u&&(l*=u=1/Math.sqrt(u),h*=u,r*=u),o*r-i*h),i=i*l-n*r,n=n*h-o*l;return 0<(u=c*c+i*i+n*n)&&(c*=u=1/Math.sqrt(u),i*=u,n*=u),e[0]=c,e[1]=i,e[2]=n,e[3]=0,e[4]=h*n-r*i,e[5]=r*c-l*n,e[6]=l*i-h*c,e[7]=0,e[8]=l,e[9]=h,e[10]=r,e[11]=0,e[12]=s,e[13]=a,e[14]=t,e[15]=1,e},str$52=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob2=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add$52=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract$32=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e},multiplyScalar2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd2=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},exactEquals$52=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals$52=function(e,t){var r=e[0],i=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],_=e[10],d=e[11],p=e[12],m=e[13],g=e[14],e=e[15],f=t[0],S=t[1],C=t[2],y=t[3],G=t[4],I=t[5],T=t[6],v=t[7],A=t[8],b=t[9],R=t[10],P=t[11],E=t[12],x=t[13],w=t[14],t=t[15];return Math.abs(r-f)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-S)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-C)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-y)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(n-G)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(G))&&Math.abs(o-I)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(l-T)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-v)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(u-A)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-b)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(_-R)<=EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(d-P)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-E)<=EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(m-x)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-w)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$42=function(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e},clone$42=function(e){var t=new ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length$42=function(e){var t=e[0];return Math.hypot(t,e[1],e[2])},fromValues$42=function(e,t,r){var i=new ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i},copy$42=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set$42=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},add$42=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract$22=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},multiply$42=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},divide$22=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},ceil$22=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor$22=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min$22=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max$22=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round$22=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale$42=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},scaleAndAdd$22=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},distance$22=function(e,t){var r=t[0]-e[0];return Math.hypot(r,t[1]-e[1],t[2]-e[2])},squaredDistance$22=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],t=t[2]-e[2];return r*r+i*i+t*t},squaredLength$42=function(e){var t=e[0],r=e[1],e=e[2];return t*t+r*r+e*e},negate$22=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse$22=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize$42=function(e,t){var r=t[0],i=t[1],s=t[2],r=r*r+i*i+s*s;return 0<r&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},dot$42=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross$22=function(e,t,r){var i=t[0],s=t[1],t=t[2],a=r[0],n=r[1],r=r[2];return e[0]=s*r-t*n,e[1]=t*a-i*r,e[2]=i*n-s*a,e},lerp$42=function(e,t,r,i){var s=t[0],a=t[1],t=t[2];return e[0]=s+i*(r[0]-s),e[1]=a+i*(r[1]-a),e[2]=t+i*(r[2]-t),e},slerp$12=function(e,t,r,i){var s=Math.acos(Math.min(Math.max(dot$42(t,r),-1),1)),a=Math.sin(s),n=Math.sin((1-i)*s)/a,i=Math.sin(i*s)/a;return e[0]=n*t[0]+i*r[0],e[1]=n*t[1]+i*r[1],e[2]=n*t[2]+i*r[2],e},hermite2=function(e,t,r,i,s,a){var n=a*a,o=n*(2*a-3)+1,l=n*(a-2)+a,h=n*(a-1),n=n*(3-2*a);return e[0]=t[0]*o+r[0]*l+i[0]*h+s[0]*n,e[1]=t[1]*o+r[1]*l+i[1]*h+s[1]*n,e[2]=t[2]*o+r[2]*l+i[2]*h+s[2]*n,e},bezier2=function(e,t,r,i,s,a){var n=1-a,o=n*n,l=a*a,h=o*n,o=3*a*o,n=3*l*n,l=l*a;return e[0]=t[0]*h+r[0]*o+i[0]*n+s[0]*l,e[1]=t[1]*h+r[1]*o+i[1]*n+s[1]*l,e[2]=t[2]*h+r[2]*o+i[2]*n+s[2]*l,e},random$32=function(e,t){t=t||1;var r=2*RANDOM()*Math.PI,i=2*RANDOM()-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=i*t,e},transformMat4$22=function(e,t,r){var i=t[0],s=t[1],t=t[2],a=r[3]*i+r[7]*s+r[11]*t+r[15];return e[0]=(r[0]*i+r[4]*s+r[8]*t+r[12])/(a=a||1),e[1]=(r[1]*i+r[5]*s+r[9]*t+r[13])/a,e[2]=(r[2]*i+r[6]*s+r[10]*t+r[14])/a,e},transformMat3$12=function(e,t,r){var i=t[0],s=t[1],t=t[2];return e[0]=i*r[0]+s*r[3]+t*r[6],e[1]=i*r[1]+s*r[4]+t*r[7],e[2]=i*r[2]+s*r[5]+t*r[8],e},transformQuat$12=function(e,t,r){var i=r[0],s=r[1],a=r[2],n=t[0],o=t[1],t=t[2],l=s*t-a*o,h=a*n-i*t,u=i*o-s*n,c=s*u-a*h,a=a*l-i*u,i=i*h-s*l,s=2*r[3];return h*=s,u*=s,a*=2,i*=2,e[0]=n+(l*=s)+(c*=2),e[1]=o+h+a,e[2]=t+u+i,e},rotateX$22=function(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateY$22=function(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateZ$22=function(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},angle$12=function(e,t){var r=e[0],i=e[1],s=e[2],a=t[0],n=t[1],o=t[2],r=Math.sqrt((r*r+i*i+s*s)*(a*a+n*n+o*o)),i=r&&dot$42(e,t)/r;return Math.acos(Math.min(Math.max(i,-1),1))},zero$22=function(e){return e[0]=0,e[1]=0,e[2]=0,e},str$42=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals$42=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals$42=function(e,t){var r=e[0],i=e[1],e=e[2],s=t[0],a=t[1],t=t[2];return Math.abs(r-s)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$32=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e},clone$32=function(e){var t=new ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues$32=function(e,t,r,i){var s=new ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},copy$32=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set$32=function(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e},add$32=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract$12=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},multiply$32=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},divide$12=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},ceil$12=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor$12=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min$12=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max$12=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round$12=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale$32=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},scaleAndAdd$12=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},distance$12=function(e,t){var r=t[0]-e[0];return Math.hypot(r,t[1]-e[1],t[2]-e[2],t[3]-e[3])},squaredDistance$12=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],t=t[3]-e[3];return r*r+i*i+s*s+t*t},length$32=function(e){var t=e[0];return Math.hypot(t,e[1],e[2],e[3])},squaredLength$32=function(e){var t=e[0],r=e[1],i=e[2],e=e[3];return t*t+r*r+i*i+e*e},negate$12=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse$12=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize$32=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=r*r+i*i+s*s+t*t;return 0<a&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=s*a,e[3]=t*a,e},dot$32=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross$12=function(e,t,r,i){var s=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],n=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],r=r[2]*i[3]-r[3]*i[2],i=t[0],h=t[1],u=t[2],t=t[3];return e[0]=h*r-u*l+t*o,e[1]=-i*r+u*n-t*a,e[2]=i*l-h*n+t*s,e[3]=-i*o+h*a-u*s,e},lerp$32=function(e,t,r,i){var s=t[0],a=t[1],n=t[2],t=t[3];return e[0]=s+i*(r[0]-s),e[1]=a+i*(r[1]-a),e[2]=n+i*(r[2]-n),e[3]=t+i*(r[3]-t),e},random$22=function(e,t){var r,i,s,a,n,o;for(t=t||1;1<=(n=(r=2*RANDOM()-1)*r+(i=2*RANDOM()-1)*i););for(;1<=(o=(s=2*RANDOM()-1)*s+(a=2*RANDOM()-1)*a););var l=Math.sqrt((1-n)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*s*l,e[3]=t*a*l,e},transformMat4$12=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*a+r[12]*t,e[1]=r[1]*i+r[5]*s+r[9]*a+r[13]*t,e[2]=r[2]*i+r[6]*s+r[10]*a+r[14]*t,e[3]=r[3]*i+r[7]*s+r[11]*a+r[15]*t,e},transformQuat2=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=r[0],o=r[1],l=r[2],r=r[3],h=r*i+o*a-l*s,u=r*s+l*i-n*a,c=r*a+n*s-o*i,i=-n*i-o*s-l*a;return e[0]=h*r+i*-n+u*-l-c*-o,e[1]=u*r+i*-o+c*-n-h*-l,e[2]=c*r+i*-l+h*-o-u*-n,e[3]=t[3],e},zero$12=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str$32=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals$32=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals$32=function(e,t){var r=e[0],i=e[1],s=e[2],e=e[3],a=t[0],n=t[1],o=t[2],t=t[3];return Math.abs(r-a)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-n)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(s-o)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$22=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e},identity$12=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle2=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},getAxisAngle2=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return EPSILON<i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},getAngle2=function(e,t){e=dot$2(e,t);return Math.acos(2*e*e-1)},multiply$22=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=r[0],o=r[1],l=r[2],r=r[3];return e[0]=i*r+t*n+s*l-a*o,e[1]=s*r+t*o+a*n-i*l,e[2]=a*r+t*l+i*o-s*n,e[3]=t*r-i*n-s*o-a*l,e},rotateX$12=function(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],t=t[3],n=Math.sin(r),r=Math.cos(r);return e[0]=i*r+t*n,e[1]=s*r+a*n,e[2]=a*r-s*n,e[3]=t*r-i*n,e},rotateY$12=function(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],t=t[3],n=Math.sin(r),r=Math.cos(r);return e[0]=i*r-a*n,e[1]=s*r+t*n,e[2]=a*r+i*n,e[3]=t*r-s*n,e},rotateZ$12=function(e,t,r){r*=.5;var i=t[0],s=t[1],a=t[2],t=t[3],n=Math.sin(r),r=Math.cos(r);return e[0]=i*r+s*n,e[1]=s*r-i*n,e[2]=a*r+t*n,e[3]=t*r-a*n,e},calculateW2=function(e,t){var r=t[0],i=t[1],t=t[2];return e[0]=r,e[1]=i,e[2]=t,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-t*t)),e},exp2=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=Math.sqrt(r*r+i*i+s*s),t=Math.exp(t),n=0<a?t*Math.sin(a)/a:0;return e[0]=r*n,e[1]=i*n,e[2]=s*n,e[3]=t*Math.cos(a),e},ln2=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=Math.sqrt(r*r+i*i+s*s),a=0<a?Math.atan2(a,t)/a:0;return e[0]=r*a,e[1]=i*a,e[2]=s*a,e[3]=.5*Math.log(r*r+i*i+s*s+t*t),e},pow2=function(e,t,r){return ln2(e,t),scale$2(e,e,r),exp2(e,e),e},slerp2=function(e,t,r,i){var s,a,n=t[0],o=t[1],l=t[2],t=t[3],h=r[0],u=r[1],c=r[2],r=r[3],_=n*h+o*u+l*c+t*r;return _<0&&(_=-_,h=-h,u=-u,c=-c,r=-r),_=EPSILON<1-_?(_=Math.acos(_),s=Math.sin(_),a=Math.sin((1-i)*_)/s,Math.sin(i*_)/s):(a=1-i,i),e[0]=a*n+_*h,e[1]=a*o+_*u,e[2]=a*l+_*c,e[3]=a*t+_*r,e},random$12=function(e){var t=RANDOM(),r=RANDOM(),i=RANDOM(),s=Math.sqrt(1-t),t=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*r),e[1]=s*Math.cos(2*Math.PI*r),e[2]=t*Math.sin(2*Math.PI*i),e[3]=t*Math.cos(2*Math.PI*i),e},invert$12=function(e,t){var r=t[0],i=t[1],s=t[2],t=t[3],a=r*r+i*i+s*s+t*t,a=a?1/a:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=t*a,e},conjugate$12=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat32=function(e,t){var r,i,s,a=t[0]+t[4]+t[8];return 0<a?(s=Math.sqrt(a+1),e[3]=.5*s,e[0]=(t[5]-t[7])*(s=.5/s),e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s):(r=((a=t[3*(a=t[4]>t[a=0]?1:a)+a]<t[8]?2:a)+1)%3,i=(a+2)%3,s=Math.sqrt(t[3*a+a]-t[3*r+r]-t[3*i+i]+1),e[a]=.5*s,e[3]=(t[3*r+i]-t[3*i+r])*(s=.5/s),e[r]=(t[3*r+a]+t[3*a+r])*s,e[i]=(t[3*i+a]+t[3*a+i])*s),e},fromEuler2=function(e,t,r,i){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ANGLE_ORDER,a=Math.PI/360,n=(i*=a,r*=a,Math.sin(t*=a)),o=Math.cos(t),l=Math.sin(r),h=Math.cos(r),u=Math.sin(i),c=Math.cos(i);switch(s){case"xyz":e[0]=n*h*c+o*l*u,e[1]=o*l*c-n*h*u,e[2]=o*h*u+n*l*c,e[3]=o*h*c-n*l*u;break;case"xzy":e[0]=n*h*c-o*l*u,e[1]=o*l*c-n*h*u,e[2]=o*h*u+n*l*c,e[3]=o*h*c+n*l*u;break;case"yxz":e[0]=n*h*c+o*l*u,e[1]=o*l*c-n*h*u,e[2]=o*h*u-n*l*c,e[3]=o*h*c+n*l*u;break;case"yzx":e[0]=n*h*c+o*l*u,e[1]=o*l*c+n*h*u,e[2]=o*h*u-n*l*c,e[3]=o*h*c-n*l*u;break;case"zxy":e[0]=n*h*c-o*l*u,e[1]=o*l*c+n*h*u,e[2]=o*h*u+n*l*c,e[3]=o*h*c-n*l*u;break;case"zyx":e[0]=n*h*c-o*l*u,e[1]=o*l*c+n*h*u,e[2]=o*h*u-n*l*c,e[3]=o*h*c+n*l*u;break;default:throw new Error("Unknown angle order "+s)}return e},str$22=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},equals$22=function(e,t){return Math.abs(dot$32(e,t))>=1-EPSILON},create$12=function(){var e=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone$12=function(e){var t=new ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues$12=function(e,t,r,i,s,a,n,o){var l=new ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=s,l[5]=a,l[6]=n,l[7]=o,l},fromRotationTranslationValues2=function(e,t,r,i,s,a,n){var o=new ARRAY_TYPE(8),s=(o[0]=e,o[1]=t,o[2]=r,o[3]=i,.5*s),a=.5*a,n=.5*n;return o[4]=s*i+a*r-n*t,o[5]=a*i+n*e-s*r,o[6]=n*i+s*t-a*e,o[7]=-s*e-a*t-n*r,o},fromRotationTranslation2=function(e,t,r){var i=.5*r[0],s=.5*r[1],r=.5*r[2],a=t[0],n=t[1],o=t[2],t=t[3];return e[0]=a,e[1]=n,e[2]=o,e[3]=t,e[4]=i*t+s*o-r*n,e[5]=s*t+r*a-i*o,e[6]=r*t+i*n-s*a,e[7]=-i*a-s*n-r*o,e},fromTranslation2=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat42=function(e,t){var r=create$22(),i=(getRotation2(r,t),new ARRAY_TYPE(3));return getTranslation$12(i,t),fromRotationTranslation2(e,r,i),e},copy$12=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},identity2=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set$12=function(e,t,r,i,s,a,n,o,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=a,e[5]=n,e[6]=o,e[7]=l,e},getDual2=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setDual2=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation2=function(e,t){var r=t[4],i=t[5],s=t[6],a=t[7],n=-t[0],o=-t[1],l=-t[2],t=t[3];return e[0]=2*(r*t+a*n+i*l-s*o),e[1]=2*(i*t+a*o+s*n-r*l),e[2]=2*(s*t+a*l+r*o-i*n),e},translate2=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=.5*r[0],l=.5*r[1],r=.5*r[2],h=t[4],u=t[5],c=t[6],t=t[7];return e[0]=i,e[1]=s,e[2]=a,e[3]=n,e[4]=n*o+s*r-a*l+h,e[5]=n*l+a*o-i*r+u,e[6]=n*r+i*l-s*o+c,e[7]=-i*o-s*l-a*r+t,e},rotateX2=function(e,t,r){var i=-t[0],s=-t[1],a=-t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*n+u*i+l*a-h*s,_=l*n+u*s+h*i-o*a,d=h*n+u*a+o*s-l*i,u=u*n-o*i-l*s-h*a;return rotateX$12(e,t,r),i=e[0],e[4]=c*(n=e[3])+u*i+_*(a=e[2])-d*(s=e[1]),e[5]=_*n+u*s+d*i-c*a,e[6]=d*n+u*a+c*s-_*i,e[7]=u*n-c*i-_*s-d*a,e},rotateY2=function(e,t,r){var i=-t[0],s=-t[1],a=-t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*n+u*i+l*a-h*s,_=l*n+u*s+h*i-o*a,d=h*n+u*a+o*s-l*i,u=u*n-o*i-l*s-h*a;return rotateY$12(e,t,r),i=e[0],e[4]=c*(n=e[3])+u*i+_*(a=e[2])-d*(s=e[1]),e[5]=_*n+u*s+d*i-c*a,e[6]=d*n+u*a+c*s-_*i,e[7]=u*n-c*i-_*s-d*a,e},rotateZ2=function(e,t,r){var i=-t[0],s=-t[1],a=-t[2],n=t[3],o=t[4],l=t[5],h=t[6],u=t[7],c=o*n+u*i+l*a-h*s,_=l*n+u*s+h*i-o*a,d=h*n+u*a+o*s-l*i,u=u*n-o*i-l*s-h*a;return rotateZ$12(e,t,r),i=e[0],e[4]=c*(n=e[3])+u*i+_*(a=e[2])-d*(s=e[1]),e[5]=_*n+u*s+d*i-c*a,e[6]=d*n+u*a+c*s-_*i,e[7]=u*n-c*i-_*s-d*a,e},rotateByQuatAppend2=function(e,t,r){var i=r[0],s=r[1],a=r[2],r=r[3],n=t[0],o=t[1],l=t[2],h=t[3];return e[0]=n*r+h*i+o*a-l*s,e[1]=o*r+h*s+l*i-n*a,e[2]=l*r+h*a+n*s-o*i,e[3]=h*r-n*i-o*s-l*a,e[4]=(n=t[4])*r+(h=t[7])*i+(o=t[5])*a-(l=t[6])*s,e[5]=o*r+h*s+l*i-n*a,e[6]=l*r+h*a+n*s-o*i,e[7]=h*r-n*i-o*s-l*a,e},rotateByQuatPrepend2=function(e,t,r){var i=t[0],s=t[1],a=t[2],t=t[3],n=r[0],o=r[1],l=r[2],h=r[3];return e[0]=i*h+t*n+s*l-a*o,e[1]=s*h+t*o+a*n-i*l,e[2]=a*h+t*l+i*o-s*n,e[3]=t*h-i*n-s*o-a*l,e[4]=i*(h=r[7])+t*(n=r[4])+s*(l=r[6])-a*(o=r[5]),e[5]=s*h+t*o+a*n-i*l,e[6]=a*h+t*l+i*o-s*n,e[7]=t*h-i*n-s*o-a*l,e},rotateAroundAxis2=function(e,t,r,i){var s,a,n,o,l,h;return Math.abs(i)<EPSILON?copy$12(e,t):(h=Math.hypot(r[0],r[1],r[2]),i*=.5,s=(n=Math.sin(i))*r[0]/h,a=n*r[1]/h,n=n*r[2]/h,r=Math.cos(i),h=t[0],e[0]=h*r+(i=t[3])*s+(o=t[1])*n-(l=t[2])*a,e[1]=o*r+i*a+l*s-h*n,e[2]=l*r+i*n+h*a-o*s,e[3]=i*r-h*s-o*a-l*n,e[4]=(i=t[4])*r+(h=t[7])*s+(o=t[5])*n-(l=t[6])*a,e[5]=o*r+h*a+l*s-i*n,e[6]=l*r+h*n+i*a-o*s,e[7]=h*r-i*s-o*a-l*n,e)},add$12=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},multiply$12=function(e,t,r){var i=t[0],s=t[1],a=t[2],n=t[3],o=r[4],l=r[5],h=r[6],u=r[7],c=t[4],_=t[5],d=t[6],t=t[7],p=r[0],m=r[1],g=r[2],r=r[3];return e[0]=i*r+n*p+s*g-a*m,e[1]=s*r+n*m+a*p-i*g,e[2]=a*r+n*g+i*m-s*p,e[3]=n*r-i*p-s*m-a*g,e[4]=i*u+n*o+s*h-a*l+c*r+t*p+_*g-d*m,e[5]=s*u+n*l+a*o-i*h+_*r+t*m+d*p-c*g,e[6]=a*u+n*h+i*l-s*o+d*r+t*g+c*m-_*p,e[7]=n*u-i*o-s*l-a*h+t*r-c*p-_*m-d*g,e},scale$12=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},lerp$12=function(e,t,r,i){var s=1-i;return dot$1(t,r)<0&&(i=-i),e[0]=t[0]*s+r[0]*i,e[1]=t[1]*s+r[1]*i,e[2]=t[2]*s+r[2]*i,e[3]=t[3]*s+r[3]*i,e[4]=t[4]*s+r[4]*i,e[5]=t[5]*s+r[5]*i,e[6]=t[6]*s+r[6]*i,e[7]=t[7]*s+r[7]*i,e},invert2=function(e,t){var r=squaredLength$1(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},conjugate2=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},normalize$12=function(e,t){var r,i,s,a,n,o,l,h,u=squaredLength$1(t);return 0<u&&(u=Math.sqrt(u),h=(r=t[0]/u)*(n=t[4])+(i=t[1]/u)*(o=t[5])+(s=t[2]/u)*(l=t[6])+(a=t[3]/u)*(t=t[7]),e[0]=r,e[1]=i,e[2]=s,e[3]=a,e[4]=(n-r*h)/u,e[5]=(o-i*h)/u,e[6]=(l-s*h)/u,e[7]=(t-a*h)/u),e},str$12=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals$12=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals$12=function(e,t){var r=e[0],i=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],e=e[7],h=t[0],u=t[1],c=t[2],_=t[3],d=t[4],p=t[5],m=t[6],t=t[7];return Math.abs(r-h)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-u)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-_)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(n-d)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create2=function(){var e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e},clone2=function(e){var t=new ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},fromValues2=function(e,t){var r=new ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},copy2=function(e,t){return e[0]=t[0],e[1]=t[1],e},set2=function(e,t,r){return e[0]=t,e[1]=r,e},add2=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract2=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},multiply2=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},divide2=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},ceil2=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor2=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min2=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max2=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round2=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd2=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},distance2=function(e,t){var r=t[0]-e[0];return Math.hypot(r,t[1]-e[1])},squaredDistance2=function(e,t){var r=t[0]-e[0],t=t[1]-e[1];return r*r+t*t},length2=function(e){var t=e[0];return Math.hypot(t,e[1])},squaredLength2=function(e){var t=e[0],e=e[1];return t*t+e*e},negate2=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse2=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize2=function(e,t){var r=t[0],i=t[1],r=r*r+i*i;return 0<r&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},dot2=function(e,t){return e[0]*t[0]+e[1]*t[1]},cross2=function(e,t,r){t=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=t,e},lerp2=function(e,t,r,i){var s=t[0],t=t[1];return e[0]=s+i*(r[0]-s),e[1]=t+i*(r[1]-t),e},random2=function(e,t){t=t||1;var r=2*RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat22=function(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[2]*t,e[1]=r[1]*i+r[3]*t,e},transformMat2d2=function(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[2]*t+r[4],e[1]=r[1]*i+r[3]*t+r[5],e},transformMat32=function(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[3]*t+r[6],e[1]=r[1]*i+r[4]*t+r[7],e},transformMat42=function(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[4]*t+r[12],e[1]=r[1]*i+r[5]*t+r[13],e},rotate2=function(e,t,r,i){var s=t[0]-r[0],t=t[1]-r[1],a=Math.sin(i),i=Math.cos(i);return e[0]=s*i-t*a+r[0],e[1]=s*a+t*i+r[1],e},angle2=function(e,t){var r=e[0],e=e[1],i=t[0],t=t[1],s=Math.sqrt((r*r+e*e)*(i*i+t*t));return Math.acos(Math.min(Math.max(s&&(r*i+e*t)/s,-1),1))},zero2=function(e){return e[0]=0,e[1]=0,e},str2=function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals2=function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals2=function(e,t){var r=e[0],e=e[1],i=t[0],t=t[1];return Math.abs(r-i)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))};setMatrixArrayType=setMatrixArrayType2,toRadian=toRadian2,equals$9=equals$92,create$8=create$82,clone$8=clone$82,copy$8=copy$82,identity$5=identity$52,fromValues$8=fromValues$82,set$8=set$82,transpose$2=transpose$22,invert$5=invert$52,adjoint$2=adjoint$22,determinant$3=determinant$32,multiply$8=multiply$82,rotate$4=rotate$42,scale$8=scale$82,fromRotation$4=fromRotation$42,fromScaling$3=fromScaling$32,str$8=str$82,frob$3=frob$32,LDU=LDU2,add$8=add$82,subtract$6=subtract$62,exactEquals$8=exactEquals$82,equals$8=equals$82,multiplyScalar$3=multiplyScalar$32,multiplyScalarAndAdd$3=multiplyScalarAndAdd$32,create$7=create$72,clone$7=clone$72,copy$7=copy$72,identity$4=identity$42,fromValues$7=fromValues$72,set$7=set$72,invert$4=invert$42,determinant$2=determinant$22,multiply$7=multiply$72,rotate$3=rotate$32,scale$7=scale$72,translate$3=translate$32,fromRotation$3=fromRotation$32,fromScaling$2=fromScaling$22,fromTranslation$3=fromTranslation$32,str$7=str$72,frob$2=frob$22,add$7=add$72,subtract$5=subtract$52,multiplyScalar$2=multiplyScalar$22,multiplyScalarAndAdd$2=multiplyScalarAndAdd$22,exactEquals$7=exactEquals$72,equals$7=equals$72,create$6=create$62,fromMat4$1=fromMat4$12,clone$6=clone$62,copy$6=copy$62,fromValues$6=fromValues$62,set$6=set$62,identity$3=identity$32,transpose$1=transpose$12,invert$3=invert$32,adjoint$1=adjoint$12,determinant$1=determinant$12,multiply$6=multiply$62,translate$2=translate$22,rotate$2=rotate$22,scale$6=scale$62,fromTranslation$2=fromTranslation$22,fromRotation$2=fromRotation$22,fromScaling$1=fromScaling$12,fromMat2d=fromMat2d2,fromQuat$1=fromQuat$12,normalFromMat4=normalFromMat42,projection=projection2,str$6=str$62,frob$1=frob$12,add$6=add$62,subtract$4=subtract$42,multiplyScalar$1=multiplyScalar$12,multiplyScalarAndAdd$1=multiplyScalarAndAdd$12,exactEquals$6=exactEquals$62,equals$6=equals$62,create$5=create$52,clone$5=clone$52,copy$5=copy$52,fromValues$5=fromValues$52,set$5=set$52,identity$2=identity$22,transpose=transpose2,invert$2=invert$22,adjoint=adjoint2,determinant=determinant2,multiply$5=multiply$52,translate$1=translate$12,scale$5=scale$52,rotate$1=rotate$12,rotateX$3=rotateX$32,rotateY$3=rotateY$32,rotateZ$3=rotateZ$32,fromTranslation$1=fromTranslation$12,fromScaling=fromScaling2,fromRotation$1=fromRotation$12,fromXRotation=fromXRotation2,fromYRotation=fromYRotation2,fromZRotation=fromZRotation2,fromRotationTranslation$1=fromRotationTranslation$12,fromQuat2=fromQuat22,getTranslation$1=getTranslation$12,getScaling=getScaling2,getRotation=getRotation2,decompose=decompose2,fromRotationTranslationScale=fromRotationTranslationScale2,fromRotationTranslationScaleOrigin=fromRotationTranslationScaleOrigin2,fromQuat=fromQuat3,frustum=frustum2,perspectiveNO=perspectiveNO2,perspectiveZO=perspectiveZO2,perspectiveFromFieldOfView=perspectiveFromFieldOfView2,orthoNO=orthoNO2,orthoZO=orthoZO2,lookAt=lookAt2,targetTo=targetTo2,str$5=str$52,frob=frob2,add$5=add$52,subtract$3=subtract$32,multiplyScalar=multiplyScalar2,multiplyScalarAndAdd=multiplyScalarAndAdd2,exactEquals$5=exactEquals$52,equals$5=equals$52,create$4=create$42,clone$4=clone$42,length$4=length$42,fromValues$4=fromValues$42,copy$4=copy$42,set$4=set$42,add$4=add$42,subtract$2=subtract$22,multiply$4=multiply$42,divide$2=divide$22,ceil$2=ceil$22,floor$2=floor$22,min$2=min$22,max$2=max$22,round$2=round$22,scale$4=scale$42,scaleAndAdd$2=scaleAndAdd$22,distance$2=distance$22,squaredDistance$2=squaredDistance$22,squaredLength$4=squaredLength$42,negate$2=negate$22,inverse$2=inverse$22,normalize$4=normalize$42,dot$4=dot$42,cross$2=cross$22,lerp$4=lerp$42,slerp$1=slerp$12,hermite=hermite2,bezier=bezier2,random$3=random$32,transformMat4$2=transformMat4$22,transformMat3$1=transformMat3$12,transformQuat$1=transformQuat$12,rotateX$2=rotateX$22,rotateY$2=rotateY$22,rotateZ$2=rotateZ$22,angle$1=angle$12,zero$2=zero$22,str$4=str$42,exactEquals$4=exactEquals$42,equals$4=equals$42,create$3=create$32,clone$3=clone$32,fromValues$3=fromValues$32,copy$3=copy$32,set$3=set$32,add$3=add$32,subtract$1=subtract$12,multiply$3=multiply$32,divide$1=divide$12,ceil$1=ceil$12,floor$1=floor$12,min$1=min$12,max$1=max$12,round$1=round$12,scale$3=scale$32,scaleAndAdd$1=scaleAndAdd$12,distance$1=distance$12,squaredDistance$1=squaredDistance$12,length$3=length$32,squaredLength$3=squaredLength$32,negate$1=negate$12,inverse$1=inverse$12,normalize$3=normalize$32,dot$3=dot$32,cross$1=cross$12,lerp$3=lerp$32,random$2=random$22,transformMat4$1=transformMat4$12,transformQuat=transformQuat2,zero$1=zero$12,str$3=str$32,exactEquals$3=exactEquals$32,equals$3=equals$32,create$2=create$22,identity$1=identity$12,setAxisAngle=setAxisAngle2,getAxisAngle=getAxisAngle2,getAngle=getAngle2,multiply$2=multiply$22,rotateX$1=rotateX$12,rotateY$1=rotateY$12,rotateZ$1=rotateZ$12,calculateW=calculateW2,exp=exp2,ln=ln2,pow=pow2,slerp=slerp2,random$1=random$12,invert$1=invert$12,conjugate$1=conjugate$12,fromMat3=fromMat32,fromEuler=fromEuler2,str$2=str$22,equals$2=equals$22,create$1=create$12,clone$1=clone$12,fromValues$1=fromValues$12,fromRotationTranslationValues=fromRotationTranslationValues2,fromRotationTranslation=fromRotationTranslation2,fromTranslation=fromTranslation2,fromRotation=fromRotation2,fromMat4=fromMat42,copy$1=copy$12,identity=identity2,set$1=set$12,getDual=getDual2,setDual=setDual2,getTranslation=getTranslation2,translate=translate2,rotateX=rotateX2,rotateY=rotateY2,rotateZ=rotateZ2,rotateByQuatAppend=rotateByQuatAppend2,rotateByQuatPrepend=rotateByQuatPrepend2,rotateAroundAxis=rotateAroundAxis2,add$1=add$12,multiply$1=multiply$12,scale$1=scale$12,lerp$1=lerp$12,invert=invert2,conjugate=conjugate2,normalize$1=normalize$12,str$1=str$12,exactEquals$1=exactEquals$12,equals$1=equals$12,create=create2,clone=clone2,fromValues=fromValues2,copy=copy2,set=set2,add=add2,subtract=subtract2,multiply=multiply2,divide=divide2,ceil=ceil2,floor=floor2,min=min2,max=max2,round=round2,scale=scale2,scaleAndAdd=scaleAndAdd2,distance=distance2,squaredDistance=squaredDistance2,length=length2,squaredLength=squaredLength2,negate=negate2,inverse=inverse2,normalize=normalize2,dot=dot2,cross=cross2,lerp=lerp2,random=random2,transformMat2=transformMat22,transformMat2d=transformMat2d2,transformMat3=transformMat32,transformMat4=transformMat42,rotate=rotate2,angle=angle2,zero=zero2,str=str2,exactEquals=exactEquals2,equals=equals2,EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,RANDOM=Math.random,ANGLE_ORDER="zyx",degree=Math.PI/180,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),common={__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM:RANDOM,ANGLE_ORDER:ANGLE_ORDER,setMatrixArrayType:setMatrixArrayType2,toRadian:toRadian2,equals:equals$92},mul$8=multiply$82,sub$6=subtract$62,mat2=Object.freeze({__proto__:null,create:create$82,clone:clone$82,copy:copy$82,identity:identity$52,fromValues:fromValues$82,set:set$82,transpose:transpose$22,invert:invert$52,adjoint:adjoint$22,determinant:determinant$32,multiply:multiply$82,rotate:rotate$42,scale:scale$82,fromRotation:fromRotation$42,fromScaling:fromScaling$32,str:str$82,frob:frob$32,LDU:LDU2,add:add$82,subtract:subtract$62,exactEquals:exactEquals$82,equals:equals$82,multiplyScalar:multiplyScalar$32,multiplyScalarAndAdd:multiplyScalarAndAdd$32,mul:mul$8,sub:sub$6}),mul$7=multiply$72,sub$5=subtract$52,mat2d=Object.freeze({__proto__:null,create:create$72,clone:clone$72,copy:copy$72,identity:identity$42,fromValues:fromValues$72,set:set$72,invert:invert$42,determinant:determinant$22,multiply:multiply$72,rotate:rotate$32,scale:scale$72,translate:translate$32,fromRotation:fromRotation$32,fromScaling:fromScaling$22,fromTranslation:fromTranslation$32,str:str$72,frob:frob$22,add:add$72,subtract:subtract$52,multiplyScalar:multiplyScalar$22,multiplyScalarAndAdd:multiplyScalarAndAdd$22,exactEquals:exactEquals$72,equals:equals$72,mul:mul$7,sub:sub$5}),mul$6=multiply$62,sub$4=subtract$42,mat3=Object.freeze({__proto__:null,create:create$62,fromMat4:fromMat4$12,clone:clone$62,copy:copy$62,fromValues:fromValues$62,set:set$62,identity:identity$32,transpose:transpose$12,invert:invert$32,adjoint:adjoint$12,determinant:determinant$12,multiply:multiply$62,translate:translate$22,rotate:rotate$22,scale:scale$62,fromTranslation:fromTranslation$22,fromRotation:fromRotation$22,fromScaling:fromScaling$12,fromMat2d:fromMat2d2,fromQuat:fromQuat$12,normalFromMat4:normalFromMat42,projection:projection2,str:str$62,frob:frob$12,add:add$62,subtract:subtract$42,multiplyScalar:multiplyScalar$12,multiplyScalarAndAdd:multiplyScalarAndAdd$12,exactEquals:exactEquals$62,equals:equals$62,mul:mul$6,sub:sub$4}),perspective=perspectiveNO2,ortho=orthoNO2,mul$5=multiply$52,sub$3=subtract$32,mat4=Object.freeze({__proto__:null,create:create$52,clone:clone$52,copy:copy$52,fromValues:fromValues$52,set:set$52,identity:identity$22,transpose:transpose2,invert:invert$22,adjoint:adjoint2,determinant:determinant2,multiply:multiply$52,translate:translate$12,scale:scale$52,rotate:rotate$12,rotateX:rotateX$32,rotateY:rotateY$32,rotateZ:rotateZ$32,fromTranslation:fromTranslation$12,fromScaling:fromScaling2,fromRotation:fromRotation$12,fromXRotation:fromXRotation2,fromYRotation:fromYRotation2,fromZRotation:fromZRotation2,fromRotationTranslation:fromRotationTranslation$12,fromQuat2:fromQuat22,getTranslation:getTranslation$12,getScaling:getScaling2,getRotation:getRotation2,decompose:decompose2,fromRotationTranslationScale:fromRotationTranslationScale2,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin2,fromQuat:fromQuat3,frustum:frustum2,perspectiveNO:perspectiveNO2,perspective:perspective,perspectiveZO:perspectiveZO2,perspectiveFromFieldOfView:perspectiveFromFieldOfView2,orthoNO:orthoNO2,ortho:ortho,orthoZO:orthoZO2,lookAt:lookAt2,targetTo:targetTo2,str:str$52,frob:frob2,add:add$52,subtract:subtract$32,multiplyScalar:multiplyScalar2,multiplyScalarAndAdd:multiplyScalarAndAdd2,exactEquals:exactEquals$52,equals:equals$52,mul:mul$5,sub:sub$3}),sub$2=subtract$22,mul$4=multiply$42,div$2=divide$22,dist$2=distance$22,sqrDist$2=squaredDistance$22,len$4=length$42,sqrLen$4=squaredLength$42,forEach$2=(()=>{var l=create$42();return function(e,t,r,i,s,a){var n,o;for(t=t||3,r=r||0,o=i?Math.min(i*t+r,e.length):e.length,n=r;n<o;n+=t)l[0]=e[n],l[1]=e[n+1],l[2]=e[n+2],s(l,l,a),e[n]=l[0],e[n+1]=l[1],e[n+2]=l[2];return e}})(),vec3=Object.freeze({__proto__:null,create:create$42,clone:clone$42,length:length$42,fromValues:fromValues$42,copy:copy$42,set:set$42,add:add$42,subtract:subtract$22,multiply:multiply$42,divide:divide$22,ceil:ceil$22,floor:floor$22,min:min$22,max:max$22,round:round$22,scale:scale$42,scaleAndAdd:scaleAndAdd$22,distance:distance$22,squaredDistance:squaredDistance$22,squaredLength:squaredLength$42,negate:negate$22,inverse:inverse$22,normalize:normalize$42,dot:dot$42,cross:cross$22,lerp:lerp$42,slerp:slerp$12,hermite:hermite2,bezier:bezier2,random:random$32,transformMat4:transformMat4$22,transformMat3:transformMat3$12,transformQuat:transformQuat$12,rotateX:rotateX$22,rotateY:rotateY$22,rotateZ:rotateZ$22,angle:angle$12,zero:zero$22,str:str$42,exactEquals:exactEquals$42,equals:equals$42,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2}),sub$1=subtract$12,mul$3=multiply$32,div$1=divide$12,dist$1=distance$12,sqrDist$1=squaredDistance$12,len$3=length$32,sqrLen$3=squaredLength$32,forEach$1=(()=>{var l=create$32();return function(e,t,r,i,s,a){var n,o;for(t=t||4,r=r||0,o=i?Math.min(i*t+r,e.length):e.length,n=r;n<o;n+=t)l[0]=e[n],l[1]=e[n+1],l[2]=e[n+2],l[3]=e[n+3],s(l,l,a),e[n]=l[0],e[n+1]=l[1],e[n+2]=l[2],e[n+3]=l[3];return e}})(),vec4=Object.freeze({__proto__:null,create:create$32,clone:clone$32,fromValues:fromValues$32,copy:copy$32,set:set$32,add:add$32,subtract:subtract$12,multiply:multiply$32,divide:divide$12,ceil:ceil$12,floor:floor$12,min:min$12,max:max$12,round:round$12,scale:scale$32,scaleAndAdd:scaleAndAdd$12,distance:distance$12,squaredDistance:squaredDistance$12,length:length$32,squaredLength:squaredLength$32,negate:negate$12,inverse:inverse$12,normalize:normalize$32,dot:dot$32,cross:cross$12,lerp:lerp$32,random:random$22,transformMat4:transformMat4$12,transformQuat:transformQuat2,zero:zero$12,str:str$32,exactEquals:exactEquals$32,equals:equals$32,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1}),clone$2=clone$32,fromValues$2=fromValues$32,copy$2=copy$32,set$2=set$32,add$2=add$32,mul$2=multiply$22,scale$2=scale$32,dot$2=dot$32,lerp$2=lerp$32,length$2=length$32,len$2=length$2,squaredLength$2=squaredLength$32,sqrLen$2=squaredLength$2,normalize$2=normalize$32,exactEquals$2=exactEquals$32,rotationTo=(()=>{var s=create$42(),a=fromValues$42(1,0,0),n=fromValues$42(0,1,0);return function(e,t,r){var i=dot$42(t,r);return i<-.999999?(cross$22(s,a,t),len$4(s)<1e-6&&cross$22(s,n,t),normalize$42(s,s),setAxisAngle2(e,s,Math.PI),e):.999999<i?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(cross$22(s,t,r),e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=1+i,normalize$2(e,e))}})(),sqlerp=(()=>{var n=create$22(),o=create$22();return function(e,t,r,i,s,a){return slerp2(n,t,s,a),slerp2(o,r,i,a),slerp2(e,n,o,2*a*(1-a)),e}})(),setAxes=(()=>{var s=create$62();return function(e,t,r,i){return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],normalize$2(e,fromMat32(e,s))}})(),quat=Object.freeze({__proto__:null,create:create$22,identity:identity$12,setAxisAngle:setAxisAngle2,getAxisAngle:getAxisAngle2,getAngle:getAngle2,multiply:multiply$22,rotateX:rotateX$12,rotateY:rotateY$12,rotateZ:rotateZ$12,calculateW:calculateW2,exp:exp2,ln:ln2,pow:pow2,slerp:slerp2,random:random$12,invert:invert$12,conjugate:conjugate$12,fromMat3:fromMat32,fromEuler:fromEuler2,str:str$22,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$22,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes}),getReal=copy$2,setReal=copy$2,mul$1=multiply$12,dot$1=dot$2,length$1=length$2,len$1=length$1,squaredLength$1=squaredLength$2,sqrLen$1=squaredLength$1,quat2=Object.freeze({__proto__:null,create:create$12,clone:clone$12,fromValues:fromValues$12,fromRotationTranslationValues:fromRotationTranslationValues2,fromRotationTranslation:fromRotationTranslation2,fromTranslation:fromTranslation2,fromRotation:fromRotation2,fromMat4:fromMat42,copy:copy$12,identity:identity2,set:set$12,getReal:getReal,getDual:getDual2,setReal:setReal,setDual:setDual2,getTranslation:getTranslation2,translate:translate2,rotateX:rotateX2,rotateY:rotateY2,rotateZ:rotateZ2,rotateByQuatAppend:rotateByQuatAppend2,rotateByQuatPrepend:rotateByQuatPrepend2,rotateAroundAxis:rotateAroundAxis2,add:add$12,multiply:multiply$12,mul:mul$1,scale:scale$12,dot:dot$1,lerp:lerp$12,invert:invert2,conjugate:conjugate2,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$12,str:str$12,exactEquals:exactEquals$12,equals:equals$12}),len=length2,sub=subtract2,mul=multiply2,div=divide2,dist=distance2,sqrDist=squaredDistance2,sqrLen=squaredLength2,forEach=(()=>{var l=create2();return function(e,t,r,i,s,a){var n,o;for(t=t||2,r=r||0,o=i?Math.min(i*t+r,e.length):e.length,n=r;n<o;n+=t)l[0]=e[n],l[1]=e[n+1],s(l,l,a),e[n]=l[0],e[n+1]=l[1];return e}})(),vec2=Object.freeze({__proto__:null,create:create2,clone:clone2,fromValues:fromValues2,copy:copy2,set:set2,add:add2,subtract:subtract2,multiply:multiply2,divide:divide2,ceil:ceil2,floor:floor2,min:min2,max:max2,round:round2,scale:scale2,scaleAndAdd:scaleAndAdd2,distance:distance2,squaredDistance:squaredDistance2,length:length2,squaredLength:squaredLength2,negate:negate2,inverse:inverse2,normalize:normalize2,dot:dot2,cross:cross2,lerp:lerp2,random:random2,transformMat2:transformMat22,transformMat2d:transformMat2d2,transformMat3:transformMat32,transformMat4:transformMat42,rotate:rotate2,angle:angle2,zero:zero2,str:str2,exactEquals:exactEquals2,equals:equals2,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach}),globalThis.glMatrix=common,globalThis.glMatrix.mat2=mat2,globalThis.glMatrix.mat2d=mat2d,globalThis.glMatrix.mat3=mat3,globalThis.glMatrix.mat4=mat4,globalThis.glMatrix.quat=quat,globalThis.glMatrix.quat2=quat2,globalThis.glMatrix.vec2=vec2,globalThis.glMatrix.vec3=vec3,globalThis.glMatrix.vec4=vec4}var EPSILON,ARRAY_TYPE,RANDOM,ANGLE_ORDER,degree,common,mul$8,sub$6,mat2,mul$7,sub$5,mat2d,mul$6,sub$4,mat3,perspective,ortho,mul$5,sub$3,mat4,sub$2,mul$4,div$2,dist$2,sqrDist$2,len$4,sqrLen$4,forEach$2,vec3,sub$1,mul$3,div$1,dist$1,sqrDist$1,len$3,sqrLen$3,forEach$1,vec4,clone$2,fromValues$2,copy$2,set$2,add$2,mul$2,scale$2,dot$2,lerp$2,length$2,len$2,squaredLength$2,sqrLen$2,normalize$2,exactEquals$2,rotationTo,sqlerp,setAxes,quat,getReal,setReal,mul$1,dot$1,length$1,len$1,squaredLength$1,sqrLen$1,quat2,len,sub,mul,div,dist,sqrDist,sqrLen,forEach,vec2,setMatrixArrayType,toRadian,equals$9,create$8,clone$8,copy$8,identity$5,fromValues$8,set$8,transpose$2,invert$5,adjoint$2,determinant$3,multiply$8,rotate$4,scale$8,fromRotation$4,fromScaling$3,str$8,frob$3,LDU,add$8,subtract$6,exactEquals$8,equals$8,multiplyScalar$3,multiplyScalarAndAdd$3,create$7,clone$7,copy$7,identity$4,fromValues$7,set$7,invert$4,determinant$2,multiply$7,rotate$3,scale$7,translate$3,fromRotation$3,fromScaling$2,fromTranslation$3,str$7,frob$2,add$7,subtract$5,multiplyScalar$2,multiplyScalarAndAdd$2,exactEquals$7,equals$7,create$6,fromMat4$1,clone$6,copy$6,fromValues$6,set$6,identity$3,transpose$1,invert$3,adjoint$1,determinant$1,multiply$6,translate$2,rotate$2,scale$6,fromTranslation$2,fromRotation$2,fromScaling$1,fromMat2d,fromQuat$1,normalFromMat4,projection,str$6,frob$1,add$6,subtract$4,multiplyScalar$1,multiplyScalarAndAdd$1,exactEquals$6,equals$6,create$5,clone$5,copy$5,fromValues$5,set$5,identity$2,transpose,invert$2,adjoint,determinant,multiply$5,translate$1,scale$5,rotate$1,rotateX$3,rotateY$3,rotateZ$3,fromTranslation$1,fromScaling,fromRotation$1,fromXRotation,fromYRotation,fromZRotation,fromRotationTranslation$1,fromQuat2,getTranslation$1,getScaling,getRotation,decompose,fromRotationTranslationScale,fromRotationTranslationScaleOrigin,fromQuat,frustum,perspectiveNO,perspectiveZO,perspectiveFromFieldOfView,orthoNO,orthoZO,lookAt,targetTo,str$5,frob,add$5,subtract$3,multiplyScalar,multiplyScalarAndAdd,exactEquals$5,equals$5,create$4,clone$4,length$4,fromValues$4,copy$4,set$4,add$4,subtract$2,multiply$4,divide$2,ceil$2,floor$2,min$2,max$2,round$2,scale$4,scaleAndAdd$2,distance$2,squaredDistance$2,squaredLength$4,negate$2,inverse$2,normalize$4,dot$4,cross$2,lerp$4,slerp$1,hermite,bezier,random$3,transformMat4$2,transformMat3$1,transformQuat$1,rotateX$2,rotateY$2,rotateZ$2,angle$1,zero$2,str$4,exactEquals$4,equals$4,create$3,clone$3,fromValues$3,copy$3,set$3,add$3,subtract$1,multiply$3,divide$1,ceil$1,floor$1,min$1,max$1,round$1,scale$3,scaleAndAdd$1,distance$1,squaredDistance$1,length$3,squaredLength$3,negate$1,inverse$1,normalize$3,dot$3,cross$1,lerp$3,random$2,transformMat4$1,transformQuat,zero$1,str$3,exactEquals$3,equals$3,create$2,identity$1,setAxisAngle,getAxisAngle,getAngle,multiply$2,rotateX$1,rotateY$1,rotateZ$1,calculateW,exp,ln,pow,slerp,random$1,invert$1,conjugate$1,fromMat3,fromEuler,str$2,equals$2,create$1,clone$1,fromValues$1,fromRotationTranslationValues,fromRotationTranslation,fromTranslation,fromRotation,fromMat4,copy$1,identity,set$1,getDual,setDual,getTranslation,translate,rotateX,rotateY,rotateZ,rotateByQuatAppend,rotateByQuatPrepend,rotateAroundAxis,add$1,multiply$1,scale$1,lerp$1,invert,conjugate,normalize$1,str$1,exactEquals$1,equals$1,create,clone,fromValues,copy,set,add,subtract,multiply,divide,ceil,floor,min,max,round,scale,scaleAndAdd,distance,squaredDistance,length,squaredLength,negate,inverse,normalize,dot,cross,lerp,random,transformMat2,transformMat2d,transformMat3,transformMat4,rotate,angle,zero,str,exactEquals,equals,GraphemeSplitter,tmpPoint1,tmpPoint2,tmpLine1,tmpLine2,lineInt,lineSegmentsIntersect,triangleArea,isLeft,isLeftOn,isRight,isRightOn,collinear,sqdist,polygonAt,polygonClear,polygonAppend,polygonMakeCCW,polygonReverse,polygonIsReflex,polygonCanSee,polygonCanSee2,polygonCopy,polygonGetCutEdges,polygonDecomp,polygonSlice,polygonIsSimple,getIntersectionPoint,polygonQuickDecomp,polygonRemoveCollinearPoints,polygonRemoveDuplicatePoints,scalar_eq,points_eq,ReadBrandList,RunTest,GetWindowsNTVersionName,asyncifyRequest,asyncifyTransaction,openReadOnlyTransaction,openWriteTransaction,lazyOpenDatabase,RequireString,getEntriesFromCursor,NOT_IMPLEMENTED,DISALLOW_CALLBACK,StructuredClone,arrayFlat,assertFail,isValidTypeChange,logDefendedObjectWarning,CheckDefendedObjectsUsedCorrectly,getObjectPropertySet,VerifyObjectPropertiesConsistent,isNegativeZero,padTwoDigits,hueToRGB,RequireStringOrNumber,SetNewCallback,DoAsyncifiedWork,DoNextAsyncifiedJob,ClearTimeCache,CheckActiveIdleTimeouts,lookupHtmlEntity,bbToHtmlReplacerFunc,IsWordBreakWhiteSpace,IsOpeningCJKPunctiationChar,IsContinuingCJKPunctuationChar,WordBreakTrimEnd,IsNewline,PlaneFromPoints,IsInFrontOfPlane,IsPointInFrontOfPlane,interpolateQuad,GetFormatSpecifiers,fillOrStrokeRect,ptToPx,getOffsetParam,CheckPendingPolls,SortZOrderList,GetDispatcher,MakeIWorldInstanceClass,GetDispatcher,GetTimelineState,GetTimelineState,GetTweenState,getActual,GetTypeFromFileExtension,AddScript,SortByInstLastCachedZIndex,SortByInstLastCachedZIndex,SortByInstZElevation,vec3EqualsXYZ,MaybePrepareLayerDraw,SortSolArray,IsSolArrayIdentical,NoActions,WrapIndex,GetExpressionFunc,EvalParams,EvalParams,GetInst,GetWorldInfo,CompareX,CompareY,IsOnScreen,IsOutsideLayout,PickDistance,SetX,SetY,SetPos,SetPosToObject,MoveForward,MoveAtAngle,GetX,GetY,GetDt,CompareWidth,CompareHeight,SetWidth,SetHeight,SetSize,GetWidth,GetHeight,GetBboxLeft,GetBboxTop,GetBboxRight,GetBboxBottom,GetBboxMidX,GetBboxMidY,IsAngleWithin,IsAngleClockwiseFrom,IsBetweenAngles,SetAngle,RotateClockwise,RotateCounterclockwise,RotateTowardAngle,RotateTowardPosition,SetTowardPosition,GetAngle,CompareOpacity,IsVisible,SetVisible,SetOpacity,SetDefaultColor,GetColor,GetOpacity,IsOnLayer,PickTopBottom,CompareZElevation,MoveToTop,MoveToBottom,MoveToLayer,ZMoveToObject,SetZElevation,LayerNumber,LayerName,ZIndex,ZElevation,TotalZElevation,IsEffectEnabled,SetEffectEnabled,SetEffectParam,CollMemory_Add,CollMemory_Remove,CollMemory_RemoveInstance,CollMemory_Get,DoOverlapCondition,FinishCollisionConditionPicking,FinishCollisionCondition,OnCollision,IsOverlapping,IsOverlappingOffset,HasParent,HasChildren,PickParent,PickChildren,PickNthChild,CompareChildCount,AddChild,RemoveChild,RemoveFromParent,ChildCount,AllChildCount,SetMeshSize,SetMeshPoint,MeshColumns,MeshRows,SetElementVisible,SetElementCSSStyle,SetElementAttribute,RemoveElementAttribute,SetElementFocus,SetElementBlur,IsElementFocused,SetElementEnabled,IsElementEnabled,CompareInstanceVar,IsBoolInstanceVarSet,PickInstVarHiLow,PickByUID,PickByUID_Normal,PickByUID_Inverted,HasTags,Tags,TagsCount,TagAt,ChangeTags,Destroy,OnCreated,OnDestroyed,SetInstanceVar,AddInstanceVar,SubInstanceVar,SetBoolInstanceVar,ToggleBoolInstanceVar,LoadFromJsonString,AsJSON,ObjectTypeName,Count,PickedCount,GetIID,GetUID,OnInstanceSignal,InstanceSignal,InstanceWaitForSignal,TemplateName,GetNextParamMap,ValidateInternalAPIToken,ForEachOrdered_SortInstances,SortZOrderList,SortInstancesByValue,ResizeArray,DoForEachTrigger,CompareValues,GetKeyboardSdkInstance,StringFromCharCode,GetTouchSdkInstance,IsExpressionType,GetAudioSdkInstance,GetAudioDOMInterface,GetTCInst,GetTimelineParameter,ValidateTags,WrapModeToStr,GetParticleEngine,randomOffset,getIndexForEase,ValidateTags,accelerate,unaryminus,bothNumbers,add,subtract,multiply,divide,mod,pow,and,or;{let GraphemeSplitter2=function(){function c(e,t){var r,i=e.charCodeAt(t=void 0===t?0:t);return 55296<=i&&i<=56319&&t<e.length-1?(r=i,56320<=(e=e.charCodeAt(t+1))&&e<=57343?1024*(r-55296)+(e-56320)+65536:r):56320<=i&&i<=57343&&1<=t?(r=e.charCodeAt(t-1),e=i,55296<=r&&r<=56319?1024*(r-55296)+(e-56320)+65536:e):i}function _(e){return 1536<=e&&e<=1541||1757==e||1807==e||2274==e||3406==e||69821==e||70082<=e&&e<=70083||72250==e||72326<=e&&e<=72329||73030==e?12:13==e?0:10==e?1:0<=e&&e<=9||11<=e&&e<=12||14<=e&&e<=31||127<=e&&e<=159||173==e||1564==e||6158==e||8203==e||8206<=e&&e<=8207||8232==e||8233==e||8234<=e&&e<=8238||8288<=e&&e<=8292||8293==e||8294<=e&&e<=8303||55296<=e&&e<=57343||65279==e||65520<=e&&e<=65528||65529<=e&&e<=65531||113824<=e&&e<=113827||119155<=e&&e<=119162||917504==e||917505==e||917506<=e&&e<=917535||917632<=e&&e<=917759||918e3<=e&&e<=921599?2:768<=e&&e<=879||1155<=e&&e<=1159||1160<=e&&e<=1161||1425<=e&&e<=1469||1471==e||1473<=e&&e<=1474||1476<=e&&e<=1477||1479==e||1552<=e&&e<=1562||1611<=e&&e<=1631||1648==e||1750<=e&&e<=1756||1759<=e&&e<=1764||1767<=e&&e<=1768||1770<=e&&e<=1773||1809==e||1840<=e&&e<=1866||1958<=e&&e<=1968||2027<=e&&e<=2035||2070<=e&&e<=2073||2075<=e&&e<=2083||2085<=e&&e<=2087||2089<=e&&e<=2093||2137<=e&&e<=2139||2260<=e&&e<=2273||2275<=e&&e<=2306||2362==e||2364==e||2369<=e&&e<=2376||2381==e||2385<=e&&e<=2391||2402<=e&&e<=2403||2433==e||2492==e||2494==e||2497<=e&&e<=2500||2509==e||2519==e||2530<=e&&e<=2531||2561<=e&&e<=2562||2620==e||2625<=e&&e<=2626||2631<=e&&e<=2632||2635<=e&&e<=2637||2641==e||2672<=e&&e<=2673||2677==e||2689<=e&&e<=2690||2748==e||2753<=e&&e<=2757||2759<=e&&e<=2760||2765==e||2786<=e&&e<=2787||2810<=e&&e<=2815||2817==e||2876==e||2878==e||2879==e||2881<=e&&e<=2884||2893==e||2902==e||2903==e||2914<=e&&e<=2915||2946==e||3006==e||3008==e||3021==e||3031==e||3072==e||3134<=e&&e<=3136||3142<=e&&e<=3144||3146<=e&&e<=3149||3157<=e&&e<=3158||3170<=e&&e<=3171||3201==e||3260==e||3263==e||3266==e||3270==e||3276<=e&&e<=3277||3285<=e&&e<=3286||3298<=e&&e<=3299||3328<=e&&e<=3329||3387<=e&&e<=3388||3390==e||3393<=e&&e<=3396||3405==e||3415==e||3426<=e&&e<=3427||3530==e||3535==e||3538<=e&&e<=3540||3542==e||3551==e||3633==e||3636<=e&&e<=3642||3655<=e&&e<=3662||3761==e||3764<=e&&e<=3769||3771<=e&&e<=3772||3784<=e&&e<=3789||3864<=e&&e<=3865||3893==e||3895==e||3897==e||3953<=e&&e<=3966||3968<=e&&e<=3972||3974<=e&&e<=3975||3981<=e&&e<=3991||3993<=e&&e<=4028||4038==e||4141<=e&&e<=4144||4146<=e&&e<=4151||4153<=e&&e<=4154||4157<=e&&e<=4158||4184<=e&&e<=4185||4190<=e&&e<=4192||4209<=e&&e<=4212||4226==e||4229<=e&&e<=4230||4237==e||4253==e||4957<=e&&e<=4959||5906<=e&&e<=5908||5938<=e&&e<=5940||5970<=e&&e<=5971||6002<=e&&e<=6003||6068<=e&&e<=6069||6071<=e&&e<=6077||6086==e||6089<=e&&e<=6099||6109==e||6155<=e&&e<=6157||6277<=e&&e<=6278||6313==e||6432<=e&&e<=6434||6439<=e&&e<=6440||6450==e||6457<=e&&e<=6459||6679<=e&&e<=6680||6683==e||6742==e||6744<=e&&e<=6750||6752==e||6754==e||6757<=e&&e<=6764||6771<=e&&e<=6780||6783==e||6832<=e&&e<=6845||6846==e||6912<=e&&e<=6915||6964==e||6966<=e&&e<=6970||6972==e||6978==e||7019<=e&&e<=7027||7040<=e&&e<=7041||7074<=e&&e<=7077||7080<=e&&e<=7081||7083<=e&&e<=7085||7142==e||7144<=e&&e<=7145||7149==e||7151<=e&&e<=7153||7212<=e&&e<=7219||7222<=e&&e<=7223||7376<=e&&e<=7378||7380<=e&&e<=7392||7394<=e&&e<=7400||7405==e||7412==e||7416<=e&&e<=7417||7616<=e&&e<=7673||7675<=e&&e<=7679||8204==e||8400<=e&&e<=8412||8413<=e&&e<=8416||8417==e||8418<=e&&e<=8420||8421<=e&&e<=8432||11503<=e&&e<=11505||11647==e||11744<=e&&e<=11775||12330<=e&&e<=12333||12334<=e&&e<=12335||12441<=e&&e<=12442||42607==e||42608<=e&&e<=42610||42612<=e&&e<=42621||42654<=e&&e<=42655||42736<=e&&e<=42737||43010==e||43014==e||43019==e||43045<=e&&e<=43046||43204<=e&&e<=43205||43232<=e&&e<=43249||43302<=e&&e<=43309||43335<=e&&e<=43345||43392<=e&&e<=43394||43443==e||43446<=e&&e<=43449||43452==e||43493==e||43561<=e&&e<=43566||43569<=e&&e<=43570||43573<=e&&e<=43574||43587==e||43596==e||43644==e||43696==e||43698<=e&&e<=43700||43703<=e&&e<=43704||43710<=e&&e<=43711||43713==e||43756<=e&&e<=43757||43766==e||44005==e||44008==e||44013==e||64286==e||65024<=e&&e<=65039||65056<=e&&e<=65071||65438<=e&&e<=65439||66045==e||66272==e||66422<=e&&e<=66426||68097<=e&&e<=68099||68101<=e&&e<=68102||68108<=e&&e<=68111||68152<=e&&e<=68154||68159==e||68325<=e&&e<=68326||69633==e||69688<=e&&e<=69702||69759<=e&&e<=69761||69811<=e&&e<=69814||69817<=e&&e<=69818||69888<=e&&e<=69890||69927<=e&&e<=69931||69933<=e&&e<=69940||70003==e||70016<=e&&e<=70017||70070<=e&&e<=70078||70090<=e&&e<=70092||70191<=e&&e<=70193||70196==e||70198<=e&&e<=70199||70206==e||70367==e||70371<=e&&e<=70378||70400<=e&&e<=70401||70460==e||70462==e||70464==e||70487==e||70502<=e&&e<=70508||70512<=e&&e<=70516||70712<=e&&e<=70719||70722<=e&&e<=70724||70726==e||70832==e||70835<=e&&e<=70840||70842==e||70845==e||70847<=e&&e<=70848||70850<=e&&e<=70851||71087==e||71090<=e&&e<=71093||71100<=e&&e<=71101||71103<=e&&e<=71104||71132<=e&&e<=71133||71219<=e&&e<=71226||71229==e||71231<=e&&e<=71232||71339==e||71341==e||71344<=e&&e<=71349||71351==e||71453<=e&&e<=71455||71458<=e&&e<=71461||71463<=e&&e<=71467||72193<=e&&e<=72198||72201<=e&&e<=72202||72243<=e&&e<=72248||72251<=e&&e<=72254||72263==e||72273<=e&&e<=72278||72281<=e&&e<=72283||72330<=e&&e<=72342||72344<=e&&e<=72345||72752<=e&&e<=72758||72760<=e&&e<=72765||72767==e||72850<=e&&e<=72871||72874<=e&&e<=72880||72882<=e&&e<=72883||72885<=e&&e<=72886||73009<=e&&e<=73014||73018==e||73020<=e&&e<=73021||73023<=e&&e<=73029||73031==e||92912<=e&&e<=92916||92976<=e&&e<=92982||94095<=e&&e<=94098||113821<=e&&e<=113822||119141==e||119143<=e&&e<=119145||119150<=e&&e<=119154||119163<=e&&e<=119170||119173<=e&&e<=119179||119210<=e&&e<=119213||119362<=e&&e<=119364||121344<=e&&e<=121398||121403<=e&&e<=121452||121461==e||121476==e||121499<=e&&e<=121503||121505<=e&&e<=121519||122880<=e&&e<=122886||122888<=e&&e<=122904||122907<=e&&e<=122913||122915<=e&&e<=122916||122918<=e&&e<=122922||125136<=e&&e<=125142||125252<=e&&e<=125258||917536<=e&&e<=917631||917760<=e&&e<=917999?3:127462<=e&&e<=127487?4:2307==e||2363==e||2366<=e&&e<=2368||2377<=e&&e<=2380||2382<=e&&e<=2383||2434<=e&&e<=2435||2495<=e&&e<=2496||2503<=e&&e<=2504||2507<=e&&e<=2508||2563==e||2622<=e&&e<=2624||2691==e||2750<=e&&e<=2752||2761==e||2763<=e&&e<=2764||2818<=e&&e<=2819||2880==e||2887<=e&&e<=2888||2891<=e&&e<=2892||3007==e||3009<=e&&e<=3010||3014<=e&&e<=3016||3018<=e&&e<=3020||3073<=e&&e<=3075||3137<=e&&e<=3140||3202<=e&&e<=3203||3262==e||3264<=e&&e<=3265||3267<=e&&e<=3268||3271<=e&&e<=3272||3274<=e&&e<=3275||3330<=e&&e<=3331||3391<=e&&e<=3392||3398<=e&&e<=3400||3402<=e&&e<=3404||3458<=e&&e<=3459||3536<=e&&e<=3537||3544<=e&&e<=3550||3570<=e&&e<=3571||3635==e||3763==e||3902<=e&&e<=3903||3967==e||4145==e||4155<=e&&e<=4156||4182<=e&&e<=4183||4228==e||6070==e||6078<=e&&e<=6085||6087<=e&&e<=6088||6435<=e&&e<=6438||6441<=e&&e<=6443||6448<=e&&e<=6449||6451<=e&&e<=6456||6681<=e&&e<=6682||6741==e||6743==e||6765<=e&&e<=6770||6916==e||6965==e||6971==e||6973<=e&&e<=6977||6979<=e&&e<=6980||7042==e||7073==e||7078<=e&&e<=7079||7082==e||7143==e||7146<=e&&e<=7148||7150==e||7154<=e&&e<=7155||7204<=e&&e<=7211||7220<=e&&e<=7221||7393==e||7410<=e&&e<=7411||7415==e||43043<=e&&e<=43044||43047==e||43136<=e&&e<=43137||43188<=e&&e<=43203||43346<=e&&e<=43347||43395==e||43444<=e&&e<=43445||43450<=e&&e<=43451||43453<=e&&e<=43456||43567<=e&&e<=43568||43571<=e&&e<=43572||43597==e||43755==e||43758<=e&&e<=43759||43765==e||44003<=e&&e<=44004||44006<=e&&e<=44007||44009<=e&&e<=44010||44012==e||69632==e||69634==e||69762==e||69808<=e&&e<=69810||69815<=e&&e<=69816||69932==e||70018==e||70067<=e&&e<=70069||70079<=e&&e<=70080||70188<=e&&e<=70190||70194<=e&&e<=70195||70197==e||70368<=e&&e<=70370||70402<=e&&e<=70403||70463==e||70465<=e&&e<=70468||70471<=e&&e<=70472||70475<=e&&e<=70477||70498<=e&&e<=70499||70709<=e&&e<=70711||70720<=e&&e<=70721||70725==e||70833<=e&&e<=70834||70841==e||70843<=e&&e<=70844||70846==e||70849==e||71088<=e&&e<=71089||71096<=e&&e<=71099||71102==e||71216<=e&&e<=71218||71227<=e&&e<=71228||71230==e||71340==e||71342<=e&&e<=71343||71350==e||71456<=e&&e<=71457||71462==e||72199<=e&&e<=72200||72249==e||72279<=e&&e<=72280||72343==e||72751==e||72766==e||72873==e||72881==e||72884==e||94033<=e&&e<=94078||119142==e||119149==e?5:4352<=e&&e<=4447||43360<=e&&e<=43388?6:4448<=e&&e<=4519||55216<=e&&e<=55238?7:4520<=e&&e<=4607||55243<=e&&e<=55291?8:44032==e||44060==e||44088==e||44116==e||44144==e||44172==e||44200==e||44228==e||44256==e||44284==e||44312==e||44340==e||44368==e||44396==e||44424==e||44452==e||44480==e||44508==e||44536==e||44564==e||44592==e||44620==e||44648==e||44676==e||44704==e||44732==e||44760==e||44788==e||44816==e||44844==e||44872==e||44900==e||44928==e||44956==e||44984==e||45012==e||45040==e||45068==e||45096==e||45124==e||45152==e||45180==e||45208==e||45236==e||45264==e||45292==e||45320==e||45348==e||45376==e||45404==e||45432==e||45460==e||45488==e||45516==e||45544==e||45572==e||45600==e||45628==e||45656==e||45684==e||45712==e||45740==e||45768==e||45796==e||45824==e||45852==e||45880==e||45908==e||45936==e||45964==e||45992==e||46020==e||46048==e||46076==e||46104==e||46132==e||46160==e||46188==e||46216==e||46244==e||46272==e||46300==e||46328==e||46356==e||46384==e||46412==e||46440==e||46468==e||46496==e||46524==e||46552==e||46580==e||46608==e||46636==e||46664==e||46692==e||46720==e||46748==e||46776==e||46804==e||46832==e||46860==e||46888==e||46916==e||46944==e||46972==e||47e3==e||47028==e||47056==e||47084==e||47112==e||47140==e||47168==e||47196==e||47224==e||47252==e||47280==e||47308==e||47336==e||47364==e||47392==e||47420==e||47448==e||47476==e||47504==e||47532==e||47560==e||47588==e||47616==e||47644==e||47672==e||47700==e||47728==e||47756==e||47784==e||47812==e||47840==e||47868==e||47896==e||47924==e||47952==e||47980==e||48008==e||48036==e||48064==e||48092==e||48120==e||48148==e||48176==e||48204==e||48232==e||48260==e||48288==e||48316==e||48344==e||48372==e||48400==e||48428==e||48456==e||48484==e||48512==e||48540==e||48568==e||48596==e||48624==e||48652==e||48680==e||48708==e||48736==e||48764==e||48792==e||48820==e||48848==e||48876==e||48904==e||48932==e||48960==e||48988==e||49016==e||49044==e||49072==e||49100==e||49128==e||49156==e||49184==e||49212==e||49240==e||49268==e||49296==e||49324==e||49352==e||49380==e||49408==e||49436==e||49464==e||49492==e||49520==e||49548==e||49576==e||49604==e||49632==e||49660==e||49688==e||49716==e||49744==e||49772==e||49800==e||49828==e||49856==e||49884==e||49912==e||49940==e||49968==e||49996==e||50024==e||50052==e||50080==e||50108==e||50136==e||50164==e||50192==e||50220==e||50248==e||50276==e||50304==e||50332==e||50360==e||50388==e||50416==e||50444==e||50472==e||50500==e||50528==e||50556==e||50584==e||50612==e||50640==e||50668==e||50696==e||50724==e||50752==e||50780==e||50808==e||50836==e||50864==e||50892==e||50920==e||50948==e||50976==e||51004==e||51032==e||51060==e||51088==e||51116==e||51144==e||51172==e||51200==e||51228==e||51256==e||51284==e||51312==e||51340==e||51368==e||51396==e||51424==e||51452==e||51480==e||51508==e||51536==e||51564==e||51592==e||51620==e||51648==e||51676==e||51704==e||51732==e||51760==e||51788==e||51816==e||51844==e||51872==e||51900==e||51928==e||51956==e||51984==e||52012==e||52040==e||52068==e||52096==e||52124==e||52152==e||52180==e||52208==e||52236==e||52264==e||52292==e||52320==e||52348==e||52376==e||52404==e||52432==e||52460==e||52488==e||52516==e||52544==e||52572==e||52600==e||52628==e||52656==e||52684==e||52712==e||52740==e||52768==e||52796==e||52824==e||52852==e||52880==e||52908==e||52936==e||52964==e||52992==e||53020==e||53048==e||53076==e||53104==e||53132==e||53160==e||53188==e||53216==e||53244==e||53272==e||53300==e||53328==e||53356==e||53384==e||53412==e||53440==e||53468==e||53496==e||53524==e||53552==e||53580==e||53608==e||53636==e||53664==e||53692==e||53720==e||53748==e||53776==e||53804==e||53832==e||53860==e||53888==e||53916==e||53944==e||53972==e||54e3==e||54028==e||54056==e||54084==e||54112==e||54140==e||54168==e||54196==e||54224==e||54252==e||54280==e||54308==e||54336==e||54364==e||54392==e||54420==e||54448==e||54476==e||54504==e||54532==e||54560==e||54588==e||54616==e||54644==e||54672==e||54700==e||54728==e||54756==e||54784==e||54812==e||54840==e||54868==e||54896==e||54924==e||54952==e||54980==e||55008==e||55036==e||55064==e||55092==e||55120==e||55148==e||55176==e?9:44033<=e&&e<=44059||44061<=e&&e<=44087||44089<=e&&e<=44115||44117<=e&&e<=44143||44145<=e&&e<=44171||44173<=e&&e<=44199||44201<=e&&e<=44227||44229<=e&&e<=44255||44257<=e&&e<=44283||44285<=e&&e<=44311||44313<=e&&e<=44339||44341<=e&&e<=44367||44369<=e&&e<=44395||44397<=e&&e<=44423||44425<=e&&e<=44451||44453<=e&&e<=44479||44481<=e&&e<=44507||44509<=e&&e<=44535||44537<=e&&e<=44563||44565<=e&&e<=44591||44593<=e&&e<=44619||44621<=e&&e<=44647||44649<=e&&e<=44675||44677<=e&&e<=44703||44705<=e&&e<=44731||44733<=e&&e<=44759||44761<=e&&e<=44787||44789<=e&&e<=44815||44817<=e&&e<=44843||44845<=e&&e<=44871||44873<=e&&e<=44899||44901<=e&&e<=44927||44929<=e&&e<=44955||44957<=e&&e<=44983||44985<=e&&e<=45011||45013<=e&&e<=45039||45041<=e&&e<=45067||45069<=e&&e<=45095||45097<=e&&e<=45123||45125<=e&&e<=45151||45153<=e&&e<=45179||45181<=e&&e<=45207||45209<=e&&e<=45235||45237<=e&&e<=45263||45265<=e&&e<=45291||45293<=e&&e<=45319||45321<=e&&e<=45347||45349<=e&&e<=45375||45377<=e&&e<=45403||45405<=e&&e<=45431||45433<=e&&e<=45459||45461<=e&&e<=45487||45489<=e&&e<=45515||45517<=e&&e<=45543||45545<=e&&e<=45571||45573<=e&&e<=45599||45601<=e&&e<=45627||45629<=e&&e<=45655||45657<=e&&e<=45683||45685<=e&&e<=45711||45713<=e&&e<=45739||45741<=e&&e<=45767||45769<=e&&e<=45795||45797<=e&&e<=45823||45825<=e&&e<=45851||45853<=e&&e<=45879||45881<=e&&e<=45907||45909<=e&&e<=45935||45937<=e&&e<=45963||45965<=e&&e<=45991||45993<=e&&e<=46019||46021<=e&&e<=46047||46049<=e&&e<=46075||46077<=e&&e<=46103||46105<=e&&e<=46131||46133<=e&&e<=46159||46161<=e&&e<=46187||46189<=e&&e<=46215||46217<=e&&e<=46243||46245<=e&&e<=46271||46273<=e&&e<=46299||46301<=e&&e<=46327||46329<=e&&e<=46355||46357<=e&&e<=46383||46385<=e&&e<=46411||46413<=e&&e<=46439||46441<=e&&e<=46467||46469<=e&&e<=46495||46497<=e&&e<=46523||46525<=e&&e<=46551||46553<=e&&e<=46579||46581<=e&&e<=46607||46609<=e&&e<=46635||46637<=e&&e<=46663||46665<=e&&e<=46691||46693<=e&&e<=46719||46721<=e&&e<=46747||46749<=e&&e<=46775||46777<=e&&e<=46803||46805<=e&&e<=46831||46833<=e&&e<=46859||46861<=e&&e<=46887||46889<=e&&e<=46915||46917<=e&&e<=46943||46945<=e&&e<=46971||46973<=e&&e<=46999||47001<=e&&e<=47027||47029<=e&&e<=47055||47057<=e&&e<=47083||47085<=e&&e<=47111||47113<=e&&e<=47139||47141<=e&&e<=47167||47169<=e&&e<=47195||47197<=e&&e<=47223||47225<=e&&e<=47251||47253<=e&&e<=47279||47281<=e&&e<=47307||47309<=e&&e<=47335||47337<=e&&e<=47363||47365<=e&&e<=47391||47393<=e&&e<=47419||47421<=e&&e<=47447||47449<=e&&e<=47475||47477<=e&&e<=47503||47505<=e&&e<=47531||47533<=e&&e<=47559||47561<=e&&e<=47587||47589<=e&&e<=47615||47617<=e&&e<=47643||47645<=e&&e<=47671||47673<=e&&e<=47699||47701<=e&&e<=47727||47729<=e&&e<=47755||47757<=e&&e<=47783||47785<=e&&e<=47811||47813<=e&&e<=47839||47841<=e&&e<=47867||47869<=e&&e<=47895||47897<=e&&e<=47923||47925<=e&&e<=47951||47953<=e&&e<=47979||47981<=e&&e<=48007||48009<=e&&e<=48035||48037<=e&&e<=48063||48065<=e&&e<=48091||48093<=e&&e<=48119||48121<=e&&e<=48147||48149<=e&&e<=48175||48177<=e&&e<=48203||48205<=e&&e<=48231||48233<=e&&e<=48259||48261<=e&&e<=48287||48289<=e&&e<=48315||48317<=e&&e<=48343||48345<=e&&e<=48371||48373<=e&&e<=48399||48401<=e&&e<=48427||48429<=e&&e<=48455||48457<=e&&e<=48483||48485<=e&&e<=48511||48513<=e&&e<=48539||48541<=e&&e<=48567||48569<=e&&e<=48595||48597<=e&&e<=48623||48625<=e&&e<=48651||48653<=e&&e<=48679||48681<=e&&e<=48707||48709<=e&&e<=48735||48737<=e&&e<=48763||48765<=e&&e<=48791||48793<=e&&e<=48819||48821<=e&&e<=48847||48849<=e&&e<=48875||48877<=e&&e<=48903||48905<=e&&e<=48931||48933<=e&&e<=48959||48961<=e&&e<=48987||48989<=e&&e<=49015||49017<=e&&e<=49043||49045<=e&&e<=49071||49073<=e&&e<=49099||49101<=e&&e<=49127||49129<=e&&e<=49155||49157<=e&&e<=49183||49185<=e&&e<=49211||49213<=e&&e<=49239||49241<=e&&e<=49267||49269<=e&&e<=49295||49297<=e&&e<=49323||49325<=e&&e<=49351||49353<=e&&e<=49379||49381<=e&&e<=49407||49409<=e&&e<=49435||49437<=e&&e<=49463||49465<=e&&e<=49491||49493<=e&&e<=49519||49521<=e&&e<=49547||49549<=e&&e<=49575||49577<=e&&e<=49603||49605<=e&&e<=49631||49633<=e&&e<=49659||49661<=e&&e<=49687||49689<=e&&e<=49715||49717<=e&&e<=49743||49745<=e&&e<=49771||49773<=e&&e<=49799||49801<=e&&e<=49827||49829<=e&&e<=49855||49857<=e&&e<=49883||49885<=e&&e<=49911||49913<=e&&e<=49939||49941<=e&&e<=49967||49969<=e&&e<=49995||49997<=e&&e<=50023||50025<=e&&e<=50051||50053<=e&&e<=50079||50081<=e&&e<=50107||50109<=e&&e<=50135||50137<=e&&e<=50163||50165<=e&&e<=50191||50193<=e&&e<=50219||50221<=e&&e<=50247||50249<=e&&e<=50275||50277<=e&&e<=50303||50305<=e&&e<=50331||50333<=e&&e<=50359||50361<=e&&e<=50387||50389<=e&&e<=50415||50417<=e&&e<=50443||50445<=e&&e<=50471||50473<=e&&e<=50499||50501<=e&&e<=50527||50529<=e&&e<=50555||50557<=e&&e<=50583||50585<=e&&e<=50611||50613<=e&&e<=50639||50641<=e&&e<=50667||50669<=e&&e<=50695||50697<=e&&e<=50723||50725<=e&&e<=50751||50753<=e&&e<=50779||50781<=e&&e<=50807||50809<=e&&e<=50835||50837<=e&&e<=50863||50865<=e&&e<=50891||50893<=e&&e<=50919||50921<=e&&e<=50947||50949<=e&&e<=50975||50977<=e&&e<=51003||51005<=e&&e<=51031||51033<=e&&e<=51059||51061<=e&&e<=51087||51089<=e&&e<=51115||51117<=e&&e<=51143||51145<=e&&e<=51171||51173<=e&&e<=51199||51201<=e&&e<=51227||51229<=e&&e<=51255||51257<=e&&e<=51283||51285<=e&&e<=51311||51313<=e&&e<=51339||51341<=e&&e<=51367||51369<=e&&e<=51395||51397<=e&&e<=51423||51425<=e&&e<=51451||51453<=e&&e<=51479||51481<=e&&e<=51507||51509<=e&&e<=51535||51537<=e&&e<=51563||51565<=e&&e<=51591||51593<=e&&e<=51619||51621<=e&&e<=51647||51649<=e&&e<=51675||51677<=e&&e<=51703||51705<=e&&e<=51731||51733<=e&&e<=51759||51761<=e&&e<=51787||51789<=e&&e<=51815||51817<=e&&e<=51843||51845<=e&&e<=51871||51873<=e&&e<=51899||51901<=e&&e<=51927||51929<=e&&e<=51955||51957<=e&&e<=51983||51985<=e&&e<=52011||52013<=e&&e<=52039||52041<=e&&e<=52067||52069<=e&&e<=52095||52097<=e&&e<=52123||52125<=e&&e<=52151||52153<=e&&e<=52179||52181<=e&&e<=52207||52209<=e&&e<=52235||52237<=e&&e<=52263||52265<=e&&e<=52291||52293<=e&&e<=52319||52321<=e&&e<=52347||52349<=e&&e<=52375||52377<=e&&e<=52403||52405<=e&&e<=52431||52433<=e&&e<=52459||52461<=e&&e<=52487||52489<=e&&e<=52515||52517<=e&&e<=52543||52545<=e&&e<=52571||52573<=e&&e<=52599||52601<=e&&e<=52627||52629<=e&&e<=52655||52657<=e&&e<=52683||52685<=e&&e<=52711||52713<=e&&e<=52739||52741<=e&&e<=52767||52769<=e&&e<=52795||52797<=e&&e<=52823||52825<=e&&e<=52851||52853<=e&&e<=52879||52881<=e&&e<=52907||52909<=e&&e<=52935||52937<=e&&e<=52963||52965<=e&&e<=52991||52993<=e&&e<=53019||53021<=e&&e<=53047||53049<=e&&e<=53075||53077<=e&&e<=53103||53105<=e&&e<=53131||53133<=e&&e<=53159||53161<=e&&e<=53187||53189<=e&&e<=53215||53217<=e&&e<=53243||53245<=e&&e<=53271||53273<=e&&e<=53299||53301<=e&&e<=53327||53329<=e&&e<=53355||53357<=e&&e<=53383||53385<=e&&e<=53411||53413<=e&&e<=53439||53441<=e&&e<=53467||53469<=e&&e<=53495||53497<=e&&e<=53523||53525<=e&&e<=53551||53553<=e&&e<=53579||53581<=e&&e<=53607||53609<=e&&e<=53635||53637<=e&&e<=53663||53665<=e&&e<=53691||53693<=e&&e<=53719||53721<=e&&e<=53747||53749<=e&&e<=53775||53777<=e&&e<=53803||53805<=e&&e<=53831||53833<=e&&e<=53859||53861<=e&&e<=53887||53889<=e&&e<=53915||53917<=e&&e<=53943||53945<=e&&e<=53971||53973<=e&&e<=53999||54001<=e&&e<=54027||54029<=e&&e<=54055||54057<=e&&e<=54083||54085<=e&&e<=54111||54113<=e&&e<=54139||54141<=e&&e<=54167||54169<=e&&e<=54195||54197<=e&&e<=54223||54225<=e&&e<=54251||54253<=e&&e<=54279||54281<=e&&e<=54307||54309<=e&&e<=54335||54337<=e&&e<=54363||54365<=e&&e<=54391||54393<=e&&e<=54419||54421<=e&&e<=54447||54449<=e&&e<=54475||54477<=e&&e<=54503||54505<=e&&e<=54531||54533<=e&&e<=54559||54561<=e&&e<=54587||54589<=e&&e<=54615||54617<=e&&e<=54643||54645<=e&&e<=54671||54673<=e&&e<=54699||54701<=e&&e<=54727||54729<=e&&e<=54755||54757<=e&&e<=54783||54785<=e&&e<=54811||54813<=e&&e<=54839||54841<=e&&e<=54867||54869<=e&&e<=54895||54897<=e&&e<=54923||54925<=e&&e<=54951||54953<=e&&e<=54979||54981<=e&&e<=55007||55009<=e&&e<=55035||55037<=e&&e<=55063||55065<=e&&e<=55091||55093<=e&&e<=55119||55121<=e&&e<=55147||55149<=e&&e<=55175||55177<=e&&e<=55203?10:9757==e||9977==e||9994<=e&&e<=9997||127877==e||127938<=e&&e<=127940||127943==e||127946<=e&&e<=127948||128066<=e&&e<=128067||128070<=e&&e<=128080||128110==e||128112<=e&&e<=128120||128124==e||128129<=e&&e<=128131||128133<=e&&e<=128135||128170==e||128372<=e&&e<=128373||128378==e||128400==e||128405<=e&&e<=128406||128581<=e&&e<=128583||128587<=e&&e<=128591||128675==e||128692<=e&&e<=128694||128704==e||128716==e||129304<=e&&e<=129308||129310<=e&&e<=129311||129318==e||129328<=e&&e<=129337||129341<=e&&e<=129342||129489<=e&&e<=129501?13:127995<=e&&e<=127999?14:8205==e?15:9792==e||9794==e||9877<=e&&e<=9878||9992==e||10084==e||127752==e||127806==e||127859==e||127891==e||127908==e||127912==e||127979==e||127981==e||128139==e||128187<=e&&e<=128188||128295==e||128300==e||128488==e||128640==e||128658==e?16:128102<=e&&e<=128105?17:11}return this.nextBreak=function(e,t){if((t=void 0===t?0:t)<0)return 0;if(!(t>=e.length-1)){var r,i,s,a,n,o=_(c(e,t)),l=[];for(t+=1;t<e.length;t++){var h=e,u=t-1;if(!(55296<=h.charCodeAt(u)&&h.charCodeAt(u)<=56319&&56320<=h.charCodeAt(1+u)&&h.charCodeAt(1+u)<=57343)){if(h=_(c(e,t)),u=h,n=a=s=void 0,s=[r=o].concat(i=l).concat([u]),a=s[s.length-2],1<(n=s.lastIndexOf(14))&&s.slice(1,n).every(function(e){return 3==e})&&-1==[3,13,17].indexOf(r)||(0<(r=s.lastIndexOf(4))&&s.slice(1,r).every(function(e){return 4==e})&&-1==[12,4].indexOf(a)?(s.filter(function(e){return 4==e}).length,1):(0!=a||1!=u)&&(2==a||0==a||1==a?(14==u&&i.every(function(e){return 3==e}),1):2==u||0==u||1==u||(6!=a||6!=u&&7!=u&&9!=u&&10!=u)&&(9!=a&&7!=a||7!=u&&8!=u)&&(10!=a&&8!=a||8!=u)&&3!=u&&15!=u&&5!=u&&12!=a&&(r=-1!=s.indexOf(3)?s.lastIndexOf(3)-1:s.length-2,!(-1!=[13,17].indexOf(s[r])&&s.slice(r+1,-1).every(function(e){return 3==e})&&14==u||15==a&&-1!=[16,17].indexOf(u)||-1==i.indexOf(4)&&4==a&&4==u)))))return t;l.push(h)}}}return e.length},this.splitGraphemes=function(e){for(var t,r=[],i=0;(t=this.nextBreak(e,i))<e.length;)r.push(e.slice(i,t)),i=t;return i<e.length&&r.push(e.slice(i)),r},this.iterateGraphemes=function(r){var i=0,e={next:function(){var e,t;return(e=this.nextBreak(r,i))<r.length?(t=r.slice(i,e),i=e,{value:t,done:!1}):i<r.length?(t=r.slice(i),i=r.length,{value:t,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(e[Symbol.iterator]=function(){return e}),e},this.countGraphemes=function(e){for(var t,r=0,i=0;(t=this.nextBreak(e,i))<e.length;)i=t,r++;return i<e.length&&r++,r},this};GraphemeSplitter=GraphemeSplitter2,self.GraphemeSplitter=GraphemeSplitter2}{let lineInt2=function(e,t,r){r=r||0;var i=[0,0],s=e[1][1]-e[0][1],a=e[0][0]-e[1][0],e=s*e[0][0]+a*e[0][1],n=t[1][1]-t[0][1],o=t[0][0]-t[1][0],t=n*t[0][0]+o*t[0][1],l=s*o-n*a;return scalar_eq2(l,0,r)||(i[0]=(o*e-a*t)/l,i[1]=(s*t-n*e)/l),i},lineSegmentsIntersect2=function(e,t,r,i){var s,a=t[0]-e[0],t=t[1]-e[1],n=i[0]-r[0],i=i[1]-r[1];return n*t-i*a!=0&&(s=(n*(e[1]-r[1])+i*(r[0]-e[0]))/(i*a-n*t),0<=(e=(a*(r[1]-e[1])+t*(e[0]-r[0]))/(n*t-i*a)))&&e<=1&&0<=s&&s<=1},triangleArea2=function(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])},isLeft2=function(e,t,r){return 0<triangleArea2(e,t,r)},isLeftOn2=function(e,t,r){return 0<=triangleArea2(e,t,r)},isRight2=function(e,t,r){return triangleArea2(e,t,r)<0},isRightOn2=function(e,t,r){return triangleArea2(e,t,r)<=0},collinear2=function(e,t,r,i){var s,a,n;return i?(n=tmpPoint2,(a=tmpPoint1)[0]=t[0]-e[0],a[1]=t[1]-e[1],n[0]=r[0]-t[0],n[1]=r[1]-t[1],s=a[0]*n[0]+a[1]*n[1],a=Math.sqrt(a[0]*a[0]+a[1]*a[1]),n=Math.sqrt(n[0]*n[0]+n[1]*n[1]),Math.acos(s/(a*n))<i):0===triangleArea2(e,t,r)},sqdist2=function(e,t){var r=t[0]-e[0],t=t[1]-e[1];return r*r+t*t},polygonAt2=function(e,t){var r=e.length;return e[t<0?t%r+r:t%r]},polygonClear2=function(e){e.length=0},polygonAppend2=function(e,t,r,i){for(var s=r;s<i;s++)e.push(t[s])},polygonMakeCCW2=function(e){for(var t=0,r=e,i=1;i<e.length;++i)(r[i][1]<r[t][1]||r[i][1]===r[t][1]&&r[i][0]>r[t][0])&&(t=i);return!isLeft2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,t+1))&&(polygonReverse2(e),!0)},polygonReverse2=function(e){for(var t=[],r=e.length,i=0;i!==r;i++)t.push(e.pop());for(i=0;i!==r;i++)e[i]=t[i]},polygonIsReflex2=function(e,t){return isRight2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,t+1))},polygonCanSee3=function(e,t,r){var i,s=tmpLine1,a=tmpLine2;if(isLeftOn2(polygonAt2(e,t+1),polygonAt2(e,t),polygonAt2(e,r))&&isRightOn2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,r)))return!1;for(var n=sqdist2(polygonAt2(e,t),polygonAt2(e,r)),o=0;o!==e.length;++o)if((o+1)%e.length!==t&&o!==t&&isLeftOn2(polygonAt2(e,t),polygonAt2(e,r),polygonAt2(e,o+1))&&isRightOn2(polygonAt2(e,t),polygonAt2(e,r),polygonAt2(e,o))&&(s[0]=polygonAt2(e,t),s[1]=polygonAt2(e,r),a[0]=polygonAt2(e,o),a[1]=polygonAt2(e,o+1),i=lineInt2(s,a),sqdist2(polygonAt2(e,t),i)<n))return!1;return!0},polygonCanSee22=function(e,t,r){for(var i=0;i!==e.length;++i)if(i!==t&&i!==r&&(i+1)%e.length!==t&&(i+1)%e.length!==r&&lineSegmentsIntersect2(polygonAt2(e,t),polygonAt2(e,r),polygonAt2(e,i),polygonAt2(e,i+1)))return!1;return!0},polygonCopy2=function(e,t,r,i){var s=i||[];if(polygonClear2(s),t<r)for(var a=t;a<=r;a++)s.push(e[a]);else{for(a=0;a<=r;a++)s.push(e[a]);for(a=t;a<e.length;a++)s.push(e[a])}return s},polygonGetCutEdges2=function(e){for(var t=[],r=[],i=[],s=Number.MAX_VALUE,a=0;a<e.length;++a)if(polygonIsReflex2(e,a))for(var n=0;n<e.length;++n)if(polygonCanSee3(e,a,n)){for(var r=polygonGetCutEdges2(polygonCopy2(e,a,n,i)),o=polygonGetCutEdges2(polygonCopy2(e,n,a,i)),l=0;l<o.length;l++)r.push(o[l]);r.length<s&&(s=(t=r).length,t.push([polygonAt2(e,a),polygonAt2(e,n)]))}return t},polygonDecomp2=function(e){var t=polygonGetCutEdges2(e);return 0<t.length?polygonSlice2(e,t):[e]},polygonSlice2=function(e,t){if(0===t.length)return[e];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2===t[0].length&&t[0][0]instanceof Array){for(var r=[e],i=0;i<t.length;i++)for(var s=t[i],a=0;a<r.length;a++){var n=r[a],n=polygonSlice2(n,s);if(n){r.splice(a,1),r.push(n[0],n[1]);break}}return r}return i=e.indexOf((s=t)[0]),a=e.indexOf(s[1]),-1!==i&&-1!==a&&[polygonCopy2(e,i,a),polygonCopy2(e,a,i)]},polygonIsSimple2=function(e){for(var t=e,r=0;r<t.length-1;r++)for(var i=0;i<r-1;i++)if(lineSegmentsIntersect2(t[r],t[r+1],t[i],t[i+1]))return!1;for(r=1;r<t.length-2;r++)if(lineSegmentsIntersect2(t[0],t[t.length-1],t[r],t[r+1]))return!1;return!0},getIntersectionPoint2=function(e,t,r,i,s){s=s||0;var a=t[1]-e[1],t=e[0]-t[0],e=a*e[0]+t*e[1],n=i[1]-r[1],i=r[0]-i[0],r=n*r[0]+i*r[1],o=a*i-n*t;return scalar_eq2(o,0,s)?[0,0]:[(i*e-t*r)/o,(a*r-n*e)/o]},polygonQuickDecomp2=function(e,t,r,i,s,a,n){a=a||100,n=n||0,s=s||25,t=void 0!==t?t:[],r=r||[],i=i||[];var o=[0,0],l=[0,0],h=[0,0],u=0,c=0,_=0,d=0,p=0,m=0,g=0,f=[],S=[],C=e,y=e;if(!(y.length<3))if(a<++n)console.warn("quickDecomp: max level ("+a+") reached.");else{for(var G=0;G<e.length;++G)if(polygonIsReflex2(C,G)){r.push(C[G]);for(var u=c=Number.MAX_VALUE,I=0;I<e.length;++I)isLeft2(polygonAt2(C,G-1),polygonAt2(C,G),polygonAt2(C,I))&&isRightOn2(polygonAt2(C,G-1),polygonAt2(C,G),polygonAt2(C,I-1))&&(h=getIntersectionPoint2(polygonAt2(C,G-1),polygonAt2(C,G),polygonAt2(C,I),polygonAt2(C,I-1)),isRight2(polygonAt2(C,G+1),polygonAt2(C,G),h))&&(_=sqdist2(C[G],h))<c&&(c=_,l=h,m=I),isLeft2(polygonAt2(C,G+1),polygonAt2(C,G),polygonAt2(C,I+1))&&isRightOn2(polygonAt2(C,G+1),polygonAt2(C,G),polygonAt2(C,I))&&(h=getIntersectionPoint2(polygonAt2(C,G+1),polygonAt2(C,G),polygonAt2(C,I),polygonAt2(C,I+1)),isLeft2(polygonAt2(C,G-1),polygonAt2(C,G),h))&&(_=sqdist2(C[G],h))<u&&(u=_,o=h,p=I);if(m===(p+1)%e.length)h[0]=(l[0]+o[0])/2,h[1]=(l[1]+o[1])/2,i.push(h),G<p?(polygonAppend2(f,C,G,p+1),f.push(h),S.push(h),0!==m&&polygonAppend2(S,C,m,C.length),polygonAppend2(S,C,0,G+1)):(0!==G&&polygonAppend2(f,C,G,C.length),polygonAppend2(f,C,0,p+1),f.push(h),S.push(h),polygonAppend2(S,C,m,G+1));else{if(p<m&&(p+=e.length),d=Number.MAX_VALUE,p<m)return t;for(I=m;I<=p;++I)isLeftOn2(polygonAt2(C,G-1),polygonAt2(C,G),polygonAt2(C,I))&&isRightOn2(polygonAt2(C,G+1),polygonAt2(C,G),polygonAt2(C,I))&&(_=sqdist2(polygonAt2(C,G),polygonAt2(C,I)))<d&&polygonCanSee22(C,G,I)&&(d=_,g=I%e.length);G<g?(polygonAppend2(f,C,G,g+1),0!==g&&polygonAppend2(S,C,g,y.length),polygonAppend2(S,C,0,G+1)):(0!==G&&polygonAppend2(f,C,G,y.length),polygonAppend2(f,C,0,g+1),polygonAppend2(S,C,g,G+1))}return f.length<S.length?(polygonQuickDecomp2(f,t,r,i,s,a,n),polygonQuickDecomp2(S,t,r,i,s,a,n)):(polygonQuickDecomp2(S,t,r,i,s,a,n),polygonQuickDecomp2(f,t,r,i,s,a,n)),t}t.push(e)}return t},polygonRemoveCollinearPoints2=function(e,t){for(var r=0,i=e.length-1;3<e.length&&0<=i;--i)collinear2(polygonAt2(e,i-1),polygonAt2(e,i),polygonAt2(e,i+1),t)&&(e.splice(i%e.length,1),r++);return r},polygonRemoveDuplicatePoints2=function(e,t){for(var r=e.length-1;1<=r;--r)for(var i=e[r],s=r-1;0<=s;--s)if(points_eq2(i,e[s],t)){e.splice(r,1);continue}},scalar_eq2=function(e,t,r){return r=r||0,Math.abs(e-t)<=r},points_eq2=function(e,t,r){return scalar_eq2(e[0],t[0],r)&&scalar_eq2(e[1],t[1],r)};lineInt=lineInt2,lineSegmentsIntersect=lineSegmentsIntersect2,triangleArea=triangleArea2,isLeft=isLeft2,isLeftOn=isLeftOn2,isRight=isRight2,isRightOn=isRightOn2,collinear=collinear2,sqdist=sqdist2,polygonAt=polygonAt2,polygonClear=polygonClear2,polygonAppend=polygonAppend2,polygonMakeCCW=polygonMakeCCW2,polygonReverse=polygonReverse2,polygonIsReflex=polygonIsReflex2,polygonCanSee=polygonCanSee3,polygonCanSee2=polygonCanSee22,polygonCopy=polygonCopy2,polygonGetCutEdges=polygonGetCutEdges2,polygonDecomp=polygonDecomp2,polygonSlice=polygonSlice2,polygonIsSimple=polygonIsSimple2,getIntersectionPoint=getIntersectionPoint2,polygonQuickDecomp=polygonQuickDecomp2,polygonRemoveCollinearPoints=polygonRemoveCollinearPoints2,polygonRemoveDuplicatePoints=polygonRemoveDuplicatePoints2,scalar_eq=scalar_eq2,points_eq=points_eq2,tmpPoint1=[],tmpPoint2=[],tmpLine1=[],tmpLine2=[],self.polyDecomp={decomp:polygonDecomp2,quickDecomp:polygonQuickDecomp2,isSimple:polygonIsSimple2,removeCollinearPoints:polygonRemoveCollinearPoints2,removeDuplicatePoints:polygonRemoveDuplicatePoints2,makeCCW:polygonMakeCCW2}}{let isReady=!1,hasAppStarted=!1,buildMode="dev",internalApiToken=Symbol("Construct internal API token"),internalApiTokenAccessesRemaining=14,C33=self.C3=class C3{constructor(){throw TypeError("static class can't be instantiated")}static _GetInternalAPIToken(){if(internalApiTokenAccessesRemaining<=0)throw new Error("cannot obtain internal API token");return--internalApiTokenAccessesRemaining,internalApiToken}static SetReady(){isReady=!0}static IsReady(){return isReady}static SetAppStarted(){hasAppStarted=!0}static HasAppStarted(){return hasAppStarted}static SetBuildMode(e){buildMode=e}static GetBuildMode(){return buildMode}static IsReleaseBuild(){return"final"===buildMode}};C33.isDebug=!1,C33.isDebugDefend=!1,C33.hardwareConcurrency=navigator.hardwareConcurrency||2,self.C3X={}}{let C33=self.C3;C33.QueryParser=class QueryParser{constructor(e){this._queryString=e,this._parameters=new Map,this._Parse()}_Parse(){let e=this._queryString;var t;for(t of(e=e.startsWith("?")||e.startsWith("#")?e.substr(1):e).split("&"))this._ParseParameter(t)}_ParseParameter(e){var t,r;e&&(e.includes("=")?(r=e.indexOf("="),t=decodeURIComponent(e.substring(0,r)),r=decodeURIComponent(e.substring(r+1)),this._parameters.set(t,r)):this._parameters.set(e,null))}LogAll(){for(var e of this._parameters)console.log("[QueryParser] Parameter '"+e[0]+"' = "+(null===e[1]?"null":"'"+e[1]+"'"))}Has(e){return this._parameters.has(e)}Get(e){e=this._parameters.get(e);return void 0===e?null:e}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(e){this._queryString=e,this._parameters.clear(),this._Parse()}},C33.QueryString=new C33.QueryParser(location.search),C33.LocationHashString=new C33.QueryParser(location.hash),C33.QueryString.Has("perf")&&(C33.isPerformanceProfiling=!0),"dev"!==C33.QueryString.Get("mode")&&C33.SetBuildMode("final")}{let GetWindowsNTVersionName2=function(e){var t=parseFloat(e),r=windowsNTVerMap.get(t);return r||(13<=t?"11":"NT "+e)},C33=(GetWindowsNTVersionName=GetWindowsNTVersionName2,self.C3),UNKNOWN="(unknown)",windowsNTVerMap=(C33.Platform={OS:UNKNOWN,OSVersion:UNKNOWN,Browser:UNKNOWN,BrowserVersion:UNKNOWN,BrowserVersionNumber:NaN,BrowserEngine:UNKNOWN,Context:"browser",IsDesktop:!0,IsMobile:!1,IsAppleOS:!1,IsIpadOS:!1,GetDetailedInfo:async()=>{}},new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]])),uaStr=navigator.userAgent,uaData=navigator.userAgentData;if(uaData&&0<uaData.brands.length){let ReadBrandList2=function(e){let t="",r="",i="",s="";for(var a of e){var n=RECOGNIZED_BROWSERS.get(a.brand),n=(!t&&n&&(t=n,r=a.version),RECOGNIZED_ENGINES.get(a.brand));!i&&n&&(i=n,s=a.version)}t||"Chromium"!==i||(C33.Platform.Browser="Chromium",C33.Platform.BrowserVersion=s),C33.Platform.Browser=t||UNKNOWN,C33.Platform.BrowserVersion=r||UNKNOWN,C33.Platform.BrowserEngine=i||UNKNOWN},RECOGNIZED_BROWSERS=(ReadBrandList=ReadBrandList2,C33.Platform.OS=uaData.platform,C33.Platform.IsMobile=uaData.mobile,C33.Platform.IsDesktop=!C33.Platform.IsMobile,new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]])),RECOGNIZED_ENGINES=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]),didGetDetailedInfo=(ReadBrandList2(uaData.brands),!1);C33.Platform.GetDetailedInfo=async()=>{if(!didGetDetailedInfo)try{var e=await navigator.userAgentData.getHighEntropyValues(["platformVersion","fullVersionList"]);ReadBrandList2(e.fullVersionList),"Windows"===C33.Platform.OS?C33.Platform.OSVersion=GetWindowsNTVersionName2(e.platformVersion):C33.Platform.OSVersion=e.platformVersion,didGetDetailedInfo=!0}catch(e){console.warn("Failed to get detailed user agent information: ",e)}}}else{let RunTest2=function(e,t){var r;for(r of Array.isArray(e)?e:[e]){var i=r.exec(uaStr);if(i){t(i);break}}},hasChrome=(RunTest=RunTest2,RunTest2(/windows\s+nt\s+([\d\.]+)/i,e=>{C33.Platform.OS="Windows";e=e[1];C33.Platform.OSVersion=GetWindowsNTVersionName2(e)}),RunTest2(/mac\s+os\s+x\s+([\d\._]+)/i,e=>{C33.Platform.OS="macOS",C33.Platform.OSVersion=e[1].replace(/_/g,".")}),RunTest2(/CrOS/,()=>{C33.Platform.OS="Chrome OS"}),RunTest2(/linux|openbsd|freebsd|netbsd/i,()=>{C33.Platform.OS="Linux"}),RunTest2(/android/i,()=>{C33.Platform.OS="Android"}),RunTest2(/android\s+([\d\.]+)/i,e=>{C33.Platform.OS="Android",C33.Platform.OSVersion=e[1]}),C33.Platform.OS===UNKNOWN&&(RunTest2(/(iphone|ipod|ipad)/i,e=>{C33.Platform.OS="iOS"}),RunTest2([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],e=>{C33.Platform.OS="iOS",C33.Platform.OSVersion=e[1].replace(/_/g,".")})),/chrome\//i.test(uaStr)),hasChromium=/chromium\//i.test(uaStr),hasEdge=/edg\//i.test(uaStr),hasOpera=/OPR\//.test(uaStr),hasNWjs=/nwjs/i.test(uaStr),hasSafari=/safari\//i.test(uaStr),hasWebKit=/webkit/i.test(uaStr),desktopOSs=(hasEdge||hasOpera||RunTest2(/chrome\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chrome",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/edg\/([\d\.]+)/i,e=>{C33.Platform.Browser="Edge",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/OPR\/([\d\.]+)/,e=>{C33.Platform.Browser="Opera",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/chromium\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chromium",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/nwjs\/[0-9.]+/i,e=>{C33.Platform.Browser="NW.js",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium",C33.Platform.Context="nwjs"}),RunTest2(/firefox\/([\d\.]+)/i,e=>{C33.Platform.Browser="Firefox",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Gecko"}),!hasSafari||hasChrome||hasChromium||hasEdge||hasOpera||hasNWjs||(C33.Platform.Browser="Safari",C33.Platform.BrowserEngine="WebKit",RunTest2(/version\/([\d\.]+)/i,e=>{C33.Platform.BrowserVersion=e[1]}),RunTest2(/crios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chrome for iOS",C33.Platform.BrowserVersion=e[1]}),RunTest2(/fxios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Firefox for iOS",C33.Platform.BrowserVersion=e[1]}),RunTest2(/edgios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Edge for iOS",C33.Platform.BrowserVersion=e[1]})),C33.Platform.BrowserEngine===UNKNOWN&&hasWebKit&&(C33.Platform.BrowserEngine="WebKit"),"Android"===C33.Platform.OS&&"Safari"===C33.Platform.Browser&&(C33.Platform.Browser="Stock"),new Set(["Windows","macOS","Linux","Chrome OS"])),isDesktop=desktopOSs.has(C33.Platform.OS)||"nwjs"===C33.Platform.Context;C33.Platform.IsDesktop=isDesktop,C33.Platform.IsMobile=!isDesktop}"Chrome"===C33.Platform.Browser&&"browser"===C33.Platform.Context&&/wv\)/.test(uaStr)&&(C33.Platform.Context="webview"),"nwjs"!==C33.Platform.Context&&"undefined"!=typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(C33.Platform.Context="webapp"),C33.Platform.BrowserVersionNumber=parseFloat(C33.Platform.BrowserVersion);let looksLikeIPadOS="macOS"===C33.Platform.OS&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints;looksLikeIPadOS&&(C33.Platform.OS="iOS",C33.Platform.OSVersion=C33.Platform.BrowserVersion,C33.Platform.IsDesktop=!1,C33.Platform.IsMobile=!0,C33.Platform.IsIpadOS=!0),C33.Platform.IsAppleOS="macOS"===C33.Platform.OS||"iOS"===C33.Platform.OS}{let asyncifyRequest2=function(r){return new Promise((e,t)=>{r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})},asyncifyTransaction2=function(r){return new Promise((e,t)=>{r.oncomplete=()=>e(),r.onerror=()=>t(r.error),r.onabort=()=>t(r.error)})},openReadOnlyTransaction2=function(e,t){return openTransaction(e,t)},openWriteTransaction2=function(e,t){return openTransaction(e,t,!0)},lazyOpenDatabase2=function(t){RequireString2(t);let e=DATABASE_PROMISE_MAP.get(t);return e instanceof Promise||(e=openDatabase(t),DATABASE_PROMISE_MAP.set(t,e),e.catch(e=>DATABASE_PROMISE_MAP.delete(t))),e},RequireString2=function(e){if("string"!=typeof e)throw new TypeError("expected string")},getEntriesFromCursor2=function(e,s){let t=e.objectStore(STORE_NAME).openCursor();return new Promise(r=>{let i=[];t.onsuccess=e=>{var t=e.target.result;if(t){switch(s){case"entries":i.push([t.key,t.value]);break;case"keys":i.push(t.key);break;case"values":i.push(t.value)}t.continue()}else r(i)}})},VERSION=(asyncifyRequest=asyncifyRequest2,asyncifyTransaction=asyncifyTransaction2,openReadOnlyTransaction=openReadOnlyTransaction2,openWriteTransaction=openWriteTransaction2,lazyOpenDatabase=lazyOpenDatabase2,RequireString=RequireString2,getEntriesFromCursor=getEntriesFromCursor2,2),STORE_NAME="keyvaluepairs",DATABASE_PROMISE_MAP=new Map,SUPPORTS_GETALL="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAll,SUPPORTS_GETALLKEYS="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAllKeys;async function openTransaction(t,r,i=!1,s=!0){var e=await lazyOpenDatabase2(t);try{return r(e.transaction([STORE_NAME],i?"readwrite":"readonly"))}catch(e){if(s&&"InvalidStateError"===e.name)return DATABASE_PROMISE_MAP.delete(t),openTransaction(t,r,i,!1);throw e}}async function openDatabase(t){RequireString2(t);var e=indexedDB.open(t,VERSION);return e.addEventListener("upgradeneeded",e=>{try{e.target.result.createObjectStore(STORE_NAME)}catch(e){console.error("Failed to create objectstore for database "+t,e)}}),asyncifyRequest2(e)}class KVStorageContainer{constructor(e){RequireString2(e),this.name=e}async ready(){await lazyOpenDatabase2(this.name)}set(r,i){return RequireString2(r),openWriteTransaction2(this.name,async e=>{var t=e.objectStore(STORE_NAME).put(i,r),t=asyncifyRequest2(t),e=asyncifyTransaction2(e);await Promise.all([e,t])})}get(r){return RequireString2(r),openReadOnlyTransaction2(this.name,async e=>{var t=e.objectStore(STORE_NAME).get(r),t=asyncifyRequest2(t),e=asyncifyTransaction2(e),[,e]=await Promise.all([e,t]);return e})}delete(r){return RequireString2(r),openWriteTransaction2(this.name,async e=>{var t=e.objectStore(STORE_NAME).delete(r),t=asyncifyRequest2(t),e=asyncifyTransaction2(e);await Promise.all([e,t])})}clear(){return openWriteTransaction2(this.name,async e=>{var t=e.objectStore(STORE_NAME).clear(),t=asyncifyRequest2(t),e=asyncifyTransaction2(e);await Promise.all([e,t])})}keys(){return openReadOnlyTransaction2(this.name,async e=>{let t;t=SUPPORTS_GETALLKEYS?(r=e.objectStore(STORE_NAME).getAllKeys(),asyncifyRequest2(r)):getEntriesFromCursor2(e,"keys");var r=asyncifyTransaction2(e),[,e]=await Promise.all([r,t]);return e})}values(){return openReadOnlyTransaction2(this.name,async e=>{let t;t=SUPPORTS_GETALL?(r=e.objectStore(STORE_NAME).getAll(),asyncifyRequest2(r)):getEntriesFromCursor2(e,"values");var r=asyncifyTransaction2(e),[,e]=await Promise.all([r,t]);return e})}entries(){return openReadOnlyTransaction2(this.name,async e=>{var t=getEntriesFromCursor2(e,"entries"),e=asyncifyTransaction2(e),[,e]=await Promise.all([e,t]);return e})}}self.KVStorageContainer=KVStorageContainer}{let NOT_IMPLEMENTED2=function(e){throw new Error(`"${e}" is not implemented`)},DISALLOW_CALLBACK2=function(e){if("function"==typeof e)throw new Error("localforage callback API is not implemented; please use the promise API instead")},StructuredClone2=function(i){return"object"==typeof i?new Promise(t=>{var{port1:e,port2:r}=new MessageChannel;r.onmessage=e=>t(e.data),e.postMessage(i)}):Promise.resolve(i)},KVStorageContainer=(NOT_IMPLEMENTED=NOT_IMPLEMENTED2,DISALLOW_CALLBACK=DISALLOW_CALLBACK2,StructuredClone=StructuredClone2,self.KVStorageContainer),CRITICAL_ERRORS=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],memoryStorage=new WeakMap,isInMemory=!1;"undefined"==typeof indexedDB&&(isInMemory=!0,console.warn("Unable to use local storage because indexedDB is not defined"));class ForageAdaptor{constructor(e){this._inst=e,memoryStorage.set(this,new Map)}_MaybeSwitchToMemoryFallback(e){if(!isInMemory)for(var t of CRITICAL_ERRORS)if(e&&t.test(e.message)){console.error("Unable to use local storage, reverting to in-memory store: ",e,e.message),isInMemory=!0;break}}async _getItemFallback(e){e=memoryStorage.get(this).get(e),e=await StructuredClone2(e);return void 0===e?null:e}async _setItemFallback(e,t){t=await StructuredClone2(t),memoryStorage.get(this).set(e,t)}_removeItemFallback(e){memoryStorage.get(this).delete(e)}_clearFallback(){memoryStorage.get(this).clear()}_keysFallback(){return Array.from(memoryStorage.get(this).keys())}IsUsingFallback(){return isInMemory}async getItem(t,e){if(DISALLOW_CALLBACK2(e),isInMemory)return this._getItemFallback(t);let r;try{r=await this._inst.get(t)}catch(e){return this._MaybeSwitchToMemoryFallback(e),isInMemory?this._getItemFallback(t):(console.error(`Error reading '${t}' from storage, returning null: `,e),null)}return void 0===r?null:r}async setItem(t,r,e){if(DISALLOW_CALLBACK2(e),void 0===r&&(r=null),isInMemory)await this._setItemFallback(t,r);else try{await this._inst.set(t,r)}catch(e){if(this._MaybeSwitchToMemoryFallback(e),!isInMemory)throw e;await this._setItemFallback(t,r)}}async removeItem(t,e){if(DISALLOW_CALLBACK2(e),isInMemory)this._removeItemFallback(t);else try{await this._inst.delete(t)}catch(e){this._MaybeSwitchToMemoryFallback(e),isInMemory?this._removeItemFallback(t):console.error(`Error removing '${t}' from storage: `,e)}}async clear(e){if(DISALLOW_CALLBACK2(e),isInMemory)this._clearFallback();else try{await this._inst.clear()}catch(e){this._MaybeSwitchToMemoryFallback(e),isInMemory?this._clearFallback():console.error("Error clearing storage: ",e)}}async keys(e){if(DISALLOW_CALLBACK2(e),isInMemory)return this._keysFallback();let t=[];try{t=await this._inst.keys()}catch(e){if(this._MaybeSwitchToMemoryFallback(e),isInMemory)return this._keysFallback();console.error("Error getting storage keys: ",e)}return t}ready(e){return DISALLOW_CALLBACK2(e),isInMemory?Promise.resolve(!0):this._inst.ready()}createInstance(e){if("object"!=typeof e)throw new TypeError("invalid options object");e=e.name;if("string"!=typeof e)throw new TypeError("invalid store name");e=new KVStorageContainer(e);return new ForageAdaptor(e)}length(e){NOT_IMPLEMENTED2("localforage.length()")}key(e,t){NOT_IMPLEMENTED2("localforage.key()")}iterate(e,t){NOT_IMPLEMENTED2("localforage.iterate()")}setDriver(e){NOT_IMPLEMENTED2("localforage.setDriver()")}config(e){NOT_IMPLEMENTED2("localforage.config()")}defineDriver(e){NOT_IMPLEMENTED2("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED2("localforage.driver()")}supports(e){NOT_IMPLEMENTED2("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED2("localforage.dropInstance()")}disableMemoryMode(){isInMemory=!1}}self.localforage=new ForageAdaptor(new KVStorageContainer("localforage"))}{let C33=self.C3;if(C33.Supports={},C33.Supports.WebAnimations=(()=>{try{var e;return"undefined"==typeof document?!1:void 0!==(e=document.createElement("div")).animate&&void 0!==e.animate([{opacity:"0"},{opacity:"1"}],1e3).reverse}catch(e){return!1}})(),C33.Supports.DialogElement="undefined"!=typeof HTMLDialogElement,C33.Supports.RequestIdleCallback=!!self.requestIdleCallback,C33.Supports.ImageBitmap=!!self.createImageBitmap,C33.Supports.ImageBitmapOptions=!1,C33.Supports.ImageBitmapOptionsResize=!1,C33.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{premultiplyAlpha:"none"}).then(()=>{C33.Supports.ImageBitmapOptions=!0}).catch(()=>{C33.Supports.ImageBitmapOptions=!1})}catch(err){C33.Supports.ImageBitmapOptions=!1}try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10}).then(e=>{C33.Supports.ImageBitmapOptionsResize=10===e.width&&10===e.height}).catch(()=>{C33.Supports.ImageBitmapOptionsResize=!1})}catch(err){C33.Supports.ImageBitmapOptionsResize=!1}}if(C33.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText),C33.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query),C33.Supports.ClipboardPermissionsQuery=!1,C33.Supports.PermissionsQuery){let permission={name:"clipboard-read"};navigator.permissions.query(permission).then(()=>{C33.Supports.ClipboardPermissionsQuery=!0}).catch(()=>{C33.Supports.ClipboardPermissionsQuery=!1})}C33.Supports.AsyncClipboardApi=!!(navigator.permissions&&navigator.clipboard&&self.ClipboardItem),C33.Supports.Proxies="undefined"!=typeof Proxy,C33.Supports.DownloadAttribute="undefined"!=typeof document&&void 0!==document.createElement("a").download,C33.Supports.Fetch="function"==typeof fetch,C33.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==C33.Platform.Browser&&navigator.storage&&navigator.storage.persist),C33.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate),C33.Supports.Fullscreen=(()=>{var e;return"undefined"!=typeof document&&"iOS"!==C33.Platform.OS&&!!((e=document.documentElement).requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen)})(),C33.Supports.ImageDecoder=void 0!==self.ImageDecoder,C33.Supports.WebCodecs=!!self.VideoEncoder,C33.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker,C33.Supports.QueryLocalFonts=!!self.queryLocalFonts,C33.Supports.UserActivation=!!navigator.userActivation,C33.Supports.CanvasToBlobWebP=!1,(async()=>{let t;"undefined"==typeof document?t=new OffscreenCanvas(32,32):((t=document.createElement("canvas")).width=32,t.height=32);var e=t.getContext("2d");e.fillStyle="blue",e.fillRect(0,0,32,32);let r=null;try{t.convertToBlob?r=await t.convertToBlob({type:"image/webp",quality:1}):t.toBlob&&(r=await new Promise(e=>t.toBlob(e,"image/webp",1))),C33.Supports.CanvasToBlobWebP=r&&"image/webp"===r.type}catch(e){C33.Supports.CanvasToBlobWebP=!1}})()}{let C33=self.C3;if(!String.prototype.trimStart){let startWhitespace=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(startWhitespace,"")}}if(!String.prototype.trimEnd){let endWhitespace=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(endWhitespace,"")}}if(String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(C33.EscapeRegex(e),"g"),t)}),Array.prototype.values||(Array.prototype.values=function*(){for(var e of this)yield e}),!Array.prototype.flat){let arrayFlat2=function(e,r){return e.reduce((e,t)=>(0<r&&Array.isArray(t)?Array.prototype.push.apply(e,arrayFlat2(t,r-1)):e.push(t),e),[])};arrayFlat=arrayFlat2,Array.prototype.flat=function(e=1){return arrayFlat2(this,e)}}Array.prototype.at||(Array.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),String.prototype.at||(String.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),RegExp.escape||(RegExp.escape=function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}),Set.prototype.isSubsetOf||(Set.prototype.isSubsetOf=function(e){if(!(e instanceof Set))throw new TypeError("argument must be a Set");for(var t of this)if(!e.has(t))return!1;return!0}),navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise((r,e)=>navigator.webkitTemporaryStorage.queryUsageAndQuota((e,t)=>r({usage:e,quota:t}),e))}),void 0===self.isSecureContext&&(self.isSecureContext="https:"===location.protocol),void 0===self.globalThis&&(self.globalThis=self)}{let assertFail2=function(e){var t=C33.GetCallStack();console.error("Assertion failure: "+e+"\n\nStack trace:\n"+t)},C33=(assertFail=assertFail2,self.C3);self.assert=function(e,t){e||assertFail2(t)}}{let C33=self.C3,C3X=self.C3X,TypedArray=(C33.IsNumber=function(e){return"number"==typeof e},C33.IsFiniteNumber=function(e){return C33.IsNumber(e)&&isFinite(e)},C33.RequireNumber=function(e){if(!C33.IsNumber(e))throw new TypeError("expected number")},C33.RequireOptionalNumber=function(e){C33.IsNullOrUndefined(e)},C33.RequireNumberInRange=function(e,t,r){if(!C33.IsNumber(e)||isNaN(e)||e<t||r<e)throw new RangeError("number outside of range")},C33.RequireAllNumber=function(...e){for(var t of e);},C33.RequireFiniteNumber=function(e){if(!C33.IsFiniteNumber(e))throw new TypeError("expected finite number")},C33.RequireOptionalFiniteNumber=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllFiniteNumber=function(...e){for(var t of e);},C33.IsString=function(e){return"string"==typeof e},C33.RequireString=function(e){if(!C33.IsString(e))throw new TypeError("expected string")},C33.RequireOptionalString=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllString=function(...e){for(var t of e);},C33.IsSimpleObject=function(e){return"object"==typeof e&&null!==e&&((e=Object.getPrototypeOf(e))?e.constructor===Object:null===e)},C33.RequireSimpleObject=function(e){if(!C33.IsSimpleObject(e))throw new TypeError("expected simple object")},C33.RequireOptionalSimpleObject=function(e){if(!C33.IsNullOrUndefined(e)&&!C33.IsSimpleObject(e))throw new TypeError("expected simple object")},C33.IsObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},C33.RequireObject=function(e){if(!C33.IsObject(e))throw new TypeError("expected object")},C33.RequireOptionalObject=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllObject=function(...e){for(var t of e);},C33.IsFileLike=function(e){return C33.WeakIsInstanceOf(e,Blob)&&"string"==typeof e.name},C33.RequireFileLike=function(e){if(!C33.IsFileLike(e))throw new TypeError("expected file")},C33.RequireOptionalFileLike=function(e){C33.IsNullOrUndefined(e)},C33.IsArray=function(e){return Array.isArray(e)},C33.RequireArray=function(e){if(!C33.IsArray(e))throw new TypeError("expected array")},C33.RequireOptionalArray=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllArray=function(...e){for(var t of e);},C33.Is2DArray=function(e){return!(!C33.IsArray(e)||e.length&&!C33.IsArray(e[0]))},C33.Require2DArray=function(e){if(!C33.Is2DArray(e))throw new TypeError("expected 2d array");for(var t of e)if(!C33.IsArray(t))throw new TypeError("expected 2d array")},C33.RequireOptional2DArray=function(e){C33.IsNullOrUndefined(e)},C33.IsFunction=function(e){return"function"==typeof e},C33.RequireFunction=function(e,t){if(!C33.IsFunction(e))throw new TypeError("expected function");if(!C33.IsNullOrUndefined(t)&&e!==t)throw new TypeError("expected same function reference")},C33.RequireOptionalFunction=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllFunction=function(...e){for(var t of e);},C33.RequireAnyFunction=function(e,...t){if(!C33.IsFunction(e))throw new TypeError("expected function");if(!t.length)throw new Error("missing comparison functions");for(var r of t)if(!C33.IsNullOrUndefined(r)&&e===r)return;throw new TypeError("expected same function reference")},C33.RequireOptionalAllFunction=function(...e){if(!C33.IsNullOrUndefined(e))for(var t of e);},C33.IsInstanceOf=function(e,t){return e instanceof t},C33.IsInstanceOfAny=function(e,...t){for(var r of t)if(C33.IsInstanceOf(e,r))return!0;return!1},C33.RequireInstanceOf=function(e,t){if(!C33.IsInstanceOf(e,t))throw new TypeError("unexpected type")},C33.RequireOptionalInstanceOf=function(e,t){C33.IsNullOrUndefined(e)},C33.RequireAllInstanceOf=function(e,...t){for(var r of t);},C33.RequireAnyInstanceOf=function(e,...t){if(!C33.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C33.RequireAnyOptionalInstanceOf=function(e,...t){if(!C33.IsNullOrUndefined(e)&&!C33.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C33.IsArrayOf=function(e,t){for(var r of e)if(!C33.IsInstanceOf(r,t))return!1;return!0},C33.IsArrayOfFiniteNumbers=function(e){for(var t of e)if(!C33.IsFiniteNumber(t))return!1;return!0},C33.RequireArrayOf=function(e,t){for(var r of e);},C33.RequireOptionalArrayOf=function(e,t){if(!C33.IsNullOrUndefined(e))for(var r of e);},C33.RequireOptionalArrayOfFunctions=function(e,t){if(!C33.IsNullOrUndefined(e))for(var r of e);},C33.RequireArrayOfAny=function(e){for(var t of e);},C33.RequireOptionalArrayOfAny=function(e){if(!C33.IsNullOrUndefined(e))for(var t of e);},C33.IsDOMNode=function(e,t){return!(C33.IsNullOrUndefined(e)||!C33.IsString(e.nodeName))&&(!t||C33.equalsNoCase(e.nodeName,t))},C33.RequireDOMNode=function(e,t){if(C33.IsNullOrUndefined(e)||!C33.IsString(e.nodeName))throw new TypeError("expected DOM node");if(t&&!C33.equalsNoCase(e.nodeName,t))throw new TypeError(`expected DOM '${t}' node`)},C33.RequireOptionalDOMNode=function(e,t){C33.IsNullOrUndefined(e)},C33.IsHTMLElement=function(e,t){return!(C33.IsNullOrUndefined(e)||!C33.IsString(e.tagName))&&(!t||C33.equalsNoCase(e.tagName,t))},C33.RequireHTMLElement=function(e,t){if(C33.IsNullOrUndefined(e)||!C33.IsString(e.tagName))throw new TypeError("expected HTML element");if(t&&!C33.equalsNoCase(e.tagName,t))throw new TypeError(`expected HTML '${t}' element`)},C33.RequireOptionalHTMLElement=function(e,t){C33.IsNullOrUndefined(e)},C33.IsDrawable=function(e){return C33.IsHTMLElement(e,"img")||C33.IsHTMLElement(e,"canvas")||C33.IsHTMLElement(e,"video")||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap},C33.RequireDrawable=function(e){if(!C33.IsDrawable(e))throw new TypeError("expected drawable")},C33.RequireOptionalDrawable=function(e){C33.IsNullOrUndefined(e)},C33.IsDrawableOrImageData=function(e){return e instanceof ImageData||C33.IsDrawable(e)},C33.RequireDrawableOrImageData=function(e){if(!C33.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C33.RequireOptionalDrawableOrImageData=function(e){if(!C33.IsNullOrUndefined(e)&&!C33.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C33.IsStringLike=function(e){return"string"==typeof e||C33.HtmlString&&e instanceof C33.HtmlString||e instanceof C33.BBString},C33.RequireStringLike=function(e){if(!C33.IsStringLike(e))throw new TypeError("expected string-like")},C33.RequireOptionalStringLike=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllStringLike=function(...e){for(var t of e);},C33.RequireOverride=function(){throw new Error("must be overridden")},C33.NotYetImplemented=function(){throw new Error("not yet implemented")},C33.IsDefined=function(e,...t){let r=e;if(void 0===r)return!1;for(var i of t){if(void 0===r[i])return!1;r=r[i]}return!0},C33.IsNullOrUndefined=function(e){return null==e},C33.AreArrayElementsOfSameType=function(e){var t,r=e[0].constructor;for(t of e)if(t.constructor!==r)return!1;return r},C33.AreArrayElementsOfType=function(e,t){for(var r of e)if(!(r instanceof t))return!1;return!0},Object.getPrototypeOf(Uint8Array));C33.IsTypedArray=function(e){return C33.IsInstanceOf(e,TypedArray)},C33.RequireTypedArray=function(e){},C33.WeakRequireTypedArray=function(e){C33.WeakRequireInstanceOf(e,TypedArray)},C33.WeakRequireAnyInstanceOf=function(e,...t){if(!C33.WeakIsAnyInstanceOf(e,...t))throw new TypeError("unexpected type")},C33.WeakIsAnyInstanceOf=function(e,...t){for(var r of t)if(C33.WeakIsInstanceOf(e,r))return!0;return!1},C33.WeakRequireInstanceOf=function(e,t){if(!C33.WeakIsInstanceOf(e,t))throw new TypeError("unexpected type")},C33.WeakIsInstanceOf=function(e,t){for(;e=Object.getPrototypeOf(e);)if(e.constructor.name===t.name)return!0;return!1},C3X.RequireNumber=C33.RequireNumber,C3X.RequireOptionalNumber=C33.RequireOptionalNumber,C3X.RequireFiniteNumber=C33.RequireFiniteNumber,C3X.RequireOptionalFiniteNumber=C33.RequireOptionalFiniteNumber,C3X.RequireString=C33.RequireString,C3X.RequireOptionalString=C33.RequireOptionalString,C3X.RequireObject=C33.RequireObject,C3X.RequireOptionalObject=C33.RequireOptionalObject,C3X.RequireArray=C33.RequireArray,C3X.RequireOptionalArray=C33.RequireOptionalArray,C3X.RequireFunction=C33.RequireFunction,C3X.RequireOptionalFunction=C33.RequireOptionalFunction,C3X.RequireInstanceOf=C33.RequireInstanceOf,C3X.RequireOptionalInstanceOf=C33.RequireOptionalInstanceOf,C3X.IsNullOrUndefined=C33.IsNullOrUndefined}{let isValidTypeChange2=function(e,t){e=C33.getType(e),t=C33.getType(t);return"null"===e||"null"===t||"undefined"!==e&&"undefined"!==t&&e===t},logDefendedObjectWarning2=function(e){console.warn("[Defence] "+e+" @",C33.GetCallStack())},CheckDefendedObjectsUsedCorrectly2=function(){var e;checkRafId=-1,(0<ctorObjectToProxy.size||0<ctorProxyToObject.size)&&(e=[...new Set([...ctorObjectToProxy.keys()].map(e=>C33.getName(e)))].join(","),console.warn("An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: "+e),ctorObjectToProxy.clear(),ctorProxyToObject.clear())},getObjectPropertySet2=function(e){var t,r=new Set;for(t in e)r.add(t);return r},VerifyObjectPropertiesConsistent2=function(e,t){var r=getObjectPropertySet2(t),t=typeProperties.get(e);if(t){var i,s=[];for(i of t.values())r.has(i)?r.delete(i):s.push(i);C33.appendArray(s,[...r]),s.length&&console.warn(`[Defence] '${C33.getName(e)}' constructor creates inconsistent properties: `+s.join(", "))}else typeProperties.set(e,r)},C33=(isValidTypeChange=isValidTypeChange2,logDefendedObjectWarning=logDefendedObjectWarning2,CheckDefendedObjectsUsedCorrectly=CheckDefendedObjectsUsedCorrectly2,getObjectPropertySet=getObjectPropertySet2,VerifyObjectPropertiesConsistent=VerifyObjectPropertiesConsistent2,self.C3),logRafIds=new Map;C33.ColorLog=function(e,t){console.log("%c"+e,"font-weight: bold; color:"+t)},C33.RafLog=function(e,...t){logRafIds.has(e)||logRafIds.set(e,-1),-1===logRafIds.get(e)&&logRafIds.set(e,requestAnimationFrame(()=>{console.log("%c"+e,"font-weight: bold",...t),logRafIds.set(e,-1)}))};let measures,ctorObjectToProxy=(C33.StartMeasure=function(e){performance.mark(e),(measures=measures||new Map).has(e)||measures.set(e,{current:0,total:0,average:0,calls:1,toString:function(){return`${e} :: current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => `+this.calls}})},C33.EndMeasure=function(e){performance.measure("measure-"+e,e);var t=performance.getEntriesByName("measure-"+e)[0],r=measures.get(e);r.current=t.duration,r.total+=r.current,r.average=r.total/r.calls,console.log(r.toString()),r.calls++,performance.clearMarks(e),performance.clearMeasures("measure-"+e)},C33.GetCallStack=function(){return(new Error).stack},C33.Debugger=function(){debugger},C33.cast=function(e,t){return e&&e instanceof t?e:null},C33.getName=function(e){return void 0===e?"undefined":null===e?"null":"boolean"==typeof e?"<boolean>":C33.IsNumber(e)?"<number>":C33.IsString(e)?"<string>":C33.IsArray(e)?"<array>":"symbol"==typeof e?"<"+e.toString()+">":C33.IsFunction(e)?e.name&&"Function"!==e.name?e.name:"<anonymous function>":"object"==typeof e?e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"<anonymous object>":"<unknown>"},C33.getType=function(e){return null===e?"null":Array.isArray(e)?"array":typeof e},C33.range=function*(t,r){if(!isFinite(Math.abs(t-r)))throw new Error("Invalid parameters");if(r<t)for(let e=t-1;e>=r;e--)yield e;else for(let e=t;e<r;e++)yield e},new Map),ctorProxyToObject=new Map,proxyToObject=new WeakMap,releasedObjects=new WeakMap,VALID_GET_MISSING_KEYS=(C33.DefendHandler={},new Set(["then","splice"])),checkRafId=(C33.DefendHandler.get=function(e,t){return t in e||"symbol"==typeof t||VALID_GET_MISSING_KEYS.has(t)||logDefendedObjectWarning2(`Accessed missing property '${t}' from defended object '${C33.getName(e)}', returning undefined`),releasedObjects.has(e)&&"symbol"!=typeof t&&!VALID_GET_MISSING_KEYS.has(t)&&logDefendedObjectWarning2(`Accessed property '${t}' on a released object '${C33.getName(e)}'
Object was originally released at: ${releasedObjects.get(e)})
Call stack at access: `),e[t]},C33.DefendHandler.set=function(e,t,r){return t in e||ctorObjectToProxy.has(e)||logDefendedObjectWarning2(`Set non-existent property '${t}' to '${r}' on defended object '${C33.getName(e)}'`),isValidTypeChange2(e[t],r)||ctorObjectToProxy.has(e)||logDefendedObjectWarning2(`Set '${C33.getType(e[t])}' property '${t}' to type '${C33.getType(r)}' on defended object '${C33.getName(e)}'`),releasedObjects.has(e)&&logDefendedObjectWarning2(`Set property '${t}' on a released object '${C33.getName(e)}'
Object was originally released at: ${releasedObjects.get(e)})
Call stack at access: `),e[t]=r,!0},C33.DefendHandler.deleteProperty=function(e,t){throw new ReferenceError(`Cannot delete property '${t}' from defended object '${C33.getName(e)}'`)},C33.DefendHandler.defineProperty=function(e,t,r){throw new ReferenceError(`Cannot define property '${t}' on defended object '${C33.getName(e)}'`)},C33.DefendHandler.enumerate=function(e){throw new ReferenceError(`Cannot enumerate defended object '${C33.getName(e)}'`)},-1),typeProperties=(C33.DefendedBase=class DefendedBase{constructor(){var e,t;if(C33.isDebugDefend&&C33.Supports.Proxies)return e=Object.create(new.target.prototype),t=new Proxy(e,C33.DefendHandler),ctorObjectToProxy.set(e,t),ctorProxyToObject.set(t,e),proxyToObject.set(t,e),-1===checkRafId&&(checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly2)),t}},C33.debugDefend=function(e){var t;return C33.isDebugDefend&&C33.Supports.Proxies&&e instanceof C33.DefendedBase?(ctorProxyToObject.has(e)&&(t=ctorProxyToObject.get(e),ctorProxyToObject.delete(e),ctorObjectToProxy.delete(t)),e):C33.isDebug?Object.seal(e):e},C33.New=function(e,...t){let r;try{r=new e(...t)}catch(e){throw ctorProxyToObject.clear(),ctorObjectToProxy.clear(),e}return C33.isDebugDefend&&VerifyObjectPropertiesConsistent2(e,r),C33.debugDefend(r)},C33.Release=function(e){e=proxyToObject.get(e);e&&releasedObjects.set(e,C33.GetCallStack())},C33.WasReleased=function(e){e=proxyToObject.get(e);return!!e&&!!releasedObjects.get(e)},new Map);C33.PerfMark=class PerfMark{constructor(e){this._name="",e&&this.start(e)}start(e){C33.isPerformanceProfiling&&(this._name=e,performance.mark(this._name+"-Start"))}end(){C33.isPerformanceProfiling&&(performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End"))}next(e){C33.isPerformanceProfiling&&(this.end(),this._name=e,performance.mark(this._name+"-Start"))}}}{let isNegativeZero2=function(e){return 0===e&&1/e<0},C33=(isNegativeZero=isNegativeZero2,self.C3),TWO_PI=2*Math.PI,D_TO_R=Math.PI/180,R_TO_D=180/Math.PI,ALPHAEX_SHIFT=(C33.wrap=function(e,t,r){e=Math.floor(e),t=Math.floor(t);var i,s=(r=Math.floor(r))-t;return 0==s?r:e<t?(i=r-(t-e)%s)===r?0:i:t+(e-t)%s},C33.mapToRange=function(e,t,r,i,s){r-=t;return 0==r&&0===i?e:(e-t)*(s-i)/r+i},C33.normalize=function(e,t,r){return t-r==0?1:(e-t)/(r-t)},C33.clamp=function(e,t,r){return e<t?t:r<e?r:e},C33.clampAngle=function(e){return(e%=TWO_PI)<0&&(e+=TWO_PI),e},C33.toRadians=function(e){return e*D_TO_R},C33.toDegrees=function(e){return e*R_TO_D},C33.distanceTo=function(e,t,r,i){return Math.hypot(r-e,i-t)},C33.distanceSquared=function(e,t,r,i){r-=e,e=i-t;return r*r+e*e},C33.angleTo=function(e,t,r,i){return Math.atan2(i-t,r-e)},C33.angleDiff=function(e,t){var r;return e===t||(r=Math.sin(e),e=Math.cos(e),1<=(r=r*Math.sin(t)+e*Math.cos(t)))?0:r<=-1?Math.PI:Math.acos(r)},C33.angleRotate=function(e,t,r){var i=Math.sin(e),s=Math.cos(e),a=Math.sin(t),n=Math.cos(t);return Math.acos(i*a+s*n)>r?0<s*a-i*n?C33.clampAngle(e+r):C33.clampAngle(e-r):C33.clampAngle(t)},C33.angleClockwise=function(e,t){var r=Math.sin(e);return Math.cos(e)*Math.sin(t)-r*Math.cos(t)<=0},C33.angleLerp=function(e,t,r,i=0){var s=C33.angleDiff(e,t),i=TWO_PI*i;return C33.angleClockwise(t,e)?C33.clampAngle(e+(s+i)*r):C33.clampAngle(e-(s+i)*r)},C33.angleLerpClockwise=function(e,t,r,i=0){var s=C33.angleDiff(e,t),i=TWO_PI*i;return C33.angleClockwise(t,e)?C33.clampAngle(e+(s+i)*r):C33.clampAngle(e+(TWO_PI-s+i)*r)},C33.angleLerpAntiClockwise=function(e,t,r,i=0){var s=C33.angleDiff(e,t),i=TWO_PI*i;return C33.angleClockwise(t,e)?C33.clampAngle(e-(-TWO_PI+s-i)*r):C33.clampAngle(e-(s+i)*r)},C33.angleReflect=function(e,t){var r=C33.angleDiff(e,t);return C33.angleClockwise(e,t)?C33.clampAngle(t-r):C33.clampAngle(t+r)},C33.lerp=function(e,t,r){return e+r*(t-e)},C33.unlerp=function(e,t,r){return e===t?0:(r-e)/(t-e)},C33.relerp=function(e,t,r,i,s){return C33.lerp(i,s,C33.unlerp(e,t,r))},C33.qarp=function(e,t,r,i){return C33.lerp(C33.lerp(e,t,i),C33.lerp(t,r,i),i)},C33.cubic=function(e,t,r,i,s){return C33.lerp(C33.qarp(e,t,r,s),C33.qarp(t,r,i,s),s)},C33.cosp=function(e,t,r){return(e+t+(e-t)*Math.cos(r*Math.PI))/2},C33.isPOT=function(e){return 0<e&&0==(e-1&e)},C33.nextHighestPowerOfTwo=function(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1},C33.roundToNearestFraction=function(e,t){return Math.round(e*t)/t},C33.floorToNearestFraction=function(e,t){return Math.floor(e*t)/t},C33.roundToDp=function(e,t){t=Math.max(Math.floor(t),0);t=Math.pow(10,t);return Math.round(e*t)/t},C33.countDecimals=function(e){return Math.floor(e)!==e&&e.toString().split(".")[1].length||0},C33.toFixed=function(e,t){var r=e.toFixed(t);let i=r.length-1;for(;0<=i&&"0"===r.charAt(i);--i);return 0<=i&&"."===r.charAt(i)&&--i,i<0?r:r.substr(0,i+1)},C33.PackRGB=function(e,t,r){return C33.clamp(e,0,255)|C33.clamp(t,0,255)<<8|C33.clamp(r,0,255)<<16},1024),ALPHAEX_MAX=1023,RGBEX_SHIFT=16384,RGBEX_MAX=8191,RGBEX_MIN=-8192,COMMON_ASPECT_RATIOS=(C33.PackRGBAEx=function(e,t,r,i){return e=C33.clamp(Math.floor(1024*e),RGBEX_MIN,RGBEX_MAX),t=C33.clamp(Math.floor(1024*t),RGBEX_MIN,RGBEX_MAX),r=C33.clamp(Math.floor(1024*r),RGBEX_MIN,RGBEX_MAX),i=C33.clamp(Math.floor(i*ALPHAEX_MAX),0,ALPHAEX_MAX),e<0&&(e+=RGBEX_SHIFT),t<0&&(t+=RGBEX_SHIFT),r<0&&(r+=RGBEX_SHIFT),-(e*RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT+t*RGBEX_SHIFT*ALPHAEX_SHIFT+r*ALPHAEX_SHIFT+i)},C33.PackRGBEx=function(e,t,r){return C33.PackRGBAEx(e,t,r,1)},C33.GetRValue=function(t){if(0<=t)return(255&t)/255;{let e=Math.floor(-t/(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT));return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetGValue=function(t){if(0<=t)return((65280&t)>>8)/255;{let e=Math.floor(-t%(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT)/(RGBEX_SHIFT*ALPHAEX_SHIFT));return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetBValue=function(t){if(0<=t)return((16711680&t)>>16)/255;{let e=Math.floor(-t%(RGBEX_SHIFT*ALPHAEX_SHIFT)/ALPHAEX_SHIFT);return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetAValue=function(e){return isNegativeZero2(e)?0:0<=e?1:Math.floor(-e%ALPHAEX_SHIFT)/ALPHAEX_MAX},C33.greatestCommonDivisor=function(e,t){for(e=Math.floor(e),t=Math.floor(t);0!==t;){var r=t;t=e%t,e=r}return e},[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]]),NO_HIT=(C33.getAspectRatio=function(e,t){if((e=Math.floor(e))===(t=Math.floor(t)))return[1,1];for(var r of COMMON_ASPECT_RATIOS){var i=e/r[0]*r[1];if(Math.abs(t-i)<1)return r.slice(0);if(i=e/r[1]*r[0],Math.abs(t-i)<1)return[r[1],r[0]]}var s=C33.greatestCommonDivisor(e,t);return[e/s,t/s]},C33.segmentsIntersect=function(e,t,r,i,s,a,n,o){var l,h,u,c,_,d=Math.min(e,r),p=Math.max(e,r),m=Math.min(s,n),g=Math.max(s,n);return!(p<m||g<d||(p=Math.min(t,i),m=Math.max(t,i),g=Math.min(a,o),d=Math.max(a,o),m<g)||d<p||(l=s-e+n-r,h=a-t+o-i,u=r-e,c=i-t,m=n-s,g=o-a,_=Math.abs(c*m-g*u),Math.abs(m*h-g*l)>_))&&Math.abs(u*h-c*l)<=_},C33.segmentsIntersectPreCalc=function(e,t,r,i,s,a,n,o,l,h,u,c){var _,d,p,m,g,f=Math.min(l,u),S=Math.max(l,u);return!(a<f||S<s||(a=Math.min(h,c),f=Math.max(h,c),o<a)||f<n||(_=l-e+u-r,d=h-t+c-i,p=r-e,m=i-t,S=u-l,s=c-h,g=Math.abs(m*S-s*p),Math.abs(S*d-s*_)>g))&&Math.abs(p*d-m*_)<=g},C33.segmentIntersectsQuad=function(e,t,r,i,s){var a=Math.min(e,r),n=Math.max(e,r),o=Math.min(t,i),l=Math.max(t,i),h=s.getTlx(),u=s.getTly(),c=s.getTrx(),_=s.getTry(),d=s.getBrx(),p=s.getBry(),m=s.getBlx(),s=s.getBly();return C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,h,u,c,_)||C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,c,_,d,p)||C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,d,p,m,s)||C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,m,s,h,u)},C33.segmentIntersectsAnyN=function(e,t,r,i,s){var a=Math.min(e,r),n=Math.max(e,r),o=Math.min(t,i),l=Math.max(t,i);let h=0;for(var u=s.length-4;h<=u;h+=2)if(C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,s[h],s[h+1],s[h+2],s[h+3]))return!0;return C33.segmentsIntersectPreCalc(e,t,r,i,a,n,o,l,s[h],s[h+1],s[0],s[1])},2),PADDING=1e-6;C33.rayIntersect=function(e,t,r,i,s,a,n,o){var r=r-e,a=o-a,l=r*a-(i-t)*(n-s);return 0!=l&&0<(i=((t-i)*(n-e)+r*(o-t))/l)&&i<1+PADDING?(a*(n-e)+(s-n)*(o-t))/l:NO_HIT},C33.rayIntersectExtended=function(e,t,r,i,s,a,n,o,l){var h=(n-s)*l,l=(o-a)*l;return C33.rayIntersect(e,t,r,i,s-h,a-l,n+h,o+l)},C33.isPointInTriangleInclusive=function(e,t,r,i,s,a,n,o){s-=r,a-=i,n-=r,o-=i,e-=r,r=t-i,t=s*s+a*a,i=s*n+a*o,s=s*e+a*r,a=n*n+o*o,n=n*e+o*r,e=1/(t*a-i*i),o=(a*s-i*n)*e,r=(t*n-i*s)*e;return 0<=o&&0<=r&&o+r<=1},C33.triangleCartesianToBarycentric=function(e,t,r,i,s,a,n,o){var s=s-r,a=a-i,n=n-r,o=o-i,e=e-r,r=t-i,t=s*s+a*a,i=s*n+a*o,l=n*n+o*o,s=e*s+r*a,a=e*n+r*o,e=t*l-i*i,n=(l*s-i*a)/e,r=(t*a-i*s)/e;return[1-n-r,n,r]},C33.triangleBarycentricToCartesian3d=function(e,t,r,i,s,a,n,o,l,h,u,c){return[e*i+t*n+r*h,e*s+t*o+r*u,e*a+t*l+r*c]}}{let C33=self.C3,mainDocument=null,baseHref="";if("undefined"!=typeof document){mainDocument=document;let baseElem=document.querySelector("base");baseHref=baseElem&&baseElem.hasAttribute("href")?baseElem.getAttribute("href"):"",baseHref&&(baseHref.startsWith("/")&&(baseHref=baseHref.substr(1)),baseHref.endsWith("/")||(baseHref+="/"))}C33.GetBaseHref=function(){return baseHref},C33.GetBaseURL=function(){var e;return mainDocument?(e=mainDocument.location,C33.GetPathFromURL(e.origin+e.pathname)+baseHref):""},C33.GetPathFromURL=function(e){var t;return!e.length||e.endsWith("/")||e.endsWith("\\")?e:-1===(t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\")))?"":e.substr(0,t+1)},C33.GetFilenameFromURL=function(e){var t;return e.length?e.endsWith("/")||e.endsWith("\\")?"":-1===(t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\")))?e:e.substr(t+1):e},C33.GetFileExtension=function(e){var t=e.lastIndexOf(".");return t<1?"":e.substr(t)},C33.SetFileExtension=function(e,t){var r=e.lastIndexOf(".");return-1===r?e+"."+t:e.substr(0,r+1)+t},C33.GetFileNamePart=function(e){var t=e.lastIndexOf(".");return t<1?e:e.substr(0,t)},C33.NormalizeFileSeparator=function(e){return e.replace(/\\/g,"/")},C33.IsFileExtension=function(e,t){return t===(e?C33.GetFileExtension(e).slice(1):"")},C33.FileNameEquals=function(e,t){let r,i;return C33.IsFileLike(e)&&(r=C33.GetFileNamePart(e.name)),C33.IsString(e)&&(r=C33.GetFileNamePart(e)),C33.IsFileLike(t)&&(i=C33.GetFileNamePart(t.name)),C33.IsString(t)&&(i=C33.GetFileNamePart(t)),r===i},C33.ParseFilePath=function(e){e=C33.NormalizeFileSeparator(e);let t=/^\w:\//.exec(e);t?(t=t[0],"/"!==(e=e.slice(3))[0]&&(e="/"+e)):t="";var r=(e=1<(e=e.replace(/\/{2,}/g,"/")).length&&"/"===e.slice(-1)?e.slice(0,-1):e).lastIndexOf("/")+1;let i="",s=e,a,n="";0<r&&(i=e.slice(0,r),s=e.slice(r));e=(a=s).lastIndexOf("."),0<e&&(n=s.slice(e),a=s.slice(0,-n.length)),r=t+i+s;return{dir:i,base:s,name:a,root:t,ext:n,full:r}},C33.Wait=function(r,i){return new Promise((e,t)=>{self.setTimeout(e,r,i)})},C33.swallowException=function(e){try{e()}catch(e){C33.isDebug&&console.warn("Swallowed exception: ",e)}},C33.noop=function(){},C33.equalsNoCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase())},C33.equalsCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize()===t.normalize())},C33.typedArraySet16=function(e,t,r){e[r++]=t[0],e[r++]=t[1],e[r++]=t[2],e[r++]=t[3],e[r++]=t[4],e[r++]=t[5],e[r++]=t[6],e[r++]=t[7],e[r++]=t[8],e[r++]=t[9],e[r++]=t[10],e[r++]=t[11],e[r++]=t[12],e[r++]=t[13],e[r++]=t[14],e[r]=t[15]},C33.truncateArray=function(e,t){e.length=t},C33.clearArray=function(e){e&&0!==e.length&&C33.truncateArray(e,0)},C33.clear2DArray=function(t){if(t){for(let e=0;e<t.length;e++){var r=t[e];C33.truncateArray(r,0)}C33.truncateArray(t,0)}},C33.extendArray=function(t,r,i){r|=0;var s=t.length;if(!(r<=s))for(let e=s;e<r;++e)t.push(i)},C33.resizeArray=function(e,t,r){var i=e.length;(t|=0)<i?C33.truncateArray(e,t):i<t&&C33.extendArray(e,t,r)},C33.shallowAssignArray=function(e,t){C33.clearArray(e),C33.appendArray(e,t)},C33.appendArray=function(r,i){if(i.length<1e4)r.push(...i);else for(let e=0,t=i.length;e<t;++e)r.push(i[e])},C33.arrayRemove=function(t,r){if(!((r=Math.floor(r))<0||r>=t.length)){var i=t.length-1;for(let e=r;e<i;++e)t[e]=t[e+1];C33.truncateArray(t,i)}},C33.arrayFindRemove=function(e,t){t=e.indexOf(t);0<=t&&e.splice(t,1)},C33.arraysEqual=function(t,r){var i=t.length;if(r.length!==i)return!1;for(let e=0;e<i;++e)if(t[e]!==r[e])return!1;return!0},C33.arrayFilterOut=function(r,i){var s=[];let a=0;for(let e=0,t=r.length;e<t;++e){var n=r[e];i(n)?s.push(n):(r[a]=n,++a)}return C33.truncateArray(r,a),s},C33.arrayRemoveAllInSet=function(r,i){var e=r.length;let s=0;for(let e=0,t=r.length;e<t;++e){var a=r[e];i.has(a)||(r[s++]=a)}return C33.truncateArray(r,s),e-s},C33.isArrayIndexInBounds=function(e,t){return e===Math.floor(e)&&0<=e&&e<t.length},C33.validateArrayIndex=function(e,t){if(!C33.isArrayIndexInBounds(e,t))throw new RangeError("array index out of bounds")},C33.cloneArray=function(e){return e.slice()},C33.deepCloneArray=function(e,t){var r,i=[];for(r of e)if(C33.IsObject(r)){var s=t(r);if(!s)throw new Error("missing clone");if(s.constructor!==r.constructor)throw new Error("object is not a clone");i.push(s)}else C33.IsArray(r)?i.push(C33.deepCloneArray(r,t)):i.push(r);return i},C33.clone2DArray=function(e){var t,r=[];for(t of e)r.push(t.slice());return r},C33.splitStringAndNormalize=function(e,t=" "){return e?e.split(t).map(e=>e.trim()).filter(e=>!!e):[]},C33.filterSet=function(e,t,r){var i,s=new Set;for(i of e.values())t(i)&&(r?s.add(r(i)):s.add(i));return s},C33.mergeSets=function(e,t){return e.union?e.union(t):new Set([...e,...t])},C33.mergeSetsInPlace=function(e,t){for(var r of t)e.add(r);return e},C33.first=function(e){for(var t of e)return t;return null},C33.xor=function(e,t){return!e!=!t},C33.compare=function(e,t,r){switch(t){case 0:return e===r;case 1:return e!==r;case 2:return e<r;case 3:return e<=r;case 4:return r<e;case 5:return r<=e;default:return!1}},C33.hasAnyOwnProperty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},C33.PromiseAllWithProgress=function(o,l){return o.length?new Promise((r,i)=>{let s=[],a=0,n=!1;for(let t=0,e=o.length;t<e;++t)s.push(void 0),o[t].then(e=>{n||(s[t]=e,++a===o.length?r(s):l(a,o.length))}).catch(e=>{n=!0,i(e)})}):Promise.resolve([])};let memoryCallbacks=[],nextTaskId=(C33.AddLibraryMemoryCallback=function(e){memoryCallbacks.push(e)},C33.GetEstimatedLibraryMemoryUsage=function(){let e=0;for(var t of memoryCallbacks){t=t();e+=t}return Math.floor(e)},1),activeTaskIds=new Map,taskMessageChannel=new MessageChannel,activeRPAFids=(taskMessageChannel.port2.onmessage=function(e){var e=e.data,t=activeTaskIds.get(e);activeTaskIds.delete(e),t&&t(performance.now())},C33.RequestUnlimitedAnimationFrame=function(e){var t=nextTaskId++;return activeTaskIds.set(t,e),taskMessageChannel.port1.postMessage(t),t},C33.CancelUnlimitedAnimationFrame=function(e){activeTaskIds.delete(e)},C33.PostTask=C33.RequestUnlimitedAnimationFrame,C33.WaitForNextTask=function(){return new Promise(e=>C33.PostTask(e))},new Set);C33.RequestPostAnimationFrame=function(t){let r=self.requestAnimationFrame(async e=>{await C33.WaitForNextTask(),activeRPAFids.has(r)&&(activeRPAFids.delete(r),t(e))});return activeRPAFids.add(r),r},C33.CancelPostAnimationFrame=function(e){activeRPAFids.has(e)&&(self.cancelAnimationFrame(e),activeRPAFids.delete(e))}}{let C33=self.C3;C33.IsAbsoluteURL=function(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},C33.IsRelativeURL=function(e){return!C33.IsAbsoluteURL(e)},C33.ThrowIfNotOk=function(e){if(!e.ok)throw new Error(`fetch '${e.url}' response returned ${e.status} `+e.statusText)},C33.FetchOk=function(e,t){return fetch(e,t).then(e=>(C33.ThrowIfNotOk(e),e))},C33.FetchText=function(e){return C33.FetchOk(e).then(e=>e.text())},C33.FetchJson=function(e){return C33.FetchOk(e).then(e=>e.json())},C33.FetchBlob=function(e){return C33.FetchOk(e).then(e=>e.blob())},C33.FetchArrayBuffer=function(e){return C33.FetchOk(e).then(e=>e.arrayBuffer())},C33.FetchImage=function(i){return new Promise((e,t)=>{let r=new Image;r.onload=()=>e(r),r.onerror=e=>t(e),r.src=i})},C33.BlobToArrayBuffer=function(i){return"function"==typeof i.arrayBuffer?i.arrayBuffer():new Promise((e,t)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=()=>t(r.error),r.readAsArrayBuffer(i)})},C33.BlobToString=function(i){return"function"==typeof i.text?i.text():new Promise((e,t)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=()=>t(r.error),r.readAsText(i)})},C33.BlobToJson=function(e){return C33.BlobToString(e).then(e=>JSON.parse(e))},C33.BlobToImage=async function(e,t){let r=URL.createObjectURL(e);try{var i=await C33.FetchImage(r);return URL.revokeObjectURL(r),r="",t&&"function"==typeof i.decode&&await i.decode(),i}finally{r&&URL.revokeObjectURL(r)}},C33.CreateCanvas=function(e,t){var r;return"undefined"!=typeof document&&"function"==typeof document.createElement?((r=document.createElement("canvas")).width=e,r.height=t,r):new OffscreenCanvas(e,t)},C33.CanvasToBlob=function(t,r,i){if("number"!=typeof i&&(i=1),r=r||"image/png",i=C33.clamp(i,0,1),t.convertToBlob)return t.convertToBlob({type:r,quality:i});if(t.toBlob)return new Promise(e=>t.toBlob(e,r,i));throw new Error("could not convert canvas to blob")},C33.DrawableToBlob=function(e,t,r){var i=C33.CreateCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),C33.CanvasToBlob(i,t,r)},C33.ImageDataToBlob=function(e,t,r){var i;return C33.Supports.ImageBitmapOptions?createImageBitmap(e,{premultiplyAlpha:"none"}).then(e=>C33.DrawableToBlob(e,t,r)):C33.Supports.ImageBitmap?createImageBitmap(e).then(e=>C33.DrawableToBlob(e,t,r)):((i=C33.CreateCanvas(e.width,e.height)).getContext("2d").putImageData(e,0,0),C33.CanvasToBlob(i,t,r))},C33.CopySet=function(e,t){e.clear();for(var r of t)e.add(r)},C33.MapToObject=function(e){var t,r,i=Object.create(null);for([t,r]of e.entries())i[t]=r;return i},C33.ObjectToMap=function(e,t){t.clear();for(var[r,i]of Object.entries(e))t.set(r,i)},C33.ToSuperJSON=function t(e){if("object"!=typeof e||null===e)return e;if(e instanceof Set)return{_c3type_:"set",data:[...e].map(e=>t(e))};if(e instanceof Map)return{_c3type_:"map",data:[...e].map(e=>[e[0],t(e[1])])};var r,i,s=Object.create(null);for([r,i]of Object.entries(e))s[r]=t(i);return s},C33.FromSuperJSON=function t(e){if("object"==typeof e&null!==e){if("set"===e._c3type_)return new Set(e.data.map(e=>t(e)));if("map"===e._c3type_)return new Map(e.data.map(e=>[e[0],t(e[1])]));var r,i,s=Object.create(null);for([r,i]of Object.entries(e))s[r]=t(i);return s}return e},C33.CSSToCamelCase=function(e){if(e.startsWith("--"))return e;let t="",r=!1,i=0;for(var s of e)"-"===s?0<i&&(r=!0):r?(t+=s.toUpperCase(),r=!1):t+=s,++i;return t},C33.IsIterator=function(e){return"object"==typeof e&&"function"==typeof e.next},C33.MakeFilledArray=function(t,r){var i=[];if("function"==typeof r)for(let e=0;e<t;++e)i.push(r());else for(let e=0;e<t;++e)i.push(r);return i}}{let padTwoDigits2=function(e){return 0===e.length?"00":1===e.length?"0"+e:e},hueToRGB2=function(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},C33=(padTwoDigits=padTwoDigits2,hueToRGB=hueToRGB2,self.C3),HSL_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i,HSLA_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;C33.Color=class Color{constructor(e,t,r,i){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,this._r=0,this._g=0,this._b=0,this._a=0,e instanceof C33.Color?this.set(e):this.setRgba(e||0,t||0,r||0,i||0)}setRgb(e,t,r){return this._r=+e,this._g=+t,this._b=+r,this.clamp(),this}setRgba(e,t,r,i){return this._r=+e,this._g=+t,this._b=+r,this._a=+i,this.clamp(),this}set(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}copy(e){return this.set(e)}add(e){this._r+=e._r,this._g+=e._g,this._b+=e._b,this._a+=e._a,this.clamp()}addRgb(e,t,r,i=0){this._r+=+e,this._g+=+t,this._b+=+r,this._a+=+i,this.clamp()}diff(e){this.setR(Math.max(this._r,e._r)-Math.min(this._r,e._r)),this.setG(Math.max(this._g,e._g)-Math.min(this._g,e._g)),this.setB(Math.max(this._b,e._b)-Math.min(this._b,e._b)),this.setA(Math.max(this._a,e._a)-Math.min(this._a,e._a)),this.clamp()}copyRgb(e){this._r=e._r,this._g=e._g,this._b=e._b}setR(e){this._r=C33.clamp(+e,0,1)}getR(){return this._r}setG(e){this._g=C33.clamp(+e,0,1)}getG(){return this._g}setB(e){this._b=C33.clamp(+e,0,1)}getB(){return this._b}setA(e){this._a=C33.clamp(+e,0,1)}getA(){return this._a}clone(){return C33.New(C33.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t++]=this._b,e[t]=this._a}writeRGBToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t]=this._b}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}equalsIgnoringAlpha(e){return this._r===e._r&&this._g===e._g&&this._b===e._b}equalsRgb(e,t,r){return this._r===e&&this._g===t&&this._b===r}equalsRgba(e,t,r,i){return this._r===e&&this._g===t&&this._b===r&&this._a===i}equalsF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)&&e[t+3]===Math.fround(this._a)}equalsRGBF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)}multiply(e){this._r*=e._r,this._g*=e._g,this._b*=e._b,this._a*=e._a}multiplyAlpha(e){this._r*=e,this._g*=e,this._b*=e,this._a*=e}premultiply(){return this._r*=this._a,this._g*=this._a,this._b*=this._a,this}unpremultiply(){return this._r/=this._a,this._g/=this._a,this._b/=this._a,this}clamp(){return this._r=C33.clamp(this._r,0,1),this._g=C33.clamp(this._g,0,1),this._b=C33.clamp(this._b,0,1),this._a=C33.clamp(this._a,0,1),this}setFromRgbValue(e){this._r=C33.GetRValue(e),this._g=C33.GetGValue(e),this._b=C33.GetBValue(e),this._a=C33.GetAValue(e)}getCssRgb(e,t,r){return`rgb(${100*(C33.IsFiniteNumber(e)?e:this.getR())}%, ${100*(C33.IsFiniteNumber(t)?t:this.getG())}%, ${100*(C33.IsFiniteNumber(r)?r:this.getB())}%)`}getCssRgba(e,t,r,i){return`rgba(${100*(C33.IsFiniteNumber(e)?e:this.getR())}%, ${100*(C33.IsFiniteNumber(t)?t:this.getG())}%, ${100*(C33.IsFiniteNumber(r)?r:this.getB())}%, ${C33.IsFiniteNumber(i)?i:this.getA()})`}toHexString(){var e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),r=Math.round(255*this.getB());return"#"+padTwoDigits2(e.toString(16))+padTwoDigits2(t.toString(16))+padTwoDigits2(r.toString(16))}parseHexString(e){if("string"!=typeof e)return!1;let t,r,i;if(3===(e="#"===(e=e.trim()).charAt(0)?e.substr(1):e).length)t=parseInt(e[0],16)/15,r=parseInt(e[1],16)/15,i=parseInt(e[2],16)/15;else{if(6!==e.length)return!1;t=parseInt(e.substr(0,2),16)/255,r=parseInt(e.substr(2,2),16)/255,i=parseInt(e.substr(4,2),16)/255}return isFinite(t)&&this.setR(t),isFinite(r)&&this.setG(r),isFinite(i)&&this.setB(i),this.setA(1),!0}toCommaSeparatedRgb(){return Math.round(255*this.getR())+`, ${Math.round(255*this.getG())}, `+Math.round(255*this.getB())}toRgbArray(){return[Math.round(255*this.getR()),Math.round(255*this.getG()),Math.round(255*this.getB())]}parseCommaSeparatedRgb(e){var t,r;return"string"==typeof e&&!((e=(e=e.replace(/^rgb\(|\)|%/,"")).split(",")).length<3||(t=parseInt(e[0].trim(),10)/255,r=parseInt(e[1].trim(),10)/255,e=parseInt(e[2].trim(),10)/255,isFinite(t)&&this.setR(t),isFinite(r)&&this.setG(r),isFinite(e)&&this.setB(e),this.setA(1),0))}parseCommaSeparatedPercentageRgb(e){var t,r;return"string"==typeof e&&!((e=(e=e.replace(/^rgb\(|\)|%/,"")).split(",")).length<3||(t=parseInt(e[0].trim(),10)/100,r=parseInt(e[1].trim(),10)/100,e=parseInt(e[2].trim(),10)/100,isFinite(t)&&this.setR(t),isFinite(r)&&this.setG(r),isFinite(e)&&this.setB(e),this.setA(1),0))}parseCommaSeparatedRgba(e){var t,r,i;return"string"==typeof e&&!((e=(e=e.replace(/^rgba\(|\)|%/,"")).split(",")).length<4||(t=parseInt(e[0].trim(),10)/255,r=parseInt(e[1].trim(),10)/255,i=parseInt(e[2].trim(),10)/255,e=parseFloat(e[3].trim()),isFinite(t)&&this.setR(t),isFinite(r)&&this.setG(r),isFinite(i)&&this.setB(i),isFinite(e)&&this.setA(e),0))}parseCommaSeparatedPercentageRgba(e){var t,r,i;return"string"==typeof e&&!((e=(e=e.replace(/^rgba\(|\)|%/,"")).split(",")).length<4||(t=parseInt(e[0].trim(),10)/100,r=parseInt(e[1].trim(),10)/100,i=parseInt(e[2].trim(),10)/100,e=parseFloat(e[3].trim()),isFinite(t)&&this.setR(t),isFinite(r)&&this.setG(r),isFinite(i)&&this.setB(i),isFinite(e)&&this.setA(e),0))}parseString(e){var t;return"string"==typeof e&&((e=e.replace(/\s+/,"")).includes(",")?e.startsWith("rgb(")?e.includes("%")?this.parseCommaSeparatedPercentageRgb(e):this.parseCommaSeparatedRgb(e):e.startsWith("rgba(")?e.includes("%")?this.parseCommaSeparatedPercentageRgba(e):this.parseCommaSeparatedRgba(e):e.startsWith("hsl(")||e.startsWith("hsla(")?this.parseHSLString(e):(t=e.split(","),e.includes("%")?3===t.length?this.parseCommaSeparatedPercentageRgb(e):4===t.length&&this.parseCommaSeparatedPercentageRgba(e):3===t.length?this.parseCommaSeparatedRgb(e):4===t.length&&this.parseCommaSeparatedRgba(e)):this.parseHexString(e))}toJSON(){return[this._r,this._g,this._b,this._a]}setFromHSLA(e,t,r,i){let s,a,n;return e%=360,t=C33.clamp(t,0,100),r=C33.clamp(r,0,100),i=C33.clamp(i,0,1),e/=360,r/=100,0===(t/=100)?s=a=n=r:(t=2*r-(r=r<.5?r*(1+t):r+t-r*t),s=hueToRGB2(t,r,e+1/3),a=hueToRGB2(t,r,e),n=hueToRGB2(t,r,e-1/3)),this.setR(s),this.setG(a),this.setB(n),this.setA(i),this}parseHSLString(e){var e=e.replace(/ |hsl|hsla|\(|\)|;/gi,""),t=HSL_TEST.exec(e),e=HSLA_TEST.exec(e);return t&&4===t.length?(this.setFromHSLA(+t[1],+t[2],+t[3],1),!0):!(!e||5!==e.length||(this.setFromHSLA(+t[1],+t[2],+t[3],+t[4]),0))}toHSLAString(){var e=this._r,t=this._g,r=this._b,i=this._a;return`hsla(${C33.Color.GetHue(e,t,r)}, ${C33.Color.GetSaturation(e,t,r)}%, ${C33.Color.GetLuminosity(e,t,r)}%, ${i})`}toHSLAArray(){var e=this._r,t=this._g,r=this._b;return[C33.Color.GetHue(e,t,r),C33.Color.GetSaturation(e,t,r),C33.Color.GetLuminosity(e,t,r),this._a]}setFromJSON(e){!Array.isArray(e)||e.length<3||(this._r=e[0],this._g=e[1],this._b=e[2],this._a=4<=e.length?e[3]:1)}set r(e){this.setR(e)}get r(){return this.getR()}set g(e){this.setG(e)}get g(){return this.getG()}set b(e){this.setB(e)}get b(){return this.getB()}set a(e){this.setA(e)}get a(){return this.getA()}setAtIndex(e,t){switch(e){case 0:this.setR(t);break;case 1:this.setG(t);break;case 2:this.setB(t);break;case 3:this.setA(t);break;default:throw new RangeError("invalid color index")}}getAtIndex(e){switch(e){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index")}}static Equals(e,t){let r,i;if(Array.isArray(e))(r=new C33.Color).setFromJSON(e);else{if(!(e instanceof C33.Color))throw new Error("unexpected type");r=e}if(Array.isArray(t))(i=new C33.Color).setFromJSON(t);else{if(!(t instanceof C33.Color))throw new Error("unexpected type");i=t}return r.equals(i)}static DiffChannel(e,t){return C33.clamp(Math.max(e,t)-Math.min(e,t),0,1)}static Diff(e,t){var r=new C33.Color;return r.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),r.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),r.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),r.setA(Math.max(e._a,t._a)-Math.min(e._a,t._a)),r}static DiffNoAlpha(e,t){var r=new C33.Color(0,0,0,1);return r.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),r.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),r.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),r}static GetHue(e,t,r){var i=Math.max(e,t,r),s=Math.min(e,t,r);if(i===s)return 0;let a=0;switch(i){case e:a=(t-r)/(i-s)+(t<r?6:0);break;case t:a=(r-e)/(i-s)+2;break;case r:a=(e-t)/(i-s)+4}return Math.round(a/6*360)}static GetSaturation(e,t,r){var i=Math.max(e,t,r),e=Math.min(e,t,r);return i===e?0:(t=i-e,Math.round(100*(.5<(i+e)/2?t/(2-i-e):t/(i+e))))}static GetLuminosity(e,t,r){var i=Math.max(e,t,r),e=Math.min(e,t,r);return i?Math.round(100*((i+e)/2)):0}},C33.Color.White=Object.freeze(C33.New(C33.Color,1,1,1,1)),C33.Color.Black=Object.freeze(C33.New(C33.Color,0,0,0,1)),C33.Color.TransparentBlack=Object.freeze(C33.New(C33.Color,0,0,0,0))}{let C33=self.C3;C33.Vector2=class Vector2{constructor(e,t){this._x=0,this._y=0,e instanceof C33.Vector2?this.copy(e):this.set(e||0,t||0)}set(e,t){this._x=+e,this._y=+t}copy(e){this._x=e._x,this._y=e._y}equals(e){return this._x===e._x&&this._y===e._y}equalsValues(e,t){return this._x===e&&this._y===t}equalsF32Array(e,t){return e[t]===Math.fround(this._x)&&e[t+1]===Math.fround(this._y)}setX(e){this._x=+e}getX(){return this._x}setY(e){this._y=+e}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._x,e[t]=this._y}offset(e,t){this._x+=+e,this._y+=+t}scale(e,t){this._x*=e,this._y*=t}divide(e,t){this._x/=e,this._y/=t}round(){this._x=Math.round(this._x),this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x),this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x),this._y=Math.ceil(this._y)}angle(){return C33.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(e,t){var r=this._x*t-this._y*e;this._y=this._y*t+this._x*e,this._x=r}rotate(e){0!==e&&this.rotatePrecalc(Math.sin(e),Math.cos(e))}rotateAbout(e,t,r){0===e||t===this._x&&r===this._y||(this._x-=t,this._y-=r,this.rotatePrecalc(Math.sin(e),Math.cos(e)),this._x+=+t,this._y+=+r)}move(e,t){0!==t&&(this._x+=Math.cos(e)*t,this._y+=Math.sin(e)*t)}normalize(){var e=this.length();0!==e&&1!==e&&(this._x/=e,this._y/=e)}clamp(e,t){this._x=C33.clamp(this._x,e,t),this._y=C33.clamp(this._y,e,t)}dot(e){return this._x*e._x+this._y*e._y}reverse(){this._x=-this._x,this._y=-this._y}perp(){var e=this._x;return this._x=this._y,this._y=-e,this}}}{let C33=self.C3;C33.Rect=class Rect{constructor(e,t,r,i){this._left=NaN,this._top=NaN,this._right=NaN,this._bottom=NaN,this._left=0,this._top=0,this._right=0,this._bottom=0,e instanceof C33.Rect?this.copy(e):this.set(e||0,t||0,r||0,i||0)}set(e,t,r,i){this._left=+e,this._top=+t,this._right=+r,this._bottom=+i}setWH(e,t,r,i){t=+t,this._left=e=+e,this._top=t,this._right=e+ +r,this._bottom=t+ +i}copy(e){this._left=+e._left,this._top=+e._top,this._right=+e._right,this._bottom=+e._bottom}clone(){return new C33.Rect(this._left,this._top,this._right,this._bottom)}static Merge(e,t){var r=new C33.Rect;return r.setLeft(Math.min(e._left,t._left)),r.setTop(Math.min(e._top,t._top)),r.setRight(Math.max(e._right,t._right)),r.setBottom(Math.max(e._bottom,t._bottom)),r}static FromObject(e){return new C33.Rect(e.left,e.top,e.right,e.bottom)}equals(e){return this._left===e._left&&this._top===e._top&&this._right===e._right&&this._bottom===e._bottom}equalsWH(e,t,r,i){return this._left===e&&this._top===t&&this.width()===r&&this.height()===i}equalsF32Array(e,t){return e[t]===Math.fround(this._left)&&e[t+1]===Math.fround(this._top)&&e[t+2]===Math.fround(this._right)&&e[t+3]===Math.fround(this._bottom)}setLeft(e){this._left=+e}getLeft(){return this._left}setTop(e){this._top=+e}getTop(){return this._top}setRight(e){this._right=+e}getRight(){return this._right}setBottom(e){this._bottom=+e}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}static fromDOMRect(e){return C33.New(C33.Rect,e.left,e.top,e.right,e.bottom)}writeToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t]=this._bottom}writeAsQuadToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t++]=this._top,e[t++]=this._right,e[t++]=this._bottom,e[t++]=this._left,e[t]=this._bottom}writeAsQuadToTypedArray3D(e,t,r){e[t++]=this._left,e[t++]=this._top,e[t++]=r,e[t++]=this._right,e[t++]=this._top,e[t++]=r,e[t++]=this._right,e[t++]=this._bottom,e[t++]=r,e[t++]=this._left,e[t++]=this._bottom,e[t]=r}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(e,t){t=+t,this._left+=e=+e,this._top+=t,this._right+=e,this._bottom+=t}offsetLeft(e){this._left+=+e}offsetTop(e){this._top+=+e}offsetRight(e){this._right+=+e}offsetBottom(e){this._bottom+=+e}toSquare(e){if("x"!==e)throw new Error("invalid axis, only 'x' supported");this._top<this._bottom?this._left<this._right?this._bottom=this._top+this.width():this._bottom=this._top-this.width():this._left<this._right?this._bottom=this._top-this.width():this._bottom=this._top+this.width()}inflate(e,t){t=+t,this._left-=e=+e,this._top-=t,this._right+=e,this._bottom+=t}deflate(e,t){t=+t,this._left+=e=+e,this._top+=t,this._right-=e,this._bottom-=t}multiply(e,t){this._left*=e,this._top*=t,this._right*=e,this._bottom*=t}divide(e,t){this._left/=e,this._top/=t,this._right/=e,this._bottom/=t}mirrorAround(e){this._left=+e-this._left,this._right=+e-this._right}flipAround(e){this._top=+e-this._top,this._bottom=+e-this._bottom}rotate90DegreesAround(e,t){var r=this.width(),i=this.height(),s=this.getLeft()+r*e,a=this.getTop()+i*t;this.setWH(s-i*t,a-r*e,i,r)}swapLeftRight(){var e=this._left;this._left=this._right,this._right=e}swapTopBottom(){var e=this._top;this._top=this._bottom,this._bottom=e}shuntY(e){var t=this._top;this._top=+e-this._bottom,this._bottom=+e-t}round(){this._left=Math.round(this._left),this._top=Math.round(this._top),this._right=Math.round(this._right),this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}clamp(e,t,r,i){this._left=Math.max(this._left,+e),this._top=Math.max(this._top,+t),this._right=Math.min(this._right,+r),this._bottom=Math.min(this._bottom,+i)}clampBoth(e,t,r,i){e=+e,t=+t,r=+r,i=+i,this._left=C33.clamp(this._left,e,r),this._top=C33.clamp(this._top,t,i),this._right=C33.clamp(this._right,e,r),this._bottom=C33.clamp(this._bottom,t,i)}normalize(){this._left>this._right&&this.swapLeftRight(),this._top>this._bottom&&this.swapTopBottom()}intersectsRect(e){return!(e._right<this._left||e._bottom<this._top||e._left>this._right||e._top>this._bottom)}intersectsRectOffset(e,t,r){return!(e._right+t<this._left||e._bottom+r<this._top||e._left+t>this._right||e._top+r>this._bottom)}containsPoint(e,t){return e>=this._left&&e<=this._right&&t>=this._top&&t<=this._bottom}containsRect(e){return e._left>=this._left&&e._top>=this._top&&e._right<=this._right&&e._bottom<=this._bottom}expandToContain(e){e._left<this._left&&(this._left=+e._left),e._top<this._top&&(this._top=+e._top),e._right>this._right&&(this._right=+e._right),e._bottom>this._bottom&&(this._bottom=+e._bottom)}lerpInto(e){this._left=C33.lerp(e._left,e._right,this._left),this._top=C33.lerp(e._top,e._bottom,this._top),this._right=C33.lerp(e._left,e._right,this._right),this._bottom=C33.lerp(e._top,e._bottom,this._bottom)}}}{let C33=self.C3;C33.Quad=class Quad{constructor(e,t,r,i,s,a,n,o){this._tlx=NaN,this._tly=NaN,this._trx=NaN,this._try=NaN,this._brx=NaN,this._bry=NaN,this._blx=NaN,this._bly=NaN,this._tlx=0,this._tly=0,this._trx=0,this._try=0,this._brx=0,this._bry=0,this._blx=0,this._bly=0,e instanceof C33.Quad?this.copy(e):this.set(e||0,t||0,r||0,i||0,s||0,a||0,n||0,o||0)}set(e,t,r,i,s,a,n,o){this._tlx=+e,this._tly=+t,this._trx=+r,this._try=+i,this._brx=+s,this._bry=+a,this._blx=+n,this._bly=+o}setRect(e,t,r,i){this.set(e,t,r,t,r,i,e,i)}copy(e){this._tlx=e._tlx,this._tly=e._tly,this._trx=e._trx,this._try=e._try,this._brx=e._brx,this._bry=e._bry,this._blx=e._blx,this._bly=e._bly}equals(e){return this._tlx===e._tlx&&this._tly===e._tly&&this._trx===e._trx&&this._try===e._try&&this._brx===e._brx&&this._bry===e._bry&&this._blx===e._blx&&this._bly===e._bly}setTlx(e){this._tlx=+e}getTlx(){return this._tlx}setTly(e){this._tly=+e}getTly(){return this._tly}setTrx(e){this._trx=+e}getTrx(){return this._trx}setTry(e){this._try=+e}getTry(){return this._try}setBrx(e){this._brx=+e}getBrx(){return this._brx}setBry(e){this._bry=+e}getBry(){return this._bry}setBlx(e){this._blx=+e}getBlx(){return this._blx}setBly(e){this._bly=+e}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}static fromDOMQuad(e){return C33.New(C33.Quad,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y,e.p4.x,e.p4.y)}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=this._trx,e[t++]=this._try,e[t++]=this._brx,e[t++]=this._bry,e[t++]=this._blx,e[t]=this._bly}writeToTypedArray3D(e,t,r){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=r,e[t++]=this._trx,e[t++]=this._try,e[t++]=r,e[t++]=this._brx,e[t++]=this._bry,e[t++]=r,e[t++]=this._blx,e[t++]=this._bly,e[t]=r}offset(e,t){t=+t,this._tlx+=e=+e,this._tly+=t,this._trx+=e,this._try+=t,this._brx+=e,this._bry+=t,this._blx+=e,this._bly+=t}round(){this._tlx=Math.round(this._tlx),this._tly=Math.round(this._tly),this._trx=Math.round(this._trx),this._try=Math.round(this._try),this._brx=Math.round(this._brx),this._bry=Math.round(this._bry),this._blx=Math.round(this._blx),this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx),this._tly=Math.floor(this._tly),this._trx=Math.floor(this._trx),this._try=Math.floor(this._try),this._brx=Math.floor(this._brx),this._bry=Math.floor(this._bry),this._blx=Math.floor(this._blx),this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx),this._tly=Math.ceil(this._tly),this._trx=Math.ceil(this._trx),this._try=Math.ceil(this._try),this._brx=Math.ceil(this._brx),this._bry=Math.ceil(this._bry),this._blx=Math.ceil(this._blx),this._bly=Math.ceil(this._bly)}setFromRect(e){this._tlx=e._left,this._tly=e._top,this._trx=e._right,this._try=e._top,this._brx=e._right,this._bry=e._bottom,this._blx=e._left,this._bly=e._bottom}setFromRotatedRect(e,t){0===t?this.setFromRect(e):this.setFromRotatedRectPrecalc(e,Math.sin(t),Math.cos(t))}setFromRotatedRectPrecalc(e,t,r){var i=e._left*t,s=e._top*t,a=e._right*t,t=e._bottom*t,n=e._left*r,o=e._top*r,l=e._right*r,e=e._bottom*r;this._tlx=n-s,this._tly=o+i,this._trx=l-s,this._try=o+a,this._brx=l-t,this._bry=e+a,this._blx=n-t,this._bly=e+i}getBoundingBox(e){e.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(e,t){var r=this._trx-this._tlx,i=this._try-this._tly,s=this._brx-this._tlx,a=this._bry-this._tly,e=e-this._tlx,t=t-this._tly,n=r*r+i*i,o=r*s+i*a,l=r*e+i*t,h=s*s+a*a,u=s*e+a*t,c=1/(n*h-o*o),_=(h*l-o*u)*c,d=(n*u-o*l)*c;return 0<=_&&0<d&&_+d<1||(d=((n=(r=this._blx-this._tlx)*r+(i=this._bly-this._tly)*i)*u-(o=r*s+i*a)*(l=r*e+i*t))*(c=1/(n*h-o*o)),0<=(_=(h*l-o*u)*c)&&0<d&&_+d<1)}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(e,t,r,i){return!(!this.containsPoint(e,t)&&!this.containsPoint(r,i))||C33.segmentIntersectsQuad(e,t,r,i,this)}intersectsQuad(e){var t,r,i,s,a,n,o=e.midX(),l=e.midY();return!!this.containsPoint(o,l)||(o=this.midX(),l=this.midY(),!!e.containsPoint(o,l))||(o=this._tlx,l=this._tly,t=this._trx,r=this._try,i=this._brx,s=this._bry,a=this._blx,n=this._bly,C33.segmentIntersectsQuad(o,l,t,r,e))||C33.segmentIntersectsQuad(t,r,i,s,e)||C33.segmentIntersectsQuad(i,s,a,n,e)||C33.segmentIntersectsQuad(a,n,o,l,e)}rotatePointsAnticlockwise(){var e=this._tlx,t=this._tly;this._tlx=this._trx,this._tly=this._try,this._trx=this._brx,this._try=this._bry,this._brx=this._blx,this._bry=this._bly,this._blx=e,this._bly=t}mirror(){this._swap(0,2),this._swap(1,3),this._swap(6,4),this._swap(7,5)}flip(){this._swap(0,6),this._swap(1,7),this._swap(2,4),this._swap(3,5)}diag(){this._swap(2,6),this._swap(3,7)}_swap(e,t){var r=this._getAtIndex(e);this._setAtIndex(e,this._getAtIndex(t)),this._setAtIndex(t,r)}_getAtIndex(e){switch(e){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index")}}_setAtIndex(e,t){switch(t=+t,e){case 0:this._tlx=t;break;case 1:this._tly=t;break;case 2:this._trx=t;break;case 3:this._try=t;break;case 4:this._brx=t;break;case 5:this._bry=t;break;case 6:this._blx=t;break;case 7:this._bly=t;break;default:throw new RangeError("invalid quad point index")}}}}{let C33=self.C3,assert=self.assert,DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1],tempQuad=C33.New(C33.Quad);C33.CollisionPoly=class CollisionPoly extends C33.DefendedBase{constructor(e,t=!0){super(),e=e||DEFAULT_POLY_POINTS,this._ptsArr=Float64Array.from(e),this._bbox=new C33.Rect,this._isBboxChanged=!0,this._enabled=t}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(e){this._ptsArr.length===e.length?this._ptsArr.set(e):this._ptsArr=Float64Array.from(e),this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS)}copy(e){this.setPoints(e._ptsArr)}setBboxChanged(){this._isBboxChanged=!0}_updateBbox(){if(this._isBboxChanged){var n=this._ptsArr;let r=n[0],i=n[1],s=r,a=i;for(let e=0,t=n.length;e<t;e+=2){var o=n[e],l=n[e+1];o<r&&(r=o),o>s&&(s=o),l<i&&(i=l),l>a&&(a=l)}this._bbox.set(r,i,s,a),this._isBboxChanged=!1}}setFromRect(e,t,r){let i=this._ptsArr;8!==i.length&&(i=new Float64Array(8),this._ptsArr=i),i[0]=e.getLeft()-t,i[1]=e.getTop()-r,i[2]=e.getRight()-t,i[3]=e.getTop()-r,i[4]=e.getRight()-t,i[5]=e.getBottom()-r,i[6]=e.getLeft()-t,i[7]=e.getBottom()-r,this._bbox.copy(e),0===t&&0===r||this._bbox.offset(-t,-r),this._isBboxChanged=!1}setFromQuad(e,t,r){tempQuad.copy(e),tempQuad.offset(t,r),this.setPoints(tempQuad.toArray()),this._isBboxChanged=!0}transform(e,t,r){let i=0,s=1;0!==r&&(i=Math.sin(r),s=Math.cos(r)),this.transformPrecalc(e,t,i,s)}transformPrecalc(r,i,s,a){var n=this._ptsArr;for(let e=0,t=n.length;e<t;e+=2){var o=e+1,l=n[e]*r,h=n[o]*i;n[e]=l*a-h*s,n[o]=h*a+l*s}this._isBboxChanged=!0}offset(r,i){var s=this._ptsArr;for(let e=0,t=s.length;e<t;e+=2)s[e]+=r,s[e+1]+=i}containsPoint(r,i){var s=this._ptsArr;if(r===s[0]&&i===s[1])return!0;this._updateBbox();var e=this._bbox,a=e.getLeft()-110,n=e.getTop()-101,o=e.getRight()+131,l=e.getBottom()+120;let h=0,u=0,c=0,_=0,d=0,p=0,m=0,g=0,f=(c=a<r?(h=a,r):(h=r,a),_=n<i?(u=n,i):(u=i,n),m=o<r?(d=o,r):(d=r,o),g=l<i?(p=l,i):(p=i,l),0),S=0;for(let e=0,t=s.length;e<t;e+=2){var C=(e+2)%t,y=s[e],G=s[e+1],I=s[C],C=s[1+C];C33.segmentsIntersectPreCalc(a,n,r,i,h,c,u,_,y,G,I,C)&&++f,C33.segmentsIntersectPreCalc(o,l,r,i,d,m,p,g,y,G,I,C)&&++S}return f%2==1||S%2==1}intersectsPoly(e,n,o){var l=e._ptsArr,h=this._ptsArr;if(this.containsPoint(l[0]+n,l[1]+o))return!0;if(e.containsPoint(h[0]-n,h[1]-o))return!0;for(let e=0,t=h.length;e<t;e+=2){var u=(e+2)%t,c=h[e],_=h[e+1],d=h[u],p=h[1+u];let r=0,i=0,s=0,a=0;s=c<d?(r=c,d):(r=d,c),a=_<p?(i=_,p):(i=p,_);for(let e=0,t=l.length;e<t;e+=2){var m=(e+2)%t,g=l[e]+n,f=l[e+1]+o,S=l[m]+n,m=l[1+m]+o;if(C33.segmentsIntersectPreCalc(c,_,d,p,r,s,i,a,g,f,S,m))return!0}}return!1}intersectsSegment(r,i,s,a,n,o){if(this.containsPoint(s-r,a-i))return!0;if(this.containsPoint(n-r,o-i))return!0;let l=0,h=0,u=0,c=0;u=s<n?(l=s,n):(l=n,s),c=a<o?(h=a,o):(h=o,a);var _=this._ptsArr;for(let e=0,t=_.length;e<t;e+=2){var d=(e+2)%t,p=_[e]+r,m=_[e+1]+i,g=_[d]+r,d=_[1+d]+i;if(C33.segmentsIntersectPreCalc(s,a,n,o,l,u,h,c,p,m,g,d))return!0}return!1}mirror(r){var i=this._ptsArr;for(let e=0,t=i.length;e<t;e+=2)i[e]=2*r-i[e];this._isBboxChanged=!0}flip(r){var i=this._ptsArr;for(let e=0,t=i.length;e<t;e+=2){var s=e+1;i[s]=2*r-i[s]}this._isBboxChanged=!0}diag(){var r=this._ptsArr;for(let e=0,t=r.length;e<t;e+=2){var i=e+1,s=r[e];r[e]=r[i],r[i]=s}this._isBboxChanged=!0}GetMidX(){var r=this._ptsArr;let i=0;for(let e=0,t=r.length;e<t;e+=2)i+=r[e];return i/this.pointCount()}GetMidY(){var r=this._ptsArr;let i=0;for(let e=0,t=r.length;e<t;e+=2)i+=r[e+1];return i/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}}}{let C33=self.C3;C33.PairMap=class PairMap extends C33.DefendedBase{constructor(e){if(super(),this._firstMap=new Map,e)for(var[t,r,i]of e)this.Set(t,r,i)}Release(){this.Clear(),this._firstMap=null}IsEmpty(){return 0===this._firstMap.size}Clear(){var e,t=this._firstMap;for(e of t.values())e.clear();t.clear()}Set(e,t,r){var i=this._firstMap;let s=i.get(e);s||(s=new Map,i.set(e,s)),s.set(t,r)}Get(e,t){e=this._firstMap.get(e);return e&&e.get(t)}Has(e,t){e=this._firstMap.get(e);return!!e&&e.has(t)}Delete(e,t){var r=this._firstMap,i=r.get(e);return!!i&&((t=i.delete(t))&&0===i.size&&r.delete(e),t)}DeleteEither(e){var t,r,i=this._firstMap,s=i.get(e);s&&(s.clear(),i.delete(e));for([t,r]of i.entries())r.delete(e)&&0===r.size&&i.delete(t)}GetSize(){let e=0;for(var t of this._firstMap.values())e+=t.size;return e}*values(){for(var e of this._firstMap.values())yield*e.values()}*keyPairs(){for(var[e,t]of this._firstMap.entries())for(var r of t.keys())yield[e,r]}*entries(){for(var[e,t]of this._firstMap.entries())for(var[r,i]of t.entries())yield[e,r,i]}}}{let C33=self.C3;C33.ArraySet=class ArraySet extends C33.DefendedBase{constructor(){super(),this._set=new Set,this._arr=[],this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear(),C33.clearArray(this._arr),this._needToRebuildArray=!1}Add(e){this._set.has(e)||(this._set.add(e),this._needToRebuildArray)||this._arr.push(e)}Has(e){return this._set.has(e)}Delete(e){this._set.delete(e)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){return this._needToRebuildArray&&(this._RebuildArray(),this._needToRebuildArray=!1),this._arr}_RebuildArray(){var e,t=this._arr;C33.clearArray(t);for(e of this._set)t.push(e)}}}{let C33=self.C3,EASE_MAP=new Map,PREDEFINED_EASE_MAP=new Map,CUSTOM_EASE_EDITOR_MAP=new Map,CUSTOM_EASE_DATA_EDITOR_MAP=new Map,CUSTOM_EASE_RUNTIME_MAP=new Map,CUSTOM_EASE_DATA_RUNTIME_MAP=new Map,PRIVATE_EASE_MAP=new Map,BUILT_IN_TRANSITION_MAP=new Map,ALIAS_MAP=new Map,EASE_TRANSLATION_KEYS=(ALIAS_MAP.set("linear","noease"),ALIAS_MAP.set("default","noease"),["default","noease","easeinquad","easeoutquad","easeinoutquad","easeincubic","easeoutcubic","easeinoutcubic","easeinquart","easeoutquart","easeinoutquart","easeinquint","easeoutquint","easeinoutquint","easeinsine","easeoutsine","easeinoutsine","easeinexpo","easeoutexpo","easeinoutexpo","easeincirc","easeoutcirc","easeinoutcirc","easeinelastic","easeoutelastic","easeinoutelastic","easeinback","easeoutback","easeinoutback","easeinbounce","easeoutbounce","easeinoutbounce"]),SHORT_EASE_TRANSLATION_KEYS=["default","noease","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"],EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]),SAMPLE_COUNT=(self.Ease=class Ease{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(e){return EASE_API2INTERNAL_NAMES.get(e)}static GetEditorEaseNames(t,...r){this._CreateEaseMap();let e,i;var s=(i=t?(CUSTOM_EASE_EDITOR_MAP.has(t)||CUSTOM_EASE_EDITOR_MAP.set(t,new Map),[...(e=CUSTOM_EASE_EDITOR_MAP.get(t)).keys()].filter(e=>!Ease.GetEditorEaseData(e,t)||Ease.GetEditorEaseData(e,t).transition.IsForAnyPurpose())):[...(e=CUSTOM_EASE_RUNTIME_MAP).keys()]).sort();return[...PREDEFINED_EASE_MAP.keys()].concat(s).filter(e=>!r.includes(e))}static GetRuntimeEaseNames(){this._CreateEaseMap();var e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),[...PREDEFINED_EASE_MAP.keys()].concat(e)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();var e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),e}static IsPredefinedTranslatedName(e){for(var t of EASE_TRANSLATION_KEYS)if(self.lang("ui.bars.timeline.eases."+t)===e)return!0;for(var r of SHORT_EASE_TRANSLATION_KEYS)if(self.lang("ui.bars.timeline.short-eases."+r)===e)return!0}static IsNamePredefined(e){return this._CreateEaseMap(),[...PREDEFINED_EASE_MAP.keys()].includes(e)}static _GetEase(e){var t=ALIAS_MAP.get(e);return t?EASE_MAP.get(t):Ease.IsNamePredefined(e)?EASE_MAP.get(e):PRIVATE_EASE_MAP.has(e)?PRIVATE_EASE_MAP.get(e):void 0}static GetBuiltInTransition(e){return this._CreateEaseMap(),BUILT_IN_TRANSITION_MAP.get(e)}static GetEditorEase(e,t){this._CreateEaseMap();var r=Ease._GetEase(e);if(r)return r;if(t)return CUSTOM_EASE_EDITOR_MAP.get(t).get(e);throw new Error("missing ease function")}static GetEditorEaseData(e,t){this._CreateEaseMap();t=CUSTOM_EASE_DATA_EDITOR_MAP.get(t);if(t)return t.get(e)}static HasEditorEase(e,t){return this._CreateEaseMap(),!!Ease._GetEase(e)||!!CUSTOM_EASE_EDITOR_MAP.get(t).get(e)}static GetRuntimeEase(e){this._CreateEaseMap();var t=Ease._GetEase(e);return t||CUSTOM_EASE_RUNTIME_MAP.get(e)}static GetRuntimeEaseData(e){return this._CreateEaseMap(),CUSTOM_EASE_DATA_RUNTIME_MAP.get(e)}static GetEaseFromIndex(e){return this._CreateEaseMap(),this.GetRuntimeEaseNames()[e]}static GetIndexForEase(e,t){return this._CreateEaseMap(),this.GetEditorEaseNames(t).indexOf(e)}static GetIndexForEaseAtRuntime(e){return this.GetIndexForEase(e)}static _CreateEaseMap(){0===EASE_MAP.size&&(this._AddPredifinedEase("default",()=>{}),this._AddPredifinedEase("noease",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}],!0),this._AddPredifinedEase("easeinsine",[{x:0,y:0,sax:.485,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.038,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutsine",[{x:0,y:0,sax:.038,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.485,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutsine",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinelastic",[{x:0,y:0,sax:.018,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.116,y:.002,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.266,y:-.005,sax:.024,say:0,eax:-.021,eay:0,se:!0,ee:!0},{x:.416,y:.016,sax:.024,say:0,eax:-.026,eay:0,se:!0,ee:!0},{x:.566,y:-.045,sax:.061,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.716,y:.132,sax:.072,say:-.004,eax:-.045,eay:0,se:!0,ee:!0},{x:.866,y:-.373,sax:.06,say:0,eax:-.049,eay:-.002,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.038,eay:-.263,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutelastic",[{x:0,y:0,sax:.038,say:.263,eax:0,eay:0,se:!0,ee:!1},{x:.136,y:1.373,sax:.049,say:.002,eax:-.06,eay:0,se:!0,ee:!0},{x:.286,y:.868,sax:.045,say:0,eax:-.072,eay:.004,se:!0,ee:!0},{x:.436,y:1.045,sax:.025,say:0,eax:-.061,eay:0,se:!0,ee:!0},{x:.586,y:.984,sax:.026,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.736,y:1.005,sax:.021,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.886,y:.998,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.018,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutelastic",[{x:0,y:0,sax:.025,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.067,y:.001,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.18,y:-.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.292,y:.025,sax:.053,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.405,y:-.118,sax:.069,say:0,eax:-.027,eay:0,se:!0,ee:!0},{x:.597,y:1.118,sax:.027,say:0,eax:-.069,eay:0,se:!0,ee:!0},{x:.71,y:.975,sax:.025,say:0,eax:-.053,eay:0,se:!0,ee:!0},{x:.822,y:1.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.935,y:.999,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.025,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinback",[{x:0,y:0,sax:.35,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.34,eay:-1.579,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutback",[{x:0,y:0,sax:.34,say:1.579,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.35,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutback",[{x:0,y:0,sax:.035,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.242,y:-.1,sax:.258,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.76,y:1.1,sax:.025,say:0,eax:-.26,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.035,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinbounce",[{x:0,y:0,sax:.033,say:.025,eax:0,eay:0,se:!0,ee:!1},{x:.092,y:0,sax:.026,say:.078,eax:-.033,eay:.025,se:!0,ee:!0},{x:.274,y:0,sax:.097,say:.319,eax:-.026,eay:.078,se:!0,ee:!0},{x:.637,y:0,sax:.105,say:.625,eax:-.097,eay:.319,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:-.004,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutbounce",[{x:0,y:0,sax:.125,say:.004,eax:0,eay:0,se:!0,ee:!1},{x:.365,y:1,sax:.097,say:-.319,eax:-.105,eay:-.625,se:!0,ee:!0},{x:.728,y:1,sax:.026,say:-.078,eax:-.097,eay:-.319,se:!0,ee:!0},{x:.91,y:1,sax:.033,say:-.025,eax:-.026,eay:-.078,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.033,eay:-.025,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutbounce",[{x:0,y:0,sax:.01,say:.006,eax:0,eay:0,se:!0,ee:!1},{x:.046,y:0,sax:.021,say:.038,eax:-.01,eay:.006,se:!0,ee:!0},{x:.137,y:0,sax:.059,say:.158,eax:-.021,eay:.038,se:!0,ee:!0},{x:.319,y:0,sax:.117,say:.744,eax:-.059,eay:.158,se:!0,ee:!0},{x:.683,y:1,sax:.059,say:-.158,eax:-.117,eay:-.744,se:!0,ee:!0},{x:.865,y:1,sax:.021,say:-.038,eax:-.059,eay:-.158,se:!0,ee:!0},{x:.956,y:1,sax:.01,say:-.006,eax:-.021,eay:-.038,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.01,eay:-.006,se:!1,ee:!0}]),this._AddPredifinedEase("easeincubic",[{x:0,y:0,sax:.75,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.138,eay:-.321,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcubic",[{x:0,y:0,sax:.138,say:.321,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.75,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcubic",[{x:0,y:0,sax:.285,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.081,say:.272,eax:-.081,eay:-.272,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.285,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquad",[{x:0,y:0,sax:.4,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.178,eay:-.392,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquad",[{x:0,y:0,sax:.178,say:.392,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.4,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquad",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.03,say:.065,eax:-.03,eay:-.065,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquart",[{x:0,y:0,sax:.25,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.5,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquart",[{x:0,y:0,sax:.5,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquart",[{x:0,y:0,sax:.765,say:.03,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.765,eay:-.03,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquint",[{x:0,y:0,sax:.6,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.2,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquint",[{x:0,y:0,sax:.2,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.6,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquint",[{eax:0,eay:0,ee:!1,sax:.84,say:0,se:!0,x:0,y:0},{eax:-.84,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPredifinedEase("easeincirc",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.024,eay:-.808,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcirc",[{x:0,y:0,sax:.024,say:.808,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcirc",[{x:0,y:0,sax:.125,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.02,say:.428,eax:-.02,eay:-.428,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinexpo",[{x:0,y:0,sax:.66,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.14,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutexpo",[{x:0,y:0,sax:.14,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.66,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutexpo",[{eax:0,eay:0,ee:!1,sax:.345,say:0,se:!0,x:0,y:0},{eax:-.06,eay:-.5,ee:!0,sax:.06,say:.5,se:!0,x:.5,y:.5},{eax:-.335,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",this.EaseSpline))}static _AddPredifinedEase(e,t,r=!1){if("function"==typeof t)Ease._AddEase(e,t,"predefined");else{if(!C33.IsArray(t))throw new Error("unexpected arguments");if(self.BuiltInTransition){let s=C33.New(self.BuiltInTransition,e,r);s.SetFromJson(t),Ease._AddEase(e,(e,t,r,i)=>s.Interpolate(e,t,r,i),"predefined"),BUILT_IN_TRANSITION_MAP.set(e,s)}else{let s=C33.New(C33.Transition,[e,t.map(e=>[e.x,e.y,e.sax,e.say,e.eax,e.eay,e.se,e.ee])],!1);s.MakeLinear(r),Ease._AddEase(e,(e,t,r,i)=>s.Interpolate(e,t,r,i),"predefined")}}}static _AddPrivateCustomEase(e,t){Ease._AddEase(e,t,"private")}static AddCustomEase(e,t,r,i){this._CreateEaseMap(),Ease._AddEase(e,t,"custom",r,i)}static RemoveCustomEase(e,t){var r;this.IsNamePredefined(e)||![...PRIVATE_EASE_MAP.keys()].includes(e)&&((r=CUSTOM_EASE_EDITOR_MAP.get(t))&&r.delete(e),r=CUSTOM_EASE_DATA_EDITOR_MAP.get(t))&&r.delete(e)}static _AddEase(e,t,r,i,s){switch(r){case"predefined":EASE_MAP.set(e,t),PREDEFINED_EASE_MAP.set(e,t);break;case"custom":(i?(CUSTOM_EASE_EDITOR_MAP.has(i)||CUSTOM_EASE_EDITOR_MAP.set(i,new Map),CUSTOM_EASE_DATA_EDITOR_MAP.has(i)||CUSTOM_EASE_DATA_EDITOR_MAP.set(i,new Map),CUSTOM_EASE_EDITOR_MAP.get(i).set(e,t),CUSTOM_EASE_DATA_EDITOR_MAP.get(i)):(CUSTOM_EASE_RUNTIME_MAP.set(e,t),CUSTOM_EASE_DATA_RUNTIME_MAP)).set(e,s);break;case"private":EASE_MAP.set(e,t),PRIVATE_EASE_MAP.set(e,t);break;default:throw new Error("unexpected ease mode")}}static NoEase(e,t,r,i){return 0===i?t:r*e/i+t}static EaseCubicBezier(e,t,r,i,s){return t+3*e*(r-t)+3*e**2*(t+i-2*r)+e**3*(s-t+3*r-3*i)}static EaseSpline(e,t,r,i,s,n,o,l,h,u){return i===s&&n===o?e:(e=get_t_for_x(e,t,i,n,l,u),t=a(r,s,o,h),i=b(r,s,o,h),n=c(r,s,o,h),calc_bezier(e,t,i,n))}static GetBezierSamples(e,t,r,i){var s=[],n=a(e,t,r,i),o=b(e,t,r,i),l=c(e,t,r,i);for(let e=0;e<SAMPLE_COUNT;++e){var h=calc_bezier(e*SAMPLE_STEP,n,o,l);s.push(h)}return s}},11),SAMPLE_STEP=1/(SAMPLE_COUNT-1),NEWTON_RAPHSON_ITERATIONS=4,NEWTON_RAPHSON_MIN_SLOPE=.01,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,a=(e,t,r,i)=>i-3*r+3*t-e,b=(e,t,r,i)=>3*r-6*t+3*e,c=(e,t,r,i)=>3*(t-e),calc_bezier=(e,t,r,i)=>((t*e+r)*e+i)*e,get_slope=(e,t,r,i)=>3*t*e*e+2*r*e+i,get_t_for_x=(i,e,t,r,s,n)=>{if(1==i)return 1;let o=0,l=1,h=n[l];var u=SAMPLE_COUNT-1;for(SAMPLE_COUNT;l!=u&&h<=i;)l++,h=n[l],o+=SAMPLE_STEP;l--;var _=(i-(h=n[l]))/(n[l+1]-h);let d=o+_*SAMPLE_STEP;var p,m=a(e,t,r,s),g=b(e,t,r,s),f=c(e,t,r,s),_=get_slope(d,m,g,f);if(0===_)return d;if(_>=NEWTON_RAPHSON_MIN_SLOPE){for(let e=0;e<NEWTON_RAPHSON_ITERATIONS;++e){var S=calc_bezier(d,m,g,f)-i,C=get_slope(d,m,g,f);d-=S/C}return d}{let e=o,t=o+SAMPLE_STEP,r=0;do{d=e+(t-e)/2;var y=calc_bezier(d,m,g,f)-i;0<y?t=d:e=d,y=Math.abs(y)>SUBDIVISION_PRECISION,p=++r<SUBDIVISION_MAX_ITERATIONS}while(y&&p);return d}}}{let RequireStringOrNumber2=function(e){C33.IsString(e)},C33=(RequireStringOrNumber=RequireStringOrNumber2,self.C3);C33.ProbabilityTable=class ProbabilityTable{constructor(e){this._items=[],this._name=e||"",this._totalWeight=0}Release(){this.Clear(),this._items=null}GetName(){return this._name}Clear(){C33.clear2DArray(this._items),this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(e=Math.random()*this.GetTotalWeight()){let t=0;for(var[r,i]of this._items)if(e<(t+=r))return i;return 0}AddItem(e,t){RequireStringOrNumber2(t),this._totalWeight+=e,this._items.push([e,t])}RemoveItem(t,r){RequireStringOrNumber2(r);var i=0===t;for(let e=0;e<this._items.length;e++){var s=this._items[e],a=i||s[0]===t,n=s[1]===r;if(a&&n){this._items.splice(e,1),this._totalWeight-=s[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(e,t){var r,i=new C33.ProbabilityTable(t);for(r of JSON.parse(e)){var s=r[0],a=r[1];i.AddItem(s,a)}return i}}}{let C33=self.C3,nextId=0;C33.ScreenReaderText=class ScreenReaderText{constructor(e,t){this._runtime=e,this._text=t,this._id=nextId++,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"create",id:this._id,text:this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"release",id:this._id}),this._runtime=null,this._text="",this._id=-1}SetText(e){this._text!==e&&(this._text=e,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"update",id:this._id,text:this._text}))}}}{let C33=self.C3;C33.Event=class Event{constructor(e,t){this.type=e,this.cancelable=!!t,this.defaultPrevented=!1,this.propagationStopped=!1,this.isAsync=!1}preventDefault(){if(!this.cancelable)throw new Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw new Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw new Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}}}{let C33=self.C3,assert=self.assert;C33.Event.Handler=class EventHandler extends C33.DefendedBase{constructor(e){super(),this._type=e,this._captureListeners=[],this._captureListenersSet=new Set,this._listeners=[],this._listenersSet=new Set,this._fireDepth=0,this._queueModifyListeners=[]}Release(){0<this._fireDepth||(C33.clearArray(this._captureListeners),this._captureListenersSet.clear(),C33.clearArray(this._listeners),this._listenersSet.clear(),C33.clearArray(this._queueModifyListeners),C33.Release(this))}_AddListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"add",func:e,capture:t}):t?this._captureListenersSet.has(e)||(this._captureListeners.push(e),this._captureListenersSet.add(e)):this._listenersSet.has(e)||(this._listeners.push(e),this._listenersSet.add(e))}_RemoveListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:e,capture:t}):t?this._captureListenersSet.has(e)&&(this._captureListenersSet.delete(e),C33.arrayFindRemove(this._captureListeners,e)):this._listenersSet.has(e)&&(this._listenersSet.delete(e),C33.arrayFindRemove(this._listeners,e))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return 0<this._fireDepth}_ProcessQueuedListeners(){var e,t=new Set,r=new Set;for(e of this._queueModifyListeners)if("add"===e.op)this._AddListener(e.func,e.capture),(e.capture?r:t).delete(e.func);else{if("remove"!==e.op)throw new Error("invalid op");(e.capture?(this._captureListenersSet.delete(e.func),r):(this._listenersSet.delete(e.func),t)).add(e.func)}C33.arrayRemoveAllInSet(this._listeners,t),C33.arrayRemoveAllInSet(this._captureListeners,r),C33.clearArray(this._queueModifyListeners)}_FireCancellable(r){this._IncreaseFireDepth();let i=!1;for(let e=0,t=this._captureListeners.length;e<t;++e)if(this._captureListeners[e](r),r.propagationStopped){i=!0;break}if(!i)for(let e=0,t=this._listeners.length;e<t&&(this._listeners[e](r),!r.propagationStopped);++e);return this._DecreaseFireDepth(),!r.defaultPrevented}_FireNonCancellable(r){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e)this._captureListeners[e](r);for(let e=0,t=this._listeners.length;e<t;++e)this._listeners[e](r);return this._DecreaseFireDepth(),!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--,0===this._fireDepth&&0<this._queueModifyListeners.length&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){e?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(r){var i=[];for(let t=0,e=this._captureListeners.length;t<e;++t){let e=this._captureListeners[t];i.push(C33.Asyncify(()=>e(r)))}for(let t=0,e=this._listeners.length;t<e;++t){let e=this._listeners[t];i.push(C33.Asyncify(()=>e(r)))}return Promise.all(i).then(()=>!r.defaultPrevented)}_FireAndWait_AsyncOptional(r){var i=[];this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){var s=this._captureListeners[e](r);s instanceof Promise&&i.push(s)}for(let e=0,t=this._listeners.length;e<t;++e){var a=this._listeners[e](r);a instanceof Promise&&i.push(a)}return this._DecreaseFireDepth(),i.length?Promise.all(i).then(()=>!r.defaultPrevented):!r.defaultPrevented}async _FireAndWaitAsync(e){return this._FireAndWait_AsyncOptional(e)}async _FireAndWaitAsyncSequential(r){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){var i=this._captureListeners[e](r);i instanceof Promise&&await i}for(let e=0,t=this._listeners.length;e<t;++e){var s=this._listeners[e](r);s instanceof Promise&&await s}return this._DecreaseFireDepth(),!r.defaultPrevented}*_FireAsGenerator(r){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){var i=this._captureListeners[e](r);C33.IsIterator(i)&&(yield*i)}for(let e=0,t=this._listeners.length;e<t;++e){var s=this._listeners[e](r);C33.IsIterator(s)&&(yield*s)}this._DecreaseFireDepth()}}}{let C33=self.C3;C33.Event.Dispatcher=class EventDispatcher extends C33.DefendedBase{constructor(){super(),this._eventHandlers=new Map,this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw new Error("already released");this.ClearEvents(),this._dispatcherWasReleased=!0,C33.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){if(this._eventHandlers){for(var e of this._eventHandlers.values())e.Release();this._eventHandlers.clear()}}_GetHandlerByType(e,t){var r=this._eventHandlers.get(e);return r||(t?(r=C33.New(C33.Event.Handler,e),this._eventHandlers.set(e,r),r):null)}HasAnyHandlerFor(e){return this._eventHandlers.has(e)}addEventListener(e,t,r){this._GetHandlerByType(e,!0)._AddListener(t,!!r)}removeEventListener(e,t,r){var i=this._GetHandlerByType(e,!1);i&&(i._RemoveListener(t,!!r),i._IsEmpty())&&this._eventHandlers.delete(e)}dispatchEvent(e){var t=this._GetHandlerByType(e.type,!1);return!t||(e.cancelable?t._FireCancellable(e):t._FireNonCancellable(e))}dispatchEventAsync(e){var t=this._GetHandlerByType(e.type,!1);return t?(e.isAsync=!0,t._FireAsync(e)):Promise.resolve(!0)}async dispatchEventAndClearAsync(e){var t=this._GetHandlerByType(e.type,!1);if(!t)return!0;this._eventHandlers.delete(e.type),e.isAsync=!0;e=await t._FireAsync(e);return t.Release(),e}async dispatchEventAndWaitAsync(e){var t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWaitAsync(e)}dispatchEventAndWait_AsyncOptional(e){var t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWait_AsyncOptional(e)}async dispatchEventAndWaitAsyncSequential(e){var t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWaitAsyncSequential(e)}dispatchGeneratorEvent(e){var t=this._GetHandlerByType(e.type,!1);if(!t)return null;if(e.cancelable)throw new Error("not supported");return t._FireAsGenerator(e)}SetDelayRemoveEventsEnabled(e){for(var t of this._eventHandlers.values())t.SetDelayRemoveEventsEnabled(e)}}}{let SetNewCallback2=function(e){callbackId=SUPPORTS_RIC&&0===highThroughputMode?requestIdleCallback(DoAsyncifiedWork2,{timeout:IDLECALLBACK_TIMEOUT}):setTimeout(DoAsyncifiedWork2,0<highThroughputMode?1:e)},DoAsyncifiedWork2=function(r){if(callbackId=-1,workQueue.length){var i=performance.now();let e=i,t=0;for(var s,a;DoNextAsyncifiedJob2(workQueue.shift()),e=performance.now(),++t,s=(e-i)/t*1.1,workQueue.length&&(SUPPORTS_RIC&&0===highThroughputMode&&void 0!==r?s<r.timeRemaining():e-i+s<SETTIMEOUT_WORK_DURATION););-1===callbackId&&workQueue.length&&(a=e-i,a=Math.max(SETTIMEOUT_INTERVAL-a,4),SetNewCallback2(a))}},DoNextAsyncifiedJob2=function(t){let e;try{e=t.func()}catch(e){return void t.reject(e)}t.resolve(e)},C33=(SetNewCallback=SetNewCallback2,DoAsyncifiedWork=DoAsyncifiedWork2,DoNextAsyncifiedJob=DoNextAsyncifiedJob2,self.C3),SETTIMEOUT_WORK_DURATION=12,SETTIMEOUT_INTERVAL=16,IDLECALLBACK_TIMEOUT=35,SUPPORTS_RIC="undefined"!=typeof requestIdleCallback,workQueue=[],callbackId=-1,highThroughputMode=0,asyncifyDisabled=C33.QueryString.Has("disable-asyncify");asyncifyDisabled&&console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously."),C33.Asyncify=function(r){let i=null;return C33.isDebug&&(i=C33.GetCallStack()),new Promise((e,t)=>{workQueue.push({func:r,resolve:e,reject:t,stack:i}),asyncifyDisabled?DoNextAsyncifiedJob2(workQueue.pop()):-1===callbackId&&SetNewCallback2(SETTIMEOUT_INTERVAL)})},C33.Asyncify.SetHighThroughputMode=function(e){if(e)++highThroughputMode;else if(--highThroughputMode<0)throw new Error("already turned off high throughput mode")}}{let ClearTimeCache2=function(){cachedNowTime=-1},CheckActiveIdleTimeouts2=function(){timerId=-1,nextDeadline=-1;var e,t,r,i=Date.now();for(e of activeIdleTimeouts)e._CheckTimeout(i)?(t=e._GetDeadline(),(-1===nextDeadline||t<nextDeadline)&&(nextDeadline=t)):activeIdleTimeouts.delete(e);-1!==nextDeadline&&(r=Math.max(nextDeadline-i+IDLE_CHECK_TIMER_OVERSHOOT,IDLE_CHECK_MIN_INTERVAL),timerId=self.setTimeout(CheckActiveIdleTimeouts2,r))},C33=(ClearTimeCache=ClearTimeCache2,CheckActiveIdleTimeouts=CheckActiveIdleTimeouts2,self.C3),IDLE_CHECK_MIN_INTERVAL=1e3,IDLE_CHECK_TIMER_OVERSHOOT=100,cachedNowTime=-1,timerId=(C33.FastGetDateNow=function(){return-1===cachedNowTime&&(cachedNowTime=Date.now(),self.setTimeout(ClearTimeCache2,16)),cachedNowTime},-1),nextDeadline=-1,activeIdleTimeouts=new Set;C33.IdleTimeout=class IdleTimeout{constructor(e,t){this._callback=e,this._timeout=1e3*t,this._deadline=0,this._isActive=!1}Reset(){var e=C33.FastGetDateNow();this._deadline=e+this._timeout,this._isActive||(activeIdleTimeouts.add(this),this._isActive=!0),-1===timerId?(nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts2,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT)):this._deadline<nextDeadline&&nextDeadline>e+IDLE_CHECK_MIN_INTERVAL&&(self.clearTimeout(timerId),nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts2,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT))}_CheckTimeout(e){return!(e>=this._deadline)||(this._callback()?(this._deadline=e+this._timeout,!0):this._isActive=!1)}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(activeIdleTimeouts.delete(this),this._isActive=!1,0===activeIdleTimeouts.size)&&-1!==timerId&&(self.clearTimeout(timerId),timerId=-1,nextDeadline=-1)}Release(){this.Cancel(),this._callback=null}}}{let C33=self.C3;C33.Disposable=class Disposable{constructor(e){this._disposed=!1,this._disposeAction=e}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(e){return new Disposable(()=>e.Release())}static From(t,r,i,s,e){if(null==s)s=!1;else if("boolean"!=typeof s&&"object"!=typeof s)throw new TypeError("invalid event listener options");if(e&&(i=i.bind(e)),r.includes(" ")){r=r.split(" ");var a=new C33.CompositeDisposable;for(let e of r)t.addEventListener(e,i,s),a.Add(C33.New(C33.Disposable,()=>t.removeEventListener(e,i,s)));return a}return t.addEventListener(r,i,s),C33.New(C33.Disposable,()=>t.removeEventListener(r,i,s))}},C33.StubDisposable=class StubDisposable extends C33.Disposable{SetAction(e){this._disposeAction=e}},C33.CompositeDisposable=class CompositeDisposable extends C33.Disposable{constructor(...e){super(),this._disposables=new Set;for(var t of e)this.Add(t)}Add(...e){if(this._disposed)throw new Error("already disposed");for(var t of e)this._disposables.add(t)}Remove(e){if(this._disposed)throw new Error("already disposed");this._disposables.delete(e)}RemoveAll(){if(this._disposed)throw new Error("already disposed");if(this._disposables){for(var e of this._disposables)e.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw new Error("already disposed");this._disposed=!0;for(var e of this._disposables)e.Dispose();this._disposables.clear(),this._disposables=null}Release(){this.Dispose()}}}{let C33=self.C3;C33.KahanSum=class KahanSum extends C33.DefendedBase{constructor(){super(),this._c=0,this._y=0,this._t=0,this._sum=0}Add(e){this._y=(e=+e)-this._c,this._t=this._sum+this._y,this._c=this._t-this._sum-this._y,this._sum=this._t}Subtract(e){this._sum-=+e}Get(){return this._sum}Reset(){this._c=0,this._y=0,this._t=0,this._sum=0}Set(e){this._c=0,this._y=0,this._t=0,this._sum=+e}Copy(e){this._c=e._c,this._y=e._y,this._t=e._t,this._sum=e._sum}Release(){}}}{let C33=self.C3,js_cols={},RED=!0,BLACK=!1;js_cols.RBnode=function(e){this.tree=e,this.right=this.tree.sentinel,this.left=this.tree.sentinel,this.parent=null,this.color=!1,this.key=null},js_cols.RedBlackSet=function(e){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=BLACK,this.root=this.sentinel,this.root.parent=this.sentinel,this.compare=e||this.default_compare},js_cols.RedBlackSet.prototype.default_compare=function(e,t){return e<t?-1:t<e?1:0},js_cols.RedBlackSet.prototype.clone=function(){var e=new js_cols.RedBlackSet(this.compare);return e.insertAll(this),e},js_cols.RedBlackSet.prototype.clear=function(){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=BLACK,this.root=this.sentinel,this.root.parent=this.sentinel},js_cols.RedBlackSet.prototype.leftRotate=function(e){var t=e.right;e.right=t.left,t.left!=this.sentinel&&(t.left.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,(t.left=e).parent=t},js_cols.RedBlackSet.prototype.rightRotate=function(e){var t=e.left;e.left=t.right,t.right!=this.sentinel&&(t.right.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,(t.right=e).parent=t},js_cols.RedBlackSet.prototype.insert=function(e){if(this.contains(e))this.get_(e).key=e;else{for(var t=new js_cols.RBnode(this),r=(t.key=e,this.sentinel),i=this.root;i!=this.sentinel;)r=i,i=this.compare(t.key,i.key)<0?i.left:i.right;(t.parent=r)==this.sentinel?this.root=t:this.compare(t.key,r.key)<0?r.left=t:r.right=t,t.left=this.sentinel,t.right=this.sentinel,t.color=RED,this.insertFixup(t),this.size++}},js_cols.RedBlackSet.prototype.insertFixup=function(e){for(;e!=this.sentinel&&e!=this.root&&e.parent.color==RED;){var t;e.parent==e.parent.parent.left?(t=e.parent.parent.right).color==RED?(e.parent.color=BLACK,t.color=BLACK,e.parent.parent.color=RED,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.leftRotate(e)),e.parent.color=BLACK,e.parent.parent.color=RED,e.parent.parent!=this.sentinel&&this.rightRotate(e.parent.parent)):(t=e.parent.parent.left).color==RED?(e.parent.color=BLACK,t.color=BLACK,e.parent.parent.color=RED,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rightRotate(e)),e.parent.color=BLACK,e.parent.parent.color=RED,e.parent.parent!=this.sentinel&&this.leftRotate(e.parent.parent))}this.root.color=BLACK},js_cols.RedBlackSet.prototype.delete_=function(e){var t=e.left==this.sentinel||e.right==this.sentinel?e:this.successor_(e),r=t.left!=this.sentinel?t.left:t.right;r.parent=t.parent,t.parent==this.sentinel?this.root=r:t==t.parent.left?t.parent.left=r:t.parent.right=r,t!=e&&(e.key=t.key),t.color==BLACK&&this.deleteFixup(r),this.size--},js_cols.RedBlackSet.prototype.deleteFixup=function(e){for(;e!=this.root&&e.color==BLACK;){var t;e=e==e.parent.left?((t=e.parent.right).color==RED&&(t.color=BLACK,e.parent.color=RED,this.leftRotate(e.parent),t=e.parent.right),t.left.color==BLACK&&t.right.color==BLACK?(t.color=RED,e.parent):(t.right.color==BLACK&&(t.left.color=BLACK,t.color=RED,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=BLACK,t.right.color=BLACK,this.leftRotate(e.parent),this.root)):((t=e.parent.left).color==RED&&(t.color=BLACK,e.parent.color=RED,this.rightRotate(e.parent),t=e.parent.left),t.right.color==BLACK&&t.left.color==BLACK?(t.color=RED,e.parent):(t.left.color==BLACK&&(t.right.color=BLACK,t.color=RED,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=BLACK,t.left.color=BLACK,this.rightRotate(e.parent),this.root))}e.color=BLACK},js_cols.RedBlackSet.prototype.remove=function(e){var t,e=this.get_(e);return e!=this.sentinel?(t=e.key,this.delete_(e),t):null},js_cols.RedBlackSet.prototype.removeSwapped=function(e,t){this.remove(t)},js_cols.RedBlackSet.prototype.min=function(e){for(;e.left!=this.sentinel;)e=e.left;return e},js_cols.RedBlackSet.prototype.max=function(e){for(;e.right!=this.sentinel;)e=e.right;return e},js_cols.RedBlackSet.prototype.successor_=function(e){if(e.right!=this.sentinel)return this.min(e.right);for(var t=e.parent;t!=this.sentinel&&e==t.right;)t=(e=t).parent;return t},js_cols.RedBlackSet.prototype.predeccessor_=function(e){if(e.left!=this.sentinel)return this.max(e.left);for(var t=e.parent;t!=this.sentinel&&e==t.left;)t=(e=t).parent;return t},js_cols.RedBlackSet.prototype.successor=function(e){if(0<this.size){var t=this.get_(e);if(t==this.sentinel)return null;if(t.right!=this.sentinel)return this.min(t.right).key;for(var r=t.parent;r!=this.sentinel&&t==r.right;)r=(t=r).parent;return r!=this.sentinel?r.key:null}return null},js_cols.RedBlackSet.prototype.predecessor=function(e){if(0<this.size){var t=this.get_(e);if(t==this.sentinel)return null;if(t.left!=this.sentinel)return this.max(t.left).key;for(var r=t.parent;r!=this.sentinel&&t==r.left;)r=(t=r).parent;return r!=this.sentinel?r.key:null}return null},js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key},js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key},js_cols.RedBlackSet.prototype.get_=function(e){for(var t=this.root;t!=this.sentinel&&0!=this.compare(t.key,e);)t=this.compare(e,t.key)<0?t.left:t.right;return t},js_cols.RedBlackSet.prototype.contains=function(e){return null!=this.get_(e).key},js_cols.RedBlackSet.prototype.getValues=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},js_cols.RedBlackSet.prototype.insertAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.insert(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.insert,this);else if("function"==js_cols.typeOf(e.getValues))for(var r=e.getValues(),t=0;t<r.length;t++)this.insert(r[t]);else if("object"==js_cols.typeOf(e))for(var i in e)this.insert(e[i])},js_cols.RedBlackSet.prototype.removeAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.remove(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.removeSwapped,this);else if("function"==js_cols.typeOf(e.getValues))for(var r=e.getValues(),t=0;t<r.length;t++)this.remove(r[t]);else if("object"==js_cols.typeOf(e))for(var i in e)this.remove(e[i])},js_cols.RedBlackSet.prototype.containsAll=function(e){if("array"==js_cols.typeOf(e)){for(var t=0;t<e.length;t++)if(!this.contains(e[t]))return!1;return!0}if("function"==js_cols.typeOf(e.forEach))return e.every(this.contains,this);if("function"==js_cols.typeOf(e.getValues)){for(var r=e.getValues(),t=0;t<r.length;t++)if(!this.contains(r[t]))return!1;return!0}if("object"==js_cols.typeOf(e)){for(var i in e)if(!this.contains(e[i]))return!1;return!0}},js_cols.RedBlackSet.prototype.range=function(e,t){var r=[];return this.traverseFromTo(function(e){r.push(e)},e,t),r},js_cols.RedBlackSet.prototype.traverse=function(e,t){if(!this.isEmpty())for(var r=this.min(this.root);r!=this.sentinel;){if(e.call(t,r.key,this))return;r=this.successor_(r)}},js_cols.RedBlackSet.prototype.traverseFrom=function(e,t,r){if(!this.isEmpty())for(var i=this.get_(t);i!=this.sentinel;){if(e.call(r,i.key,this))return;i=this.successor_(i)}},js_cols.RedBlackSet.prototype.traverseTo=function(e,t,r){if(!this.isEmpty())for(var i=this.min(this.root),s=this.get_(t);i!=s;){if(e.call(r,i.key,this))return;i=this.successor_(i)}},js_cols.RedBlackSet.prototype.traverseFromTo=function(e,t,r,i){if(!this.isEmpty())for(var s=this.get_(t),a=this.get_(r);s!=a;){if(e.call(i,s.key,this))return;s=this.successor_(s)}},js_cols.RedBlackSet.prototype.traverseBackwards=function(e,t){if(!this.isEmpty())for(var r=this.max(this.root);r!=this.sentinel;){if(e.call(t,r.key,this))return;r=this.predeccessor_(r)}},js_cols.RedBlackSet.prototype.forEach=function(e,t){if(!this.isEmpty())for(var r=this.min(this.root);r!=this.sentinel;r=this.successor_(r))e.call(t,r.key,r.key,this)},js_cols.RedBlackSet.prototype.some=function(e,t){if(!this.isEmpty())for(var r=this.min(this.root);r!=this.sentinel;r=this.successor_(r))if(e.call(t,r.key,r.key,this))return!0;return!1},js_cols.RedBlackSet.prototype.every=function(e,t){if(this.isEmpty())return!1;for(var r=this.min(this.root);r!=this.sentinel;r=this.successor_(r))if(!e.call(t,r.key,r.key,this))return!1;return!0},js_cols.RedBlackSet.prototype.map=function(e,t){var r=[];if(!this.isEmpty())for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))r.push(e.call(t,i.key,i.key,this));return r},js_cols.RedBlackSet.prototype.filter=function(e,t){var r=[];if(!this.isEmpty())for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.call(t,i.key,i.key,this)&&r.push(i.key);return r},js_cols.RedBlackSet.prototype.getCount=function(){return this.size},js_cols.RedBlackSet.prototype.isEmpty=function(){return 0==this.size},js_cols.RedBlackSet.prototype.isSubsetOf=function(e){var t=js_cols.getCount(e);if(this.getCount()>t)return!1;var r=0;if(this.isEmpty())return!0;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))js_cols.contains.call(e,e,i.key)&&r++;return r==this.getCount()},js_cols.RedBlackSet.prototype.intersection=function(e){var t=new js_cols.RedBlackSet(this.compare);if(!this.isEmpty())for(var r=this.min(this.root);r!=this.sentinel;r=this.successor_(r))e.contains.call(e,r.key,r.key,this)&&t.insert(r.key);return t},C33.RedBlackSet=class RedBlackSet extends C33.DefendedBase{constructor(e){super(),this._rbSet=new js_cols.RedBlackSet(e),this._enableQueue=!1,this._queueInsert=new Set,this._queueRemove=new Set}Add(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.delete(e):this._queueInsert.add(e):this._rbSet.insert(e)}Remove(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.add(e):this._queueInsert.delete(e):this._rbSet.remove(e)}Has(e){return this._enableQueue?!!this._queueInsert.has(e)||!this._queueRemove.has(e)&&this._rbSet.contains(e):this._rbSet.contains(e)}Clear(){this._rbSet.clear(),this._queueInsert.clear(),this._queueRemove.clear()}toArray(){if(this._enableQueue)throw new Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");var e=this._rbSet;return e.min(e.root).key}Shift(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");var e=this.Front();return this.Remove(e),e}SetQueueingEnabled(e){if(this._enableQueue!==(e=!!e)&&!(this._enableQueue=e)){for(var t of this._queueRemove)this._rbSet.remove(t);this._queueRemove.clear();for(var r of this._queueInsert)this._rbSet.insert(r);this._queueInsert.clear()}}ForEach(e){this._rbSet.forEach(e)}*values(){if(!this.IsEmpty()){var t=this._rbSet;for(let e=t.min(t.root);e!=t.sentinel;e=t.successor_(e))yield e.key}}[Symbol.iterator](){return this.values()}}}{let C33=self.C3;C33.PromiseThrottle=class PromiseThrottle{constructor(e=C33.hardwareConcurrency){this._maxParallel=e,this._queue=[],this._activeCount=0}Add(r){return new Promise((e,t)=>{this._queue.push({func:r,resolve:e,reject:t}),this._MaybeStartNext()})}_FindInQueue(r){for(let e=0,t=this._queue.length;e<t;++e)if(this._queue[e].func===r)return e;return-1}RemoveAndResolve(e,t){e=this._FindInQueue(e);if(-1===e)throw new Error("cannot find promise to resolve");this._queue[e].resolve(t),this._queue.splice(e,1)}RemoveAndReject(e,t){e=this._FindInQueue(e);if(-1===e)throw new Error("cannot find promise to reject");this._queue[e].reject(t),this._queue.splice(e,1)}async _MaybeStartNext(){if(this._queue.length&&!(this._activeCount>=this._maxParallel)){this._activeCount++;var t=this._queue.shift();try{var e=await t.func();t.resolve(e)}catch(e){t.reject(e)}this._activeCount--,this._MaybeStartNext()}}static async Batch(e,t){let r=[],i=!1;for(var s=[];e--;)s.push((async()=>{for(var e;e=t.pop();){if(i)return;try{r.push(await e())}catch(e){throw i=!0,e}}})());return await Promise.all(s),r}}}{let C33=self.C3;C33.RateLimiter=class RateLimiter{constructor(e,t,r){this._callback=e,this._interval=t,this._intervalOnBattery=r||2*t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1,this._callbackArguments=null}SetCanRunImmediate(e){this._canRunImmediate=!!e}_GetInterval(){return void 0!==C33.Battery&&C33.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...e){var t,r;-1===this._timerId&&(this._callbackArguments=e,t=(e=C33.FastGetDateNow())-this._lastCallTime,(r=this._GetInterval())<=t&&this._canRunImmediate?(this._lastCallTime=e,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(r-t,4)))}_RunCallback(){this._ignoreReset=!0;var e=this._callbackArguments;this._callbackArguments=null,e?this._callback(...e):this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=C33.FastGetDateNow())}_OnTimer(){this._timerId=-1,this._lastCallTime=C33.FastGetDateNow(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._callbackArguments=null,this._timerCallFunc=null}}}{let C33=self.C3;C33.SVGRasterManager=class SVGRasterManager{constructor(){this._images=new Map,this._allowNpotSurfaces=!1,this._getBaseSizeCallback=null,this._rasterAtSizeCallback=null,this._releaseResultCallback=null,this._redrawCallback=null}SetNpotSurfaceAllowed(e){this._allowNpotSurfaces=!!e}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(e){this._getBaseSizeCallback=e}GetBaseSize(e){if(this._getBaseSizeCallback)return this._getBaseSizeCallback(e);throw new Error("no get base size callback set")}SetRasterAtSizeCallback(e){this._rasterAtSizeCallback=e}RasterAtSize(e,t,r,i,s,a){if(this._rasterAtSizeCallback)return this._rasterAtSizeCallback(e,t,r,i,s,a);throw new Error("no raster at size callback set")}SetReleaseResultCallback(e){this._releaseResultCallback=e}ReleaseResult(e){if(!this._releaseResultCallback)throw new Error("no release result callback set");this._releaseResultCallback(e)}SetRedrawCallback(e){this._redrawCallback=e}Redraw(){if(!this._redrawCallback)throw new Error("no redraw callback set");this._redrawCallback()}AddImage(e){let t=this._images.get(e);return t||(t=C33.New(C33.SVGRasterImage,this,e),this._images.set(e,t)),t.IncReference(),t}_RemoveImage(e){this._images.delete(e.GetDataSource())}OnTexturesChanged(){for(var e of this._images.values())e.ReleaseRasterizedResult(),e.ForceRasterAgain()}}}{let C33=self.C3,MAX_SURFACE_SIZE=4096;C33.SVGRasterImage=class SVGRasterImage{constructor(e,t){this._manager=e,this._dataSource=t,this._refCount=0,this._baseWidth=0,this._baseHeight=0,this._getBaseSizePromise=this._manager.GetBaseSize(t).then(e=>{this._manager&&(this._baseWidth=e[0],this._baseHeight=e[1],this._manager.Redraw())}).catch(e=>{console.error("[SVG] Error loading SVG: ",e),this._hadError=!0,this._manager&&this._manager.Redraw()}),this._rasterSurfaceWidth=0,this._rasterSurfaceHeight=0,this._rasterImageWidth=0,this._rasterImageHeight=0,this._isRasterizing=!1,this._rasterizedResult=null,this._forceRaster=!1,this._hadError=!1}Release(){if(this._refCount<=0)throw new Error("already released");this._refCount--,0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult(),this._manager._RemoveImage(this),this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return 0<this._refCount}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(r,i,s){if(0!==i&&0!==s&&!this._hadError&&!this._isRasterizing){let e=C33.nextHighestPowerOfTwo(Math.ceil(i)),t=C33.nextHighestPowerOfTwo(Math.ceil(s));var a=Math.max(e,t);a>MAX_SURFACE_SIZE&&(i*=a=MAX_SURFACE_SIZE/a,s*=a,e=Math.min(Math.ceil(e*a),MAX_SURFACE_SIZE),t=Math.min(Math.ceil(t*a),MAX_SURFACE_SIZE)),i<e&&s<t&&(s=(a=i/s)<e/t?(i=t*a,t):(i=e)/a),this._manager.IsNpotSurfaceAllowed()&&(e=Math.ceil(i),t=Math.ceil(s)),e<=this._rasterSurfaceWidth&&t<=this._rasterSurfaceHeight&&!this._forceRaster||(this._isRasterizing=!0,this._rasterSurfaceWidth=e,this._rasterSurfaceHeight=t,a=await this._manager.RasterAtSize(this._dataSource,r,this._rasterSurfaceWidth,this._rasterSurfaceHeight,i,s),this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=a,this._rasterImageWidth=i,this._rasterImageHeight=s,this._isRasterizing=!1,this._forceRaster=!1,this._manager.Redraw()))}}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}}}{let lookupHtmlEntity2=function(e){return HTML_ENTITY_MAP.get(e)},C33=(lookupHtmlEntity=lookupHtmlEntity2,self.C3),NUMERIC_CHARS=(C33.UTF8_BOM="\ufeff",new Set("0123456789")),WHITESPACE_CHARS=(C33.IsNumericChar=function(e){return NUMERIC_CHARS.has(e)},new Set(" \t\n\r            ​\u2028\u2029  　")),cjkPunctuationRegex=(C33.IsWhitespaceChar=function(e){return WHITESPACE_CHARS.has(e)},C33.FilterWhitespace=function(e){return[...e].filter(e=>!C33.IsWhitespaceChar(e)).join("")},C33.IsStringAllWhitespace=function(e){for(var t of e)if(!C33.IsWhitespaceChar(t))return!1;return!0},C33.IsCharArrayAllWhitespace=function(e){for(var t of e)if(!C33.IsWhitespaceChar(t))return!1;return!0},C33.IsUnprintableChar=function(e){return 1===e.length&&e.charCodeAt(0)<32},C33.FilterUnprintableChars=function(e){return[...e].filter(e=>!C33.IsUnprintableChar(e)).join("")},null);try{cjkPunctuationRegex=new RegExp("\\p{P}(?<=[\\u3000-\\u303F\\uFF00-\\uFFEF])","u")}catch(err){console.warn("Unable to detect CJK punctuation: ",err)}C33.IsCJKPunctuationChar=function(e){return!C33.IsWhitespaceChar(e)&&cjkPunctuationRegex&&cjkPunctuationRegex.test(e)};let NUMERIC_STRING_CHARS=new Set("0123456789.+-e"),HTML_ENTITY_MAP=(C33.IsStringNumber=function(e){if(!(e=e.trim()).length)return!1;var t,r=e.charAt(0);if("-"!==r&&!NUMERIC_CHARS.has(r))return!1;for(t of e)if(!NUMERIC_STRING_CHARS.has(t))return!1;return!0},C33.RemoveTrailingDigits=function(e){let t=e.length;for(;0<t;){var r=e.charAt(t-1);if(!C33.IsNumericChar(r))break;--t}return e.substr(0,t)},C33.IncrementNumberAtEndOf=function(e){var t=C33.RemoveTrailingDigits(e);let r=e.substr(t.length);return t+(r=r?(parseInt(r,10)+1).toString():"2")},new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]])),HTML_ENTITY_REGEX=/[&<>"']/g,ESCAPE_REGEX=(C33.EscapeHTML=function(e){return e.replace(HTML_ENTITY_REGEX,lookupHtmlEntity2)},C33.EscapeJS=function(e){e=C33.ReplaceAll(e,"\\","\\\\"),e=C33.ReplaceAll(e,'"','\\"');return e=C33.ReplaceAll(e,"\t","\\t"),e=C33.ReplaceAll(e,"\r",""),C33.ReplaceAll(e,"\n","\\n")},C33.EscapeXML=function(e){e=C33.ReplaceAll(e,"&","&amp;"),e=C33.ReplaceAll(e,"<","&lt;");return e=C33.ReplaceAll(e,">","&gt;"),C33.ReplaceAll(e,'"',"&quot;")},/[-[\]{}()*+?.,\\^$|#\s]/g),intlSegmenter=(C33.EscapeRegex=function(e){return e.replace(ESCAPE_REGEX,"\\$&")},C33.CountCharsInString=function(e,t){let r=0;for(var i of e)i===t&&++r;return r},C33.FindAll=function(e,t,r=!1){if(!t)return[];r||(e=e.toLowerCase(),t=t.toLowerCase());var i=t.length;let s=0;for(var a,n=[];-1<(a=e.indexOf(t,s));)n.push(a),s=a+i;return n},C33.ReplaceAll=function(e,t,r){return e.replaceAll(t,()=>r)},C33.ReplaceAllCaseInsensitive=function(e,t,r){return e.replace(new RegExp(C33.EscapeRegex(t),"gi"),()=>r)},C33.SetElementContent=function(e,t){"string"==typeof t?e.textContent=t:t.isPlainText()?e.textContent=t.toString():(e.innerHTML=t.toHTML(),t instanceof C33.BBString&&t.attachLinkHandlers(e))},C33.StringLikeEquals=function(e,t){return e instanceof C33.HtmlString||e instanceof C33.BBString?e.equals(t):t instanceof C33.HtmlString||t instanceof C33.BBString?t.equals(e):e===t},C33.StringSubstitute=function(r,...i){let s=r;for(let e=0,t=i.length;e<t;++e){var a=`{${e}}`;if(!r.includes(a))throw new Error(`missing placeholder '${a}' in string substitution`);s=s.replace(a,i[e].toString())}return s},C33.StringSubstituteAllowMissing=function(r,...i){let s=r,a=-1,n=-1;for(let e=0,t=i.length;e<t;++e){var o=`{${e}}`;r.includes(o)?(n=e,s=s.replace(o,i[e].toString())):-1===a&&(a=e)}if(0<=a&&0<=n&&a<n)throw new Error(`missing placeholder '${a}' in string substitution`);return s},C33.StringSubstituteMap=function(e,t){let r=e;for(var[i,s]of Object.entries(t))r=r.replaceAll(i,s.toString());return r},C33.SortAZ=function(e,t){return t<e?1:e<t?-1:0},C33.SortAZCaseInsensitive=function(e,t){e=e.toLowerCase(),t=t.toLowerCase();return t<e?1:e<t?-1:0},null),graphemeSplitter=null,KILOBYTE=(self.Intl&&self.Intl.Segmenter?intlSegmenter=new self.Intl.Segmenter:graphemeSplitter=new self.GraphemeSplitter,C33.SplitGraphemes=function(e){if(intlSegmenter){var t,r=[];for(t of intlSegmenter.segment(e))r.push(t.segment);return r}return graphemeSplitter.splitGraphemes(e)},C33.IterateGraphemes=function*(e){if(intlSegmenter)for(var t of intlSegmenter.segment(e))yield t.segment;else yield*graphemeSplitter.iterateGraphemes(e)},C33.CountGraphemes=function(t){if(intlSegmenter){let e=0;for(var r of intlSegmenter.segment(t))++e;return e}return graphemeSplitter.countGraphemes(t)},1024),MEGABYTE=1024*KILOBYTE,GIGABYTE=1024*MEGABYTE,TERABYTE=1024*GIGABYTE,DEFAULT_FORMATTIME_OPTS=(C33.FormatDataSize=function(t,r){var r="common."+(r?"dataRates":"dataSizes")+".",i=self.langSub;if(t<KILOBYTE)return i(r+"bytes",t);if(t<MEGABYTE){let e=t/KILOBYTE;return i(r+"kilobytes",e=e<10?Math.round(10*e)/10:Math.round(e))}if(t<GIGABYTE){let e=t/MEGABYTE;return i(r+"megabytes",e=e<10?Math.round(10*e)/10:Math.round(e))}if(t<TERABYTE){let e=t/GIGABYTE;return i(r+"gigabytes",e=e<10?Math.round(10*e)/10:Math.round(e))}{let e=t/TERABYTE;return i(r+"terabytes",e=e<10?Math.round(10*e)/10:Math.round(e))}},{approximate:!1,days:!0,hours:!0,minutes:!0,seconds:!0});C33.FormatTime=function(e,t){t=Object.assign({},DEFAULT_FORMATTIME_OPTS,t),C33.Lang.PushContext("common.time");var r,i=[],s=self.lang,a=self.langPluralSub,e=(t.days&&0<(r=Math.floor(e/86400))&&(e-=24*r*3600,i.push(a(".days",null,r))),t.hours&&(0<(r=Math.floor(e/3600))||i.length)&&(e-=3600*r,i.push(a(".hours",null,r))),t.minutes&&(0<(r=Math.floor(e/60))||i.length||!t.seconds)&&(e-=60*r,i.push(a(".minutes",null,r))),t.seconds&&(r=Math.floor(e%60),i.push(a(".seconds",null,r))),(t.approximate?s(".approx-prefix"):"")+i.join(s(".separator")));return C33.Lang.PopContext(),e},C33.ZeroPad=function(e,t){let r=e<0?"-":"";var e=(e=Math.abs(e)).toString(),i=t-e.length;for(let e=0;e<i;++e)r+="0";return r+e},C33.StringToTitleCase=function(e){return e.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())},C33.CompareVersionStrings=function(e,t){let r=e.split(".").map(e=>e.trim()),i=t.split(".").map(e=>e.trim());C33.resizeArray(r,4,"0"),C33.resizeArray(i,4,"0"),r=r.map(e=>parseInt(e,10)),i=i.map(e=>parseInt(e,10));for(let e=0;e<4;++e){var s=r[e]-i[e];if(0!=s)return s<0?-1:1}return 0},C33.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)})},C33.StringHammingDistance=function(r,i){if(r.length!==i.length)throw new Error("strings must be same length");let s=0;for(let e=0,t=r.length;e<t;++e)r.charAt(e)!==i.charAt(e)&&++s;return s},C33.StringLevenshteinDistance=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;let r,i,s,a,n,o;for(t.length<e.length&&(r=e,e=t,t=r),o=Array(e.length+1),i=0;i<=e.length;i++)o[i]=i;for(i=1;i<=t.length;i++){for(a=i,s=1;s<=e.length;s++)n=t[i-1]===e[s-1]?o[s-1]:Math.min(o[s-1]+1,Math.min(a+1,o[s]+1)),o[s-1]=a,a=n;o[e.length]=a}return o[e.length]}}{let bbToHtmlReplacerFunc2=function(e,t,r){var i=BB_CODE_MAP.get(r);if(!i)return"class"===r?t?"</span>":`<span class="bbclass${classIndex++}">`:e;if("string"!=typeof i)return Array.isArray(i)?(s=i[0],a=i[1],t?"</"+s+">":`<${s} class="${a}">`):void 0;if("a"===i&&0===linkActions.length||"abbr"===i&&0===tipList.length)return e;if("a"!==i||t){if("abbr"!==i||t)return"<"+t+i+">";{var s=parseInt(r.substring(3),10)-1;if(s<0||s>=tipList.length)throw new Error("invalid bbcode tip substitution");var a=tipList[s];let e="";if("string"==typeof a?e=a:"function"==typeof a&&(e=a()),"string"!=typeof e)throw new TypeError("invalid bbcode tip");return`<abbr title="${C33.ReplaceAll(e,'"',"&quot;")}">`}}e=parseInt(r.substring(1),10)-1;if(e<0||e>=linkActions.length)throw new Error("invalid bbcode link substitution");t=linkActions[e];if("string"==typeof t)return`<a href="${linkActions[e]}">`;if("function"==typeof t)return`<a class="bblink${e}">`;throw new TypeError("invalid bbcode link action")},C33=(bbToHtmlReplacerFunc=bbToHtmlReplacerFunc2,self.C3),assert=self.assert,BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),SELF_CLOSING_TAGS=new Set(["icon"]),BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g,CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g,linkActions=null,tipList=null,classIndex=0,LINEBREAK_REGEX=/\n/g;C33.BBString=class BBString{constructor(e,t){if(this._bbstr=t&&t.noEscape?e:C33.EscapeHTML(e),this._htmlstr="",this._convertLineBreaks=!1,this._linkActions=[],this._tipList=[],t){if(this._convertLineBreaks=!!t.convertLineBreaks,t.links){if(9<t.links.length)throw new Error("too many links");this._linkActions=t.links}if(t.tips){if(9<t.tips.length)throw new Error("too many tips");this._tipList=t.tips}}this._hasAnyBBtags=this._bbstr.includes("["),this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n"),this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&"),this._hasParsedFragments=!1,this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(BBREGEX,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let e=this._bbstr;this._hasAnyBBtags&&(classIndex=0,linkActions=this._linkActions,tipList=this._tipList,e=e.replace(BBREGEX,bbToHtmlReplacerFunc2),linkActions=null,tipList=null),this._needsLineBreakConversion&&(e=e.replace(LINEBREAK_REGEX,"<br>")),this._htmlstr=e}return this._htmlstr}attachLinkHandlers(r){if(this._linkActions.length)for(let e=0,t=this._linkActions.length;e<t;++e){var i=this._linkActions[e];if("function"==typeof i){var s=r.querySelector(".bblink"+e);if(!s)throw new Error("unable to attach BBString link handler");s.onclick=i}}}equals(e){return e instanceof C33.HtmlString?this.toHTML()===e.toHTML():e instanceof C33.BBString?this._bbstr===e._bbstr:this._bbstr===e}toFragmentList(){if(!this._hasParsedFragments){var r=[],t=this._bbstr,i=[];let e=CUSTOM_BBREGEX.lastIndex=0;for(var s;null!==(l=CUSTOM_BBREGEX.exec(t));){var a=l.index;if(!(0<a&&"\\"===t.charAt(a-1))){var n=l[0],o=l[1],l=l[2],h=t.substring(e,a);if(e=a+n.length,h&&r.push({text:h,styles:i.slice(0)}),l)if(o){var u=l.toLowerCase();for(let e=i.length-1;0<=e;--e)if(i[e].tag===u){i.splice(e,1);break}}else{let e=l,t=null;a=l.indexOf("=");if(-1!==a?(e=l.substring(0,a).toLowerCase(),t=l.substring(a+1)):e=e.toLowerCase(),SELF_CLOSING_TAGS.has(e)){if("icon"!==e)throw new Error("unknown self-closing tag "+e);r.push({icon:t,styles:i.slice(0)})}else i.push({tag:e,param:t})}}}e<t.length&&r.push({text:t.substring(e),styles:i.slice(0)});for(s of r)s.text&&(s.text=this._ProcessBBCodeEscapeSequences(s.text));this._fragments=r.map(e=>e.icon?C33.New(C33.IconFragment,{icon:e.icon,styles:e.styles}):C33.New(C33.TextFragment,{chArr:C33.SplitGraphemes(e.text),styles:e.styles})),this._hasParsedFragments=!0}return this._fragments}_ProcessBBCodeEscapeSequences(e){return e=C33.ReplaceAll(e,"\\[","["),C33.ReplaceAll(e,"\\\\","\\")}static StripTags(e){return C33.New(C33.BBString,e,{noEscape:!0}).toPlainText()}static StripAnyTags(e){return e.replace(CUSTOM_BBREGEX,"")}}}{let IsWordBreakWhiteSpace2=function(e){return" "!==e&&" "!==e&&C33.IsWhitespaceChar(e)},IsOpeningCJKPunctiationChar2=function(e){return CJK_OPEN_PUNCTUATION.has(e)},IsContinuingCJKPunctuationChar2=function(e){return C33.IsCJKPunctuationChar(e)&&!IsOpeningCJKPunctiationChar2(e)},WordBreakTrimEnd2=function(e){for(;0<e.length&&IsWordBreakWhiteSpace2(e.at(-1));)e.pop()},IsNewline2=function(e){return"\n"===e||"\r\n"===e},C33=(IsWordBreakWhiteSpace=IsWordBreakWhiteSpace2,IsOpeningCJKPunctiationChar=IsOpeningCJKPunctiationChar2,IsContinuingCJKPunctuationChar=IsContinuingCJKPunctuationChar2,WordBreakTrimEnd=WordBreakTrimEnd2,IsNewline=IsNewline2,self.C3),CJK_OPEN_PUNCTUATION=new Set("〈《「『【〔〖〘〚〝");C33.WordWrap=class WordWrap{constructor(){this._lines=[],this._iconSet=null}GetLines(){return this._lines}GetLineCount(){return this._lines.length}SetIconSet(e){this._iconSet=e}_MeasureLine(e,t){let r=0,i=0,s=0,a=0,n=0;for(var o of e){var l;-1===o.GetWidth()&&(l=t(o),o.SetHeight(l.height),o.SetFontBoundingBoxAscent(l.fontBoundingBoxAscent||0),o.SetFontBoundingBoxDescent(l.fontBoundingBoxDescent||0),o.SetTopToAlphabeticDistance(l.topToAlphabeticDistance||0),o.IsText()?o.SetWidth(l.width):o.IsIcon()&&o.CalculateWidthFromHeight(this._iconSet)),r+=o.GetWidth(),i=Math.max(i,o.GetHeight()),s=Math.max(s,o.GetFontBoundingBoxAscent()),a=Math.max(a,o.GetFontBoundingBoxDescent()),n=Math.max(n,o.GetTopToAlphabeticDistance())}return{width:r,height:i,fontBoundingBoxAscent:s,fontBoundingBoxDescent:a,topToAlphabeticDistance:n}}_AddLine(e,t,r,i,s,a){this._lines.push(C33.New(C33.WordWrap.Line,{fragments:e,width:t,height:r,fontBoundingBoxAscent:i,fontBoundingBoxDescent:s,topToAlphabeticDistance:a}))}WordWrap(t,r,i,s,a){if("string"==typeof t&&(t=[C33.New(C33.TextFragment,{chArr:C33.SplitGraphemes(t)})]),C33.clearArray(this._lines),!(!t.length||1===t.length&&t[0].IsText()&&t[0].IsEmpty()||i<2)){if(1===t.length){var n=t[0];if(n.IsText()&&n.GetLength()<=100&&!n.HasNewLine()){var{width:o,height:l,fontBoundingBoxAscent:h,fontBoundingBoxDescent:u,topToAlphabeticDistance:c}=r(n);if(n.SetWidth(o+=a),n.SetHeight(l),n.SetFontBoundingBoxAscent(h||0),n.SetFontBoundingBoxDescent(u||0),n.SetTopToAlphabeticDistance(c||0),o<=i)return void this._AddLine([n],o,l,h,u,c)}}let e;e="word"===s?this._TokeniseByWord(t):"cjk"===s?this._TokeniseByCJK(t):this._TokeniseByChar(t),this._WrapText(e,r,i,a)}}_TokeniseByWord(e){var t,r=[];let i=[],s=!1;for(t of e){var a,n,o=t.GetStyles();if(t.IsIcon())0<i.length&&r.push(i),r.push([t]),i=[];else for(var l of t.GetCharacterArray())IsNewline2(l)?(0<i.length&&r.push(i),r.push([C33.New(C33.TextFragment,{chArr:["\n"],styles:o})]),i=[]):0===i.length?(i.push(C33.New(C33.TextFragment,{chArr:[l],styles:o})),s=IsWordBreakWhiteSpace2(l)):(a=IsWordBreakWhiteSpace2(l))===s?(n=i.at(-1)).GetStyles()===o?n._AppendChar(l):i.push(C33.New(C33.TextFragment,{chArr:[l],styles:o})):(r.push(i),i=[C33.New(C33.TextFragment,{chArr:[l],styles:o})],s=a)}return 0<i.length&&r.push(i),r}_TokeniseByCJK(e){var t,r=[];let i=[],s=!1;for(t of e){var a,n=t.GetStyles();if(t.IsIcon())0<i.length&&r.push(i),r.push([t]),i=[];else for(var o of t.GetCharacterArray())IsNewline2(o)?(0<i.length&&r.push(i),r.push([C33.New(C33.TextFragment,{chArr:["\n"],styles:n})]),i=[]):s=(0===i.length?i.push(C33.New(C33.TextFragment,{chArr:[o],styles:n})):s||IsContinuingCJKPunctuationChar2(o)?(a=i.at(-1)).GetStyles()===n?a._AppendChar(o):i.push(C33.New(C33.TextFragment,{chArr:[o],styles:n})):(r.push(i),i=[C33.New(C33.TextFragment,{chArr:[o],styles:n})]),IsOpeningCJKPunctiationChar2(o))}return 0<i.length&&r.push(i),r}_TokeniseByChar(e){var r,i=[];for(let t of e)t.IsText()?(r=t.GetCharacterArray(),C33.appendArray(i,r.map(e=>[C33.New(C33.TextFragment,{chArr:[e],styles:t.GetStyles()})]))):i.push([t]);return i}_CopyLine(e){return e.map(e=>e._Clone())}_AddWordToLine(e,t){var r=e.length?e.at(-1):null;let i=0;r&&r.IsText()&&t[0].IsText()&&t[0].GetStyles()===r.GetStyles()&&(r._Append(t[0].GetCharacterArray()),i=1);for(var s=t.length;i<s;++i){var a=t[i];e.push(a._Clone())}}_WrapText(e,t,r,i){let s=[],a=0,n=0,o=0,l=0,h=0;for(var u of e){var c,_,d;1===u.length&&u[0].IsText()&&1===u[0].GetLength()&&IsNewline2(u[0].GetCharacterArray()[0])?(0===n&&(c=t(C33.New(C33.TextFragment,{chArr:[" "],styles:u[0].GetStyles()})),n=c.height,o=c.fontBoundingBoxAscent||0,l=c.fontBoundingBoxDescent||0,h=c.topToAlphabeticDistance||0),this._AddLine(s,a,n,o,l,h),s=[],a=0,n=0,o=0,l=0,h=0):(c=this._CopyLine(s),this._AddWordToLine(c,u),d=(_=this._MeasureLine(c,t)).width,h=r<=d?(0<s.length&&this._AddLine(s,a,n,o,l,h),s=[],u[0].IsText()&&C33.IsCharArrayAllWhitespace(u[0].GetCharacterArray())?(a=0,n=0,o=0,l=0):(this._AddWordToLine(s,u),u=this._MeasureLine(s,t),a=u.width,n=u.height,o=u.fontBoundingBoxAscent,l=u.fontBoundingBoxDescent,u.topToAlphabeticDistance)):(s=c,a=d,n=_.height,o=_.fontBoundingBoxAscent,l=_.fontBoundingBoxDescent,_.topToAlphabeticDistance))}0<s.length&&this._AddLine(s,a,n,o,l,h),this._TrimLinesTrailingWhitespace(t,i)}_TrimLinesTrailingWhitespace(t,r){for(var i of this._lines){var s,a,n=i._GetFragmentsArray();if(n.length){let e=n.at(-1);e.IsText()&&(a=(s=e.GetCharacterArray()).slice(0),WordBreakTrimEnd2(a),0===a.length?(i.OffsetWidth(-e.GetWidth()),n.pop()):a.length<s.length&&(e.SetCharacterArray(a),s=t(e).width,a=e.GetWidth()-s,e.SetWidth(s),i.OffsetWidth(-a)),0!==r)&&0<n.length&&((e=n.at(-1)).OffsetWidth(r),i.OffsetWidth(r))}}}Clear(){C33.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce((e,t)=>Math.max(e,t.GetWidth()),0)}GetTotalLineHeight(){return this._lines.reduce((e,t)=>e+t.GetHeight(),0)}}}{let C33=self.C3;C33.WordWrap.Line=class WordWrapLine{constructor(e){this._fragments=e.fragments||[],this._width=e.width||-1,this._height=e.height||-1,this._fontBoundingBoxAscent=e.fontBoundingBoxAscent||-1,this._fontBoundingBoxDescent=e.fontBoundingBoxDescent||-1,this._topToAlphabeticDistance=e.topToAlphabeticDistance||-1,this._posX=0,this._posY=0}fragments(){return this._fragments.values()}*fragmentsReverse(){var t=this._fragments;for(let e=t.length-1;0<=e;--e)yield t[e]}_GetFragmentsArray(){return this._fragments}OffsetWidth(e){this._width+=e}GetWidth(){return this._width}GetHeight(){return this._height}GetFoundBoundingBoxAscent(){return this._fontBoundingBoxAscent}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(e){this._posX=e}GetPosX(){return this._posX}SetPosY(e){this._posY=e}GetPosY(){return this._posY}}}{let C33=self.C3;C33.FragmentBase=class FragmentBase{constructor(e){this._styles=e.styles||[],this._width=e.width||-1,this._height=e.height||-1,this._fontBoundingBoxAscent=e.fontBoundingBoxAscent||-1,this._fontBoundingBoxDescent=e.fontBoundingBoxDescent||-1,this._topToAlphabeticDistance=e.topToAlphabeticDistance||-1,this._posX=0,this._posY=0}IsText(){return!1}IsIcon(){return!1}GetStyles(){return this._styles}GetStyleTag(t){var r=this._styles;for(let e=r.length-1;0<=e;--e){var i=r[e];if(i.tag===t)return i}return null}HasStyleTag(e){return!!this.GetStyleTag(e)}GetStyleMap(){var e,t=new Map;for(e of this._styles)t.set(e.tag,e.param);return t}OffsetWidth(e){this._width+=e}SetWidth(e){this._width=e}GetWidth(){return this._width}SetHeight(e){this._height=e}GetHeight(){return this._height}SetFontBoundingBoxAscent(e){this._fontBoundingBoxAscent=e}GetFontBoundingBoxAscent(){return this._fontBoundingBoxAscent}SetFontBoundingBoxDescent(e){this._fontBoundingBoxDescent=e}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}SetTopToAlphabeticDistance(e){this._topToAlphabeticDistance=e}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(e){this._posX=e}GetPosX(){return this._posX}SetPosY(e){this._posY=e}GetPosY(){return this._posY}}}{let C33=self.C3;C33.TextFragment=class TextFragment extends C33.FragmentBase{constructor(e){super(e),this._chArr=e.chArr}IsText(){return!0}_Append(e){C33.appendArray(this._chArr,e),this._width=-1,this._height=-1,this._fontBoundingBoxAscent=-1,this._fontBoundingBoxDescent=-1,this._topToAlphabeticDistance=-1}_AppendChar(e){this._chArr.push(e)}_Clone(){return C33.New(C33.TextFragment,{chArr:this._chArr.slice(0),styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetCharacterArray(){return this._chArr}SetCharacterArray(e){this._chArr=e}GetLength(){return this._chArr.length}IsEmpty(){return 0===this._chArr.length}HasNewLine(){return this._chArr.includes("\n")}}}{let C33=self.C3;C33.IconFragment=class IconFragment extends C33.FragmentBase{constructor(e){super(e),this._icon=e.icon}IsIcon(){return!0}GetIconParameter(){return this._icon}_Clone(){return C33.New(C33.IconFragment,{icon:this._icon,styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetTextIcon(e){var t;return e?(t=Number(this._icon),String(t)===this._icon?(t=Math.floor(t),e.GetTextIconByIndex(t)):e.GetTextIconByTag(this._icon)):null}CalculateWidthFromHeight(e){e=this.GetTextIcon(e);this._width=e?this._height*e.GetWidth()/e.GetHeight():0}GetDrawable(e){e=this.GetTextIcon(e);return e?e.GetDrawable():null}GetLength(){return 1}}}{let C33=self.C3;C33.TextIconManager=class TextIconManager{constructor(e){this._iconSets=new Map,this._getIconSetMetaCallback=e.getIconSetMeta,this._getIconSetContentCallback=e.getIconSetContent}Release(){for(var e of this._iconSets.values())e.Release();this._iconSets.clear()}GetIconSet(e){var t,r=this._iconSets.get(e);return r||(t=this._getIconSetMetaCallback(e),r=C33.New(C33.TextIconSet,this,{source:e,iconMeta:t}),this._iconSets.set(e,r)),r}HasIconSet(e){return this._iconSets.has(e)}DeleteIconSet(e){var t=this._iconSets.get(e);t&&t.Release(),this._iconSets.delete(e)}async _GetIconSetContent(e){return this._getIconSetContentCallback(e)}}}{let C33=self.C3;C33.TextIconSet=class TextIconSet{constructor(e,t){this._textIconManager=e,this._source=t.source,this._iconsArray=[],this._iconsByTag=new Map,this._hasStartedLoad=!1,this._isLoading=!1,this._loadPromise=null;var r=t.iconMeta.icons;for(let e=0,t=r.length;e<t;++e){var i=r[e],s=C33.New(C33.TextIcon,this,{index:e,tag:i.tag,source:i.source,width:i.width,height:i.height});this._iconsArray.push(s),i.tag&&this._iconsByTag.set(i.tag.toLowerCase(),s)}}Release(){for(var e of this._iconsArray)e.Release();C33.clearArray(this._iconsArray),this._iconsByTag.clear(),this._textIconManager=null,this._source=null}HasLoaded(){return this._hasStartedLoad}IsLoading(){return this._isLoading}LoadContent(){return this._loadPromise||(this._loadPromise=this._DoLoadContent()),this._loadPromise}async _DoLoadContent(){if(!this._hasStartedLoad){this._hasStartedLoad=!0,this._isLoading=!0;var e=await this._textIconManager._GetIconSetContent(this._source);if(this._textIconManager){var r=e.icons;for(let e=0,t=Math.min(r.length,this._iconsArray.length);e<t;++e){var i=r[e].drawable;this._iconsArray[e]._SetDrawable(i)}this._isLoading=!1}}}GetTextIconByIndex(e){return(e=Math.floor(e))<0||e>=this._iconsArray.length?null:this._iconsArray[e]}GetTextIconByTag(e){return this._iconsByTag.get(e.toLowerCase())||null}}}{let C33=self.C3;C33.TextIcon=class TextIcon{constructor(e,t){this._textIconSet=e,this._source=t.source||null,this._index=t.index,this._tag=t.tag,this._width=t.width,this._height=t.height,this._drawable=null}Release(){this._width=0,this._height=0,this._textIconSet=null}GetSource(){return this._source}GetWidth(){return this._width}GetHeight(){return this._height}_SetDrawable(e){this._drawable=e}GetDrawable(){return this._drawable}}}{let PlaneFromPoints2=function(e,t,r,i){var s=tempVec3c;vec32.subtract(tempVec3a,r,t),vec32.subtract(tempVec3b,e,t),vec32.cross(s,tempVec3a,tempVec3b),vec32.normalize(s,s),i.set(s[0],s[1],s[2],vec32.dot(e,s))},IsInFrontOfPlane2=function(e,t,r,i,s,a,n){var o=n.x,l=n.y,h=n.z,u=n.w,c=n.xF,_=n.yF,n=n.zF,d=1-c,p=1-_,m=1-n;return u<=o*e*c+o*i*d+l*t*_+l*s*p+h*r*n+h*a*m||u<o*i*c+o*e*d+l*s*_+l*t*p+h*a*n+h*r*m},IsPointInFrontOfPlane2=function(e,t,r,i){var s=i.x;return i.w<=s*e+i.y*t+i.z*r},C33=(PlaneFromPoints=PlaneFromPoints2,IsInFrontOfPlane=IsInFrontOfPlane2,IsPointInFrontOfPlane=IsPointInFrontOfPlane2,self.C3),glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempVec3a=vec32.create(),tempVec3b=vec32.create(),tempVec3c=vec32.create(),tempVec4=vec42.create(),tempMat4=mat42.create(),neartl=vec32.create(),neartr=vec32.create(),nearbl=vec32.create(),nearbr=vec32.create(),fartl=vec32.create(),fartr=vec32.create(),farbl=vec32.create(),farbr=vec32.create(),unitViewport=vec42.fromValues(0,0,1,1);C33.Gfx={Project(e,t,r,i,s,a,n){var o=i[0]*e+i[4]*t+i[8]*r+i[12],l=i[1]*e+i[5]*t+i[9]*r+i[13],h=i[2]*e+i[6]*t+i[10]*r+i[14],e=i[3]*e+i[7]*t+i[11]*r+i[15],t=s[0]*o+s[4]*l+s[8]*h+s[12]*e,r=s[1]*o+s[5]*l+s[9]*h+s[13]*e,i=s[2]*o+s[6]*l+s[10]*h+s[14]*e,o=s[3]*o+s[7]*l+s[11]*h+s[15]*e;return 0!=o&&(r*=o=1/o,i*=o,n[0]=(.5*(t*=o)+.5)*a[2]+a[0],n[1]=(.5*r+.5)*a[3]+a[1],n[2]=.5*(1+i),!0)},Unproject(e,t,r,i,s,a,n){var o=tempMat4,l=tempVec4;return mat42.multiply(o,s,i),null!==mat42.invert(o,o)&&(l[0]=(e-a[0])/a[2]*2-1,l[1]=(t-a[1])/a[3]*2-1,l[2]=2*r-1,l[3]=1,vec42.transformMat4(l,l,o),0!==l[3])&&(l[3]=1/l[3],n[0]=l[0]*l[3],n[1]=l[1]*l[3],n[2]=l[2]*l[3],!0)},UnprojectScreenToWorldZ(e,t,r,i,s,a,n){var o=tempVec3a,l=tempVec3b;if(!C33.Gfx.Unproject(e,t,0,i,s,a,o))return!1;if(!C33.Gfx.Unproject(e,t,1,i,s,a,l))return!1;e=tempVec3b,vec32.subtract(e,l,o),t=tempVec3c,vec32.set(t,0,0,1),i=-r,s=vec32.dot(t,e);let h=0;if(0===s){if(0!==vec32.dot(t,o)+i)return!1}else if((h=-(vec32.dot(o,t)+i)/s)<0)return!1;return vec32.scaleAndAdd(n,o,e,h),!0}};class Plane{constructor(){this.x=NaN,this.y=NaN,this.z=NaN,this.w=NaN,this.xF=NaN,this.yF=NaN,this.zF=NaN}set(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i,this.xF=0<e?1:0,this.yF=0<t?1:0,this.zF=0<r?1:0}}C33.Gfx.ViewFrustum=class ViewFrustum{constructor(){this._leftP=new Plane,this._topP=new Plane,this._rightP=new Plane,this._bottomP=new Plane,this._nearP=new Plane,this._farP=new Plane}CalculatePlanes(e,t){var r=unitViewport;C33.Gfx.Unproject(0,1,0,e,t,r,neartl),C33.Gfx.Unproject(1,1,0,e,t,r,neartr),C33.Gfx.Unproject(0,0,0,e,t,r,nearbl),C33.Gfx.Unproject(1,0,0,e,t,r,nearbr),C33.Gfx.Unproject(0,1,1,e,t,r,fartl),C33.Gfx.Unproject(1,1,1,e,t,r,fartr),C33.Gfx.Unproject(0,0,1,e,t,r,farbl),C33.Gfx.Unproject(1,0,1,e,t,r,farbr),PlaneFromPoints2(nearbl,neartl,fartl,this._leftP),PlaneFromPoints2(neartl,neartr,fartr,this._topP),PlaneFromPoints2(neartr,nearbr,farbr,this._rightP),PlaneFromPoints2(nearbr,nearbl,farbl,this._bottomP),PlaneFromPoints2(farbl,fartl,fartr,this._farP),PlaneFromPoints2(nearbr,neartr,neartl,this._nearP)}ContainsAABB(e,t,r,i,s,a){return IsInFrontOfPlane2(e,t,r,i,s,a,this._leftP)&&IsInFrontOfPlane2(e,t,r,i,s,a,this._topP)&&IsInFrontOfPlane2(e,t,r,i,s,a,this._rightP)&&IsInFrontOfPlane2(e,t,r,i,s,a,this._bottomP)&&IsInFrontOfPlane2(e,t,r,i,s,a,this._nearP)&&IsInFrontOfPlane2(e,t,r,i,s,a,this._farP)}IsBehindNearPlane(e,t,r){return!IsPointInFrontOfPlane2(e,t,r,this._nearP)}}}{let C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempMat4=mat42.create(),tmpVec3a=vec32.fromValues(0,0,0),tmpVec3b=vec32.fromValues(0,0,0),tmpVec3c=vec32.fromValues(0,0,0),defaultUpVector=vec32.fromValues(0,1,0),tmpVec4=vec42.fromValues(0,0,0,0),tmpQuad=new C33.Quad,tmpRect=new C33.Rect,defaultTexCoordsQuad=new C33.Quad(0,0,1,0,1,1,0,1),DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1e4},matWebGLtoWebGPU=mat42.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);C33.Gfx.RendererBase=class RendererBase{constructor(e){e=Object.assign({},DEFAULT_RENDERERBASE_OPTS,e),this._width=0,this._height=0,this._fovY=C33.toRadians(45),this._tan_fovY_2=Math.tan(this._fovY/2),this._matP=mat42.create(),this._matMV=mat42.create(),this._zAxisScale=!1,this._nearZ=e.nearZ,this._farZ=e.farZ,this._allShaderPrograms=[],this._shaderProgramsByName=new Map,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._stateGroups=new Map,this._currentStateGroup=null,this._blendModeTable=[],this._namedBlendModeMap=new Map,this._baseZ=0,this._currentZ=0,this._lineWidth=1,this._lineWidthStack=[this._lineWidth],this._lineCap=1,this._lineCapStack=[this._lineCap],this._lineOffset=.5,this._lineOffsetStack=[this._lineOffset],this._frameNumber=0,this._enableMipmaps=!0,this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(e){let t=0,r=e.length,i=0;for(;t<r;)e[t++]=i,e[t++]=i+1,e[t++]=i+2,e[t++]=i,e[t++]=i+2,e[t++]=i+3,i+=4}_ClearState(){this._baseZ=0,this._currentZ=0,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._ClearAllShaderPrograms()}InitState(){this._ClearState(),this._currentStateGroup=null}OnDeviceOrContextLost(){for(var e of this._allShaderPrograms)e.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(e){return this.IsZAxisScaleNormalized()?100:e/(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(e){return this.IsZAxisScaleNormalized()?e/(2*this._GetTanFovYDiv2())/this.GetDefaultCameraZ(e):1}SetNearZ(e){this._nearZ=e}GetNearZ(){return this._nearZ}SetFarZ(e){this._farZ=e}GetFarZ(){return this._farZ}SetFovY(e){this._fovY=e,this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=!1}SetZAxisScaleRegular(){this._zAxisScale=!0}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(e,t,r=.5,i=.5){var s,a,n=this.GetNearZ(),o=this.GetFarZ(),l=this.GetFovY();.5===r&&.5===i?this.IsWebGPU()?mat42.perspectiveZO(e,l,t,n,o):mat42.perspective(e,l,t,n,o):(l=2*(r=1-r)-2,r=2*r,s=2*i-2,i=2*i,t=(a=this._GetTanFovYDiv2()*n)*t,mat42.frustum(e,l*t,r*t,s*a,i*a,n,o),this.IsWebGPU()&&mat42.mul(e,matWebGLtoWebGPU,e))}CalculateOrthographicMatrix(e,t,r,i=1){var s=self.devicePixelRatio,a=2*this.GetDefaultCameraZ(r)*s*this._GetTanFovYDiv2()/r,t=t*a/(2*s*i),r=r*a/(2*s*i),a=-t,s=t,i=-r,t=r;this.IsWebGPU()?mat42.orthoZO(e,a,s,i,t,this.GetNearZ(),this.GetFarZ()):mat42.ortho(e,a,s,i,t,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(e,t,r,i,s,a=1){let n=1;this.IsZAxisScaleNormalized()&&(n=200*this._GetTanFovYDiv2()/s);var s=tmpVec3c,o=(vec32.set(s,n,-n,1),tmpVec3a),l=tmpVec3b;vec32.multiply(o,t,s),vec32.multiply(l,r,s),mat42.lookAt(e,o,l,i||defaultUpVector),s[2]=a,mat42.scale(e,e,s)}CalculateLookAtModelView2(e,t,r,i,s,a,n,o){return vec32.set(tmpVec3a,e,t,r),vec32.set(tmpVec3b,i,s,a),this.CalculateLookAtModelView(tempMat4,tmpVec3a,tmpVec3b,defaultUpVector,n,o),tempMat4}_AddShaderProgram(e){this._allShaderPrograms.push(e),this._shaderProgramsByName.set(e.GetName(),e)}_RemoveShaderProgram(e){var t=this._allShaderPrograms.indexOf(e);-1!==t&&this._allShaderPrograms.splice(t,1),this._shaderProgramsByName.delete(e.GetName())}_ClearAllShaderPrograms(){C33.clearArray(this._allShaderPrograms),this._shaderProgramsByName.clear()}GetShaderProgramByName(e){return this._shaderProgramsByName.get(e)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(e){this._currentStateGroup=e}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(e,t,r,i){var s=C33.Gfx.StateGroup.MakeKey(e,t,r,i);let a=this._stateGroups.get(s);return a||(a=C33.New(C33.Gfx.StateGroup,this,e,t,r,i),this._stateGroups.set(s,a)),a.AddRef(),a}ReleaseStateGroup(e){e.DecRef(),0===e._GetRefCount()&&(this._currentStateGroup===e&&(this._currentStateGroup=null),this._stateGroups.delete(e.GetKey()),e.Release())}_InitBlendModeData(e){C33.clearArray(this._blendModeTable),this._namedBlendModeMap.clear();let t=0;for(var r of e){var i=r[0],s=r[1],r=r[2];this._blendModeTable.push([s,r]),this._namedBlendModeMap.set(i,{number:t,srcBlend:s,destBlend:r}),t++}}_GetBlendByIndex(e){return this._blendModeTable[e]}GetSrcBlendByIndex(e){return this._GetBlendByIndex(e)[0]}GetDestBlendByIndex(e){return this._GetBlendByIndex(e)[1]}GetNamedBlend(e){e=this._namedBlendModeMap.get(e);if(void 0===e)throw new Error("invalid blend name");return e}NamedBlendToNumber(e){e=this._namedBlendModeMap.get(e);if(void 0===e)throw new Error("invalid blend name");return e.number}SetBaseZ(e){this._baseZ=e}GetBaseZ(){return this._baseZ}SetCurrentZ(e){this._currentZ=e,this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(e,t,r,i){var s=C33.angleTo(e,t,r,i),a=Math.sin(s),s=Math.cos(s),n=.5*this._lineWidth,a=a*n,s=s*n,n=this._lineCap;2===n?this.LinePreCalc_LineCap2(e,t,0,r,i,0,a,s):1===n?this.LinePreCalc_LineCap1(e,t,0,r,i,0,a,s):this.LinePreCalc_LineCap0(e,t,0,r,i,0,a,s)}Line3D(e,t,r,i,s,a){var n=C33.angleTo(e,t,i,s),o=Math.sin(n),n=Math.cos(n),l=.5*this._lineWidth,o=o*l,n=n*l,l=this._lineCap;2===l?this.LinePreCalc_LineCap2(e,t,r,i,s,a,o,n):1===l?this.LinePreCalc_LineCap1(e,t,r,i,s,a,o,n):this.LinePreCalc_LineCap0(e,t,r,i,s,a,o,n)}LinePreCalc_LineCap2(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l-o,t=t+l-n,i=i+l+o,s=s+l+n,l=2*o,h=2*n;this.Quad3D2(e+n,t-o,r,i+n,s-o,a,i-n-l,s+o-h,a,e-n+l,t+o+h,r,defaultTexCoordsQuad)}LinePreCalc_LineCap1(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l-o,t=t+l-n,i=i+l+o,s=s+l+n;this.Quad3D2(e+n,t-o,r,i+n,s-o,a,i-n,s+o,a,e-n,t+o,r,defaultTexCoordsQuad)}LinePreCalc_LineCap0(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l,t=t+l,i=i+l,s=s+l;this.Quad3D2(e+n,t-o,r,i+n,s-o,a,i-n,s+o,a,e-n,t+o,r,defaultTexCoordsQuad)}TexturedLine(e,t,r,i,s,a){var n=C33.angleTo(e,t,r,i),o=Math.sin(n),n=Math.cos(n),l=.5*this._lineWidth,o=o*l,n=n*l,l=this._lineCap;2===l?this.TexturedLinePreCalc_LineCap2(e,t,r,i,o,n,s,a):1===l?this.TexturedLinePreCalc_LineCap1(e,t,r,i,o,n,s,a):this.TexturedLinePreCalc_LineCap0(e,t,r,i,o,n,s,a)}TexturedLinePreCalc_LineCap2(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l-a,t=t+l-s,r=r+l+a,i=i+l+s,l=2*a,h=2*s,u=e+s,c=t-a,e=e-s+l,t=t+a+h,_=r+s,d=i-a,r=r-s-l,s=i+a-h;tmpQuad.set(u,c,_,d,r,s,e,t),tmpRect.set(n,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap1(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l-a,t=t+l-s,r=r+l+a,i=i+l+s,l=e+s,h=t-a,e=e-s,t=t+a,u=r+s,c=i-a,r=r-s,s=i+a;tmpQuad.set(l,h,u,c,r,s,e,t),tmpRect.set(n,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap0(e,t,r,i,s,a,n,o){var l=this._lineOffset,e=e+l,t=t+l,r=r+l,i=i+l,l=e+s,h=t-a,e=e-s,t=t+a,u=r+s,c=i-a,r=r-s,s=i+a;tmpQuad.set(l,h,u,c,r,s,e,t),tmpRect.set(n,0,o,0),this.Quad3(tmpQuad,tmpRect)}LineRect(e,t,r,i){var s=.5*this._lineWidth,a=this._lineCap;2===a?this._LineRectPreCalc_LineCap2(e,t,r,i,s):1===a?this._LineRectPreCalc_LineCap1(e,t,r,i,s):this._LineRectPreCalc_LineCap0(e,t,r,i,s)}_LineRectPreCalc_LineCap2(e,t,r,i,s){this.LinePreCalc_LineCap2(e,t,0,r,t,0,0,s),this.LinePreCalc_LineCap2(r,t,0,r,i,0,s,0),this.LinePreCalc_LineCap2(r,i,0,e,i,0,0,-s),this.LinePreCalc_LineCap2(e,i,0,e,t,0,-s,0)}_LineRectPreCalc_LineCap1(e,t,r,i,s){this.LinePreCalc_LineCap1(e,t,0,r,t,0,0,s),this.LinePreCalc_LineCap1(r,t,0,r,i,0,s,0),this.LinePreCalc_LineCap1(r,i,0,e,i,0,0,-s),this.LinePreCalc_LineCap1(e,i,0,e,t,0,-s,0)}_LineRectPreCalc_LineCap0(e,t,r,i,s){this.LinePreCalc_LineCap0(e,t,0,r,t,0,0,s),this.LinePreCalc_LineCap0(r,t,0,r,i,0,s,0),this.LinePreCalc_LineCap0(r,i,0,e,i,0,0,-s),this.LinePreCalc_LineCap0(e,i,0,e,t,0,-s,0)}LineRect2(e){this.LineRect(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}LineQuad(e){var t=C33.angleTo(e.getTlx(),e.getTly(),e.getTrx(),e.getTry()),r=Math.sin(t),t=Math.cos(t),i=.5*this._lineWidth,r=r*i,t=t*i,i=this._lineCap;2===i?this._LineQuadPreCalc_LineCap2(e,r,t):1===i?this._LineQuadPreCalc_LineCap1(e,r,t):this._LineQuadPreCalc_LineCap0(e,r,t)}_LineQuadPreCalc_LineCap2(e,t,r){this.LinePreCalc_LineCap2(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,r),this.LinePreCalc_LineCap2(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,r,-t),this.LinePreCalc_LineCap2(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-r),this.LinePreCalc_LineCap2(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-r,t)}_LineQuadPreCalc_LineCap1(e,t,r){this.LinePreCalc_LineCap1(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,r),this.LinePreCalc_LineCap1(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,r,-t),this.LinePreCalc_LineCap1(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-r),this.LinePreCalc_LineCap1(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-r,t)}_LineQuadPreCalc_LineCap0(e,t,r){this.LinePreCalc_LineCap0(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,r),this.LinePreCalc_LineCap0(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,r,-t),this.LinePreCalc_LineCap0(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-r),this.LinePreCalc_LineCap0(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-r,t)}SetLineWidth(e){this._lineWidth=e,this._lineWidthStack[this._lineWidthStack.length-1]=e}GetLineWidth(){return this._lineWidth}PushLineWidth(e){if(100<=this._lineWidthStack.length)throw new Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(e),this._lineWidth=e}PopLineWidth(){if(this._lineWidthStack.length<=1)throw new Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop(),this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2,this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(e){if("butt"===e)this.PushLineCapButt();else if("square"===e)this.PushLineCapSquare();else{if("zag"!==e)throw new Error("invalid line cap");this.PushLineCapZag()}}PushLineCapButt(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0),this._lineCap=0}PushLineCapSquare(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1),this._lineCap=1}PushLineCapZag(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2),this._lineCap=2}PopLineCap(){if(this._lineCapStack.length<=1)throw new Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop(),this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(e){this._lineOffset=e,this._lineOffsetStack[this._lineOffsetStack.length-1]=e}GetLineOffset(){return this._lineOffset}PushLineOffset(e){if(100<=this._lineOffsetStack.length)throw new Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(e),this._lineOffset=e}PopLineOffset(){if(this._lineOffsetStack.length<=1)throw new Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop(),this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(t){var e=t.length/2;if(e<3)throw new Error("need at least 3 points");var r=e-2,i=r-1,s=t[0],a=t[1];for(let e=0;e<r;e+=2){var n,o=2*e,l=t[2+o],h=t[3+o],u=t[4+o],c=t[5+o];e===i?this.Quad2(s,a,l,h,u,c,u,c):(n=t[6+o],this.Quad2(s,a,l,h,u,c,n,t[7+o]))}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0),this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(e){this._hasMajorPerformanceCaveat=!!e}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}GetEstimatedBackBufferMemoryUsage(){}GetEstimatedRenderBufferMemoryUsage(){}GetEstimatedTextureMemoryUsage(){}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}CreateRendererText(){return C33.New(C33.Gfx.RendererText,this)}}}{let C33=self.C3;C33.Gfx.ShaderProgramBase=class ShaderProgramBase{constructor(e,t){this._name=t.name,this._renderer=e,this._extendBoxHorizontal=t.extendBoxHorizontal||0,this._extendBoxVertical=t.extendBoxVertical||0,this._crossSampling=!!t.crossSampling,this._mustPreDraw=!!t.mustPreDraw,this._preservesOpaqueness=!!t.preservesOpaqueness,this._supports3dDirectRendering=!!t.supports3dDirectRendering,this._animated=!!t.animated,this._blendsBackground=!!t.blendsBackground,this._usesDepth=!!t.usesDepth,this._usesAnySrcRectOrPixelSize=!1,this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}Supports3DDirectRendering(){return this._supports3dDirectRendering}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return!1}}}{let C33=self.C3;C33.Gfx.StateGroup=class StateGroup{constructor(e,t,r,i,s){this._renderer=e,this._refCount=0,this._shaderProgram=null,this._shaderProgramName="",this._blendMode=r,this._color=C33.New(C33.Color),this._color.set(i),this._zElevation=s,"string"==typeof t?this._shaderProgramName=t:(this._shaderProgram=t,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(0<this._refCount)throw new Error("releasing state group still in use");this._renderer=null,this._shaderProgram=null,this._shaderProgramName=""}Apply(){var e=this._renderer;e.SetProgram(this._shaderProgram),e.SetBlendMode(this._blendMode),e.SetColor(this._color),e.SetCurrentZ(this._zElevation),e._SetCurrentStateGroup(this)}GetKey(){return C33.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(e){if(this._shaderProgram=e.GetShaderProgramByName(this._shaderProgramName),!this._shaderProgram)throw new Error("failed to restore shader program")}static MakeKey(e,t,r,i){return("string"==typeof e?e:e.GetName())+","+t+","+r.getR()+","+r.getG()+","+r.getB()+","+r.getA()+","+i}}}{let interpolateQuad2=function(e,t,r){var i=r.getTlx(),s=r.getTly(),a=r.getTrx()-i,n=r.getTry()-s;return[i+a*e+(r.getBlx()-i)*t,s+n*e+(r.getBly()-s)*t]},C33=(interpolateQuad=interpolateQuad2,self.C3),tempQuadTex=C33.New(C33.Quad);C33.Gfx.MeshPoint=class MeshPoint{constructor(e,t,r){this._mesh=e,this._col=t,this._row=r,this._x=NaN,this._y=NaN,this._zElevation=NaN,this._u=NaN,this._v=NaN,this._x=0,this._y=0,this._zElevation=0,this._u=0,this._v=0}_Init(e,t,r,i){this._x=e,this._y=t,this._u=r,this._v=i}GetX(){return this._x}SetX(e){this._x!==e&&(this._x=e,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(e){this._y!==e&&(this._y=e,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(e){this._zElevation!==e&&(this._zElevation=Math.max(e,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(e){this._u=e}GetV(){return this._v}SetV(e){this._v=e}_Interpolate_TexRect(e,t,r){[this._x,this._y]=interpolateQuad2(e._x,e._y,t),this._zElevation=e._zElevation,this._u=C33.lerp(r.getLeft(),r.getRight(),e._u),this._v=C33.lerp(r.getTop(),r.getBottom(),e._v)}_Interpolate_TexQuad(e,t,r){[this._x,this._y]=interpolateQuad2(e._x,e._y,t),this._zElevation=e._zElevation,[this._u,this._v]=interpolateQuad2(e._u,e._v,r)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(e){this.SetX(e.x),this.SetY(e.y),e.hasOwnProperty("z")&&this.SetZElevation(e.z),this.SetU(e.u),this.SetV(e.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}},C33.Gfx.Mesh=class Mesh{constructor(r,e,t){if(r<2||e<2)throw new Error("invalid mesh size");this._hsize=r,this._vsize=e,this._owner=t||null,this._pts=[],this._minX=0,this._minY=0,this._maxX=1,this._maxY=1,this._maxZ=0,this._pointsChanged=!1;var i=r-1,s=e-1;for(let t=0;t<e;++t){var a=[];for(let e=0;e<r;++e){var n=C33.New(C33.Gfx.MeshPoint,this,e,t),o=e/i,l=t/s;n._Init(o,l,o,l),a.push(n)}this._pts.push(a)}}Release(){C33.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=!0}_MaybeComputeBounds(){if(this._pointsChanged){let e=1/0,t=1/0,r=-1/0,i=-1/0,s=0;for(var a of this._pts)for(var n of a){var o=n.GetX(),l=n.GetY();e=Math.min(e,o),t=Math.min(t,l),r=Math.max(r,o),i=Math.max(i,l),s=Math.max(s,n.GetZElevation())}this._minX=e,this._minY=t,this._maxX=r,this._maxY=i,this._maxZ=s,this._pointsChanged=!1}}GetMinX(){return this._MaybeComputeBounds(),this._minX}GetMinY(){return this._MaybeComputeBounds(),this._minY}GetMaxX(){return this._MaybeComputeBounds(),this._maxX}GetMaxY(){return this._MaybeComputeBounds(),this._maxY}GetMaxZ(){return this._MaybeComputeBounds(),this._maxZ}HasAnyZElevation(){return 0<this.GetMaxZ()}GetMeshPointAt(e,t){return e=Math.floor(e),t=Math.floor(t),e<0||e>=this._hsize||t<0||t>=this._vsize?null:this._pts[t][e]}CalculateTransformedMesh(e,r,i){var s=i instanceof C33.Rect;if(e.GetHSize()!==this.GetHSize()||e.GetVSize()!==this.GetVSize())throw new Error("source mesh wrong size");var a=e._pts,n=this._pts;for(let e=0,t=n.length;e<t;++e){var o=a[e],l=n[e];for(let e=0,t=l.length;e<t;++e){var h=o[e],u=l[e];s?u._Interpolate_TexRect(h,r,i):u._Interpolate_TexQuad(h,r,i)}}}Draw(s){var a=this._pts;let n=a[0];for(let e=1,t=a.length;e<t;++e){var o=a[e];let r=n[0],i=o[0];for(let e=1,t=o.length;e<t;++e){var l=n[e],h=o[e];tempQuadTex.set(r.GetU(),r.GetV(),l.GetU(),l.GetV(),h.GetU(),h.GetV(),i.GetU(),i.GetV()),s.Quad3D2(r.GetX(),r.GetY(),r.GetZElevation(),l.GetX(),l.GetY(),l.GetZElevation(),h.GetX(),h.GetY(),h.GetZElevation(),i.GetX(),i.GetY(),i.GetZElevation(),tempQuadTex),r=l,i=h}n=o}}Outline(n,o){o=o||((e,t,r)=>[e,t,r]);var e=this._pts;let l=e[0];for(let s=1,a=e.length;s<a;++s){var h=e[s];let r=l[0],i=h[0];for(let e=1,t=h.length;e<t;++e){var u=l[e],c=h[e],[_,d,p]=o(r.GetX(),r.GetY(),r.GetZElevation()),[m,g,f]=o(u.GetX(),u.GetY(),u.GetZElevation()),[S,C,y]=o(c.GetX(),c.GetY(),c.GetZElevation()),[G,I,T]=o(i.GetX(),i.GetY(),i.GetZElevation());n.Line3D(_,d,p,m,g,f),n.Line3D(_,d,p,S,C,y),n.Line3D(_,d,p,G,I,T),e===t-1&&n.Line3D(m,g,f,S,C,y),s===a-1&&n.Line3D(G,I,T,S,C,y),r=u,i=c}l=h}}InsertPolyMeshVertices(e){var r=.99999999,i=e.pointsArr();let s=[];var a=this.GetHSize()-1,n=this.GetVSize()-1,o=1/a,l=1/n,h=a-1,u=n-1;let c=i[0],_=i[1],d=C33.clamp(Math.floor(c*a),0,h),p=C33.clamp(Math.floor(_*n),0,u),m=!0,g=0,f=0,S=0;let C=-1;var y=()=>{c=C33.clamp(C33.lerp(c,g,S),0,1),_=C33.clamp(C33.lerp(_,f,S),0,1),s.push(c,_)};for(let e=0,t=i.length;e<t;e+=2){c=i[e],_=i[e+1],s.push(c,_),d=C33.clamp(Math.floor(c*a),0,h),p=C33.clamp(Math.floor(_*n),0,u);var G=(e+2)%t;for(g=i[G],f=i[1+G],C=-1;;){if(1e6<s.length)throw new Error("Too many mesh poly points");var I=d*o,T=p*l,v=(d+1)*o,A=(p+1)*l;if(m=C33.isPointInTriangleInclusive(c,_,I,T,v,T,v,A),0!==C&&0<=(S=C33.rayIntersectExtended(c,_,g,f,I,T,v,A,-.001))&&S<=r)y(),m=!m,C=0;else if(0<p&&2!==C&&0<=(S=C33.rayIntersectExtended(c,_,g,f,I,T,v,T,.001))&&S<=r)y(),p--,m=!1,C=4;else if(d<h&&3!==C&&0<=(S=C33.rayIntersectExtended(c,_,g,f,v,T,v,A,.001))&&S<=r)y(),d++,m=!1,C=1;else if(0<d&&1!==C&&0<=(S=C33.rayIntersectExtended(c,_,g,f,I,T,I,A,.001))&&S<=r)y(),d--,m=!0,C=3;else{if(!(p<u&&4!==C&&0<=(S=C33.rayIntersectExtended(c,_,g,f,I,A,v,A,.001))&&S<=r))break;y(),p++,m=!0,C=2}}}return C33.New(C33.CollisionPoly,s)}TransformCollisionPoly(e,t){e=this._TransformPolyPoints(e);this._SimplifyPoly(e),t.setPoints(e)}_TransformPolyPoints(e){var r=[],i=e.pointsArr();for(let e=0,t=i.length;e<t;e+=2){var s=i[e],a=i[e+1],[s,a]=this.TransformPoint(s,a);r.push(s,a)}return r}TransformPoint(e,t){var r=this.GetHSize()-1,i=this.GetVSize()-1,s=1/r,a=1/i,r=C33.clamp(Math.floor(e*r),0,r-1),i=C33.clamp(Math.floor(t*i),0,i-1),n=r*s,o=i*a,l=(r+1)*s,h=(i+1)*a,u=this.GetMeshPointAt(r,i),c=this.GetMeshPointAt(r+1,i+1),_=C33.isPointInTriangleInclusive(e,t,n,o,l,o,l,h),s=_?n+s:n,a=_?o:o+a,r=this.GetMeshPointAt(r+(_?1:0),i+(_?0:1)),[i,_,e]=C33.triangleCartesianToBarycentric(e,t,n,o,s,a,l,h);return C33.triangleBarycentricToCartesian3d(i,_,e,u.GetX(),u.GetY(),u.GetZElevation(),r.GetX(),r.GetY(),r.GetZElevation(),c.GetX(),c.GetY(),c.GetZElevation())}_SimplifyPoly(r){var i=[];let s=r[0],a=r[1],n=s-r.at(-2),o=a-r.at(-1);for(let e=0,t=r.length;e<t;e+=2){var l=(e+2)%t,h=r[l],l=r[1+l],u=h-s,c=l-a,_=Math.abs(u)<1e-7&&Math.abs(n)<1e-7&&Math.sign(c)===Math.sign(o),d=Math.abs(c)<1e-7&&Math.abs(o)<1e-7&&Math.sign(u)===Math.sign(n);(!_&&!d&&.001<Math.abs(u/n-c/o)||0==u&&0==c)&&i.push(s,a),s=h,a=l,n=u,o=c}6<=i.length&&i.length<r.length&&C33.shallowAssignArray(r,i)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map(e=>e.map(e=>e.SaveToJson()))}}LoadFromJson(e){var r=this.GetHSize(),i=this.GetVSize();if(e.cols!==r||e.rows!==i)throw new Error("mesh data wrong size");var s=e.points;for(let t=0;t<i;++t){var a=s[t];for(let e=0;e<r;++e)this.GetMeshPointAt(e,t).LoadFromJson(a[e])}}}}{let GetFormatSpecifiers2=function(e,t){let r,i,s,a;switch(e){case"rgba8":r=t.RGBA8,i=t.RGBA,s=t.RGBA,a=t.UNSIGNED_BYTE;break;case"rgb8":r=t.RGB8,i=t.RGB,s=t.RGB,a=t.UNSIGNED_BYTE;break;case"rgba4":r=t.RGBA4,i=t.RGBA,s=t.RGBA,a=t.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":r=t.RGB5_A1,i=t.RGBA,s=t.RGBA,a=t.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":r=t.RGB565,i=t.RGB,s=t.RGB,a=t.UNSIGNED_SHORT_5_6_5;break;default:throw new Error("invalid pixel format")}return{sizedinternalformat:r,internalformat:i,format:s,type:a}},C33=(GetFormatSpecifiers=GetFormatSpecifiers2,self.C3),VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]),VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]),CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:!0,flipY:!1},allTextures=new Set;C33.Gfx.WebGLRendererTexture=class WebGLRendererTexture{constructor(e){this._renderer=e,this._texture=null,this._width=0,this._height=0,this._isStatic=!0,this._wrapX="clamp-to-edge",this._wrapY="clamp-to-edge",this._sampling="trilinear",this._anisotropy=0,this._pixelFormat="rgba8",this._isMipMapped=!1,this._mipMapQuality="default",this._refCount=0}_CreateStatic(t,r){if(!("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||t instanceof ImageData||t instanceof ArrayBuffer||null===t))throw new Error("invalid texture source");if(r=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,r),this._texture)throw new Error("already created texture");if(this._wrapX=r.wrapX,this._wrapY=r.wrapY,this._sampling=r.sampling,this._anisotropy=r.anisotropy,this._pixelFormat=r.pixelFormat,this._isMipMapped=!!r.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=r.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");if(this._isStatic=!0,t instanceof ArrayBuffer||null===t||r.isSvg){if(this._width=r.width,this._height=r.height,t instanceof ArrayBuffer&&t.byteLength!==this._width*this._height*4)throw new Error("ArrayBuffer wrong size")}else this._width=t.width,this._height=t.height;if(this._width<=0||this._height<=0)throw new Error("invalid texture data size");r.isSvg&&((e=C33.CreateCanvas(this._width,this._height)).getContext("2d").drawImage(t,0,0,this._width,this._height),t=e);var e=C33.isPOT(this._width)&&C33.isPOT(this._height),i=this._renderer.GetMaxTextureSize();if(this._width>i||this._height>i)throw new Error("texture data exceeds maximum texture size");var i=this._renderer.GetContext(),s=this._renderer.GetWebGLVersionNumber(),r=(this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this._texture),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),GetFormatSpecifiers2(this._pixelFormat,i));if(this._renderer.SupportsNPOTTextures()||e||!this._IsTiled())if(2<=s){let e;e=this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,i.texStorage2D(i.TEXTURE_2D,e,r.sizedinternalformat,this._width,this._height),t instanceof ArrayBuffer?i.texSubImage2D(i.TEXTURE_2D,0,0,0,this._width,this._height,r.format,r.type,new Uint8Array(t)):null!==t&&i.texSubImage2D(i.TEXTURE_2D,0,0,0,r.format,r.type,t)}else t instanceof ArrayBuffer?i.texImage2D(i.TEXTURE_2D,0,r.internalformat,this._width,this._height,0,r.format,r.type,new Uint8Array(t)):null===t?i.texImage2D(i.TEXTURE_2D,0,r.internalformat,this._width,this._height,0,r.format,r.type,null):i.texImage2D(i.TEXTURE_2D,0,r.internalformat,r.format,r.type,t);else{if(null===t)throw new Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");(t=t instanceof ArrayBuffer?new ImageData(new Uint8ClampedArray(t),this._width,this._height):t)instanceof ImageData&&((e=C33.CreateCanvas(this._width,this._height)).getContext("2d").putImageData(t,0,0),t=e);s=C33.CreateCanvas(C33.nextHighestPowerOfTwo(this._width),C33.nextHighestPowerOfTwo(this._height)),e=s.getContext("2d");e.imageSmoothingEnabled="nearest"!==this._sampling,e.drawImage(t,0,0,this._width,this._height,0,0,s.width,s.height),i.texImage2D(i.TEXTURE_2D,0,r.internalformat,r.format,r.type,s)}null!==t&&this._SetTextureParameters(i),i.bindTexture(i.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_CreateDynamic(e,t,r){if(r=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,r),this._texture)throw new Error("already created texture");if(this._wrapX=r.wrapX,this._wrapY=r.wrapY,this._sampling=r.sampling,this._pixelFormat=r.pixelFormat,this._isMipMapped=!!r.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=r.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=!1,this._width=Math.floor(e),this._height=Math.floor(t);e=C33.isPOT(this._width)&&C33.isPOT(this._height),t=this._renderer.GetMaxTextureSize();if(this._width<=0||this._height<=0)throw new Error("invalid texture size");if(this._width>t||this._height>t)throw new Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!e)throw new Error("non-power-of-two tiled textures not supported");t=this._renderer.GetContext(),e=this._renderer.GetWebGLVersionNumber(),this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),r=GetFormatSpecifiers2(this._pixelFormat,t),e=2<=e?r.sizedinternalformat:r.internalformat;t.texImage2D(t.TEXTURE_2D,0,e,this._width,this._height,0,r.format,r.type,null),this._SetTextureParameters(t),t.bindTexture(t.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_GetMipMapHint(e){if("default"===this._mipMapQuality)return this._isStatic?e.NICEST:e.FASTEST;if("low"===this._mipMapQuality)return e.FASTEST;if("high"===this._mipMapQuality)return e.NICEST;throw new Error("invalid mipmap quality")}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(e,t){if("clamp-to-edge"===t)return e.CLAMP_TO_EDGE;if("repeat"===t)return e.REPEAT;if("mirror-repeat"===t)return e.MIRRORED_REPEAT;throw new Error("invalid wrap mode")}_SetTextureParameters(e){var t=C33.isPOT(this._width)&&C33.isPOT(this._height),t=(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._GetTextureWrapMode(e,this._wrapX)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._GetTextureWrapMode(e,this._wrapY)),"nearest"===this._sampling?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),this._isMipMapped=!1):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),(t||this._renderer.SupportsNPOTTextures())&&this._isMipMapped?(e.hint(e.GENERATE_MIPMAP_HINT,this._GetMipMapHint(e)),e.generateMipmap(e.TEXTURE_2D),t="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR_MIPMAP_NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this._isMipMapped=!1)),this._renderer._GetAnisotropicExtension());t&&0<this._anisotropy&&"nearest"!==this._sampling&&e.texParameterf(e.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(e,t){if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||e instanceof ImageData))throw new Error("invalid texture source");if(!this._texture||this._refCount<=0)throw new Error("texture not created");if(this._isStatic)throw new Error("cannot update static texture");t=Object.assign({},UPDATE_DEFAULT_OPTIONS,t);var r=e.width||e.videoWidth,i=e.height||e.videoHeight,s=this._renderer.GetWebGLVersionNumber(),a=this._renderer.GetContext(),t=(a.bindTexture(a.TEXTURE_2D,this._texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!!t.flipY),GetFormatSpecifiers2(this._pixelFormat,a)),s=2<=s?t.sizedinternalformat:t.internalformat;try{if(this._width===r&&this._height===i){var n=C33.isPOT(this._width)&&C33.isPOT(this._height);a.texSubImage2D(a.TEXTURE_2D,0,0,0,t.format,t.type,e),(n||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(a.hint(a.GENERATE_MIPMAP_HINT,this._GetMipMapHint(a)),a.generateMipmap(a.TEXTURE_2D))}else{this._width=r,this._height=i;var o=C33.isPOT(this._width)&&C33.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!o)throw new Error("non-power-of-two tiled textures not supported");a.texImage2D(a.TEXTURE_2D,0,s,t.format,t.type,e),(o||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(a.hint(a.GENERATE_MIPMAP_HINT,this._GetMipMapHint(a)),a.generateMipmap(a.TEXTURE_2D))}}catch(e){console.error("Error updating WebGL texture: ",e)}a.bindTexture(a.TEXTURE_2D,null),this._renderer._ResetLastTexture()}_Delete(){if(0<this._refCount)throw new Error("texture still has references");if(!this._texture)throw new Error("already deleted texture");allTextures.delete(this),this._renderer.GetContext().deleteTexture(this._texture),this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(this._refCount<=0)throw new Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let e=this._width*this._height;switch(this._pixelFormat){case"rgba8":e*=4;break;case"rgb8":e*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":e*=2}return this._isMipMapped&&(e+=Math.floor(e/3)),e}static OnContextLost(){allTextures.clear()}static allTextures(){return allTextures.values()}}}{let C33=self.C3,assert=self.assert,glMatrix=self.glMatrix,vec32=glMatrix.vec3,mat42=glMatrix.mat4,VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},allRenderTargets=new Set;C33.Gfx.WebGLRenderTarget=class WebGLRenderTarget{constructor(e){this._renderer=e,this._frameBuffer=null,this._frameBufferNoDepth=null,this._texture=null,this._renderBuffer=null,this._width=0,this._height=0,this._isDefaultSize=!0,this._sampling="trilinear",this._alpha=!0,this._depth=!1,this._isSampled=!0,this._multisampling=0,this._projectionMatrix=mat42.create(),this._lastFov=0,this._lastNearZ=0,this._lastFarZ=0}_Create(e,t,r){r=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,r);var i=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw new Error("already created render target");if(this._sampling=r.sampling,this._alpha=!!r.alpha,this._depth=!!r.depth,this._isSampled=!!r.isSampled,this._isDefaultSize=!!r.isDefaultSize,this._multisampling=r.multisampling,!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(0<this._multisampling&&(i<2||this._isSampled))throw new Error("invalid use of multisampling");if(i<2&&(this._isSampled=!0),this._width=e,this._height=t,this._width<=0||this._height<=0)throw new Error("invalid render target size");this._CalculateProjection();r=this._renderer.GetContext(),this._frameBuffer=r.createFramebuffer(),this._depth&&(this._frameBufferNoDepth=r.createFramebuffer()),this._isSampled?(this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1}),i=this._texture._GetTexture(),r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),this._depth&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBufferNoDepth),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0))):(this._renderBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this._renderBuffer),e=this._alpha?r.RGBA8:r.RGB8,0<this._multisampling&&((t=r.getInternalformatParameter(r.RENDERBUFFER,e,r.SAMPLES))&&t[0]?(i=t[0],this._multisampling>i&&(this._multisampling=i)):this._multisampling=0),0===this._multisampling?r.renderbufferStorage(r.RENDERBUFFER,e,this._width,this._height):r.renderbufferStorageMultisample(r.RENDERBUFFER,this._multisampling,e,this._width,this._height),r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,this._renderBuffer),this._depth&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBufferNoDepth),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,this._renderBuffer)),r.bindRenderbuffer(r.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer();this._depth&&t&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,t,0):r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t)),r.bindFramebuffer(r.FRAMEBUFFER,null),allRenderTargets.add(this)}_Resize(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this._CalculateProjection(),(e=this._renderer.GetContext()).bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(e.bindRenderbuffer(e.RENDERBUFFER,this._renderBuffer),e.renderbufferStorage(e.RENDERBUFFER,this._alpha?e.RGBA8:e.RGB8,this._width,this._height),e.bindRenderbuffer(e.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer(),this._depth&&t&&(this._renderer._CanSampleDepth()?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,t,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)),e.bindFramebuffer(e.FRAMEBUFFER,null))}_Delete(){if(!this._texture&&!this._renderBuffer)throw new Error("already deleted render target");allRenderTargets.delete(this);var e=this._renderer.GetContext(),e=(this._texture?(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),e.bindFramebuffer(e.FRAMEBUFFER,null),2<=this._renderer.GetWebGLVersionNumber()&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)),e.deleteFramebuffer(this._frameBuffer),this._depth&&e.deleteFramebuffer(this._frameBufferNoDepth),this._renderer.GetBatchState());e.currentFramebuffer=null,this._frameBuffer=e.currentFramebufferNoDepth=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height),this._lastFov=this._renderer.GetFovY(),this._lastNearZ=this._renderer.GetNearZ(),this._lastFarZ=this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){return this._renderer.GetFovY()===this._lastFov&&this._renderer.GetNearZ()===this._lastNearZ&&this._renderer.GetFarZ()===this._lastFarZ||this._CalculateProjection(),this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){var e={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};return this._isDefaultSize||(e.width=this._width,e.height=this._height),e}IsCompatibleWithOptions(e){return"nearest"!==(e=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,e)).sampling===this.IsLinearSampling()&&!!e.alpha===this.HasAlpha()&&!!e.depth===this.HasDepthBuffer()&&!(2<=this._renderer.GetWebGLVersionNumber()&&!!e.isSampled!==this.IsSampled())&&("number"==typeof e.width||"number"==typeof e.height?!this.IsDefaultSize()&&this.GetWidth()===Math.floor(e.width)&&this.GetHeight()===Math.floor(e.height):this.IsDefaultSize())}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(e,t){e=await e.ReadBackRenderTargetToImageData(t,!0);return C33.ImageDataToBlob(e)}static OnContextLost(){allRenderTargets.clear()}static allRenderTargets(){return allRenderTargets.values()}static ResizeAll(e,t){for(var r of allRenderTargets)r.IsDefaultSize()&&r._Resize(e,t)}}}{let C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,mat42=glMatrix.mat4,RESERVED_UNIFORM_NAMES=new Set(["aPos","aTex","aPoints","matP","matMV","samplerFront","samplerBack","samplerDepth","destStart","destEnd","srcStart","srcEnd","srcOriginStart","srcOriginEnd","pixelSize","seconds","devicePixelRatio","layerScale","layerAngle","layoutStart","layoutEnd","color","color2_","pointTexStart","pointTexEnd","zElevation","tileSize","tileSpacing","outlineThickness","zNear","zFar"]);C33.Gfx.WebGLShaderProgram=class WebGLShaderProgram extends C33.Gfx.ShaderProgramBase{static async Compile(e,t){let r=e.GetContext();var i=t.src,s=t.vertexSrc,t=t.name,a=r.createShader(r.FRAGMENT_SHADER),i=(r.shaderSource(a,i),r.compileShader(a),r.createShader(r.VERTEX_SHADER));r.shaderSource(i,s),r.compileShader(i);let n=r.createProgram(),o=(r.attachShader(n,a),r.attachShader(n,i),r.bindAttribLocation(n,0,"aPos"),r.bindAttribLocation(n,1,"aTex"),r.bindAttribLocation(n,2,"aPoints"),r.linkProgram(n),e._GetParallelShaderCompileExtension());if(o?await e._WaitForObjectReady(()=>r.getProgramParameter(n,o.COMPLETION_STATUS_KHR)):await C33.Wait(5),!r.getShaderParameter(a,r.COMPILE_STATUS))throw s=r.getShaderInfoLog(a),r.deleteShader(a),r.deleteShader(i),r.deleteProgram(n),new Error("Error compiling fragment shader: "+s);if(!r.getShaderParameter(i,r.COMPILE_STATUS))throw e=r.getShaderInfoLog(i),r.deleteShader(a),r.deleteShader(i),r.deleteProgram(n),new Error("Error compiling vertex shader: "+e);if(r.getProgramParameter(n,r.LINK_STATUS))return(s=C33.FilterUnprintableChars(r.getProgramInfoLog(n)||"").trim())&&!C33.IsStringAllWhitespace(s)&&console.info(`[WebGL] Shader program '${t}' compilation log: `,s),r.deleteShader(a),r.deleteShader(i),n;throw e=r.getProgramInfoLog(n),r.deleteShader(a),r.deleteShader(i),r.deleteProgram(n),new Error("Error linking shader program: "+e)}static async Create(e,t){var r=await C33.Gfx.WebGLShaderProgram.Compile(e,t);return new C33.Gfx.WebGLShaderProgram(e,r,t)}constructor(e,t,r){super(e,r);var i,s=e.GetContext(),a=e.GetBatchState(),n=(e.EndBatch(),s.useProgram(t),this._gl=s,this._shaderProgram=t,this._isDeviceTransform="<default-device-transform>"===r.name,s.getAttribLocation(t,"aPos")),o=s.getAttribLocation(t,"aTex"),t=(this._locAPoints=s.getAttribLocation(t,"aPoints"),-1!==n&&(s.bindBuffer(s.ARRAY_BUFFER,e._vertexBuffer),s.vertexAttribPointer(n,e.GetNumVertexComponents(),s.FLOAT,!1,0,0),s.enableVertexAttribArray(n)),-1!==o&&(s.bindBuffer(s.ARRAY_BUFFER,e._texcoordBuffer),s.vertexAttribPointer(o,2,s.FLOAT,!1,0,0),s.enableVertexAttribArray(o)),-1!==this._locAPoints&&(s.bindBuffer(s.ARRAY_BUFFER,e._pointBuffer),s.vertexAttribPointer(this._locAPoints,4,s.FLOAT,!1,0,0),s.enableVertexAttribArray(this._locAPoints)),s.bindBuffer(s.ARRAY_BUFFER,null),this._uMatP=new C33.Gfx.WebGLShaderUniform(this,"matP","mat4"),this._uMatMV=new C33.Gfx.WebGLShaderUniform(this,"matMV","mat4"),this._uColor=new C33.Gfx.WebGLShaderUniform(this,"color","vec4"),this._uSamplerFront=new C33.Gfx.WebGLShaderUniform(this,"samplerFront","sampler"),this._uPointTexStart=new C33.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2"),this._uPointTexEnd=new C33.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2"),this._uZElevation=new C33.Gfx.WebGLShaderUniform(this,"zElevation","float"),this._uTileSize=new C33.Gfx.WebGLShaderUniform(this,"tileSize","vec2"),this._uTileSpacing=new C33.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2"),this._uColor2=new C33.Gfx.WebGLShaderUniform(this,"color2_","vec4"),this._uOutlineThickness=new C33.Gfx.WebGLShaderUniform(this,"outlineThickness","float"),this._uSamplerBack=new C33.Gfx.WebGLShaderUniform(this,"samplerBack","sampler"),this._uSamplerDepth=new C33.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler"),this._uDestStart=new C33.Gfx.WebGLShaderUniform(this,"destStart","vec2"),this._uDestEnd=new C33.Gfx.WebGLShaderUniform(this,"destEnd","vec2"),this._uSrcStart=new C33.Gfx.WebGLShaderUniform(this,"srcStart","vec2"),this._uSrcEnd=new C33.Gfx.WebGLShaderUniform(this,"srcEnd","vec2"),this._uSrcOriginStart=new C33.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2"),this._uSrcOriginEnd=new C33.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2"),this._uPixelSize=new C33.Gfx.WebGLShaderUniform(this,"pixelSize","vec2"),this._uSeconds=new C33.Gfx.WebGLShaderUniform(this,"seconds","float"),this._uDevicePixelRatio=new C33.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float"),this._uLayerScale=new C33.Gfx.WebGLShaderUniform(this,"layerScale","float"),this._uLayerAngle=new C33.Gfx.WebGLShaderUniform(this,"layerAngle","float"),this._uLayoutStart=new C33.Gfx.WebGLShaderUniform(this,"layoutStart","vec2"),this._uLayoutEnd=new C33.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2"),this._uZNear=new C33.Gfx.WebGLShaderUniform(this,"zNear","float"),this._uZFar=new C33.Gfx.WebGLShaderUniform(this,"zFar","float"),this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed()),r.parameters||[]);this._uCustomParameters=[],this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed(),this._hasCurrentMatP=!1,this._hasCurrentMatMV=!1,this._uColor.Init4f(1,1,1,1),this._uColor2.Init4f(1,1,1,1),this._uSamplerFront.Init1i(0),this._uSamplerBack.Init1i(1),this._uSamplerDepth.Init1i(2),this._uPointTexStart.Init2f(0,0),this._uPointTexEnd.Init2f(1,1),this._uZElevation.Init1f(0),this._uTileSize.Init2f(0,0),this._uTileSpacing.Init2f(0,0),this._uDestStart.Init2f(0,0),this._uDestEnd.Init2f(1,1),this._uSrcStart.Init2f(0,0),this._uSrcEnd.Init2f(0,0),this._uSrcOriginStart.Init2f(0,0),this._uSrcOriginEnd.Init2f(0,0),this._uPixelSize.Init2f(0,0),this._uDevicePixelRatio.Init1f(1),this._uZNear.Init1f(e.GetNearZ()),this._uZFar.Init1f(e.GetFarZ()),this._uLayerScale.Init1f(1),this._uLayerAngle.Init1f(0),this._uSeconds.Init1f(0),this._uLayoutStart.Init2f(0,0),this._uLayoutEnd.Init2f(0,0),this._uOutlineThickness.Init1f(1);for(i of t){var l=i[0],h=i[2],l=new C33.Gfx.WebGLShaderUniform(this,l,h);"color"===h?l.Init3f(0,0,0):l.Init1f(0),this._uCustomParameters.push(l)}this._isDeviceTransform?this._UpdateDeviceTransformUniforms(a.currentMatP):(this.UpdateMatP(a.currentMatP,!0),this.UpdateMatMV(a.currentMV,!0));n=a.currentShader;s.useProgram(n?n._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram),this._shaderProgram=null,this._renderer._RemoveShaderProgram(this),this._gl=null,super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(e){return e<0||e>=this._uCustomParameters.length?null:this._uCustomParameters[e].GetType()}AreCustomParametersAlreadySetInBatch(r){for(let e=0,t=r.length;e<t;++e)if(!this._uCustomParameters[e].IsSetToCustomInBatch(r[e]))return!1;return!0}SetCustomParametersInBatch(r){for(let e=0,t=r.length;e<t;++e)this._uCustomParameters[e].SetBatchValueCustom(r[e])}AreOptionalUniformsAlreadySetInBatch(e,t,r,i,s,a,n,o,l,h){return!this._uSamplerBack.IsUsed()&&!(this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(s,a)||this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(e.getLeft(),e.getTop())||this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(e.getRight(),e.getBottom())||this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(n)||this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(o)||this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(l)||this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(t.getLeft(),t.getTop())||this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(t.getRight(),t.getBottom())||this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(r.getLeft(),r.getTop())||this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(r.getRight(),r.getBottom())||this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(i.getLeft(),i.getTop())||this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(i.getTop(),i.getBottom())||this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(h))}SetOptionalUniformsInBatch(e,t,r,i,s,a,n,o,l,h){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(s,a),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(e.getLeft(),e.getTop()),this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(e.getRight(),e.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(n),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(o),this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(l),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(t.getLeft(),t.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(t.getRight(),t.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(r.getLeft(),r.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(r.getRight(),r.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(i.getLeft(),i.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(i.getTop(),i.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(h))}UpdateMatP(e,t){this._hasCurrentMatP&&!t||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(e),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(e,t){this._hasCurrentMatMV&&!t||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(e),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(e){if(!this._isDeviceTransform)throw new Error("not device transform shader");this._uMatP.UpdateMatrix4fv(e);var e=this._renderer,t=e.GetWidth()/2,r=e.GetHeight()/2,t=e.CalculateLookAtModelView2(t,r,e.GetDefaultCameraZ(e.GetHeight()),t,r,0,e.GetHeight());this._uMatMV.UpdateMatrix4fv(t)}UpdateColor(e){this._uColor.IsUsed()&&this._uColor.Update4f(e[0],e[1],e[2],e[3])}static GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES}static GetDefaultVertexShaderSource(e){e=e?"highmedp":"mediump";return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","attribute highp vec3 aPos;",`attribute ${e} vec2 aTex;`,`varying ${e} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {",`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,`	vTex = aTex;`,"}"].join("\n")}static GetDefaultVertexShaderSource_WebGL2(e){e=e?"highp":"mediump";return["#version 300 es","in highp vec3 aPos;",`in ${e} vec2 aTex;`,`out ${e} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {",`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,`	vTex = aTex;`,"}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL2(){return["#version 300 es","in mediump vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\toutColor = texture(samplerFront, vTex) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL2(){return["#version 300 es","in highp vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highp vec2 srcStart;","uniform highp vec2 pixelSize;","uniform highp vec2 tileSize;","uniform highp vec2 tileSpacing;","void main(void) {","\thighp vec2 tile = floor(vTex);","\thighp vec2 tex = fract(vTex);","\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTileRandomizationFragmentShaderSource(e,t,r){let i="";return 2<=e?i="#version 300 es\n":(t&&(i="#extension GL_EXT_frag_depth : enable\n"),r&&(i+="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n")),i+`
#ifdef GL_FRAGMENT_PRECISION_HIGH
#define highmedp highp
#else
#define highmedp mediump
#endif
precision highmedp float;
${2<=e?"in":"varying"} vec2 vTex;
${2<=e?"out lowp vec4 outColor;":""}
uniform lowp vec4 color;
uniform lowp sampler2D samplerFront;
uniform vec2 pixelSize;

uniform vec2 tileSize;
uniform vec2 tileSpacing;
uniform float outlineThickness;

const float PI = 3.1415926;

lowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)
{
	return (a + b + (a - b) * cos(x * PI)) / 2.0;
}

vec3 randVec3(vec2 seed)
{
	return vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),
				fract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),
				fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));
}

lowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)
{
	vec2 posRandom = tileSize;
	float angleRandom = outlineThickness;
	
	vec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;
	
	float angle = angleRandom * rand.z * PI;
	float sin_a = sin(angle);
	float cos_a = cos(angle);
	float aspect = pixelSize.x / pixelSize.y;

	vec2 mid = tile + vec2(0.5, 0.5);
	vec2 dp = uv - mid;
	dp.x /= aspect;
	vec2 r = vec2(dp.x * cos_a - dp.y * sin_a,
				  dp.y * cos_a + dp.x * sin_a);
	r.x *= aspect;

	vec2 p = mid + r + (posRandom * rand.xy / 2.0);
	
	${2<=e?"return textureGrad(samplerFront, p, ddx, ddy);":""}
	${e<2&&r?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":""}
	${e<2&&!r?"return texture2D(samplerFront, p);":""}
}

void main(void) {
	
	${e<2?"lowp vec4 outColor;":""}
	
	float blendMarginX = tileSpacing.x;
	float blendMarginY = tileSpacing.y;
	
	vec2 tile = floor(vTex);
	vec2 tex = fract(vTex);
	vec2 ddx = ${2<=e||r?"dFdx(vTex)":"vec2(0.0, 0.0)"};
	vec2 ddy = ${2<=e||r?"dFdy(vTex)":"vec2(0.0, 0.0)"};
	
	vec4 curTile = sampleTile(tile, vTex, ddx, ddy);
	
	bool inLeftMargin = (tex.x < blendMarginX);
	bool inRightMargin = (tex.x > 1.0 - blendMarginX);
	bool inTopMargin = (tex.y < blendMarginY);
	bool inBottomMargin = (tex.y > 1.0 - blendMarginY);
	
	if (inLeftMargin)
	{
		lowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);
		float leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;
		lowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);
			
			outColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);
			
			outColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = leftMixedTile;
		}
	}
	else if (inRightMargin)
	{
		lowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);
		float rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);
		lowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);
			
			outColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);
			
			outColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = rightMixedTile;
		}
	}
	else if (inTopMargin)
	{
		lowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
		outColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
	}
	else if (inBottomMargin)
	{
		lowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
		outColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
	}
	else
	{
		outColor = curTile;
	}
	
	outColor *= color;
	${e<2?"gl_FragColor = outColor;":""}
	${2<=e?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
	${e<2&&t?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
}
`}static GetPointVertexShaderSource_WebGL1(){return["attribute vec4 aPoints;","varying float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointVertexShaderSource_WebGL2(){return["#version 300 es","in vec4 aPoints;","out float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return["uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetPointFragmentShaderSource_WebGL2(){return["#version 300 es","uniform lowp sampler2D samplerFront;","in lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","out lowp vec4 outColor;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\toutColor = texture(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetColorFillFragmentShaderSource(){return["uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n")}static GetLinearGradientFillFragmentShaderSource(){return["precision lowp float;","varying mediump vec2 vTex;","uniform vec4 color;","uniform vec4 color2_;","vec3 fromLinear(vec3 linearRGB)","{","\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));","\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);","\tvec3 lower = linearRGB * vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","vec3 toLinear(vec3 sRGB)","{","\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));","\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));","\tvec3 lower = sRGB/vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","void main(void) {","\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);","\tfloat a = mix(color.a, color2_.a, vTex.x);","\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);","}"].join("\n")}static GetPenumbraFillFragmentShaderSource(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","precision lowp float;","varying highmedp vec2 vTex;","uniform vec4 color;","void main(void) {",`	highmedp float grad = vTex.x / (1.0 - vTex.y);`,`	gl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);`,"}"].join("\n")}static GetSmoothLineFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float f = step(diffSq.x + diffSq.y, 0.25);","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump float innerF = step(distSq, 0.25);","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}static GetSmoothEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);","\tgl_FragColor = color * f;","}"].join("\n")}static GetSmoothEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 pxNorm = pixelSize * norm;","\tmediump vec2 innerEdge1 = halfNorm - pxNorm;","\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;","\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);","\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;","\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;","\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);","\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;","\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}}}{let C33=self.C3,glMatrix=self.glMatrix,mat42=glMatrix.mat4,TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);C33.Gfx.WebGLShaderUniform=class WebGLShaderUniform{constructor(e,t,r){if(!TYPE_SIZES.has(r))throw new Error("invalid uniform type");this._owner=e,this._gl=this._owner.GetWebGLContext(),this._name=t,this._type=r,this._isColorType="color"===this._type,this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),t),this._isUsed=!!this._location;e=TYPE_SIZES.get(r);this._lastValue=new Float32Array(e),this._lastBatchValue=new Float32Array(e)}Release(){this._owner=null,this._gl=null,this._location=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,e))}Init1i(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,e))}Init2f(e,t){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,e,t))}Init3f(e,t,r){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=r,this._lastBatchValue.set(this._lastValue),this._gl.uniform3f(this._location,e,t,r))}Init4f(e,t,r,i){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=r,this._lastValue[3]=i,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,e,t,r,i))}Update1f(e){e=Math.fround(e);var t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1f(this._location,e))}Update1i(e){var t=this._lastValue;t[0]!==e&&this._gl.uniform1i(this._location,t[0]=e)}Update2f(e,t){e=Math.fround(e),t=Math.fround(t);var r=this._lastValue;r[0]===e&&r[1]===t||(r[0]=e,r[1]=t,this._gl.uniform2f(this._location,e,t))}Update3f(e,t,r){e=Math.fround(e),t=Math.fround(t),r=Math.fround(r);var i=this._lastValue;i[0]===e&&i[1]===t&&i[2]===r||(i[0]=e,i[1]=t,i[2]=r,this._gl.uniform3f(this._location,e,t,r))}Update4f(e,t,r,i){e=Math.fround(e),t=Math.fround(t),r=Math.fround(r),i=Math.fround(i);var s=this._lastValue;s[0]===e&&s[1]===t&&s[2]===r&&s[3]===i||(s[0]=e,s[1]=t,s[2]=r,s[3]=i,this._gl.uniform4f(this._location,e,t,r,i))}UpdateMatrix4fv(e){var t=this._lastValue;mat42.exactEquals(t,e)||(C33.typedArraySet16(t,e,0),this._gl.uniformMatrix4fv(this._location,!1,e))}IsSetToCustomInBatch(e){var t=this._lastBatchValue;return this.IsColorType()?t[0]===Math.fround(e.getR())&&t[1]===Math.fround(e.getG())&&t[2]===Math.fround(e.getB()):t[0]===Math.fround(e)}SetBatchValueCustom(e){var t=this._lastBatchValue;this.IsColorType()?(t[0]=e.getR(),t[1]=e.getG(),t[2]=e.getB()):t[0]=e}IsSetTo1InBatch(e){return this._lastBatchValue[0]===Math.fround(e)}IsSetTo2InBatch(e,t){var r=this._lastBatchValue;return r[0]===Math.fround(e)&&r[1]===Math.fround(t)}SetBatch1(e){this._lastBatchValue[0]=e}SetBatch2(e,t){var r=this._lastBatchValue;r[0]=e,r[1]=t}}}{let C33=self.C3,glMatrix=self.glMatrix,vec42=glMatrix.vec4,mat42=glMatrix.mat4,BATCH_NULL=0,BATCH_QUAD=1,BATCH_SETTEXTURE=2,BATCH_SETCOLOR=3,BATCH_SETBLEND=4,BATCH_SETVIEWPORT=5,BATCH_SETPROJECTION=6,BATCH_SETMODELVIEW=7,BATCH_SETRENDERTARGET=8,BATCH_CLEARSURFACE=9,BATCH_POINTS=10,BATCH_SETPROGRAM=11,BATCH_SETPROGRAMPARAMETERS=12,BATCH_SETPROGRAMCUSTOMPARAMETERS=13,BATCH_INVALIDATEFRAMEBUFFER=14,BATCH_SETPOINTTEXCOORDS=15,BATCH_SETTILEMAPINFO=16,BATCH_BLITFRAMEBUFFER=17,BATCH_STARTQUERY=18,BATCH_ENDQUERY=19,BATCH_SETELLIPSEPARAMS=20,BATCH_SETGRADIENTCOLOR=21,BATCH_CLEARDEPTH=22,BATCH_SETDEPTHENABLED=23,BATCH_SETDEPTHSAMPLINGENABLED=24,BATCH_COPLANAR_STARTSTENCILPASS=25,BATCH_COPLANAR_STARTCOLORPASS=26,BATCH_COPLANAR_RESTORE=27,BATCH_SET_SCISSOR=28,BATCH_SETTILERANDOMIZATIONINFO=29;C33.Gfx.BatchState=class BatchState{constructor(e){this.renderer=e,this.currentMV=mat42.create(),this.currentMatP=mat42.create(),this.currentFramebuffer=null,this.currentFramebufferNoDepth=null,this.isDepthSamplingEnabled=!1,this.currentColor=vec42.fromValues(1,1,1,1),this.currentShader=null,this.pointTexCoords=new C33.Rect,this.clearColor=C33.New(C33.Color,0,0,0,0)}},C33.Gfx.WebGLBatchJob=class WebGLBatchJob{constructor(e){var t=new ArrayBuffer(96);this._type=0,this._batchState=e,this._gl=e.renderer.GetContext(),this._startIndex=0,this._indexCount=0,this._texParam=null,this._mat4param=new Float32Array(t,0,16),this._colorParam=new Float32Array(t,64,4),this._srcOriginRect=new Float32Array(t,80,4),this._shaderParams=[]}InitQuad(e,t){this._type=BATCH_QUAD,this._startIndex=e,this._indexCount=t}DoQuad(){var e=this._gl;e.drawElements(e.TRIANGLES,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(e){this._type=BATCH_SETTEXTURE,this._texParam=e}DoSetTexture(){var e=this._gl,t=this._texParam;e.bindTexture(e.TEXTURE_2D,t?t._GetTexture():null)}InitSetColor(e){this._type=BATCH_SETCOLOR,e.writeToTypedArray(this._colorParam,0)}DoSetColor(){var e=this._colorParam,t=this._batchState;vec42.copy(t.currentColor,e),t.currentShader.UpdateColor(e)}InitSetGradientColor(e){this._type=BATCH_SETGRADIENTCOLOR,e.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){var e=this._colorParam,t=this._batchState.currentShader;t._uColor2.IsUsed()&&t._uColor2.Update4f(e[0],e[1],e[2],e[3])}InitSetBlend(e,t){this._type=BATCH_SETBLEND,this._startIndex=e,this._indexCount=t}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(e,t,r,i){this._type=BATCH_SETVIEWPORT;var s=this._colorParam;s[0]=e,s[1]=t,s[2]=r,s[3]=i}DoSetViewport(){var e=this._colorParam;this._gl.viewport(e[0],e[1],e[2],e[3])}InitSetProjection(e){this._type=BATCH_SETPROJECTION,mat42.copy(this._mat4param,e)}DoSetProjection(){var e=this._batchState,r=e.renderer._allShaderPrograms,i=e.currentShader,s=this._mat4param;for(let e=0,t=r.length;e<t;++e){var a=r[e];a===i?a.UpdateMatP(s,!0):a.SetMatPStale()}mat42.copy(e.currentMatP,s)}InitSetModelView(e){this._type=BATCH_SETMODELVIEW,mat42.copy(this._mat4param,e)}DoSetModelView(){var e=this._batchState,r=e.renderer._allShaderPrograms,i=e.currentShader,s=this._mat4param;for(let e=0,t=r.length;e<t;++e){var a=r[e];a===i?a.UpdateMatMV(s,!0):a.SetMatMVStale()}mat42.copy(e.currentMV,s)}InitSetRenderTarget(e){this._type=BATCH_SETRENDERTARGET,this._texParam=e}DoSetRenderTarget(){var e=this._gl,t=this._texParam,r=this._batchState;t?(r.currentFramebuffer=t._GetFramebuffer(),r.currentFramebufferNoDepth=t._GetFramebufferNoDepth(),r.isDepthSamplingEnabled&&r.currentFramebufferNoDepth?e.bindFramebuffer(e.FRAMEBUFFER,r.currentFramebufferNoDepth):e.bindFramebuffer(e.FRAMEBUFFER,r.currentFramebuffer)):(r.currentFramebuffer=null,r.currentFramebufferNoDepth=null,e.bindFramebuffer(e.FRAMEBUFFER,null))}InitClearSurface(e){this._type=BATCH_CLEARSURFACE,e.writeToTypedArray(this._mat4param,0)}InitClearSurface2(e,t,r,i){this._type=BATCH_CLEARSURFACE;var s=this._mat4param;s[0]=e,s[1]=t,s[2]=r,s[3]=i}DoClearSurface(){var e=this._gl,t=this._mat4param,r=this._batchState.clearColor,i=t[0],s=t[1],a=t[2],t=t[3];r.equalsRgba(i,s,a,t)||(e.clearColor(i,s,a,t),r.setRgba(i,s,a,t)),e.clear(e.COLOR_BUFFER_BIT)}InitSetPointTexCoords(e){this._type=BATCH_SETPOINTTEXCOORDS,e.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){var e=this._mat4param;this._batchState.pointTexCoords.set(e[0],e[1],e[2],e[3])}InitPoints(e,t){this._type=BATCH_POINTS,this._startIndex=e,this._indexCount=1,this._mat4param[0]=t}DoPoints(){var e=this._gl,t=this._batchState,r=t.renderer._spPoints,i=(e.useProgram(r._shaderProgram),r.UpdateMatP(t.currentMatP,!1),r.UpdateMatMV(t.currentMV,!1),t.pointTexCoords),i=(r._uPointTexStart.IsUsed()&&r._uPointTexStart.Update2f(i.getLeft(),i.getTop()),r._uPointTexEnd.IsUsed()&&r._uPointTexEnd.Update2f(i.getRight(),i.getBottom()),this._mat4param[0]);r._uZElevation.IsUsed()&&r._uZElevation.Update1f(i),r._uColor.IsUsed()&&(i=t.currentColor,r._uColor.Update4f(i[0],i[1],i[2],i[3])),e.drawArrays(e.POINTS,this._startIndex/4,this._indexCount),e.useProgram(t.currentShader._shaderProgram)}InitSetProgram(e){this._type=BATCH_SETPROGRAM,this._texParam=e}DoSetProgram(){var e=this._gl,t=this._batchState,r=this._texParam;t.currentShader=r,e.useProgram(r._shaderProgram),r.UpdateMatP(t.currentMatP,!1),r.UpdateMatMV(t.currentMV,!1),r._uColor.IsUsed()&&(e=t.currentColor,r._uColor.Update4f(e[0],e[1],e[2],e[3]))}InitSetProgramParameters(){this._type=BATCH_SETPROGRAMPARAMETERS}DoSetProgramParameters(){var e,t,r=this._batchState.currentShader,i=this._gl,s=this._mat4param,a=this._colorParam,n=this._srcOriginRect;r._uSamplerBack.IsUsed()&&(e=this._batchState.renderer,t=this._texParam,e._lastTexture1!==t)&&(i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t?t._GetTexture():null),e._lastTexture1=t,i.activeTexture(i.TEXTURE0)),r._uPixelSize.IsUsed()&&r._uPixelSize.Update2f(s[0],s[1]),r._uDestStart.IsUsed()&&r._uDestStart.Update2f(s[2],s[3]),r._uDestEnd.IsUsed()&&r._uDestEnd.Update2f(s[4],s[5]),r._uDevicePixelRatio.IsUsed()&&r._uDevicePixelRatio.Update1f(this._indexCount),r._uLayerScale.IsUsed()&&r._uLayerScale.Update1f(s[6]),r._uLayerAngle.IsUsed()&&r._uLayerAngle.Update1f(s[7]),r._uSrcStart.IsUsed()&&r._uSrcStart.Update2f(s[12],s[13]),r._uSrcEnd.IsUsed()&&r._uSrcEnd.Update2f(s[14],s[15]),r._uSrcOriginStart.IsUsed()&&r._uSrcOriginStart.Update2f(n[0],n[1]),r._uSrcOriginEnd.IsUsed()&&r._uSrcOriginEnd.Update2f(n[2],n[3]),r._uLayoutStart.IsUsed()&&r._uLayoutStart.Update2f(a[0],a[1]),r._uLayoutEnd.IsUsed()&&r._uLayoutEnd.Update2f(a[2],a[3]),r._uSeconds.IsUsed()&&r._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=BATCH_SETPROGRAMCUSTOMPARAMETERS}DoSetProgramCustomParameters(){var r=this._batchState.currentShader._uCustomParameters,i=this._shaderParams;for(let e=0,t=r.length;e<t;++e){var s=r[e],a=i[e];s.IsColorType()?s.Update3f(a.getR(),a.getG(),a.getB()):s.Update1f(a)}}InitInvalidateFramebuffer(e){this._type=BATCH_INVALIDATEFRAMEBUFFER,this._texParam=e}DoInvalidateFramebuffer(){var e=this._gl,t=this._texParam,r=this._batchState.currentFramebuffer;t!==r&&e.bindFramebuffer(e.FRAMEBUFFER,t),e.invalidateFramebuffer(e.FRAMEBUFFER,[e.COLOR_ATTACHMENT0]),t!==r&&e.bindFramebuffer(e.FRAMEBUFFER,r)}InitBlitFramebuffer(e,t,r){this._type=BATCH_BLITFRAMEBUFFER;var i=this._mat4param,s=this._batchState.renderer,s=(i[0]=e.GetWidth(),i[1]=e.GetHeight(),i[2]=(t||s).GetWidth(),i[3]=(t||s).GetHeight(),i[4]=e.IsLinearSampling()?1:0,i[5]="stretch"===r,this._shaderParams);C33.clearArray(s),s.push(e._GetFramebuffer()),s.push(t?t._GetFramebuffer():null)}DoBlitFramebuffer(){var e=this._mat4param,t=this._shaderParams,r=this._gl,i=e[0],s=e[1],a=e[2],n=e[3],o=0!==e[4],e=0!==e[5],l=t[0],t=t[1];r.bindFramebuffer(r.READ_FRAMEBUFFER,l),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,t),e?r.blitFramebuffer(0,0,i,s,0,0,a,n,r.COLOR_BUFFER_BIT,o?r.LINEAR:r.NEAREST):(l=Math.min(i,a),t=Math.min(s,n),e=Math.max(s-n,0),o=Math.max(n-s,0),r.blitFramebuffer(0,e,l,t+e,0,o,l,t+o,r.COLOR_BUFFER_BIT,r.NEAREST))}InitStartQuery(e){this._type=BATCH_STARTQUERY,this._texParam=e}DoStartQuery(){this._texParam.BeginTimeElapsed(),this._texParam=null}InitEndQuery(e){this._type=BATCH_ENDQUERY,this._texParam=e}DoEndQuery(){this._texParam.EndTimeElapsed(),this._texParam=null}InitSetEllipseParams(e,t,r){this._type=BATCH_SETELLIPSEPARAMS;var i=this._mat4param;i[0]=e,i[1]=t,i[2]=r}DoSetEllipseParams(){var e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[2])}InitSetTilemapInfo(e,t,r,i,s,a,n){this._type=BATCH_SETTILEMAPINFO;var o=this._mat4param;e.writeToTypedArray(o,0),o[4]=1/t,o[5]=1/r,o[6]=i/t,o[7]=s/r,o[8]=a/t,o[9]=n/r}DoSetTilemapInfo(){var e=this._batchState.currentShader,t=this._mat4param;e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(t[0],t[1]),e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[4],t[5]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[6],t[7]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[8],t[9])}InitSetTileRandomizationInfo(e,t,r,i,s,a,n){this._type=BATCH_SETTILERANDOMIZATIONINFO;var o=this._mat4param;o[0]=1/e,o[1]=1/t,o[2]=r,o[3]=i,o[4]=s,o[5]=a,o[6]=n}DoSetTileRandomizationInfo(){var e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[2],t[3]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[4]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[5],t[6])}InitClearDepth(e){this._type=BATCH_CLEARDEPTH,this._startIndex=e?1:0}DoClearDepth(){var e=this._gl,t=0!==this._startIndex;t||e.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT),t||e.depthMask(!1)}InitSetDepthEnabled(e){this._type=BATCH_SETDEPTHENABLED,this._startIndex=e?1:0}DoSetDepthEnabled(){var e=this._gl;0===this._startIndex?(e.disable(e.DEPTH_TEST),e.depthMask(!1)):(e.enable(e.DEPTH_TEST),e.depthMask(!0))}InitSetDepthSamplingEnabled(e){this._type=BATCH_SETDEPTHSAMPLINGENABLED,this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){var e=this._gl,t=this._batchState,r=t.renderer,i=0!==this._startIndex;t.isDepthSamplingEnabled=i,e.activeTexture(e.TEXTURE2),i?(t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebufferNoDepth),e.bindTexture(e.TEXTURE_2D,r._GetDepthBuffer())):(e.bindTexture(e.TEXTURE_2D,null),t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebuffer)),e.activeTexture(e.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=BATCH_COPLANAR_STARTSTENCILPASS}DoCoplanarStartStencilPass(){var e=this._gl;e.clear(e.STENCIL_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=BATCH_COPLANAR_STARTCOLORPASS}DoCoplanarStartColorPass(){var e=this._gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}InitCoplanarRestore(){this._type=BATCH_COPLANAR_RESTORE}DoCoplanarRestore(){var e=this._gl;e.disable(e.STENCIL_TEST)}InitSetScissor(e,t,r,i,s){this._type=BATCH_SET_SCISSOR,this._startIndex=e?1:0;e=this._mat4param;e[0]=t,e[1]=r,e[2]=i,e[3]=s}DoSetScissor(){var e=this._gl,t=this._mat4param;1===this._startIndex?(e.enable(e.SCISSOR_TEST),e.scissor(t[0],t[1],t[2],t[3])):e.disable(e.SCISSOR_TEST)}Run(){switch(this._type){case 1:return void this.DoQuad();case 2:return void this.DoSetTexture();case 3:return void this.DoSetColor();case 4:return void this.DoSetBlend();case 5:return void this.DoSetViewport();case 6:return void this.DoSetProjection();case 7:return void this.DoSetModelView();case 8:return void this.DoSetRenderTarget();case 9:return void this.DoClearSurface();case 10:return void this.DoPoints();case 11:return void this.DoSetProgram();case 12:return void this.DoSetProgramParameters();case 13:return void this.DoSetProgramCustomParameters();case 14:return void this.DoInvalidateFramebuffer();case 15:return void this.DoSetPointTextureCoords();case 16:return void this.DoSetTilemapInfo();case 17:return void this.DoBlitFramebuffer();case 18:return void this.DoStartQuery();case 19:return void this.DoEndQuery();case 20:return void this.DoSetEllipseParams();case 21:return void this.DoSetGradientColor();case 22:return void this.DoClearDepth();case 23:return void this.DoSetDepthEnabled();case 24:return void this.DoSetDepthSamplingEnabled();case 25:return void this.DoCoplanarStartStencilPass();case 26:return void this.DoCoplanarStartColorPass();case 27:return void this.DoCoplanarRestore();case 28:return void this.DoSetScissor();case 29:return void this.DoSetTileRandomizationInfo()}}}}{let fillOrStrokeRect2=function(e,t,r,i,s,a){t?e.strokeRect(r,i,s,a):e.fillRect(r,i,s,a)},ptToPx2=function(e){return e*(4/3)},getOffsetParam2=function(e,t){e=e.trim();var r=parseFloat(e);return isFinite(r)?e.endsWith("%")?t*r/100:r:0},C33=(fillOrStrokeRect=fillOrStrokeRect2,ptToPx=ptToPx2,getOffsetParam=getOffsetParam2,self.C3),MAX_TEXTURE_SIZE=4096,EXTRA_LINE_HEIGHT=4,GENERIC_FONT_FAMILIES=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),DEFAULT_OPTS={timeout:60},tempColor=new C33.Color(0,0,0,1),VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]),VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]),VALID_WORD_WRAP_MODES=new Set(["word","cjk","character"]),VALID_TEXT_DIRECTIONS=new Set(["ltr","rtl"]),allRendererTexts=new Set,didCheckFoundBoundingBoxSupport=(C33.FontManager&&C33.FontManager.addEventListener("fontload",e=>{var t,r=e.font.GetName();for(t of allRendererTexts)(t.IsBBCodeEnabled()||C33.equalsNoCase(t.GetFontName(),r))&&t._SetWordWrapChanged()}),!1),supportsFontBoundingBoxMeasurements=!1;C33.Gfx.RendererText=class RendererText{constructor(e,t){t=Object.assign({},DEFAULT_OPTS,t),this._renderer=e,this._fontName="Arial",this._fontSize=16,this._fontSizeScale=1,this._lineHeight=0,this._isBold=!1,this._isItalic=!1,this._colorStr="black",this._isBBcodeEnabled=!1,this._iconSet=null,this._iconSmoothing=!0,this.onloadfont=null,this._alreadyLoadedFonts=new Set,this._horizontalAlign="left",this._verticalAlign="top",this._text="",this._bbString=null,this._wrappedText=C33.New(C33.WordWrap),this._wrapMode="word",this._textDirection="ltr",this._wordWrapChanged=!1,this._textLayoutChanged=!1,this._drawChanged=!1,this._drawMaxCharCount=-1,this._drawCharCount=0,this._cssWidth=0,this._cssHeight=0,this._width=0,this._height=0,this._zoom=1,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._lastCanvasWidth=-1,this._lastCanvasHeight=-1,this._lastTextCanvasFont="",this._lastMeasureCanvasFont="",this._lastTextCanvasFillStyle="",this._lastTextCanvasOpacity=1,this._lastTextCanvasLineWidth=1,this._measureTextCallback=e=>this._MeasureText(e),this._texture=null,this._rcTex=new C33.Rect,this._scaleFactor=1,this._textureTimeout=new C33.IdleTimeout(()=>{this.ReleaseTexture(),this._SetTextCanvasSize(8,8)},t.timeout),this.ontextureupdate=null,this._wasReleased=!1,allRendererTexts.add(this)}Release(){this.onloadfont=null,this._alreadyLoadedFonts.clear(),this._iconSet=null,this._bbString=null,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._measureTextCallback=null,this._textureTimeout.Release(),this.ontextureupdate=null,this.ReleaseTexture(),this._wrappedText.Clear(),this._wrappedText=null,this._renderer=null,this._wasReleased=!0,allRendererTexts.delete(this)}_SetDrawChanged(){this._drawChanged=!0}_SetTextLayoutChanged(){this._SetDrawChanged(),this._textLayoutChanged=!0}_SetWordWrapChanged(){this._SetTextLayoutChanged(),this._wordWrapChanged=!0}SetBBCodeEnabled(e){this._isBBcodeEnabled!==(e=!!e)&&(this._isBBcodeEnabled=e,e=this._isBBcodeEnabled?"alphabetic":"top",this._textContext&&(this._textContext.textBaseline=e),this._measureContext&&(this._measureContext.textBaseline=e),this._SetWordWrapChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetIconSet(e){this._iconSet!==e&&(this._iconSet=e,this._wrappedText.SetIconSet(e),this._iconSet&&this._iconSet.IsLoading()&&this._iconSet.LoadContent().then(()=>this._SetDrawChanged()),this._SetWordWrapChanged())}SetIconSmoothing(e){this._iconSmoothing!==(e=!!e)&&(this._iconSmoothing=e,this._SetDrawChanged())}SetFontName(e){this._fontName!==(e=e||"serif")&&(this._fontName=e,this._SetWordWrapChanged())}GetFontName(){return this._fontName}SetFontSize(e){this._fontSize!==(e=e<.1?.1:e)&&(this._fontSize=e,this._SetWordWrapChanged())}GetFontSize(){return this._fontSize}SetFontSizeScale(e){this._fontSizeScale!==e&&(this._fontSizeScale=e,this._SetWordWrapChanged())}SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._SetTextLayoutChanged())}GetLineHeight(){return this._lineHeight}SetBold(e){this._isBold!==(e=!!e)&&(this._isBold=e,this._SetWordWrapChanged())}IsBold(){return this._isBold}SetItalic(e){this._isItalic!==(e=!!e)&&(this._isItalic=e,this._SetWordWrapChanged())}IsItalic(){return this._isItalic}SetDrawMaxCharacterCount(e){e=Math.floor(e),this._drawMaxCharCount!==e&&(this._drawMaxCharCount=e,this._SetDrawChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetFontString(e,t){var r=[],i=((this._isBold||t.HasStyleTag("b"))&&r.push("bold"),(this._isItalic||t.HasStyleTag("i"))&&r.push("italic"),t.GetStyleTag("size")),i=(i?parseFloat(i.param):this._fontSize)*this._fontSizeScale;r.push(e?i+"pt":i*this.GetDrawScale()+"pt");let s=this._fontName;e=t.GetStyleTag("font");return e&&e.param&&(s=e.param,this.onloadfont)&&!this._alreadyLoadedFonts.has(s)&&(this.onloadfont(s),this._alreadyLoadedFonts.add(s)),s&&(GENERIC_FONT_FAMILIES.has(s)?r.push(s):r.push('"'+s+'"')),r.join(" ")}SetColor(e){e instanceof C33.Color&&(e=e.getCssRgb()),this._colorStr!==e&&(this._colorStr=e,this._SetDrawChanged())}SetColorRgb(e,t,r){tempColor.setRgb(e,t,r),this.SetColor(tempColor)}SetHorizontalAlignment(e){if(!VALID_HORIZ_ALIGNMENTS.has(e))throw new Error("invalid horizontal alignment");this._horizontalAlign!==e&&(this._horizontalAlign=e,this._SetTextLayoutChanged())}GetHorizontalAlignment(){return this._horizontalAlign}SetVerticalAlignment(e){if(!VALID_VERT_ALIGNMENTS.has(e))throw new Error("invalid vertical alignment");this._verticalAlign!==e&&(this._verticalAlign=e,this._SetTextLayoutChanged())}GetVerticalAlignment(){return this._verticalAlign}SetWordWrapMode(e){if(!VALID_WORD_WRAP_MODES.has(e))throw new Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetWordWrapChanged())}GetWordWrapMode(){return this._wrapMode}SetTextDirection(e){if(!VALID_TEXT_DIRECTIONS.has(e))throw new Error("invalid text direction");this._textDirection!==e&&(this._textDirection=e,this._textContext&&(this._textContext.direction=this._textDirection),this._measureContext&&(this._measureContext.direction=this._textDirection),this._SetWordWrapChanged())}GetTextDirection(){return this._textDirection}SetText(e){this._text!==e&&(this._text=e,this._SetWordWrapChanged())}GetText(){return this._text}GetDrawScale(){return this._scaleFactor*this._zoom*self.devicePixelRatio}SetSize(t,r,i){if(void 0===i&&(i=1),!(t<=0||this._cssWidth===t&&this._cssHeight===r&&this._zoom===i)){var s=this._cssWidth,t=(this._cssWidth=t,this._cssHeight=r,this._zoom=i,self.devicePixelRatio),r=(this._width=this._cssWidth*this._zoom*t,this._height=this._cssHeight*this._zoom*t,Math.max(this._width,this._height)),i=Math.min(this._renderer.GetMaxTextureSize(),MAX_TEXTURE_SIZE);let e=1;i<r&&(e=i/r,this._width=Math.min(this._width*e,i),this._height=Math.min(this._height*e,i)),this._scaleFactor=e,this._cssWidth!==s?this._SetWordWrapChanged():this._SetTextLayoutChanged()}}GetWidth(){return this._width}GetHeight(){return this._height}GetZoom(){return this._zoom}GetTextWidth(){return this._UpdateTextMeasurements(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){return this._UpdateTextMeasurements(),this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+EXTRA_LINE_HEIGHT)-this._lineHeight}GetLengthInGraphemes(){this._UpdateTextMeasurements();let e=0;for(var t of this._wrappedText.GetLines())for(var r of t.fragments())e+=r.GetLength();return e}GetTexture(){return this._textureTimeout.Reset(),this._MaybeUpdate(),this._texture}HitTestFragment(e,t){this._UpdateTextMeasurements();var r,i=this.GetDrawScale();for(r of this._wrappedText.GetLines()){var s=r.GetFontBoundingBoxDescent()*i;if(t>=r.GetPosY()-r.GetHeight()*i+s&&t<r.GetPosY()+s)for(var a of r.fragments())if(e>=a.GetPosX()&&e<a.GetPosX()+a.GetWidth()*i)return a}return null}*fragmentsWithTag(e){var t;this._UpdateTextMeasurements();for(t of this._wrappedText.GetLines())for(var r of t.fragments()){var i=r.GetStyleTag("tag");i&&C33.equalsNoCase(i.param,e)&&(yield r)}}FindFragmentWithTag(e,t){for(var r of this.fragmentsWithTag(e)){if(0===t)return r;--t}return null}CountFragmentsWithTag(e){let t=0;for(var r of this.fragmentsWithTag(e))++t;return t}_MaybeUpdate(){this._texture&&!this._drawChanged&&!this._textLayoutChanged&&!this._wordWrapChanged||this._wasReleased||this._width<=0||this._height<=0||(this._drawChanged=!1,this._DoUpdate())}_DoUpdate(){this._wasReleased||(this._UpdateTextMeasurements(),this._SetTextCanvasSize(Math.max(C33.nextHighestPowerOfTwo(Math.ceil(this._width)),128),Math.max(C33.nextHighestPowerOfTwo(Math.ceil(this._height)),64)),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset())}_SetTextCanvasSize(e,t){this._textCanvas||(this._textCanvas=C33.CreateCanvas(16,16));let r=!1;this._lastCanvasWidth===e&&this._lastCanvasHeight===t||(this._lastCanvasWidth=e,this._lastCanvasHeight=t,this._textCanvas.width=e,this._textCanvas.height=t,r=!0),this._textContext||(this._textContext=this._textCanvas.getContext("2d"),r=!0),r?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.direction=this._textDirection,this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,e,t)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=C33.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=C33.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline="top",this._measureContext.direction=this._textDirection,this._measureContextTop.direction=this._textDirection)}_SetMeasureFontString(e){this._lastMeasureCanvasFont!==e&&(this._lastMeasureCanvasFont=e,this._measureContext.font=e,this._measureContextTop.font=e)}_SupportsFontBoundingBoxMeasurements(){var e;return didCheckFoundBoundingBoxSupport||(didCheckFoundBoundingBoxSupport=!0,this._MaybeCreateMeasureContext(),e=this._measureContext.measureText("test"),supportsFontBoundingBoxMeasurements="number"==typeof e.fontBoundingBoxAscent&&"number"==typeof e.fontBoundingBoxDescent),supportsFontBoundingBoxMeasurements}_UpdateTextMeasurements(){this._UpdateWordWrap(),this._UpdateTextLayout()}_UpdateWordWrap(){this._wordWrapChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new C33.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._wordWrapChanged=!1)}_UpdateTextLayout(){this._textLayoutChanged&&(this._LayoutText(),this._textLayoutChanged=!1)}_MeasureText(e){var t=e.IsText()?e.GetCharacterArray().join(""):" ",e=(this._SetMeasureFontString(this._GetFontString(!0,e)),e.GetStyleTag("size")),e=(e?parseFloat(e.param):this._fontSize)*this._fontSizeScale,r=this._measureContext.measureText(t);let i=0;return this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()&&(t=this._measureContextTop.measureText(t),i=r.fontBoundingBoxAscent-t.fontBoundingBoxAscent),{width:r.width,height:ptToPx2(e),fontBoundingBoxAscent:r.fontBoundingBoxAscent||0,fontBoundingBoxDescent:r.fontBoundingBoxDescent||0,topToAlphabeticDistance:i}}_SetDrawFontString(e){this._lastTextCanvasFont!==e&&(this._lastTextCanvasFont=e,this._textContext.font=e)}_SetDrawCanvasColor(e){this._lastTextCanvasFillStyle!==e&&(this._lastTextCanvasFillStyle=e,this._textContext.fillStyle=e,this._textContext.strokeStyle=e)}_SetDrawCanvasOpacity(e){this._lastTextCanvasOpacity!==e&&(this._lastTextCanvasOpacity=e,this._textContext.globalAlpha=e)}_SetDrawCanvasLineWith(e){this._lastTextCanvasLineWidth!==e&&(this._lastTextCanvasLineWidth=e,this._textContext.lineWidth=e)}_LayoutText(){let i=this.GetDrawScale(),s=(EXTRA_LINE_HEIGHT+this._lineHeight)*i,a=0;var n=this._wrappedText.GetLines();if(0!==n.length){for(var e of n){e.SetPosX(NaN),e.SetPosY(NaN);for(var t of e.fragments())t.SetPosX(NaN),t.SetPosY(NaN)}var o,l=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements();let r=n[0].GetHeight()*i;"center"===this._verticalAlign?(o=n.reduce((e,t)=>e+t.GetHeight()*i+s,0)-s,a=Math.max(this._height/2-o/2,0),l&&(r=n[0].GetTopToAlphabeticDistance()*i)):"bottom"===this._verticalAlign&&(o=n.reduce((e,t)=>e+t.GetHeight()*i+s,0)-this._lineHeight*i,l=l?n.at(-1).GetFontBoundingBoxDescent()*i:0,a=this._height-o-l-2);for(let e=0,t=n.length;e<t;++e){var h=n[e],u=h.GetHeight()*i,c=a;if(this._isBBcodeEnabled){if(a+=0===e?r:u,0<e&&a>this._height-EXTRA_LINE_HEIGHT*i)break}else if(0<e&&a>=this._height-u)break;0<=c&&this._LayoutTextLine(h,a,i),this._isBBcodeEnabled||(a+=u),a+=s}}}_LayoutTextLine(e,t,r){let i=0;"center"===this._horizontalAlign?i=(this._width-e.GetWidth()*r)/2:"right"===this._horizontalAlign&&(i=this._width-e.GetWidth()*r),e.SetPosX(i),e.SetPosY(t);for(var s of"ltr"===this._textDirection?e.fragments():e.fragmentsReverse())this._LayoutFragment(s,i,t,r),i+=s.GetWidth()*r}_LayoutFragment(e,t,r,i){var s=e.GetStyleTag("offsetx"),s=(t+=s?getOffsetParam2(s.param,e.GetHeight())*i:0,e.GetStyleTag("offsety"));r+=s?getOffsetParam2(s.param,e.GetHeight())*i:0,e.IsIcon()&&(r+=(s=e.GetStyleTag("iconoffsety"))?getOffsetParam2(s.param,e.GetHeight())*i:.2*e.GetHeight()*i),e.SetPosX(t),e.SetPosY(r)}_DrawTextToCanvas(){this._textContext.imageSmoothingEnabled=this._iconSmoothing,this._textContext.imageSmoothingQuality="high",this._drawCharCount=0;var e,t=this.GetDrawScale();for(e of this._wrappedText.GetLines())this._DrawTextLine(e,t)}_DrawTextLine(e,t){var r=e.GetPosX(),i=e.GetPosY();if(Number.isFinite(r)&&Number.isFinite(i))for(var s of"ltr"===this._textDirection?e.fragments():e.fragmentsReverse())this._DrawFragment(s,t,e.GetHeight())}_DrawFragment(r,i,s){var a=this._textContext,n=r.GetPosX(),o=r.GetPosY();if(Number.isFinite(n)&&Number.isFinite(o)){s=s/16;let e=r.GetWidth()*i;var l=r.GetHeight()*i,h=r.GetHeight()/16,u=(EXTRA_LINE_HEIGHT+this._lineHeight)*i;let t=r.IsText()?r.GetCharacterArray():null;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;r.IsText()&&this._drawCharCount+t.length>this._drawMaxCharCount&&(t=t.slice(0,this._drawMaxCharCount-this._drawCharCount),e=this._MeasureText(r).width*i),this._drawCharCount+=r.GetLength()}var c,_,d,p=r.GetStyleTag("background"),m=r.HasStyleTag("u"),g=r.HasStyleTag("s");r.IsText()&&C33.IsCharArrayAllWhitespace(t)&&!p&&!m&&!g||r.HasStyleTag("hide")||(c=r.GetStyleTag("color"),d=r.GetStyleTag("opacity"),this._SetDrawCanvasOpacity(d?parseFloat(d.param)/100:1),p&&(this._SetDrawCanvasColor(p.param),a.fillRect(n,o-l,e,l+u)),p=(d=r.GetStyleTag("linethickness"))?parseFloat(d.param):1,(u=r.HasStyleTag("stroke"))&&this._SetDrawCanvasLineWith(.5*h*p*this.GetDrawScale()),r.IsText()?(d=t.join(""),this._SetDrawFontString(this._GetFontString(!1,r)),!u&&(this._SetDrawCanvasLineWith(.5*h*p*this.GetDrawScale()),_=r.GetStyleTag("outlineback"))&&(this._SetDrawCanvasColor(_.param),this._FillOrStrokeText(!0,d,n,o,e)),this._SetDrawCanvasColor(c?c.param:this._colorStr),this._FillOrStrokeText(u,d,n,o,e),!u&&(this._SetDrawCanvasLineWith(.5*h*p*this.GetDrawScale()),_=r.GetStyleTag("outline"))&&(this._SetDrawCanvasColor(_.param),this._FillOrStrokeText(!0,d,n,o,e))):r.IsIcon()&&0<r.GetWidth()&&(_=r.GetDrawable(this._iconSet))&&a.drawImage(_,n,o-l,e,l),this._SetDrawCanvasColor(c?c.param:this._colorStr),m&&fillOrStrokeRect2(a,u,n,o+i*s,e,i*s*p),g&&a.fillRect(n,o-l/4+(d=i*h)/2-d*p/2,e,d*p))}}_FillOrStrokeText(e,t,r,i,s){"rtl"===this._textDirection&&(r+=s),e?"Gecko"===C33.Platform.BrowserEngine?this._textContext.strokeText(t,r,i,s):this._textContext.strokeText(t,r,i):"Gecko"===C33.Platform.BrowserEngine?this._textContext.fillText(t,r,i,s):this._textContext.fillText(t,r,i)}_UpdateTexture(){this._renderer.IsContextLost()||(this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textCanvas.width,this._textCanvas.height,{mipMap:!0,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this._rcTex.set(0,0,this._width/this._texture.GetWidth(),this._height/this._texture.GetHeight()),this.ontextureupdate&&this.ontextureupdate())}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(var e of allRendererTexts)e.ReleaseTexture()}static GetAll(){return allRendererTexts.values()}}}{let C33=self.C3;class WebGLRealTimeElapsedQuery{constructor(e){this._gl=e.GetContext(),this._version=e.GetWebGLVersionNumber(),this._timerExt=e._GetDisjointTimerQueryExtension(),this._query=null,this._isActive=!1,this._hasResult=!1,this._result=0,1===this._version?this._query=this._timerExt.createQueryEXT():this._query=this._gl.createQuery()}Release(){this._DeleteQueryObject(),this._gl=null,this._timerExt=null,this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),this._query=null)}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query),this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT),this._isActive=!1}CheckForResult(){if(this._query&&!this._hasResult&&!this._isActive){let e=!1;e=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE);var t=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);e&&!t&&(1===this._version?this._result=this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._result=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1e9,this._hasResult=!0),(e||t)&&this._DeleteQueryObject()}}HasResult(){return this._hasResult}GetResult(){if(this._hasResult)return this._result;throw new Error("no result available")}}C33.Gfx.WebGLTimeElapsedQuery=class WebGLTimeElapsedQuery{constructor(e){this._renderer=e,this._frameNumber=e.GetFrameNumber(),this._isActive=!1,this._parentQuery=null,this._isNested=!1,this._realQuery=null,this._queries=[]}Release(){for(var e of this._queries)e instanceof WebGLRealTimeElapsedQuery&&e.Release();C33.clearArray(this._queries),this._parentQuery=null,this._realQuery=null,this._renderer=null}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");var e=this._renderer._GetTimeQueryStack();0<e.length?(this._isNested=!0,this._parentQuery=e.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null),this._isActive=!0,e.push(this),this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");if(this._renderer._GetTimeQueryStack().pop()!==this)throw new Error("can only end most nested query");this._isActive=!1,this._EndReal(),this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=C33.New(WebGLRealTimeElapsedQuery,this._renderer),this._queries.push(this._realQuery),this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed(),this._realQuery=null}CheckForResult(){for(var e of this._queries)e.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every(e=>e.HasResult())}GetResult(){return this._queries.reduce((e,t)=>e+t.GetResult(),0)}GetFrameNumber(){return this._frameNumber}}}{let C33=self.C3;C33.Gfx.WebGLQueryResultBuffer=class WebGLQueryResultBuffer{constructor(e,t=1e3){this._renderer=e,this._maxQueries=t,this._buffer=[],this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear(),this._renderer._RemoveQueryResultBuffer(this),this._renderer=null}Clear(){for(var e of this._buffer)e.Release();C33.clearArray(this._buffer)}AddTimeElapsedQuery(){var e=new C33.Gfx.WebGLTimeElapsedQuery(this._renderer);return this._buffer.push(e),this._buffer.length>this._maxQueries&&this._buffer.shift().Release(),e}CheckForResults(e){for(var t of this._buffer){if(t.GetFrameNumber()>=e)return;if(t.IsNested())return;t.CheckForResult()}}GetFrameRangeResultSum(e,t){if(t<=e)return NaN;let r=0;for(var i of this._buffer){if(i.GetFrameNumber()>=t)break;if(!(i.GetFrameNumber()<e)){if(!i.HasResult())return NaN;r+=i.GetResult()}}return r}DeleteAllBeforeFrameNumber(r){for(let e=0,t=this._buffer.length;e<t;++e){var i=this._buffer[e];if(!(i.GetFrameNumber()<r))return void(0<e&&this._buffer.splice(0,e));i.Release()}}}}{let CheckPendingPolls2=function(){pollRafId=-1;for(var e of pendingPolls)e.checkFunc()&&(e.resolve(),pendingPolls.delete(e));0<pendingPolls.size&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls2))},C33=(CheckPendingPolls=CheckPendingPolls2,self.C3),assert=self.assert,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]),MAX_VERTICES=8e3,MAX_INDICES=MAX_VERTICES/2*3,MAX_POINTS=8e3,LAST_POINT=MAX_POINTS-4,PARTIAL_TEXTURE_UPLOAD_CHUNK_SIZE=262144,defaultTexCoordsQuad=new C33.Quad(0,0,1,0,1,1,0,1),tmpProjection=mat42.create(),tmpModelView=mat42.create(),tmpQuad=new C33.Quad,tmpRect=new C33.Rect,loseContextExtension=null,pendingPolls=(C33.isDebug&&(self.debug_lose_webgl_context=function(){loseContextExtension?loseContextExtension.loseContext():console.warn("WEBGL_lose_context not supported")},self.debug_restore_webgl_context=function(){loseContextExtension?loseContextExtension.restoreContext():console.warn("WEBGL_lose_context not supported")}),new Set),pollRafId=-1;C33.Gfx.WebGLRenderer=class WebGLRenderer extends C33.Gfx.RendererBase{constructor(e,t){if(super(t),t=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,t),!VALID_POWER_PREFERENCES.has(t.powerPreference))throw new Error("invalid power preference");var r={alpha:!!t.alpha,depth:!1,antialias:!1,powerPreference:t.powerPreference,failIfMajorPerformanceCaveat:!!t.failIfMajorPerformanceCaveat};let i=null,s=0;if(2<=t.maxWebGLVersion&&(i=e.getContext("webgl2",r),s=2),i||(i=e.getContext("webgl",r),s=1),!i)throw new Error("renderer-unavailable (could not get WebGL context)");this._gl=i,this._attribs=i.getContextAttributes(),this._versionString=i.getParameter(i.VERSION),this._version=s,this._viewport=vec42.create(),this._didChangeTransform=!1,this._bbProjectionMatrix=mat42.create(),this._usesDepthBuffer=!!t.depth,this._canSampleDepth=!(!t.depth||!t.canSampleDepth),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._depthBuffer=null,this._isAutoSizeDepthBuffer=!0,this._depthBufferWidth=0,this._depthBufferHeight=0,this._vertexBuffer=null,this._texcoordBuffer=null,this._indexBuffer=null,this._pointBuffer=null,this._vertexData=new Float32Array(MAX_VERTICES*this.GetNumVertexComponents()),this._indexData=new Uint16Array(MAX_INDICES),this._texcoordData=new Float32Array(2*MAX_VERTICES),this._pointData=new Float32Array(4*MAX_POINTS),this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._lastVertexPtr=0,this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._batch=[],this._batchPtr=0,this._topOfBatch=0,this._currentRenderTarget=null,this._lastPointZ=0,this._batchState=C33.New(C33.Gfx.BatchState,this),this._lastColor=C33.New(C33.Color,1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._lastSrcBlend=0,this._lastDestBlend=0,this._lastPointTexCoords=new C33.Rect,this._lastScissorRect=C33.New(C33.Rect,0,0,-1,-1),this._coplanarMode=0,this._maxTextureSize=-1,this._minPointSize=0,this._maxPointSize=0,this._highpPrecision=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._extensions=[],this._isInitialisingAfterContextRestored=!1,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._isGpuProfilingEnabled=!!t.enableGpuProfiling,this._timerExt=null,this._allQueryResultBuffers=new Set,this._timeQueryStack=[],this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();var e=this._gl,t=this.GetNumVertexComponents(),t=(this._lastColor.setRgba(1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._vertexPtr=0,this._pointPtr=0,this._lastVertexPtr=MAX_VERTICES*t-4*t,C33.clearArray(this._batch),this._batchPtr=0,this._topOfBatch=0,this._lastProgram=null,this._currentRenderTarget=null,this._lastPointTexCoords.set(0,0,1,1),this._lastPointZ=0,this._batchState),t=(t.currentShader=null,t.currentFramebuffer=null,t.currentFramebufferNoDepth=null,vec42.set(t.currentColor,1,1,1,1),t.clearColor.setRgba(0,0,0,0),t.pointTexCoords.set(0,0,1,1),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._lastSrcBlend=e.ONE,this._lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this._InitBlendModes(e),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this._usesDepthBuffer?(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.LEQUAL)):(e.disable(e.DEPTH_TEST),e.depthMask(!1)),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferData(e.ARRAY_BUFFER,this._pointData.byteLength,e.DYNAMIC_DRAW),this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertexData.byteLength,e.DYNAMIC_DRAW),this._texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,this._texcoordData.byteLength,e.DYNAMIC_DRAW),this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indexData,e.STATIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),e.getParameter(e.ALIASED_POINT_SIZE_RANGE)),t=(this._minPointSize=t[0],this._maxPointSize=t[1],e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT)),r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),t=(this._highpPrecision=t&&r?Math.min(t.precision,r.precision):0,2048<this._maxPointSize&&(this._maxPointSize=2048),this._extensions=e.getSupportedExtensions(),e.getExtension("WEBGL_debug_renderer_info"));if(t&&(this._unmaskedVendor=e.getParameter(t.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),this._parallelShaderCompileExt=e.getExtension("KHR_parallel_shader_compile"),C33.isDebug&&(loseContextExtension=e.getExtension("WEBGL_lose_context")),this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?this._timerExt=e.getExtension("EXT_disjoint_timer_query"):this._timerExt=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query")),this._anisotropicExt=e.getExtension("EXT_texture_filter_anisotropic"),this._anisotropicExt?this._maxAnisotropy=e.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):this._maxAnisotropy=0,this.GetWebGLVersionNumber()<2&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=e.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw new Error("no depth texture support");this.GetWebGLVersionNumber()<2&&(this._fragDepthExt=e.getExtension("EXT_frag_depth"),this._stdDerivativesExt=e.getExtension("OES_standard_derivatives"),this._textureLodExt=e.getExtension("EXT_shader_texture_lod"));r=C33.Gfx.WebGLShaderProgram,t=r.GetDefaultVertexShaderSource(!1);let i=r.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(),s=t,a=r.GetPointFragmentShaderSource_WebGL1_NoFragDepth(),n=r.GetPointVertexShaderSource_WebGL1(),o=r.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(),l=r.GetDefaultVertexShaderSource(!0),h=!1;this._usesDepthBuffer&&(this.GetWebGLVersionNumber()<2?this._fragDepthExt&&(i=r.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(),a=r.GetPointFragmentShaderSource_WebGL1_FragDepthEXT(),o=r.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(),h=!0):(s=r.GetDefaultVertexShaderSource_WebGL2(),i=r.GetTextureFillFragmentShaderSource_WebGL2(),a=r.GetPointFragmentShaderSource_WebGL2(),n=r.GetPointVertexShaderSource_WebGL2(),o=r.GetTilemapFragmentShaderSource_WebGL2(),l=r.GetDefaultVertexShaderSource_WebGL2(!0)));var e=r.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),h,this._stdDerivativesExt&&this._textureLodExt),u=2<=this.GetWebGLVersionNumber()?r.GetDefaultVertexShaderSource_WebGL2():t,r=[[i,s,"<default>"],[i,s,"<default-device-transform>"],[a,n,"<point>"],[r.GetColorFillFragmentShaderSource(),t,"<fill>"],[r.GetLinearGradientFillFragmentShaderSource(),t,"<lineargradient>"],[r.GetPenumbraFillFragmentShaderSource(),t,"<penumbra>"],[r.GetHardEllipseFillFragmentShaderSource(),t,"<hardellipse>"],[r.GetHardEllipseOutlineFragmentShaderSource(),t,"<hardellipseoutline>"],[r.GetSmoothEllipseFillFragmentShaderSource(),t,"<smoothellipse>"],[r.GetSmoothEllipseOutlineFragmentShaderSource(),t,"<smoothellipseoutline>"],[r.GetSmoothLineFillFragmentShaderSource(),t,"<smoothline>"],[o,l,"<tilemap>"],[e,u,"<tilerandomization>"]],t=await Promise.all(r.map(e=>this.CreateShaderProgram({src:e[0],vertexSrc:e[1],name:e[2]})));this._spTextureFill=t[0],this._spDeviceTransformTextureFill=t[1],this._spPoints=t[2],this._spColorFill=t[3],this._spLinearGradientFill=t[4],this._spPenumbraFill=t[5],this._spHardEllipseFill=t[6],this._spHardEllipseOutline=t[7],this._spSmoothEllipseFill=t[8],this._spSmoothEllipseOutline=t[9],this._spSmoothLineFill=t[10],this._spTilemapFill=t[11],this._spTileRandomization=t[12],this.SetTextureFillMode()}async CreateShaderProgram(e){e=await C33.Gfx.WebGLShaderProgram.Create(this,e);return this._AddShaderProgram(e),e}ResetLastProgram(){this._lastProgram=null}SetSize(e,t,r){var i;this._width===e&&this._height===t&&!r||(this.EndBatch(),r=this._gl,i=this._batchState,this._width=e,this._height=t,this._SetViewport(0,0,e,t),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,e/t),this.SetProjectionMatrix(this._bbProjectionMatrix),this._spDeviceTransformTextureFill&&(r.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0),this._lastTexture0=null,this._lastTexture1=null,this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height),this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height),r.bindFramebuffer(r.FRAMEBUFFER,null),this._currentRenderTarget=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null)}_SetDepthBufferSize(e,t){var r=this._gl;this._depthBuffer&&this._depthBufferWidth===e&&this._depthBufferHeight===t||(this._canSampleDepth?(this._depthBuffer&&r.deleteTexture(this._depthBuffer),this._depthBuffer=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this._depthBuffer),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),2<=this.GetWebGLVersionNumber()?r.texImage2D(r.TEXTURE_2D,0,r.DEPTH24_STENCIL8,e,t,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):this._depthTextureExt&&r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_STENCIL,e,t,0,r.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),r.bindTexture(r.TEXTURE_2D,null)):(this._depthBuffer&&r.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this._depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,2<=this._version?r.DEPTH24_STENCIL8:r.DEPTH_STENCIL,e,t),r.bindRenderbuffer(r.RENDERBUFFER,null)),this._depthBufferWidth=e,this._depthBufferHeight=t)}SetFixedSizeDepthBuffer(e,t){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(e,t))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(e,t,r,i){var s=this._viewport;s[0]===e&&s[1]===t&&s[2]===r&&s[3]===i||(this.PushBatch().InitSetViewport(e,t,r,i),vec42.set(s,e,t,r,i),this._topOfBatch=0)}SetFovY(e){super.SetFovY(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetNearZ(e){super.SetNearZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(e){super.SetFarZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(e){mat42.exactEquals(this._matP,e)||(this.PushBatch().InitSetProjection(e),mat42.copy(this._matP,e),this._topOfBatch=0,this._didChangeTransform=!0)}SetDefaultRenderTargetProjectionState(){let e,t,r;var i=this._currentRenderTarget;r=(null===i?(e=this._bbProjectionMatrix,t=this.GetWidth(),this):(e=i.GetProjectionMatrix(),t=i.GetWidth(),i)).GetHeight(),this.SetProjectionMatrix(e),this._SetViewport(0,0,t,r)}SetModelViewMatrix(e){mat42.exactEquals(this._matMV,e)||(this.PushBatch().InitSetModelView(e),mat42.copy(this._matMV,e),this._topOfBatch=0,this._didChangeTransform=!0)}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){var e=this._batch;return this._batchPtr===e.length&&e.push(new C33.Gfx.WebGLBatchJob(this._batchState)),e[this._batchPtr++]}EndBatch(){0===this._batchPtr||this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._batchPtr=0,this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._topOfBatch=0)}_WriteBuffers(){var e=this._gl;0<this._pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))),0<this._vertexPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){var r=this._batch;for(let e=0,t=this._batchPtr;e<t;++e)r[e].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(e,t,r,i){var s=this._lastColor;s.equalsRgba(e,t,r,i)||(s.setRgba(e,t,r,i),this.PushBatch().InitSetColor(s),this._topOfBatch=0,this._currentStateGroup=null)}SetOpacity(e){var t=this._lastColor;t.getA()!==e&&(t.setA(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}SetColor(e){var t=this._lastColor;t.equals(e)||(t.set(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(e){e!==this._lastTexture0&&(this.PushBatch().InitSetTexture(e),this._lastTexture0=e,this._topOfBatch=0)}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(e){e=this._GetBlendByIndex(e);this._SetBlend(e[0],e[1])}SetNamedBlendMode(e){e=this.GetNamedBlend(e);this._SetBlend(e.srcBlend,e.destBlend)}_SetBlend(e,t){e===this._lastSrcBlend&&t===this._lastDestBlend||(this.PushBatch().InitSetBlend(e,t),this._lastSrcBlend=e,this._lastDestBlend=t,this._topOfBatch=0,this._currentStateGroup=null)}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(e){this.Rect2(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}Rect2(e,t,r,i){this.Quad2(e,t,r,t,r,i,e,i)}_ExtendQuadBatch(){let e=this._vertexPtr;e>=this._lastVertexPtr&&(this.EndBatch(),e=0),1===this._topOfBatch?this._batch[this._batchPtr-1]._indexCount+=6:(this.PushBatch().InitQuad(e,6),this._topOfBatch=1)}_WriteQuadToVertexBuffer(e){e.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ),this._vertexPtr+=12}Quad(e){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad2(e,t,r,i,s,a,n,o){this._ExtendQuadBatch();var l=this._vertexData,h=this._vertexPtr,u=this._baseZ+this._currentZ;l[h++]=e,l[h++]=t,l[h++]=u,l[h++]=r,l[h++]=i,l[h++]=u,l[h++]=s,l[h++]=a,l[h++]=u,l[h++]=n,l[h++]=o,l[h++]=u,this._vertexPtr=h,defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad4(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D(e,t,r,i,s,a,n,o,l,h,u,c,_){this._ExtendQuadBatch();var d=this._vertexData,p=this._vertexPtr,m=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=m+r,d[p++]=i,d[p++]=s,d[p++]=m+a,d[p++]=n,d[p++]=o,d[p++]=m+l,d[p++]=h,d[p++]=u,d[p++]=m+c,this._vertexPtr=p,_.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D2(e,t,r,i,s,a,n,o,l,h,u,c,_){this._ExtendQuadBatch();var d=this._vertexData,p=this._vertexPtr,m=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=m+r,d[p++]=i,d[p++]=s,d[p++]=m+a,d[p++]=n,d[p++]=o,d[p++]=m+l,d[p++]=h,d[p++]=u,d[p++]=m+c,this._vertexPtr=p,_.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}DrawMesh(r,i,s){var a=this._vertexData,n=this._texcoordData;if(s.length%3!=0)throw new Error("invalid index buffer length");for(let e=0,t=s.length;e<t;){var o=s[e++],l=s[e++],h=s[e++],u=3*o,c=3*l,_=3*h,o=2*o,l=2*l,h=2*h,d=(this._ExtendQuadBatch(),this._vertexPtr),p=this._texPtr;a[d++]=r[0+u],a[d++]=r[1+u],a[d++]=r[2+u],a[d++]=r[0+c],a[d++]=r[1+c],a[d++]=r[2+c],a[d++]=r[0+_],a[d++]=r[1+_],a[d++]=r[2+_],a[d++]=r[0+_],a[d++]=r[1+_],a[d++]=r[2+_],n[p++]=i[0+o],n[p++]=i[1+o],n[p++]=i[0+l],n[p++]=i[1+l],n[p++]=i[0+h],n[p++]=i[1+h],n[p++]=i[0+h],n[p++]=i[1+h],this._vertexPtr=d,this._texPtr=p}}FullscreenQuad(e,t){this.SetCurrentZ(0),mat42.copy(tmpProjection,this._matP),mat42.copy(tmpModelView,this._matMV),this.SetDefaultRenderTargetProjectionState();var r,i,s,a,n,[o,l]=this.GetRenderTargetSize(this._currentRenderTarget),h=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(l),0,0,0,l);this.SetModelViewMatrix(h),"crop"===e&&this._currentRenderTarget&&t?(h=this._width/2,e=this._height/2,r=t.GetWidth(),t=t.GetHeight(),i=this._currentRenderTarget.GetWidth(),n=this._currentRenderTarget.GetHeight(),i=Math.min(i,r),s=Math.min(n,t),a=Math.max(t-n,0),n=Math.max(n-t,0),tmpRect.set(-h,e-n,-h+i,e-s-n),tmpQuad.setFromRect(tmpRect),tmpRect.set(0,a,i,s+a),tmpRect.divide(r,t),this.Quad3(tmpQuad,tmpRect)):this.Rect2(-(h=o/2),e=l/2,h,-e),this.SetProjectionMatrix(tmpProjection),this.SetModelViewMatrix(tmpModelView)}StartRenderingPoints(e){this._lastPointTexCoords.equals(e)||(this._lastPointTexCoords.copy(e),this.PushBatch().InitSetPointTexCoords(e),this._topOfBatch=0)}FinishRenderingPoints(){}Point(e,t,r,i){this._pointPtr>=LAST_POINT&&this.EndBatch();var s=this._pointPtr,a=this._baseZ+this._currentZ,a=(2===this._topOfBatch&&this._lastPointZ===a?this._batch[this._batchPtr-1]._indexCount++:(this.PushBatch().InitPoints(s,a),this._topOfBatch=2,this._lastPointZ=a),this._pointData);a[s++]=e,a[s++]=t,a[s++]=r,a[s++]=i,this._pointPtr=s}SetProgram(e){this._lastProgram!==e&&(this.PushBatch().InitSetProgram(e),this._lastProgram=e,this._topOfBatch=0,this._currentStateGroup=null)}GetProgram(){return this._lastProgram}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(e){this.PushBatch().InitSetGradientColor(e),this._topOfBatch=0}SetEllipseParams(e,t,r=1){this.PushBatch().InitSetEllipseParams(e,t,r),this._topOfBatch=0}SetTilemapInfo(e,t,r,i,s,a,n){if(this._lastProgram!==this._spTilemapFill)throw new Error("must set tilemap fill mode first");this.PushBatch().InitSetTilemapInfo(e,t,r,i,s,a,n),this._topOfBatch=0}SetTileRandomizationInfo(e,t,r,i,s,a,n){if(this._lastProgram!==this._spTileRandomization)throw new Error("must set tile randomization mode first");this.PushBatch().InitSetTileRandomizationInfo(e,t,r,i,s,a,n),this._topOfBatch=0}SetProgramParameters(e,t,r,i,s,a,n,o,l,h,u){var c,_,d=this._lastProgram;u%=10800,d._hasAnyOptionalUniforms&&!d.AreOptionalUniformsAlreadySetInBatch(t,r,i,s,a,n,o,l,h,u)&&((c=this.PushBatch()).InitSetProgramParameters(),d.SetOptionalUniformsInBatch(t,r,i,s,a,n,o,l,h,u),(_=c._mat4param)[0]=a,_[1]=n,t.writeToTypedArray(_,2),_[6]=l,_[7]=h,r.writeToTypedArray(_,12),a=c._colorParam,s.writeToTypedArray(a,0),n=a[1],a[1]=a[3],a[3]=n,i.writeToTypedArray(c._srcOriginRect,0),c._startIndex=u,c._indexCount=o,d._uSamplerBack.IsUsed()?c._texParam=e?e.GetTexture():null:c._texParam=null,this._topOfBatch=0)}SetProgramCustomParameters(e){var t,r=this._lastProgram;0===e.length||r.AreCustomParametersAlreadySetInBatch(e)||((t=this.PushBatch()).InitSetProgramCustomParameters(),r.SetCustomParametersInBatch(e),C33.shallowAssignArray(t._shaderParams,e),this._topOfBatch=0)}ClearRgba(e,t,r,i){this.PushBatch().InitClearSurface2(e,t,r,i),this._topOfBatch=0}Clear(e){this.PushBatch().InitClearSurface(e),this._topOfBatch=0}Start(){}Finish(){super.Finish(),this._gl.flush()}ClearDepth(){this._usesDepthBuffer&&this._currentRenderTarget&&this._currentRenderTarget.HasDepthBuffer()&&(this.PushBatch().InitClearDepth(this._isDepthEnabled),this._topOfBatch=0)}SetDepthEnabled(e){this._isDepthEnabled!==(e=!!e)&&this._usesDepthBuffer&&(this._isDepthEnabled=e,this.PushBatch().InitSetDepthEnabled(e),this._topOfBatch=0)}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){if(e=!!e,this._canSampleDepth&&this._isDepthSamplingEnabled!==e){if(e&&this.IsDepthEnabled())throw new Error("depth still enabled");this._isDepthSamplingEnabled=e,this.PushBatch().InitSetDepthSamplingEnabled(e),this._topOfBatch=0}}SetScissorRect(e,t,r,i,s=0){e=Math.floor(e),t=Math.floor(t),r=Math.floor(r),i=Math.floor(i),this._lastScissorRect.equalsWH(e,t,r,i)||(this._lastScissorRect.setWH(e,t,r,i),t=(s||this.GetRenderTargetSize(this.GetRenderTarget())[1])-t-i,this.PushBatch().InitSetScissor(!0,e,t,r,i),this._topOfBatch=0)}RemoveScissorRect(){-1!==this._lastScissorRect.getRight()&&(this._lastScissorRect.set(0,0,-1,-1),this.PushBatch().InitSetScissor(!1,0,0,0,0),this._topOfBatch=0)}CheckForQueryResults(){for(var e of this._allQueryResultBuffers)e.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost(),C33.Gfx.WebGLRendererTexture.OnContextLost(),C33.Gfx.WebGLRenderTarget.OnContextLost(),C33.Gfx.RendererText.OnContextLost();for(var e of this._allQueryResultBuffers)e.Clear();this._extensions=[],this._timerExt=null,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._depthBuffer=null;for(var t of this._stateGroups.values())t.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0,await this.InitState(),this._isInitialisingAfterContextRestored=!1;for(var e of this._stateGroups.values())e.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(e,t){if(this.IsContextLost())throw new Error("context lost");this.EndBatch();var r=C33.New(C33.Gfx.WebGLRendererTexture,this);return r._CreateStatic(e,t),r}async CreateStaticTextureAsync(t,r){if(this.IsContextLost())throw new Error("context lost");if(r=Object.assign({},r),C33.Supports.ImageBitmapOptions){let e=await createImageBitmap(t,{premultiplyAlpha:"premultiply"});var i=r.wrapX&&"clamp-to-edge"!==r.wrapX||r.wrapY&&"clamp-to-edge"!==r.wrapY,s=C33.isPOT(e.width)&&C33.isPOT(e.height);return this.SupportsNPOTTextures()||s||!i?r.premultiplyAlpha=!1:C33.Supports.ImageBitmapOptionsResize?(e=await createImageBitmap(t,{premultiplyAlpha:"premultiply",resizeWidth:C33.nextHighestPowerOfTwo(e.width),resizeHeight:C33.nextHighestPowerOfTwo(e.height)}),r.premultiplyAlpha=!1):e=await createImageBitmap(t,{premultiplyAlpha:"none"}),C33.Asyncify(()=>this.CreateStaticTexture(e,r))}if(t instanceof Blob){if("undefined"==typeof Image)throw new Error("texture upload variant not supported in worker");s=await C33.BlobToImage(t);t=s}return C33.Asyncify(()=>this.CreateStaticTexture(t,r))}CreateDynamicTexture(e,t,r){this.EndBatch();var i=C33.New(C33.Gfx.WebGLRendererTexture,this);return i._CreateDynamic(e,t,r),i}UpdateTexture(e,t,r){this.EndBatch(),t._Update(e,r)}DeleteTexture(e){e&&(e.SubtractReference(),0<e.GetReferenceCount()||(this.EndBatch(),e===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),e===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()))}CreateRenderTarget(e){let t=this._width,r=this._height,i=!0;if(e&&("number"==typeof e.width&&(t=Math.floor(e.width),i=!1),"number"==typeof e.height)&&(r=Math.floor(e.height),i=!1),t<=0||r<=0)throw new Error("invalid size");this.EndBatch();var s=C33.New(C33.Gfx.WebGLRenderTarget,this);return s._Create(t,r,Object.assign({isDefaultSize:i},e)),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,s}SetRenderTarget(e,t=!0){e!==this._currentRenderTarget&&(e&&e.IsDefaultSize()&&e._Resize(this._width,this._height),this.PushBatch().InitSetRenderTarget(e),this._currentRenderTarget=e,this._topOfBatch=0,t)&&this.SetDefaultRenderTargetProjectionState()}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(e){return e?[e.GetWidth(),e.GetHeight()]:[this._width,this._height]}CopyRenderTarget(e,t="stretch"){this._version<2||this._currentRenderTarget&&0<this._currentRenderTarget.GetMultisampling()?(this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(e,t)):(this.PushBatch().InitBlitFramebuffer(e,this._currentRenderTarget,t),this._topOfBatch=0)}DrawRenderTarget(e,t="stretch"){e=e.GetTexture();if(!e)throw new Error("not a texture-backed render target");this.SetTexture(e),this.FullscreenQuad(t,e)}InvalidateRenderTarget(e){this._version<2||(this.PushBatch().InitInvalidateFramebuffer(e._GetFramebuffer()),this._topOfBatch=0)}DeleteRenderTarget(e){this.SetRenderTarget(null),this.EndBatch();var t=e.GetTexture();t===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),t===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()}async ReadBackRenderTargetToImageData(t,r,i){this.EndBatch();let e=this._currentRenderTarget,s,a,n,o=(n=t?(s=t.GetWidth(),a=t.GetHeight(),t._GetFramebuffer()):(s=this.GetWidth(),a=this.GetHeight(),null),0),l=0,h=s,u=a;if(i){o=C33.clamp(Math.floor(i.getLeft()),0,s-1),l=C33.clamp(Math.floor(i.getTop()),0,a-1);let e=i.width(),t=(e=0===e?s-o:C33.clamp(Math.floor(e),0,s-o),i.height());t=0===t?a-l:C33.clamp(Math.floor(t),0,a-l),h=e,u=t,l=a-(l+u)}let c=this._gl;c.bindFramebuffer(c.FRAMEBUFFER,n);t=()=>{c.bindFramebuffer(c.FRAMEBUFFER,null),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,this.SetRenderTarget(e)};let _;if(!r&&2<=this.GetWebGLVersionNumber()){c.bindFramebuffer(c.READ_FRAMEBUFFER,n);var i=c.createBuffer(),r=h*u*4,d=c.PIXEL_PACK_BUFFER;c.bindBuffer(d,i),c.bufferData(d,r,c.STREAM_READ),c.readPixels(o,l,h,u,c.RGBA,c.UNSIGNED_BYTE,0),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.bindBuffer(d,null),t();let e=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);await this._WaitForObjectReady(()=>c.getSyncParameter(e,c.SYNC_STATUS)===c.SIGNALED),c.deleteSync(e),_=new ImageData(h,u),c.bindBuffer(d,i),c.getBufferSubData(d,0,new Uint8Array(_.data.buffer),0,r),c.bindBuffer(d,null),c.deleteBuffer(i)}else _=new ImageData(h,u),c.readPixels(o,l,h,u,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array(_.data.buffer)),t();return _}CoplanarStartStencilPass(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarStartStencilPass(),this._topOfBatch=0,this._coplanarMode=1}CoplanarStartColorPass(){this.SetDepthEnabled(!1),this.PushBatch().InitCoplanarStartColorPass(),this._topOfBatch=0,this._coplanarMode=2}IsCoplanarColorPass(){return 2===this._coplanarMode}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarRestore(),this._topOfBatch=0,this._coplanarMode=0}StartQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitStartQuery(e),this._topOfBatch=0)}EndQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitEndQuery(e),this._topOfBatch=0)}_WaitForObjectReady(t){var e=new Promise(e=>pendingPolls.add({resolve:e,checkFunc:t}));return-1===pollRafId&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls2)),e}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let e=0;for(var t of C33.Gfx.WebGLRenderTarget.allRenderTargets())t.GetTexture()||(e+=t.GetEstimatedMemoryUsage());return e}GetEstimatedTextureMemoryUsage(){let e=0;for(var t of C33.Gfx.WebGLRendererTexture.allTextures())e+=t.GetEstimatedMemoryUsage();return e}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return 2<=this.GetWebGLVersionNumber()}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){var e;return 2<=this.GetWebGLVersionNumber()?"webgl2":(e=[],this._fragDepthExt&&e.push("EXT_frag_depth"),this._stdDerivativesExt&&e.push("OES_standard_derivatives"),this._textureLodExt&&e.push("EXT_shader_texture_lod"),0<e.length?"webgl1:"+e.join(","):"webgl1:none")}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(e){this._allQueryResultBuffers.add(e)}_RemoveQueryResultBuffer(e){this._allQueryResultBuffers.delete(e)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(e){this._InitBlendModeData([["normal",e.ONE,e.ONE_MINUS_SRC_ALPHA],["additive",e.ONE,e.ONE],["xor",e.ONE,e.ONE_MINUS_SRC_ALPHA],["copy",e.ONE,e.ZERO],["destination-over",e.ONE_MINUS_DST_ALPHA,e.ONE],["source-in",e.DST_ALPHA,e.ZERO],["destination-in",e.ZERO,e.SRC_ALPHA],["source-out",e.ONE_MINUS_DST_ALPHA,e.ZERO],["destination-out",e.ZERO,e.ONE_MINUS_SRC_ALPHA],["source-atop",e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],["destination-atop",e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA]])}CreateWebGLText(){return this.CreateRendererText()}}}{let C33=self.C3,DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};C33.Gfx.EffectChainManager=class EffectChainManager{constructor(e){e=Object.assign({},DEFAULT_CTOR_OPTS,e),this._cbGetDrawSize=e.getDrawSize,this._cbGetRenderTarget=e.getRenderTarget,this._cbReleaseRenderTarget=e.releaseRenderTarget,this._cbGetTime=e.getTime,this._cbRedraw=e.redraw,this._webgpuBackTexture=null,this._allEffectChains=new Set}_AddEffectChain(e){this._allEffectChains.add(e)}_RemoveEffectChain(e){this._allEffectChains.delete(e)}OnContextLost(){this._webgpuBackTexture=null;for(var e of this._allEffectChains)e.OnContextLost()}GetDrawSize(e){return this._cbGetDrawSize?this._cbGetDrawSize(e):[e.GetWidth(),e.GetHeight()]}GetRenderTarget(e){return this._cbGetRenderTarget(e)}ReleaseRenderTarget(e,t){this._cbReleaseRenderTarget(e,t)}GetTime(){return this._cbGetTime()}Redraw(e){this._cbRedraw(e)}_GetWebGPUBackTexture(e,t,r){return t=Math.floor(t),r=Math.floor(r),!this._webgpuBackTexture||this._webgpuBackTexture.GetWidth()===t&&this._webgpuBackTexture.GetHeight()===r||(e.DeleteTexture(this._webgpuBackTexture),this._webgpuBackTexture=null),null===this._webgpuBackTexture&&(this._webgpuBackTexture=e.CreateStaticTexture(null,{width:t,height:r,sampling:"nearest",mipMap:!1})),this._webgpuBackTexture}}}{let C33=self.C3,assert=self.assert,glMatrix=self.glMatrix,mat42=glMatrix.mat4,tempRect=C33.New(C33.Rect),tempRect2=C33.New(C33.Rect),tempRect3=C33.New(C33.Rect),tempRect4=C33.New(C33.Rect),tempMat4a=mat42.create(),tempMat4b=mat42.create(),DEFAULT_CTOR_OPTS={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1};C33.Gfx.EffectChain=class EffectChain{constructor(e,t){t=Object.assign({},DEFAULT_CTOR_OPTS,t),this._manager=e,this._cbDrawContent=t.drawContent,this._cbGetSourceTextureInfo=t.getSourceTextureInfo,this._cbGetShaderParameters=t.getShaderParameters,this._cbDrawContentHook=null,this._shaderProgramList=[],this._shaderProgramIndices=[],this._steps=[],this._needsRebuild=!1,this._blendMode=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._didChangeTransform=!1,this._depthEnabledAtStart=!1,this._coplanarColorPassAtStart=!1,this._canUseFastPath=!1,this._useFullSurface=!1,this._isSourceTextureRotated=!1,this._numTempSurfacesRequired=0,this._renderTargets=[null,null,null],this._invalidateRenderTargets=!!t.invalidateRenderTargets,this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._drawWidth=0,this._drawHeight=0,this._contentObject=null,this._contextObject=null,this._layoutRect=C33.New(C33.Rect),this._drawSurfaceRect=C33.New(C33.Rect),this._rcTexOriginal=C33.New(C33.Rect),this._rcTexBounce=C33.New(C33.Rect),this._rcTexDest=C33.New(C33.Rect),this._devicePixelRatio=1,this._layerScale=1,this._layerAngle=0,this._time=0,this._destRenderTarget=null,this._backTex=null,this._compositOffX=0,this._compositOffY=0,this._updateOwnProjection=!1,this._projectionMatrix=mat42.create(),this._modelViewMatrix=mat42.create(),this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this),C33.clearArray(this._steps),C33.clearArray(this._shaderProgramList),C33.clearArray(this._shaderProgramIndices),this._contentObject=null,this._contextObject=null,this._cbDrawContent=null,this._cbGetSourceTextureInfo=null,this._cbGetShaderParameters=null}OnContextLost(){this._needsRebuild=!0,C33.clearArray(this._steps),C33.clearArray(this._shaderProgramList),C33.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(s,e){if(e=Object.assign({},DEFAULT_BUILDSTEPS_OPTS,e),C33.clearArray(this._steps),this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._numTempSurfacesRequired=0,this._isSourceTextureRotated=!!e.isSourceTextureRotated,this._useFullSurface=!!e.useFullSurface,this._needsRebuild=!1,C33.shallowAssignArray(this._shaderProgramList,s),0!==s.length){if(e.indexMap){if(e.indexMap.length!==s.length)throw new Error("incorrect indexMap length");C33.shallowAssignArray(this._shaderProgramIndices,e.indexMap)}else{C33.clearArray(this._shaderProgramIndices);for(let e=0,t=s.length;e<t;++e)this._shaderProgramIndices.push(e)}for(var t of s)this._boxExtendHorizontal+=t.GetBoxExtendHorizontal(),this._boxExtendVertical+=t.GetBoxExtendVertical(),t.IsAnimated()&&(this._isAnyShaderAnimated=!0),t.UsesDepth()&&(this._isAnyShaderDepthSampling=!0),t.BlendsBackground()&&(this._isAnyShaderBackgroundBlending=!0),t.UsesCrossSampling()&&(this._isAnyShaderCrossSampling=!0),t.UsesIsSrcTexRotated()&&(this._isAnyIsSrcTexRotated=!0);this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(s[0].GetRenderer());var a=this._ShouldPreDraw(s[0],e),n=this._ShouldPostDraw(s.at(-1),e);if(1!==s.length||a||n){this._canUseFastPath=!1;let i=0;a&&(this._numTempSurfacesRequired=1,this._steps.push(C33.New(C33.Gfx.EffectChain.Step.PreDraw,this,-1,1)),i=1);for(let t=0,r=s.length;t<r;++t)if(0!==t||a){let e=1===i?2:1;t!==r-1||n||(e=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,e),this._steps.push(C33.New(C33.Gfx.EffectChain.Step.Bounce,this,i,e,t)),i=e}else this._numTempSurfacesRequired=1,this._steps.push(C33.New(C33.Gfx.EffectChain.Step.FirstBounce,this,-1,1,t)),i=1;n&&this._steps.push(C33.New(C33.Gfx.EffectChain.Step.PostDraw,this,i,0))}else this._canUseFastPath=!0}}_ShouldPreDraw(e,t){return!!(t.forcePreDraw||e.MustPreDraw()||t.is3D&&!e.Supports3DDirectRendering()||e.UsesDepth()&&!this._useFullSurface||0!==this._boxExtendHorizontal||0!==this._boxExtendVertical)||(e.GetRenderer().IsWebGL()?e.BlendsBackground()&&(t.isRotatedOrNegativeSizeInstance||t.isSourceTextureRotated)||e.UsesAnySrcRectOrPixelSize()&&t.isSourceTextureRotated:e.BlendsBackground()&&!this._useCopyTextureBackgroundSampling&&t.isRotatedOrNegativeSizeInstance)}_ShouldPostDraw(e,t){return!!t.forcePostDraw||(e.GetRenderer().IsWebGL()?e.BlendsBackground()||e.UsesCrossSampling():(e.BlendsBackground()||e.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling())}_ShouldUseCopyTextureBackgroundSampling(e){return e.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(e,t,r){e.IsWebGPU()&&null===t&&(t=e.GetBackbufferRenderTarget()),this._destRenderTarget=t,this._contentObject=r.contentObject||null,this._contextObject=r.contextObject||null,this._blendMode=r.blendMode||0,this._devicePixelRatio=r.devicePixelRatio||1,this._layerScale=r.layerScale||1,this._layerAngle=r.layerAngle||0,this._time="number"==typeof r.time?r.time:this._manager.GetTime(),this._didChangeTransform=!1,e.ResetDidChangeTransformFlag(),this._isAnyShaderAnimated&&this._Redraw();let i=!1;if(this._UseCopyTextureBackgroundSampling()&&(this._CalculateDrawSizeAndRectangles(e,r),i=!0,this._backTex=this._manager._GetWebGPUBackTexture(e,this._drawWidth,this._drawHeight),tempRect.copy(this._drawSurfaceRect),tempRect.roundOuter(),e.IsWebGPU()&&e._MaybeDoPendingClearRenderPass(this._destRenderTarget),e.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height())),this._canUseFastPath)this._Render_FastPath(e,r);else if(i||this._CalculateDrawSizeAndRectangles(e,r),0!==this._rcTexOriginal.width()||0!==this._rcTexOriginal.height()){e.SetAlphaBlend(),e.ResetColor(),e.SetBaseZ(0),e.SetCurrentZ(0),this._cbDrawContentHook=r.drawContentHook||null,this._compositOffX=r.compositOffX||0,this._compositOffY=r.compositOffY||0,this._updateOwnProjection=!!r.updateOwnProjection,this._OnBeforeStartEffectChain(e),this._renderTargets[0]=t,this._renderTargets[1]=1<=this._numTempSurfacesRequired?this._GetRenderTarget():null,this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(var s of this._steps){var a=this._GetRenderTargetForId(s.GetSrcTargetId()),n=this._GetRenderTargetForId(s.GetDestTargetId());e.IsWebGPU()?s.Run_WebGPU(e,a,n):s.Run_WebGL(e,a,n)}e.SetTexture(null),this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]),this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]),this._renderTargets.fill(null),this._OnAfterEndEffectChain(e),this._destRenderTarget=null,this._backTex=null,this._contentObject=null,this._contextObject=null,this._cbDrawContentHook=null}}_CalculateDrawSizeAndRectangles(e,t){var[r,i]=this._manager.GetDrawSize(e);this._SetDrawSize(e,r,i),this._CalculateRectangles(t)}_SetDrawSize(e,t,r){if(t<=0||r<=0)throw new Error("invalid draw size");this._drawWidth===t&&this._drawHeight===r||this._CalculateDeviceTransformMatrices(e,t,r,0,0,this._projectionMatrix,this._modelViewMatrix),this._drawWidth=t,this._drawHeight=r}_CalculateDeviceTransformMatrices(e,t,r,i,s,a,n){i=t/2+i,s=r/2+s,e.CalculatePerspectiveMatrix(a,t/r),a=e.CalculateLookAtModelView2(i,s,e.GetDefaultCameraZ(r),i,s,0,r);mat42.copy(n,a)}_CalculateRectangles(e){this._layoutRect.copy(e.layoutRect),e.drawSurfaceRect?this._drawSurfaceRect.copy(e.drawSurfaceRect):this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight),this._rcTexOriginal.copy(this._drawSurfaceRect),this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);e=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*e,this._boxExtendVertical*e),this._rcTexDest.copy(this._drawSurfaceRect),this._rcTexDest.divide(this._drawWidth,this._drawHeight),this._drawSurfaceRect.clampBoth(0,0,this._drawWidth,this._drawHeight),this._rcTexBounce.copy(this._drawSurfaceRect),this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(e){var t;this._depthEnabledAtStart=e.IsDepthEnabled(),this._coplanarColorPassAtStart=e.IsCoplanarColorPass(),this._useFullSurface?(e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)):(tempRect.copy(this._drawSurfaceRect),e.IsWebGL()?(t=this._layerScale*this._devicePixelRatio,tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*t,Math.max(this._boxExtendVertical,1)*t),tempRect.roundOuter(),tempRect.clamp(0,0,this._drawWidth,this._drawHeight)):tempRect.roundOuter(),e.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight))}_OnAfterEffectChainDrawContent(e){e.ResetColor(),this._useFullSurface||(this._coplanarColorPassAtStart&&e.CoplanarRestoreStandardRendering(),e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(e){e.SetDepthSamplingEnabled(!1),this._coplanarColorPassAtStart&&e.CoplanarStartColorPass(),e.SetDepthEnabled(this._depthEnabledAtStart),this._useFullSurface||e.RemoveScissorRect(),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!1),this._didChangeTransform=e.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(e){return e<0?null:this._renderTargets[e]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(e){this._manager.ReleaseRenderTarget(e,this)}_GetShaderProgramAt(e){return this._shaderProgramList[e]}_DrawContent(e){this._cbDrawContentHook?this._cbDrawContentHook(this,e,()=>this._cbDrawContent(e,this)):this._cbDrawContent(e,this),this._canUseFastPath||this._OnAfterEffectChainDrawContent(e)}_IsRenderTargetSameSizeAndOffset(e){var t;return!!this._useFullSurface||0===this._compositOffX&&0===this._compositOffY&&([e,t]=e.GetRenderTargetSize(e.GetRenderTarget()),e===this._drawWidth)&&t===this._drawHeight}_SetDeviceTransform(e,t){let r=this._projectionMatrix,i=this._modelViewMatrix;var s;t&&!this._IsRenderTargetSameSizeAndOffset(e)&&(r=tempMat4a,i=tempMat4b,[t,s]=e.GetRenderTargetSize(e.GetRenderTarget()),this._CalculateDeviceTransformMatrices(e,t,s,this._compositOffX,this._compositOffY,r,i),this._useFullSurface||e.RemoveScissorRect()),e.SetProjectionMatrix(r),e.SetModelViewMatrix(i)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(e,t){return this._cbGetShaderParameters(this._shaderProgramIndices[e],t)}_SetProgramParameters(e,t){let r=this._rcTexDest,i=this._rcTexBounce,s=this._rcTexOriginal;e.IsWebGL()&&(tempRect2.copy(r),tempRect2.flipAround(1),r=tempRect2,tempRect3.copy(i),tempRect3.flipAround(1),i=tempRect3,tempRect4.copy(s),tempRect4.flipAround(1),s=tempRect4),this._DoSetProgramParameters(e,t,i,s,r,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(e,t){let i=this._rcTexBounce,s=this._rcTexOriginal,a=1/this._drawWidth,n=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let{srcTexRect:e,srcWidth:t,srcHeight:r}=this._cbGetSourceTextureInfo(this._contentObject);e||(tempRect.set(0,0,0,0),e=tempRect),t=t||this._drawWidth,r=r||this._drawHeight,i=e,s=e,a=1/t,n=1/r}else e.IsWebGL()&&(tempRect3.copy(i),tempRect3.flipAround(1),i=tempRect3,tempRect4.copy(s),tempRect4.flipAround(1),s=tempRect4);let r=this._rcTexDest;e.IsWebGL()&&((r=tempRect2).copy(this._rcTexDest),r.flipAround(1)),this._DoSetProgramParameters(e,t,i,s,r,a,n),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(e){return this._isAnyShaderBackgroundBlending?e.IsWebGPU()?this._UseCopyTextureBackgroundSampling()?this._backTex:this._destRenderTarget.GetTexture():this._destRenderTarget:null}_DoSetProgramParameters(e,t,r,i,s,a,n){e.SetProgramParameters(this._GetBackTex(e),s,r,i,this._layoutRect,a,n,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(t,e))}_Render_FastPath(e,t){var r,i,s=this._shaderProgramList[0],a=e.IsDepthEnabled(),n=s.UsesDepth();n&&(e.SetDepthEnabled(!1),e.SetDepthSamplingEnabled(!0),this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1)),e.SetProgram(s),e.SetBlendMode(this._blendMode),e.SetRenderTarget(this._destRenderTarget);let o=0,l=1;this._rcTexOriginal.set(0,0,1,1),l=s.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo?({srcTexRect:s,srcWidth:i,srcHeight:r}=this._cbGetSourceTextureInfo(this._contentObject),s&&this._rcTexOriginal.copy(s),o=Number.isFinite(i)?1/i:0,Number.isFinite(r)?1/r:0):([s,i]=this._manager.GetDrawSize(e),o=1/s,1/i),t.layoutRect?this._layoutRect.copy(t.layoutRect):this._layoutRect.set(0,0,0,0),e.SetProgramParameters(this._GetBackTex(e),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,o,l,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(0,e)),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated),e.SetBaseZ(0),this._DrawContent(e),n&&(e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(a))}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){return!!this._canUseFastPath&&!this._UseCopyTextureBackgroundSampling()}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(e,t,r){}}}{let C33=self.C3;C33.Gfx.EffectChain.Step=class EffectChainStep{constructor(e,t,r,i=-1){this._effectChain=e,this._srcTargetId=t,this._destTargetId=r,this._index=i}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(e,t,r){}Run_WebGPU(e,t,r){}}}{let C33=self.C3;C33.Gfx.EffectChain.Step.PreDraw=class PreDrawStep extends C33.Gfx.EffectChain.Step{constructor(e,t,r,i){super(e,t,r,i)}Run_WebGL(e,t,r){var i=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(r,i._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),i._DrawContent(e),i._ClampRcTexDest()}Run_WebGPU(e,t,r){var i=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(r,!1),e.ClearRgba(0,0,0,0),i._DrawContent(e),i._ClampRcTexDest()}}}{let C33=self.C3,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad);C33.Gfx.EffectChain.Step.PostDraw=class PostDrawStep extends C33.Gfx.EffectChain.Step{constructor(e,t,r,i){super(e,t,r,i)}Run_WebGL(e,t,r){var i=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(r),i._SetDeviceTransform(e,!0),e.SetBlendMode(i._GetBlendMode()),e.SetTexture(t.GetTexture()),tempQuad.setFromRect(i._GetDrawSurfaceRect()),tempRect.copy(i._GetRcTexBounce()),tempRect.flipAround(1),e.Quad3(tempQuad,tempRect),i._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,r){var i=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(r,!1),i._IsRenderTargetSameSizeAndOffset(e)?tempQuad.setFromRect(i._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),i._SetDeviceTransform(e,!0),tempQuad.setFromRect(i._GetDrawSurfaceRect())),e.SetBackTexture(null),e.SetBlendMode(i._GetBlendMode()),e.SetTexture(t.GetTexture()),i.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad,i._GetRcTexBounce())}}}{let C33=self.C3;C33.Gfx.EffectChain.Step.FirstBounce=class FirstBounceStep extends C33.Gfx.EffectChain.Step{constructor(e,t,r,i){super(e,t,r,i)}Run_WebGL(e,t,r){var i=this.GetEffectChain();e.SetRenderTarget(r,i._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),i._SetFirstBounceProgramParameters(e,this.GetIndex()),i._DrawContent(e),i._ClampRcTexDest()}Run_WebGPU(e,t,r){var i=this.GetEffectChain();e.SetRenderTarget(r,!1),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),i._SetFirstBounceProgramParameters(e,this.GetIndex()),i._DrawContent(e),i._ClampRcTexDest()}}}{let C33=self.C3,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad);C33.Gfx.EffectChain.Step.Bounce=class BounceStep extends C33.Gfx.EffectChain.Step{constructor(e,t,r,i){super(e,t,r,i)}Run_WebGL(e,t,r){var i=this.GetEffectChain(),r=(e.SetRenderTarget(r),0===this.GetDestTargetId());r?e.SetBlendMode(i._GetBlendMode()):(e.ClearRgba(0,0,0,0),e.SetCopyBlend()),e.SetProgram(this.GetShaderProgram()),i._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),i._SetDeviceTransform(e,r),tempQuad.setFromRect(i._GetDrawSurfaceRect()),tempRect.copy(i._GetRcTexBounce()),tempRect.flipAround(1),e.Quad3(tempQuad,tempRect),i._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,r){var i=this.GetEffectChain(),r=(e.SetRenderTarget(r,!1),0===this.GetDestTargetId());r?(e.SetBlendMode(i._GetBlendMode()),e.SetBackTexture(null),i._IsRenderTargetSameSizeAndOffset(e)?tempQuad.setFromRect(i._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),i._SetDeviceTransform(e,!0),tempQuad.setFromRect(i._GetDrawSurfaceRect()))):(e.ClearRgba(0,0,0,0),e.SetCopyBlend(),tempQuad.setFromRect(i._GetRcTexBounce())),e.SetProgram(this.GetShaderProgram()),i._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),i.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad,i._GetRcTexBounce())}}}{let SortZOrderList2=function(e,t){var r=e[0]-t[0];return 0!=r?r:e[1]-t[1]},C33=(SortZOrderList=SortZOrderList2,self.C3),C3X=self.C3X,runtime=null,keysDownByKey=new Set,tempZOrderList=[],tempInstances=[],didWarnInAlertPolyfill=!1,didWarnFpsDeprecated=!1,VALID_FRAMERATE_MODES=new Set(["vsync","unlimited-tick","unlimited-frame"]);self.IRuntime=class IRuntime{constructor(e){runtime=e,Object.defineProperties(this,{assets:{value:runtime.GetAssetManager().GetIAssetManager(),writable:!1},collisions:{value:runtime.GetCollisionEngine().GetICollisionEngine(),writable:!1},objects:{value:{},writable:!1},globalVars:{value:{},writable:!1},projectName:{value:runtime.GetProjectName(),writable:!1},projectVersion:{value:runtime.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(runtime),writable:!1},isInWorker:{value:runtime.IsInWorker(),writable:!1},viewportWidth:{value:runtime.GetOriginalViewportWidth(),writable:!1},viewportHeight:{value:runtime.GetOriginalViewportHeight(),writable:!1},sampling:{value:runtime.GetSampling(),writable:!1},isPixelRoundingEnabled:{value:runtime.IsPixelRoundingEnabled(),writable:!1},sdk:{value:new self.ISDKUtils(e),writable:!1}}),runtime.UserScriptDispatcher().addEventListener("keydown",e=>{keysDownByKey.has(e.key)?e.stopPropagation():keysDownByKey.add(e.key)}),runtime.UserScriptDispatcher().addEventListener("keyup",e=>keysDownByKey.delete(e.key)),runtime.Dispatcher().addEventListener("window-blur",()=>keysDownByKey.clear()),runtime.IsInWorker()&&(self.alert=e=>(didWarnInAlertPolyfill||(didWarnInAlertPolyfill=!0,console.warn("[Construct] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual.")),this.alert(e)))}_InitObjects(e){Object.defineProperties(this.objects,e)}_InitGlobalVars(e){Object.defineProperties(this.globalVars,e)}addEventListener(e,t){runtime.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){runtime.UserScriptDispatcher().removeEventListener(e,t)}callFunction(e,...t){C3X.RequireString(e);var r=runtime.GetEventSheetManager(),i=r.GetFunctionBlockByName(e);if(!i)throw new Error(`cannot find function name '${e}'`);if(!i.IsEnabled())return i.GetDefaultReturnValue();if(t.length<i.GetFunctionParameterCount())throw new Error(`not enough function parameters passed for '${e}' (${t.length} passed, ${i.GetFunctionParameterCount()} expected)`);e=i.GetEventBlock();let s=e.GetSolModifiersIncludingParents();var a=r.GetCurrentEvent();if(a){s=s.slice(0);var n,o,l=new Set(s);for(n of a.GetSolModifiersIncludingParents())l.has(n)||(s.push(n),l.add(n));for(o of r.GetDynamicSolModifiersSet())l.has(o)||(s.push(o),l.add(o))}return e.RunAsExpressionFunctionCall(s,i.IsCopyPicked(),i.GetReturnType(),i.GetDefaultReturnValue(),...t)}setReturnValue(e){var t=runtime.GetEventStack().GetCurrentExpFuncStackFrame();if(!t)throw new Error("not in a function which returns a value");switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:"number"!=typeof e&&"string"!=typeof e||t.SetFunctionReturnValue(e)}}signal(e){C3X.RequireString(e),runtime.GetEventSheetManager().Signal(e)}waitForSignal(e){return C3X.RequireString(e),runtime.GetEventSheetManager().WaitForSignal(e)}getViewportSize(){return[runtime.GetOriginalViewportWidth(),runtime.GetOriginalViewportHeight()]}get isSuspended(){return runtime.IsSuspended()}get dt(){return runtime.GetDt()}get dtRaw(){return runtime.GetDtRaw()}get gameTime(){return runtime.GetGameTime()}get wallTime(){return runtime.GetWallTime()}get timeScale(){return runtime.GetTimeScale()}set timeScale(e){C3X.RequireFiniteNumber(e),runtime.SetTimeScale(e)}get fps(){return didWarnFpsDeprecated||(console.warn("IRuntime.fps is deprecated. Use IRuntime.framesPerSecond instead."),didWarnFpsDeprecated=!0),runtime.GetFramesPerSecond()}get framesPerSecond(){return runtime.GetFramesPerSecond()}get ticksPerSecond(){return runtime.GetTicksPerSecond()}get cpuUtilisation(){return runtime.GetMainThreadTime()}get gpuUtilisation(){return runtime.GetGPUUtilisation()}get framerateMode(){return runtime.GetFramerateMode()}set framerateMode(e){if(!VALID_FRAMERATE_MODES.has(e))throw new Error("invalid framerate mode");runtime._SetFramerateMode(e)}get minDt(){return runtime.GetMinDt()}set minDt(e){C3X.RequireFiniteNumber(e),runtime.SetMinDt(e)}get maxDt(){return runtime.GetMaxDt()}set maxDt(e){runtime.SetMaxDt(e)}random(){return runtime.Random()}get layout(){var e=runtime.GetMainRunningLayout();if(e)return e.GetILayout();throw new Error("no layout is running - make sure a layout is loaded before accessing")}getLayout(e){var t=runtime.GetLayoutManager();let r=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(r=t.GetLayout(e))return r.GetILayout();throw new Error("invalid layout")}getAllLayouts(){return runtime.GetLayoutManager().GetAllLayouts().map(e=>e.GetILayout())}goToLayout(e){var t=runtime.GetLayoutManager();let r=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(!(r=t.GetLayout(e)))throw new Error("invalid layout");t.IsPendingChangeMainLayout()||t.ChangeMainLayout(r)}get keyboard(){var e=runtime._GetCommonScriptInterfaces().keyboard;if(e)return e;throw new Error("runtime.keyboard used but Keyboard object missing - add it to your project first")}get mouse(){var e=runtime._GetCommonScriptInterfaces().mouse;if(e)return e;throw new Error("runtime.mouse used but Mouse object missing - add it to your project first")}get touch(){var e=runtime._GetCommonScriptInterfaces().touch;if(e)return e;throw new Error("runtime.touch used but Touch object missing - add it to your project first")}get timelineController(){var e=runtime._GetCommonScriptInterfaces().timelineController;if(e)return e;throw new Error("runtime.timelineController used but Timeline Controller object missing - add it to your project first")}get platformInfo(){var e=runtime._GetCommonScriptInterfaces().platformInfo;if(e)return e;throw new Error("runtime.platformInfo used but Platform Info object missing - add it to your project first")}invokeDownload(e,t){C3X.RequireString(e),C3X.RequireString(t),runtime.InvokeDownload(e,t)}getInstanceByUid(e){C3X.RequireFiniteNumber(e);e=runtime.GetInstanceByUID(e);return e?e.GetInterfaceClass():null}sortZOrder(e,i){C3X.RequireFunction(i);var t,s=runtime.GetCurrentLayout();for(t of e){var r=runtime._UnwrapIWorldInstance(t),a=r.GetWorldInfo();tempZOrderList.push([a.GetLayer().GetIndex(),a.GetZIndex()]),tempInstances.push(r)}if(0!==tempZOrderList.length){tempZOrderList.sort(SortZOrderList2),tempInstances.sort((e,t)=>i(e.GetInterfaceClass(),t.GetInterfaceClass()));let r=!1;for(let e=0,t=tempZOrderList.length;e<t;++e){var n=tempInstances[e],o=s.GetLayerByIndex(tempZOrderList[e][0]),l=tempZOrderList[e][1],h=o._GetInstances();h[l]!==n&&((h[l]=n).GetWorldInfo()._SetLayer(o,!0),o.SetZIndicesChanged(n),r=!0)}r&&runtime.UpdateRender(),C33.clearArray(tempZOrderList),C33.clearArray(tempInstances)}}async createWorker(e,t){var r=new MessageChannel,i=r.port1,r=r.port2;return await runtime.PostComponentMessageToDOMAsync("runtime","script-create-worker",{url:e,opts:t,port2:r},[r]),i}alert(e){return runtime.PostComponentMessageToDOMAsync("runtime","alert",{message:e+(runtime.IsInWorker()?" [via Web Worker]":"")})}getHTMLLayer(e){return C3X.RequireFiniteNumber(e),runtime._GetHTMLLayerWrapElement(e)}addLoadPromise(e){runtime.AddLoadPromise(e)}}}{let C33=self.C3,C3X=self.C3X,assetManager=null;self.IAssetManager=class IAssetManager{constructor(e){assetManager=e,Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}loadImageAsset(e){e=self.IImageInfo._Unwrap(e);if(!e)throw new Error("invalid IImageInfo");e.LoadAsset(assetManager.GetRuntime())}fetchText(e){return assetManager.FetchText(e)}fetchJson(e){return assetManager.FetchJson(e)}fetchBlob(e){return assetManager.FetchBlob(e)}fetchArrayBuffer(e){return assetManager.FetchArrayBuffer(e)}getProjectFileUrl(e){return assetManager.GetProjectFileUrl(e)}getMediaFileUrl(e){return"flat"===assetManager.GetFileStructure()&&C33.IsRelativeURL(e)&&(e=e.toLowerCase()),assetManager.GetMediaFileUrl(e)}get mediaFolder(){return assetManager.GetMediaSubfolder()}async decodeWebMOpus(e,t){if(this.isWebMOpusSupported)throw new Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");t=await assetManager.GetRuntime()._WasmDecodeWebMOpus(t),t=new Float32Array(t),e=e.createBuffer(1,t.length,48e3);return e.getChannelData(0).set(t),e}loadScripts(...e){return assetManager.LoadScripts(...e)}compileWebAssembly(e){return assetManager.CompileWebAssembly(e)}loadStyleSheet(e){return assetManager.LoadStyleSheet(e)}}}{let C33=self.C3,C3X=self.C3X,collisionEngine=null;self.ICollisionEngine=class ICollisionEngine{constructor(e){collisionEngine=e,Object.defineProperties(this,{runtime:{value:collisionEngine.GetRuntime(),writable:!1}})}testOverlap(e,t){var r=collisionEngine.GetRuntime(),e=r._UnwrapIWorldInstance(e),r=r._UnwrapIWorldInstance(t);return collisionEngine.TestOverlap(e,r)}testOverlapAny(e,t){var r,i=collisionEngine.GetRuntime(),s=i._UnwrapIWorldInstance(e);for(r of t){var a=i._UnwrapIWorldInstance(r);if(collisionEngine.TestOverlap(s,a))return r}return null}testOverlapSolid(e){e=collisionEngine.GetRuntime()._UnwrapIWorldInstance(e),e=collisionEngine.TestOverlapSolid(e);return e?e.GetInterfaceClass():null}setCollisionCellSize(e,t){if(C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),e=Math.floor(e),t=Math.floor(t),e<=0||t<=0)throw new Error("invalid cell size");collisionEngine.SetCollisionCellSize(e,t)}getCollisionCellSize(){return collisionEngine.GetCollisionCellSize()}getCollisionCandidates(e,t){let r=collisionEngine.GetRuntime(),i;i=Array.isArray(e)?e.map(e=>r._UnwrapIObjectClass(e)):[r._UnwrapIObjectClass(e)];e=C33.Rect.FromObject(t),t=[];return collisionEngine.GetObjectClassesCollisionCandidates(null,i,e,t),t.map(e=>e.GetInterfaceClass())}}}{let C33=self.C3,C3X=self.C3X;self.IStorage=class IStorage{constructor(e){this._storage=e._GetProjectStorage()}getItem(e){return C3X.RequireString(e),this._storage.getItem(e)}setItem(e,t){return C3X.RequireString(e),this._storage.setItem(e,t)}removeItem(e){return C3X.RequireString(e),this._storage.removeItem(e)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IPlugin=class IPlugin{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken);map.set(this,e),Object.defineProperties(this,{runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},isSingleGlobal:{value:e.IsSingleGlobal(),writable:!1},isWorldType:{value:e.IsWorldType(),writable:!1},isHTMLElementType:{value:e.IsHTMLElementType(),writable:!1},isRotatable:{value:e.IsRotatable(),writable:!1},hasEffects:{value:e.HasEffects(),writable:!1},is3d:{value:e.Is3D(),writable:!1},supportsHierarchies:{value:e.SupportsSceneGraph(),writable:!1},supportsMesh:{value:e.SupportsMesh(),writable:!1}})}static getByConstructor(e){return(e=e&&C33.AddonManager.GetPluginByConstructorFunction(e))?e.GetIPlugin():null}getSingleGlobalObjectType(){return map.get(this).GetSingleGlobalObjectClass().GetIObjectClass()}getSingleGlobalInstance(){return map.get(this).GetSingleGlobalInstance().GetInterfaceClass()}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IObjectClass=class IObjectClass{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken);map.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},plugin:{value:e.GetPlugin().GetIPlugin(),writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}addEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().removeEventListener(e,t)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return C33.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return C33.first(this.pickedInstances())}getPairedInstance(e){var t=map.get(this),e=t.GetRuntime()._UnwrapIInstance(e),t=t.GetPairedInstance(e);return t?t.GetInterfaceClass():null}*instances(){for(var e of map.get(this).instancesIncludingPendingCreate())yield e.GetInterfaceClass()}*pickedInstances(){for(var e of map.get(this).GetCurrentSol().GetInstances())yield e.GetInterfaceClass()}setInstanceClass(e){if(C3X.RequireFunction(e),0<map.get(this).GetInstanceCount())throw new Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");map.get(this)._SetUserScriptInstanceClass(e)}createInstance(e,t,r,i,s){if(C3X.RequireNumber(t),C3X.RequireNumber(r),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid layer parameter");var a=map.get(this),n=a.GetRuntime(),e=n.GetMainRunningLayout().GetLayer(e);if(e)return a=n.CreateInstance(a,e,t,r,i,s),i&&e.SortAndAddInstancesByZIndex(a),(t=n.GetEventSheetManager()).BlockFlushingInstances(!0),a._TriggerOnCreatedOnSelfAndRelated(),t.BlockFlushingInstances(!1),t.IsInEventEngine()||n.GetLayoutManager().IsEndingLayout()||n.FlushPendingInstances(),a.GetInterfaceClass();throw new Error("invalid layer")}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,VALID_WHERE_STRINGS=["above","below","top-sublayer","bottom-sublayer"];self.ILayout=class ILayout{constructor(e){map.set(this,e);var t=[],r=e.GetEffectList(),i=r.GetAllEffectTypes().length;for(let e=0;e<i;++e)t.push(new self.IEffectInstance(r,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},effects:{value:t,writable:!1}})}addEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().removeEventListener(e,t)}get width(){return map.get(this).GetWidth()}set width(e){C3X.RequireFiniteNumber(e),map.get(this).SetWidth(e)}get height(){return map.get(this).GetHeight()}set height(e){C3X.RequireFiniteNumber(e),map.get(this).SetHeight(e)}setSize(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r.SetWidth(e),r.SetHeight(t)}getSize(){var e=map.get(this);return[e.GetWidth(),e.GetHeight()]}set scale(e){C3X.RequireFiniteNumber(e),map.get(this).SetScale(e)}get scale(){return map.get(this).GetScale()}set angle(e){C3X.RequireFiniteNumber(e),map.get(this).SetAngle(e)}get angle(){return map.get(this).GetAngle()}set scrollX(e){C3X.RequireNumber(e),map.get(this).SetScrollX(e)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(e){C3X.RequireNumber(e),map.get(this).SetScrollY(e)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(e,t){C3X.RequireNumber(e),C3X.RequireNumber(t);var r=map.get(this);r.SetScrollX(e),r.SetScrollY(t)}getScrollPosition(){var e=map.get(this);return[e.GetScrollX(),e.GetScrollY()]}getLayer(e){var t=map.get(this);let r=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");return(r=t.GetLayer(e))?r.GetILayer():null}getAllLayers(){return map.get(this).GetLayers().map(e=>e.GetILayer())}*allLayers(){for(var e of map.get(this).allLayers())yield e.GetILayer()}addLayer(e,t,r){var i=map.get(this),s=self.ILayer,s=(C3X.RequireString(e),C3X.RequireOptionalInstanceOf(t,s),t?i.GetRuntime()._UnwrapScriptInterface(t):null),t=VALID_WHERE_STRINGS.indexOf(r);if(t<0)throw new Error("invalid location");i.AddLayer(e,s,t)}moveLayer(e,t,r){var i=map.get(this),s=i.GetRuntime(),a=self.ILayer,e=(C3X.RequireInstanceOf(e,a),s._UnwrapScriptInterface(e));if(!e)throw new Error("invalid layer");C3X.RequireOptionalInstanceOf(t,a);a=t?s._UnwrapScriptInterface(t):null,s=VALID_WHERE_STRINGS.indexOf(r);if(s<0)throw new Error("invalid location");i.MoveLayer(e,a,s)}removeLayer(e){var t=map.get(this),r=self.ILayer,r=(C3X.RequireInstanceOf(e,r),t.GetRuntime()._UnwrapScriptInterface(e));if(!r)throw new Error("invalid layer");e=r.GetRuntime();t.RemoveLayer(r),e.GetEventSheetManager().IsInEventEngine()||e.FlushPendingInstances()}removeAllDynamicLayers(){var e=map.get(this),t=e.GetRuntime();e.RemoveAllDynamicLayers(),t.GetEventSheetManager().IsInEventEngine()||t.FlushPendingInstances()}setVanishingPoint(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),map.get(this).SetVanishingPointXY(e,t)}getVanishingPoint(){return map.get(this)._GetVanishingPoint()}set projection(e){C3X.RequireString(e);var t=map.get(this);if("perspective"===e)t.SetPerspectiveProjection();else{if("orthographic"!==e)throw new Error("invalid projection");t.SetOrthographicProjection()}}get projection(){return map.get(this).IsOrthographicProjection()?"orthographic":"perspective"}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(e=>[e[1],e[0]])),tempColor=C33.New(C33.Color);self.ILayer=class ILayer{constructor(e){map.set(this,e);var t=[],r=e.GetEffectList(),i=r.GetAllEffectTypes().length;for(let e=0;e<i;++e)t.push(new self.IEffectInstance(r,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},layout:{value:e.GetLayout().GetILayout(),writable:!1},effects:{value:t,writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}get parentLayer(){var e=map.get(this).GetParentLayer();return e?e.GetILayer():null}*parentLayers(){for(var e of map.get(this).parentLayers())yield e.GetILayer()}*subLayers(){for(var e of map.get(this).GetSubLayers())yield e.GetILayer()}*allSubLayers(){for(var e of map.get(this).GetSubLayers())for(var t of e.selfAndAllSubLayers())yield t.GetILayer()}get index(){return map.get(this).GetIndex()}get isVisible(){return map.get(this)._IsVisibleFlagSet()}set isVisible(e){map.get(this).SetVisible(e)}get isSelfAndParentsVisible(){return map.get(this).IsVisible()}get isInteractive(){return map.get(this).IsInteractive()}set isInteractive(e){map.get(this).SetInteractive(e)}get isHTMLElementsLayer(){return map.get(this).IsHTMLElementsLayer()}set isHTMLElementsLayer(e){map.get(this).SetIsHTMLElementsLayer(!!e)}get isSelfAndParentsInteractive(){return map.get(this).IsSelfAndParentsInteractive()}get opacity(){return map.get(this).GetOpacity()}set opacity(e){e=C33.clamp(+e,0,1),isNaN(e)||map.get(this).SetOpacity(e)}set scale(e){C3X.RequireFiniteNumber(e),map.get(this).SetOwnScale(e)}get scale(){return map.get(this).GetOwnScale()}set scaleRate(e){C3X.RequireFiniteNumber(e),map.get(this).SetScaleRate(e)}get scaleRate(){return map.get(this).GetScaleRate()}set angle(e){C3X.RequireFiniteNumber(e),map.get(this).SetAngle(e)}get angle(){return map.get(this).GetOwnAngle()}set parallaxX(e){C3X.RequireFiniteNumber(e),map.get(this).SetParallaxX(e)}get parallaxX(){return map.get(this).GetParallaxX()}set parallaxY(e){C3X.RequireFiniteNumber(e),map.get(this).SetParallaxY(e)}get parallaxY(){return map.get(this).GetParallaxY()}set zElevation(e){C3X.RequireFiniteNumber(e),map.get(this).SetZElevation(e)}get zElevation(){return map.get(this).GetZElevation()}set isTransparent(e){map.get(this).SetTransparent(e)}get isTransparent(){return map.get(this).IsTransparent()}set isForceOwnTexture(e){map.get(this).SetForceOwnTexture(e)}get isForceOwnTexture(){return map.get(this).IsForceOwnTexture()}set blendMode(e){C3X.RequireString(e);e=BLEND_MODE_TO_INDEX.get(e);if("number"!=typeof e)throw new Error("invalid blend mode");map.get(this).SetBlendMode(e)}get blendMode(){return INDEX_TO_BLEND_MODE.get(map.get(this).GetBlendMode())}set backgroundColor(e){if(C3X.RequireArray(e),e.length<3)throw new Error("expected 3 elements");tempColor.setRgb(e[0],e[1],e[2]);var e=map.get(this),t=e.GetBackgroundColor();t.equalsIgnoringAlpha(tempColor)||(t.copyRgb(tempColor),e.GetRuntime().UpdateRender())}get backgroundColor(){var e=map.get(this).GetBackgroundColor();return[e.getR(),e.getG(),e.getB()]}set scrollX(e){C3X.RequireNumber(e);var t=map.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollX(e)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(e){C3X.RequireNumber(e);var t=map.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollY(e)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(e,t){C3X.RequireNumber(e),C3X.RequireNumber(t);var r=map.get(this);r.SetOwnScrollPositionEnabled(!0),r.SetScrollX(e),r.SetScrollY(t)}getScrollPosition(){var e=map.get(this);return[e.GetScrollX(),e.GetScrollY()]}restoreScrollPosition(){map.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return map.get(this).GetViewport().toDOMRect()}cssPxToLayer(e,t,r=0){C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(r);var i=map.get(this),s=i.GetRuntime();return i.CanvasCssToLayer(e-s.GetCanvasClientX(),t-s.GetCanvasClientY(),r)}layerToCssPx(e,t,r=0){C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(r);var i=map.get(this),s=i.GetRuntime(),[i,e]=i.LayerToCanvasCss(e,t,r);return[i+s.GetCanvasClientX(),e+s.GetCanvasClientY()]}drawSurfaceToLayer(e,t,r=0){return C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(r),map.get(this).DrawSurfaceToLayer(e,t,r)}layerToDrawSurface(e,t,r=0){return C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(r),map.get(this).LayerToDrawSurface(e,t,r)}get renderScale(){return map.get(this).GetRenderScale()}}}{let GetDispatcher2=function(e){var t=dispatchers.get(e);return t||(t=C33.New(C33.Event.Dispatcher),dispatchers.set(e,t)),t},C33=(GetDispatcher=GetDispatcher2,self.C3),C3X=self.C3X,map=new WeakMap,dispatchers=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IInstance=class IInstance{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken),t=(map.set(this,e),{runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},objectType:{value:e.GetObjectClass().GetIObjectClass(),writable:!1},plugin:{value:e.GetPlugin().GetIPlugin(),writable:!1}});e._GetInstVarsScriptDescriptor(t),e._GetBehaviorsScriptDescriptor(t),Object.defineProperties(this,t),e.GetRuntime()._MapScriptInterface(this,e)}static _GetInitInst(){return C33.AddonManager._GetInitObject()}_release(){var e=dispatchers.get(this);e&&(e.Release(),dispatchers.delete(this)),map.delete(this)}addEventListener(e,t,r){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).addEventListener(e,t,r)}removeEventListener(e,t,r){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).removeEventListener(e,t,r)}dispatchEvent(e){GetDispatcher2(this).dispatchEvent(e)}destroy(){var e=map.get(this),t=e.GetRuntime();t.DestroyInstance(e),t.GetEventSheetManager().IsInEventEngine()||t.GetLayoutManager().IsEndingLayout()||t.GetEventSheetManager().IsFlushingBlocked()||t.FlushPendingInstances()}getOtherContainerInstances(){var e=map.get(this).GetSiblings();return e?e.map(e=>e.GetInterfaceClass()):[]}*otherContainerInstances(){var e=map.get(this);if(e.IsInContainer())for(var t of e.siblings())yield t.GetInterfaceClass()}get uid(){return map.get(this).GetUID()}get templateName(){return map.get(this).GetTemplateName()}set timeScale(e){C3X.RequireFiniteNumber(e),map.get(this).SetTimeScale(e)}get timeScale(){return map.get(this).GetActiveTimeScale()}restoreTimeScale(){map.get(this).RestoreTimeScale()}get dt(){var e=map.get(this);return e.GetRuntime().GetDt(e)}hasTags(...e){C3X.RequireArray(e);var e=new Set(e),t=map.get(this).GetTagsSet();return e.isSubsetOf(t)}setAllTags(e){C3X.RequireInstanceOf(e,Set),map.get(this).SetTagsSet(e)}getAllTags(){return new Set(map.get(this).GetTagsSet())}signal(e){C3X.RequireString(e);var t=map.get(this);t.GetRuntime().GetEventSheetManager().InstanceSignal(t,e)}waitForSignal(e){C3X.RequireString(e);var t=map.get(this);return t.GetRuntime().GetEventSheetManager().WaitForInstanceSignal(t,e)}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKInstanceBase=class ISDKInstanceBase extends self.IInstance{constructor(e){super(),map.set(this,C33.AddonManager._GetInitObject2(internalApiToken)),this._p_isTicking=!1,this._p_tickFunc=null,this._p_isTicking2=!1,this._p_tickFunc2=null,this._p_domComponentId=e?.domComponentId,this._p_wrapperComponentId=e?.wrapperComponentId}_release(){super._release(),map.delete(this)}_getInitProperties(){return C33.AddonManager._GetInitProperties()}_trigger(e){var t=map.get(this);t.GetRuntime().Trigger(e,t)}_triggerAsync(e){var t=map.get(this);return t.GetRuntime().TriggerAsync(e,t)}_addDOMMessageHandler(e,t){if(C3X.RequireString(e),C3X.RequireFunction(t),!this._p_domComponentId)throw new Error("no DOM component id set");map.get(this).GetRuntime().AddDOMComponentMessageHandler(this._p_domComponentId,e,t)}_addDOMMessageHandlers(e){C3X.RequireArray(e);for(var[t,r]of e)this._addDOMMessageHandler(t,r)}_postToDOM(e,t){if(C3X.RequireString(e),!this._p_domComponentId)throw new Error("no DOM component id set");map.get(this).GetRuntime().PostComponentMessageToDOM(this._p_domComponentId,e,t)}_postToDOMAsync(e,t){if(C3X.RequireString(e),this._p_domComponentId)return map.get(this).GetRuntime().PostComponentMessageToDOMAsync(this._p_domComponentId,e,t);throw new Error("no DOM component id set")}_postToDOMMaybeSync(e,t){if(!map.get(this).GetRuntime().IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._p_domComponentId,handler:e,data:t,responseId:null});this._postToDOM(e,t)}_setTicking(e){var t;this._p_isTicking!==(e=!!e)&&(this._p_isTicking=e,t=map.get(this).GetRuntime(),e?(this._p_tickFunc||(this._p_tickFunc=()=>this._tick()),t.Dispatcher().addEventListener("tick",this._p_tickFunc)):t.Dispatcher().removeEventListener("tick",this._p_tickFunc))}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(e){var t;this._p_isTicking2!==(e=!!e)&&(this._p_isTicking2=e,t=map.get(this).GetRuntime(),e?(this._p_tickFunc2||(this._p_tickFunc2=()=>this._tick2()),t.Dispatcher().addEventListener("tick2",this._p_tickFunc2)):t.Dispatcher().removeEventListener("tick2",this._p_tickFunc2))}_isTicking2(){return this._p_isTicking2}_tick2(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(e){}_isWrapperExtensionAvailable(){if(this._p_wrapperComponentId)return map.get(this).GetRuntime().HasWrapperComponentId(this._p_wrapperComponentId);throw new Error("no wrapper component id set")}_addWrapperExtensionMessageHandler(e,t){if(C3X.RequireString(e),C3X.RequireFunction(t),!this._p_wrapperComponentId)throw new Error("no wrapper component id set");map.get(this).GetRuntime().AddWrapperExtensionMessageHandler(this._p_wrapperComponentId,e,t)}_addWrapperMessageHandlers(e){C3X.RequireArray(e);for(var[t,r]of e)this._addWrapperExtensionMessageHandler(t,r)}_sendWrapperExtensionMessage(e,t){if(!this._p_wrapperComponentId)throw new Error("no wrapper component id set");this.runtime.sdk.sendWrapperExtensionMessage(this._p_wrapperComponentId,e,t)}_sendWrapperExtensionMessageAsync(e,t){if(this._p_wrapperComponentId)return this.runtime.sdk.sendWrapperExtensionMessageAsync(this._p_wrapperComponentId,e,t);throw new Error("no wrapper component id set")}}}{let MakeIWorldInstanceClass2=function(e){return class i extends e{constructor(e){super(e);var e=C33.AddonManager._GetInitObject2(internalApiToken),t=(map.set(this,e),[]),e=e.GetWorldInfo(),r=e.GetInstanceEffectList();if(r){var i=e.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let e=0;e<i;++e)t.push(new self.IEffectInstance(r,e))}Object.defineProperties(this,{effects:{value:t,writable:!1}})}get layout(){return map.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return map.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return map.get(this).GetWorldInfo().GetX()}set x(e){e=+e;var t=map.get(this).GetWorldInfo();isNaN(e)||t.GetX()===e||(t.SetX(e),t.SetBboxChanged())}get y(){return map.get(this).GetWorldInfo().GetY()}set y(e){e=+e;var t=map.get(this).GetWorldInfo();isNaN(e)||t.GetY()===e||(t.SetY(e),t.SetBboxChanged())}setPosition(e,t){e=+e,t=+t;var r=map.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||r.GetX()===e&&r.GetY()===t||(r.SetXY(e,t),r.SetBboxChanged())}getPosition(){var e=map.get(this).GetWorldInfo();return[e.GetX(),e.GetY()]}offsetPosition(e,t){var r;e=+e,t=+t,isNaN(e)||isNaN(t)||0===e&&0===t||((r=map.get(this).GetWorldInfo()).OffsetXY(e,t),r.SetBboxChanged())}get zElevation(){return map.get(this).GetWorldInfo().GetZElevation()}set zElevation(e){e=+e;var t=map.get(this),r=t.GetWorldInfo();isNaN(e)||r.GetZElevation()===e||(r.SetZElevation(e),t.GetRuntime().UpdateRender())}get totalZElevation(){return map.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return map.get(this).GetWorldInfo().GetWidth()}set width(e){e=+e;var t=map.get(this).GetWorldInfo();isNaN(e)||t.GetWidth()===e||(t.SetWidth(e),t.SetBboxChanged())}get height(){return map.get(this).GetWorldInfo().GetHeight()}set height(e){e=+e;var t=map.get(this).GetWorldInfo();isNaN(e)||t.GetHeight()===e||(t.SetHeight(e),t.SetBboxChanged())}setSize(e,t){e=+e,t=+t;var r=map.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||r.GetWidth()===e&&r.GetHeight()===t||(r.SetSize(e,t),r.SetBboxChanged())}getSize(){var e=map.get(this).GetWorldInfo();return[e.GetWidth(),e.GetHeight()]}get angle(){return map.get(this).GetWorldInfo().GetAngle()}set angle(e){e=C33.clampAngle(+e);var t=map.get(this).GetWorldInfo();isNaN(e)||t.GetAngle()===e||(t.SetAngle(e),t.SetBboxChanged())}get angleDegrees(){return C33.toDegrees(this.angle)}set angleDegrees(e){this.angle=C33.toRadians(e)}getBoundingBox(){return map.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return map.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}isOnScreen(){return map.get(this).GetWorldInfo().IsInViewport2()}get isVisible(){return map.get(this).GetWorldInfo().IsVisible()}set isVisible(e){e=!!e;var t=map.get(this),r=t.GetWorldInfo();r.IsVisible()!==e&&(r.SetVisible(e),t.GetRuntime().UpdateRender())}get opacity(){return map.get(this).GetWorldInfo().GetOpacity()}set opacity(e){e=C33.clamp(+e,0,1);var t=map.get(this),r=t.GetWorldInfo();isNaN(e)||r.GetOpacity()===e||(r.SetOpacity(e),t.GetRuntime().UpdateRender())}set colorRgb(e){if(C3X.RequireArray(e),e.length<3)throw new Error("expected 3 elements");tempColor.setRgb(e[0],e[1],e[2]);var e=map.get(this),t=e.GetWorldInfo();t.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor)||(t.SetUnpremultipliedColor(tempColor),e.GetRuntime().UpdateRender())}get colorRgb(){var e=map.get(this).GetWorldInfo().GetUnpremultipliedColor();return[e.getR(),e.getG(),e.getB()]}set blendMode(e){C3X.RequireString(e);e=BLEND_MODE_TO_INDEX.get(e);if("number"!=typeof e)throw new Error("invalid blend mode");var t=map.get(this);t.GetWorldInfo().SetBlendMode(e),t.GetRuntime().UpdateRender()}get blendMode(){return INDEX_TO_BLEND_MODE.get(map.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){map.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){map.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(e){C3X.RequireInstanceOf(e,ILayer);var t=map.get(this),e=t.GetRuntime()._UnwrapScriptInterface(e);if(!e)throw new Error("invalid layer");t.GetWorldInfo().ZOrderMoveToLayer(e)}moveAdjacentToInstance(e,t){C3X.RequireInstanceOf(e,i),map.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(map.get(e),t)}get zIndex(){return map.get(this).GetWorldInfo().GetZIndex()}get isCollisionEnabled(){return map.get(this).GetWorldInfo().IsCollisionEnabled()}set isCollisionEnabled(e){map.get(this).GetWorldInfo().SetCollisionEnabled(!!e)}containsPoint(e,t){return C3X.RequireNumber(e),C3X.RequireNumber(t),map.get(this).GetWorldInfo().ContainsPoint(+e,+t)}testOverlap(e){C3X.RequireInstanceOf(e,i);var t=map.get(this),e=map.get(e);return t.GetRuntime().GetCollisionEngine().TestOverlap(t,e)}testOverlapSolid(){var e=map.get(this),e=e.GetRuntime().GetCollisionEngine().TestOverlapSolid(e);return e?e.GetInterfaceClass():null}getParent(){var e=map.get(this).GetParent();return e?e.GetInterfaceClass():null}getTopParent(){var e=map.get(this).GetTopParent();return e?e.GetInterfaceClass():null}*parents(){for(var e of map.get(this).parents())yield e.GetInterfaceClass()}getChildCount(){return map.get(this).GetChildCount()}getChildAt(e){e=map.get(this).GetChildAt(e);return e?e.GetInterfaceClass():null}*children(){for(var e of map.get(this).children())yield e.GetInterfaceClass()}*allChildren(){for(var e of map.get(this).allChildren())yield e.GetInterfaceClass()}addChild(e,t){C3X.RequireInstanceOf(e,i),C3X.RequireOptionalObject(t),t=t||{};var r=map.get(this),e=map.get(e);r.AddChild(e,t)}removeChild(e){C3X.RequireInstanceOf(e,i);var t=map.get(this),e=map.get(e);t.RemoveChild(e)}removeFromParent(){var e=map.get(this);e.HasParent()&&e.GetParent().RemoveChild(e)}getHierarchyOpts(){var e=map.get(this).GetWorldInfo();return{transformX:e.GetTransformWithParentX(),transformY:e.GetTransformWithParentY(),transformWidth:e.GetTransformWithParentWidth(),transformHeight:e.GetTransformWithParentHeight(),transformAngle:e.GetTransformWithParentAngle(),transformZElevation:e.GetTransformWithParentZElevation(),transformOpacity:e.GetTransformWithParentOpacity(),transformVisibility:e.GetTransformWithParentVisibility(),destroyWithParent:e.GetDestroyWithParent()}}createMesh(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),map.get(this).GetWorldInfo().CreateMesh(e,t)}releaseMesh(){var e=map.get(this).GetWorldInfo();e.ReleaseMesh(),e.SetBboxChanged()}setMeshPoint(e,t,r){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireObject(r);var i=map.get(this).GetWorldInfo();i.SetMeshPoint(e,t,r)&&i.SetBboxChanged()}getMeshPoint(e,t){let r=NaN,i=NaN,s=NaN,a=NaN,n=NaN;var o=map.get(this).GetWorldInfo();return o.HasMesh()&&null!==(o=o.GetSourceMesh().GetMeshPointAt(e,t))&&(r=o.GetX(),i=o.GetY(),s=o.GetZElevation(),a=o.GetU(),n=o.GetV()),{x:r,y:i,zElevation:s,u:a,v:n}}getMeshSize(){var e=map.get(this).GetWorldInfo();return e.HasMesh()?[(e=e.GetSourceMesh()).GetHSize(),e.GetVSize()]:[0,0]}}},C33=(MakeIWorldInstanceClass=MakeIWorldInstanceClass2,self.C3),C3X=self.C3X,IInstance=self.IInstance,ILayer=self.ILayer,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken(),BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(e=>[e[1],e[0]])),tempColor=C33.New(C33.Color);self.IWorldInstance=MakeIWorldInstanceClass2(self.IInstance),self.IWorldInstanceSDKBase=MakeIWorldInstanceClass2(self.ISDKInstanceBase)}{let C33=self.C3,C3X=self.C3X,map=new WeakMap;self.IDOMInstance=class IDOMInstance extends self.IWorldInstance{constructor(){super(),map.set(this,self.IInstance._GetInitInst())}getElement(){return map.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){map.get(this).GetSdkInstance().FocusElement()}blur(){map.get(this).GetSdkInstance().BlurElement()}setCssStyle(e,t){C3X.RequireString(e),map.get(this).GetSdkInstance().SetElementCSSStyle(e,t)}}}{let GetDispatcher2=function(e){var t=dispatchers.get(e);return t||(t=C33.New(C33.Event.Dispatcher),dispatchers.set(e,t)),t},C33=(GetDispatcher=GetDispatcher2,self.C3),C3X=self.C3X,map=new WeakMap,dispatchers=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IBehaviorInstance=class IBehaviorInstance{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken),t=(map.set(this,e),{runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:e.GetBehavior().GetIBehavior(),writable:!1},behaviorType:{value:e.GetBehaviorType().GetIBehaviorType(),writable:!1}});Object.defineProperties(this,t),e.GetRuntime()._MapScriptInterface(this,e)}static _GetInitInst(){return C33.AddonManager._GetInitObject()}get instance(){return map.get(this).GetObjectInstance().GetInterfaceClass()}_release(){var e=dispatchers.get(this);e&&(e.Release(),dispatchers.delete(this)),map.delete(this)}addEventListener(e,t,r){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).addEventListener(e,t,r)}removeEventListener(e,t,r){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).removeEventListener(e,t,r)}dispatchEvent(e){GetDispatcher2(this).dispatchEvent(e)}}}{let C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.IBehaviorType=class IBehaviorType{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken),e={runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:e.GetBehavior().GetIBehavior(),writable:!1},name:{value:e.GetName(),writable:!1}};Object.defineProperties(this,e)}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IBehavior=class IBehavior{constructor(){var e=C33.AddonManager._GetInitObject2(internalApiToken),e=(map.set(this,e),{runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1}});Object.defineProperties(this,e)}getAllInstances(){return map.get(this).GetInstances().map(e=>e.GetInterfaceClass())}static getByConstructor(e){return(e=e&&C33.AddonManager.GetBehaviorByConstructorFunction(e))?e.GetIBehavior():null}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,tempColor=C33.New(C33.Color);self.IEffectInstance=class IEffectInstance{constructor(e,t){map.set(this,e),Object.defineProperties(this,{index:{value:t,writable:!1}})}get name(){return map.get(this).GetAllEffectTypes()[this.index].GetName()}get isActive(){return map.get(this).IsEffectIndexActive(this.index)}set isActive(e){e=!!e;var t=map.get(this);t.IsEffectIndexActive(this.index)!==e&&(t.SetEffectIndexActive(this.index,e),t.UpdateActiveEffects(),t.GetRuntime().UpdateRender())}setParameter(e,t){C3X.RequireFiniteNumber(e),e=Math.floor(+e);var r=map.get(this),i=r.GetEffectParameter(this.index,e);if(null===i)throw new RangeError("invalid index");if(i instanceof C33.Color){if(!Array.isArray(t)||t.length<3)throw new TypeError("expected array with 3 elements");tempColor.setRgb(t[0],t[1],t[2]),t=tempColor}else if("number"!=typeof t)throw new TypeError("expected number");r.SetEffectParameter(this.index,e,t)&&r.IsEffectIndexActive(this.index)&&r.GetRuntime().UpdateRender()}getParameter(e){C3X.RequireFiniteNumber(e),e=Math.floor(+e);e=map.get(this).GetEffectParameter(this.index,e);if(null===e)throw new RangeError("invalid index");return e instanceof C33.Color?[e.getR(),e.getG(),e.getB()]:e}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap;self.IAnimation=class IAnimation{constructor(e){map.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1}})}get speed(){return map.get(this).GetSpeed()}get isLooping(){return map.get(this).IsLooping()}get repeatCount(){return map.get(this).GetRepeatCount()}get repeatTo(){return map.get(this).GetRepeatTo()}get isPingPong(){return map.get(this).IsPingPong()}get frameCount(){return map.get(this).GetFrameCount()}getFrames(){return map.get(this).GetFrames().map(e=>e.GetIAnimationFrame())}*frames(){for(var e of map.get(this).GetFrames())yield e.GetIAnimationFrame()}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap;self.IImageInfo=class IImageInfo{constructor(e){map.set(this,e)}static _Unwrap(e){return map.get(e)}get width(){return map.get(this).GetWidth()}get height(){return map.get(this).GetHeight()}getSize(){var e=map.get(this);return[e.GetWidth(),e.GetHeight()]}getTexture(e){return e.getTextureForImageInfo(this)}getTexRect(){return map.get(this).GetTexRect().toDOMRect()}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap;self.IAnimationFrame=class IAnimationFrame extends self.IImageInfo{constructor(e){super(e.GetImageInfo()),map.set(this,e),Object.defineProperties(this,{duration:{value:e.GetDuration(),writable:!1},originX:{value:e.GetOriginX(),writable:!1},originY:{value:e.GetOriginY(),writable:!1}})}getOrigin(){var e=map.get(this);return[e.GetOriginX(),e.GetOriginY()]}getImagePointCount(){return map.get(this).GetImagePointCount()}getImagePointX(e){return this.getImagePoint(e)[0]}getImagePointY(e){return this.getImagePoint(e)[1]}getImagePoint(e){var t=map.get(this);let r=null;if("number"==typeof e)r=t.GetImagePointByIndex(Math.floor(e));else{if("string"!=typeof e)throw new TypeError("expected string or number");r=t.GetImagePointByName(e)}return r?[r.GetX(),r.GetY()]:this.getOrigin()}getPolyPointCount(){var e=map.get(this).GetCollisionPoly();return e?e.pointCount():0}getPolyPointX(e){return this.getPolyPoint(e)[0]}getPolyPointY(e){return this.getPolyPoint(e)[1]}getPolyPoint(e){C3X.RequireFiniteNumber(e),e=Math.floor(e);var t=map.get(this).GetCollisionPoly();return!t||e<0||e>=t.pointCount()?[0,0]:[(t=t.pointsArr())[2*e],t[2*e+1]]}get tag(){return map.get(this).GetTag()}}}{let GetTimelineState2=function(e){e=map.get(e);if(e.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return e},C33=(GetTimelineState=GetTimelineState2,self.C3),C3X=self.C3X,map=new WeakMap;self.ITimelineStateBase=class ITimelineStateBase{constructor(e){map.set(this,e),e.GetRuntime()._MapScriptInterface(this,e)}pause(){GetTimelineState2(this).Stop()}resume(){GetTimelineState2(this).Resume()}stop(){GetTimelineState2(this).Reset()}hasTags(e){return GetTimelineState2(this).HasTags(e)}set time(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetTime(e)}get time(){return GetTimelineState2(this).GetTime()}set totalTime(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetTotalTime(e)}get totalTime(){return GetTimelineState2(this).GetTotalTime()}set isLooping(e){GetTimelineState2(this).SetLoop(!!e)}get isLooping(){return GetTimelineState2(this).GetLoop()}set isPingPong(e){GetTimelineState2(this).SetPingPong(!!e)}get isPingPong(){return GetTimelineState2(this).GetPingPong()}set playbackRate(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetPlaybackRate(e)}get playbackRate(){return GetTimelineState2(this).GetPlaybackRate()}get progress(){var e=GetTimelineState2(this);return e.GetTime()/e.GetTotalTime()}get tags(){return GetTimelineState2(this).GetTags()}get finished(){return GetTimelineState2(this).GetPlayPromise()}get isPlaying(){return GetTimelineState2(this).IsPlaying()}get isPaused(){return GetTimelineState2(this).IsPaused()}get isReleased(){return map.get(this).IsReleased()}}}{let GetTimelineState2=function(e){e=map.get(e);if(e.IsReleased())throw new Error("timeline was released and is no longer valid");return e},C33=(GetTimelineState=GetTimelineState2,self.C3),C3X=self.C3X,map=new WeakMap,easeToIndexFunc=null;self.ITimelineState=class ITimelineState extends self.ITimelineStateBase{constructor(e){super(e),map.set(this,e);e={name:{value:e.GetName(),writable:!1}};Object.defineProperties(this,e)}}}{let GetTweenState2=function(e){e=map.get(e);if(e.IsReleased())throw new Error("tween was released and is no longer valid");return e},C33=(GetTweenState=GetTweenState2,self.C3),C3X=self.C3X,map=new WeakMap,behInstMap=new WeakMap,easeToIndexFunc=null;self.ITweenState=class ITweenState extends self.ITimelineStateBase{constructor(e,t,r){super(e),easeToIndexFunc=easeToIndexFunc||r.easeToIndexFunc,map.set(this,e),t&&behInstMap.set(this,t)}stop(){var e=GetTweenState2(this);behInstMap.get(this).ReleaseTween(e)}setEase(e){C3X.RequireString(e);e=self.Ease.GetEaseFromIndex(easeToIndexFunc(e));GetTweenState2(this).SetEase(e)}get instance(){var e=GetTweenState2(this).GetInstance();return e?e.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState2(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(e){GetTweenState2(this).SetDestroyInstanceOnComplete(!!e)}get value(){var e=GetTweenState2(this);if("value"!==e.GetId())throw new Error("not a value tween");return e.GetPropertyTrack("value").GetSourceAdapterValue()}}}{let C33=self.C3,C3X=self.C3X;self.ISDKPluginBase=class ISDKPluginBase extends self.IPlugin{constructor(){super()}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKDOMPluginBase=class ISDKDOMPluginBase extends self.ISDKPluginBase{constructor(e){if(super(),map.set(this,C33.AddonManager._GetInitObject2(internalApiToken)),!e?.domComponentId)throw new Error("no DOM component ID specified");this._p_domComponentId=e.domComponentId,this._p_nextElementId=0,this._p_instMap=new Map,this._addElementMessageHandler("elem-focused",e=>e._onElemFocused()),this._addElementMessageHandler("elem-blurred",e=>{e&&e._onElemBlurred()})}_addElement(e){var t=this._p_nextElementId++;return this._p_instMap.set(t,e),t}_removeElement(e){this._p_instMap.delete(e)}_addElementMessageHandler(e,r){map.get(this).GetRuntime().AddDOMComponentMessageHandler(this._p_domComponentId,e,e=>{var t=this._p_instMap.get(e.elementId);r(t,e)})}_addElementMessageHandlers(e){C3X.RequireArray(e);for(var[t,r]of e)this._addElementMessageHandlers(t,r)}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKObjectTypeBase=class ISDKObjectTypeBase extends self.IObjectClass{constructor(){super();var e=C33.AddonManager._GetInitObject2(internalApiToken);map.set(this,e)}_onCreate(){}getImageInfo(){return map.get(this).GetImageInfo().GetIImageInfo()}_loadTextures(e){}_releaseTextures(e){}_onDynamicTextureLoadComplete(){}_preloadTexturesWithInstances(e){}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKWorldInstanceBase=class ISDKWorldInstanceBase extends self.IWorldInstanceSDKBase{constructor(e){super(e),map.set(this,C33.AddonManager._GetInitObject2(internalApiToken)),this._p_renderercontextlost_handler=null,this._p_renderercontextrestored_handler=null}_release(){var e;super._release(),this._p_renderercontextlost_handler&&((e=map.get(this).GetRuntime().Dispatcher()).removeEventListener("renderercontextlost",this._p_renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this._p_renderercontextrestored_handler),this._p_renderercontextlost_handler=null,this._p_renderercontextrestored_handler=null),map.delete(this)}_handleRendererContextLoss(){var e;this._p_renderercontextlost_handler||(this._p_renderercontextlost_handler=()=>this._onRendererContextLost(),this._p_renderercontextrestored_handler=()=>this._onRendererContextRestored(),(e=map.get(this).GetRuntime().Dispatcher()).addEventListener("renderercontextlost",this._p_renderercontextlost_handler),e.addEventListener("renderercontextrestored",this._p_renderercontextrestored_handler))}_onRendererContextLost(){}_onRendererContextRestored(){}_draw(e){}}}{let C33=self.C3,C3X=self.C3X,tempRect=C33.New(C33.Rect),map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKDOMInstanceBase=class ISDKDOMInstanceBase extends self.ISDKWorldInstanceBase{constructor(e){if(!e?.domComponentId)throw new Error("no DOM component ID specified");super(e);e=C33.AddonManager._GetInitObject2(internalApiToken),map.set(this,e),this._p_elementId=this.plugin._addElement(this),this._p_isElementShowing=!0,this._p_elemHasFocus=!1,this._p_autoFontSize=!1,this._p_autoFontSizeOffset=-.2,this._p_lastRect=C33.New(C33.Rect,0,0,-1,-1),e=e.GetRuntime().GetCanvasManager();this._p_lastWindowWidth=e.GetLastWidth(),this._p_lastWindowHeight=e.GetLastHeight(),this._p_lastHTMLIndex=-1,this._p_lastHTMLZIndex=-1,this._p_isPendingUpdateState=!1,this._setTicking(!0)}_release(){super._release(),this.plugin._removeElement(this._p_elementId),this._postToDOMElement("destroy"),this._p_elementId=-1,map.delete(this)}_getElementInDOMMode(){if(map.get(this).GetRuntime().IsInWorker())throw new Error("not valid in worker mode");return this._postToDOMElementMaybeSync("get-element")}_postToDOMElement(e,t){(t=t||{}).elementId=this._p_elementId,this._postToDOM(e,t)}_postToDOMElementMaybeSync(e,t){return(t=t||{}).elementId=this._p_elementId,this._postToDOMMaybeSync(e,t)}_postToDOMElementAsync(e,t){return(t=t||{}).elementId=this._p_elementId,this._postToDOMAsync(e,t)}_createElement(e){e=e||{};var t=map.get(this).GetWorldInfo();e.elementId=this._p_elementId,e.isVisible=t.IsVisible(),e.htmlIndex=t.GetLayer().GetHTMLIndex(),e.htmlZIndex=t.GetHTMLZIndex(),Object.assign(e,this._getElementState()),this._p_isElementShowing=!!e.isVisible,this._postToDOMMaybeSync("create",e),this._updatePosition(!0)}setElementVisible(e){this._p_isElementShowing!==(e=!!e)&&(this._p_isElementShowing=e,this._postToDOMElement("set-visible",{isVisible:e}))}_tick(){this._updatePosition(!1)}_shouldPreserveElement(){var e=map.get(this).GetRuntime().GetCanvasManager().GetFullscreenMode();return"Android"===C33.Platform.OS&&("scale-inner"===e||"scale-outer"===e||"crop"===e)}_updatePosition(e){var t=map.get(this);if(!t.IsDestroyed()){var r=t.GetWorldInfo(),i=r.GetLayer(),s=r.GetBoundingBox(),[a,n]=i.LayerToCanvasCss(s.getLeft(),s.getTop()),[s,o]=i.LayerToCanvasCss(s.getRight(),s.getBottom()),t=t.GetRuntime().GetCanvasManager(),l=t.GetCssWidth(),h=t.GetCssHeight();if(r.IsVisible()&&i.IsVisible())if(!this._shouldPreserveElement()&&(s<=0||o<=0||l<=a||h<=n))this.setElementVisible(!1);else{tempRect.set(a,n,s,o);l=t.GetLastWidth(),h=t.GetLastHeight(),a=i.GetHTMLIndex(),n=r.GetHTMLZIndex();if(!e&&tempRect.equals(this._p_lastRect)&&this._p_lastWindowWidth===l&&this._p_lastWindowHeight===h&&this._p_lastHTMLIndex===a&&this._p_lastHTMLZIndex===n)this.setElementVisible(!0);else{this._p_lastRect.copy(tempRect),this._p_lastWindowWidth=l,this._p_lastWindowHeight=h,this._p_lastHTMLIndex=a,this._p_lastHTMLZIndex=n,this.setElementVisible(!0);let e=null;this._p_autoFontSize&&(e=i.GetDisplayScale()+this._p_autoFontSizeOffset),this._postToDOMElement("update-position",{left:Math.round(this._p_lastRect.getLeft()),top:Math.round(this._p_lastRect.getTop()),width:Math.round(this._p_lastRect.width()),height:Math.round(this._p_lastRect.height()),htmlIndex:a,htmlZIndex:n,fontSize:e})}}else this.setElementVisible(!1)}}focusElement(){this._postToDOMElementMaybeSync("focus",{focus:!0})}blurElement(){this._postToDOMElementMaybeSync("focus",{focus:!1})}_onElemFocused(){this._p_elemHasFocus=!0}_onElemBlurred(){this._p_elemHasFocus=!1}isElementFocused(){return this._p_elemHasFocus}setElementCSSStyle(e,t){this.postToDOMElement("set-css-style",{prop:C33.CSSToCamelCase(e),val:t})}setElementAttribute(e,t){this.postToDOMElement("set-attribute",{name:e,val:t})}removeElementAttribute(e){this.postToDOMElement("remove-attribute",{name:e})}_updateElementState(){this._p_isPendingUpdateState||(this._p_isPendingUpdateState=!0,Promise.resolve().then(()=>{this._p_isPendingUpdateState=!1,this._postToDOMElement("update-state",this._getElementState())}))}_getElementState(){}_getElementId(){return this._p_elementId}}}{let C33=self.C3,C3X=self.C3X;self.ISDKBehaviorBase=class ISDKBehaviorBase extends self.IBehavior{constructor(){super()}}}{let C33=self.C3,C3X=self.C3X;self.ISDKBehaviorTypeBase=class ISDKBehaviorTypeBase extends globalThis.IBehaviorType{constructor(){super()}_onCreate(){}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKBehaviorInstanceBase=class ISDKBehaviorInstanceBase extends self.IBehaviorInstance{constructor(){super(),map.set(this,C33.AddonManager._GetInitObject2(internalApiToken)),this._p_isTicking=!1,this._p_isTicking2=!1,this._p_isPostTicking=!1}_release(){super._release(),this._setTicking(!1),this._setTicking2(!1),this._setPostTicking(!1),map.delete(this)}_getInitProperties(){return C33.AddonManager._GetInitProperties()}_postCreate(){}_trigger(e){var t=map.get(this);t.GetRuntime().Trigger(e,t.GetObjectInstance(),t.GetBehaviorType())}_triggerAsync(e){var t=map.get(this);return t.GetRuntime().TriggerAsync(e,t.GetObjectInstance(),t.GetBehaviorType())}_setTicking(e){var t;this._p_isTicking!==(e=!!e)&&(this._p_isTicking=e,t=map.get(this).GetRuntime(),e?t._AddBehInstToTick(this):t._RemoveBehInstToTick(this))}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(e){var t;this._p_isTicking2!==(e=!!e)&&(this._p_isTicking2=e,t=map.get(this).GetRuntime(),e?t._AddBehInstToTick2(this):t._RemoveBehInstToTick2(this))}_isTicking2(){return this._p_isTicking2}_tick2(){}_setPostTicking(e){var t;this._p_isPostTicking!==(e=!!e)&&(this._p_isPostTicking=e,t=map.get(this).GetRuntime(),e?t._AddBehInstToPostTick(this):t._RemoveBehInstToPostTick(this))}_isPostTicking(){return this._p_isPostTicking}_postTick(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(e){}}}{let C33=self.C3,C3X=self.C3X,runtime=null;self.ISDKUtils=class ISDKUtils{constructor(e){runtime=e}addLoadPromise(e){runtime.AddLoadPromise(e)}sendWrapperExtensionMessage(e,t,r){C3X.RequireString(e),C3X.RequireString(t),C3X.RequireOptionalArray(r),runtime.SendWrapperExtensionMessage(e,t,r)}sendWrapperExtensionMessageAsync(e,t,r){return C3X.RequireString(e),C3X.RequireString(t),C3X.RequireOptionalArray(r),runtime.SendWrapperExtensionMessageAsync(e,t,r)}createLoopingConditionContext(e){return C3X.RequireOptionalString(e),new self.ILoopingConditionContext(runtime,e)}set isAutoSuspendEnabled(e){runtime._SetAutoSuspendEnabled(!!e)}get isAutoSuspendEnabled(){return runtime._IsAutoSuspendEnabled()}setSuspended(e){runtime.SetSuspended(!!e)}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap;self.ILoopingConditionContext=class ILoopingConditionContext{constructor(e,t){var r=e.GetEventSheetManager(),i=e.GetCurrentEvent(),s=i.GetSolModifiers(),a=e.GetEventStack(),n=a.GetCurrentStackFrame(),a=a.Push(i),r=r.GetLoopStack().Push();t&&r.SetName(t),e.SetDebuggingEnabled(!1),map.set(this,{runtime:e,currentEvent:i,solModifiers:s,oldFrame:n,newFrame:a,loop:r})}retrigger(){var{runtime:e,currentEvent:t,solModifiers:r,oldFrame:i,newFrame:s,loop:a}=map.get(this),e=e.GetEventSheetManager();e.PushCopySol(r),t.Retrigger(i,s),e.PopSol(r),a.SetIndex(a.GetIndex()+1)}get isStopped(){var e=map.get(this).loop;return e.IsStopped()}release(){var e=map.get(this).runtime,t=e.GetEventStack(),r=e.GetEventSheetManager().GetLoopStack();e.SetDebuggingEnabled(!0),r.Pop(),t.Pop(),map.delete(this)}}}{let C33=self.C3,C3X=self.C3X,renderer=null,runtime=null;self.IRenderer=class IRenderer{constructor(e,t){runtime=e,renderer=t}setAlphaBlendMode(){renderer.SetAlphaBlend()}setBlendMode(e){renderer.SetNamedBlendMode(e)}setColorFillMode(){renderer.SetColorFillMode()}setTextureFillMode(){renderer.SetTextureFillMode()}setSmoothLineFillMode(){renderer.SetSmoothLineFillMode()}setColor(e){renderer.SetColorRgba(e[0],e[1],e[2],e[3])}setColorRgba(e,t,r,i){renderer.SetColorRgba(e,t,r,i)}resetColor(){renderer.ResetColor()}setOpacity(e){renderer.SetOpacity(e)}setCurrentZ(e){renderer.SetCurrentZ(e)}getCurrentZ(){renderer.GetCurrentZ()}rect(e){renderer.Rect2(e.left,e.top,e.right,e.bottom)}rect2(e,t,r,i){renderer.Rect2(e,t,r,i)}quad(e){renderer.Quad(C33.Quad.fromDOMQuad(e))}quad2(e,t,r,i,s,a,n,o){renderer.Quad2(e,t,r,i,s,a,n,o)}quad3(e,t){renderer.Quad3(C33.Quad.fromDOMQuad(e),C33.Rect.fromDOMRect(t))}quad4(e,t){renderer.Quad4(C33.Quad.fromDOMQuad(e),C33.Quad.fromDOMQuad(t))}quad3D(e,t,r,i,s,a,n,o,l,h,u,c,_){renderer.Quad3D(e,t,r,i,s,a,n,o,l,h,u,c,C33.Rect.fromDOMRect(_))}quad3D2(e,t,r,i,s,a,n,o,l,h,u,c,_){renderer.Quad3D2(e,t,r,i,s,a,n,o,l,h,u,c,C33.Quad.fromDOMQuad(_))}drawMesh(e,t,r){renderer.DrawMesh(e,t,r)}convexPoly(e){renderer.ConvexPoly(e)}line(e,t,r,i){renderer.Line(e,t,r,i)}texturedLine(e,t,r,i,s,a){renderer.TexturedLine(e,t,r,i,s,a)}lineRect(e,t,r,i){renderer.LineRect(e,t,r,i)}lineRect2(e){renderer.LineRect2(C33.Rect.fromDOMRect(e))}lineQuad(e){renderer.LineQuad(C33.Quad.fromDOMQuad(e))}pushLineWidth(e){renderer.PushLineWidth(e)}popLineWidth(){renderer.PopLineWidth()}pushLineCap(e){renderer.PushLineCap(e)}popLineCap(){renderer.PopLineCap()}setTexture(e){C3X.RequireOptionalInstanceOf(e,self.ITexture);e=e?runtime._UnwrapScriptInterface(e):null;renderer.SetTexture(e)}loadTextureForImageInfo(e,t){e=self.IImageInfo._Unwrap(e);if(e)return e.LoadStaticTexture(renderer,{wrapX:t?.wrapX??"clamp-to-edge",wrapY:t?.wrapY??"clamp-to-edge",sampling:t?.sampling??"trilinear",mipMap:t?.mipMap??!0});throw new Error("invalid IImageInfo")}releaseTextureForImageInfo(e){e=self.IImageInfo._Unwrap(e);if(!e)throw new Error("invalid IImageInfo");e.ReleaseTexture()}getTextureForImageInfo(e){var e=self.IImageInfo._Unwrap(e);if(e)return e=e.GetTexture(),self.ITexture.GetInterface(runtime,e);throw new Error("invalid IImageInfo")}createDynamicTexture(e,t,r){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);e=renderer.CreateDynamicTexture(e,t,{wrapX:r?.wrapX??"clamp-to-edge",wrapY:r?.wrapY??"clamp-to-edge",sampling:r?.sampling??"trilinear",mipMap:r?.mipMap??!0});return self.ITexture.GetInterface(runtime,e)}updateTexture(e,t,r){C3X.RequireInstanceOf(t,self.ITexture);t=runtime._UnwrapScriptInterface(t);renderer.UpdateTexture(e,t,{premultiplyAlpha:r?.premultiplyAlpha??!0})}deleteTexture(e){C3X.RequireInstanceOf(e,self.ITexture);e=runtime._UnwrapScriptInterface(e);renderer.DeleteTexture(e)}createRendererText(){var e=renderer.CreateRendererText();return new self.IRendererText(runtime,e)}setDeviceTransform(){runtime.GetCanvasManager().SetDeviceTransform(renderer)}setLayerTransform(e){C3X.RequireInstanceOf(e,globalThis.ILayer),runtime._UnwrapScriptInterface(e)._SetTransform(renderer)}}}{let C33=self.C3,C3X=self.C3X,map=new WeakMap,reverseMap=new WeakMap;self.ITexture=class ITexture{constructor(e,t){map.set(this,{runtime:e,texture:t}),reverseMap.set(t,this),e._MapScriptInterface(this,t),Object.defineProperties(this,{width:{value:t.GetWidth(),writable:!1},height:{value:t.GetHeight(),writable:!1}})}static GetInterface(e,t){return t?reverseMap.get(t)||new self.ITexture(e,t):null}}}{let getActual2=function(e){return map.get(e).rendererText},C33=(getActual=getActual2,self.C3),C3X=self.C3X,map=new WeakMap;self.IRendererText=class IRendererText{constructor(e,t){map.set(this,{runtime:e,rendererText:t}),e._MapScriptInterface(this,t)}release(){getActual2(this).Release()}set fontFace(e){C3X.RequireString(e),getActual2(this).SetFontName(e)}get fontFace(){return getActual2(this).GetFontName()}set sizePt(e){C3X.RequireFiniteNumber(e),getActual2(this).SetFontSize(e)}get sizePt(){return getActual2(this).GetFontSize()}set lineHeight(e){C3X.RequireFiniteNumber(e),getActual2(this).SetLineHeight(e)}get lineHeight(){return getActual2(this).GetLineHeight()}set isBold(e){getActual2(this).SetBold(e)}get isBold(){return getActual2(this).IsBold()}set isItalic(e){getActual2(this).SetItalic(e)}get isItalic(){return getActual2(this).IsItalic()}setColor(e){C3X.RequireArray(e),this.setColorRgb(e[0],e[1],e[2])}setColorRgb(e,t,r){getActual2(this).SetColorRgb(e,t,r)}setCssColor(e){C3X.RequireString(e),getActual2(this).SetColor(e)}set horizontalAlign(e){getActual2(this).SetHorizontalAlignment(e)}get horizontalAlign(){return getActual2(this).GetHorizontalAlignment()}set verticalAlign(e){getActual2(this).SetVerticalAlignment(e)}get verticalAlign(){return getActual2(this).GetVerticalAlignment()}set wordWrapMode(e){getActual2(this).SetWordWrapMode(e)}get wordWrapMode(){return getActual2(this).GetWordWrapMode()}set textDirection(e){getActual2(this).SetTextDirection(e)}get textDirection(){return getActual2(this).GetTextDirection()}set text(e){C3X.RequireString(e),getActual2(this).SetText(e)}get text(){return getActual2(this).GetText()}setSize(e,t,r){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(r),getActual2(this).SetSize(e,t,r)}getTexture(){var{runtime:e,rendererText:t}=map.get(this),t=t.GetTexture();return self.ITexture.GetInterface(e,t)}getTexRect(){return getActual2(this).GetTexRect().toDOMRect()}setTextureUpdateCallback(e){C3X.RequireFunction(e),getActual2(this).ontextureupdate=e}releaseTexture(){getActual2(this).ReleaseTexture()}get textWidth(){return getActual2(this).GetTextWidth()}get textHeight(){return getActual2(this).GetTextHeight()}}}{let GetTypeFromFileExtension2=function(e){return e&&!((e=e.split(".")).length<2)&&(e=e.at(-1).toLowerCase(),EXT_TO_TYPE.get(e))||""},AddScript2=function(i){return new Promise((e,t)=>{var r=document.createElement("script");r.onload=e,r.onerror=t,r.async=!1,r.type="module",r.src=i,document.head.appendChild(r)})},C33=(GetTypeFromFileExtension=GetTypeFromFileExtension2,AddScript=AddScript2,self.C3),VALID_LOAD_POLICIES=new Set(["local","remote"]),EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);C33.AssetManager=class AssetManager extends C33.DefendedBase{constructor(e,t){super();var r=t.exportType,e=(this._runtime=e,this._fileStructure="folders",this._cordovaBlobUrlCache=new Map,this._isCordova="cordova"===r,this._isiOSCordova=!!t.isiOSCordova,this._isFileProtocol=!!t.isFileProtocol,this._swClientId=t.swClientId,this._supportedAudioFormats=t.supportedAudioFormats||{},this._audioFiles=new Map,this._preloadSounds=!1,this._scriptSubfolder=t.scriptFolder,this._mediaSubfolder="",this._fontsSubfolder="",this._iconsSubfolder="",this._fileMap=t.fileMap||new Map,this._fileMapBlobUrls=new Map,"html5"===r||"scirra-arcade"===r||"instant-games"===r);this._defaultLoadPolicy=e?"remote":"local",this._assetsByUrl=new Map,this._webFonts=[],this._loadPromises=[],this._hasFinishedInitialLoad=!1,this._totalAssetSizeToLoad=0,this._assetSizeLoaded=0,this._lastLoadProgress=0,this._hasHadErrorLoading=!1,this._loadingRateLimiter=C33.New(C33.RateLimiter,()=>this._FireLoadingProgressEvent(),50),this._localPromiseThrottle=C33.New(C33.PromiseThrottle,Math.max(C33.hardwareConcurrency,8)),this._remotePromiseThrottle=C33.New(C33.PromiseThrottle,20),this._iAssetManager=new self.IAssetManager(this)}Release(){for(var e of this._assetsByUrl.values())e.Release();this._assetsByUrl.clear(),C33.clearArray(this._loadPromises),this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(e){this._fileStructure=e}GetFileStructure(){return this._fileStructure}GetScriptSubfolder(){return this._scriptSubfolder}_SetMediaSubfolder(e){this._mediaSubfolder=e}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(e){this._fontsSubfolder=e}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(e){this._iconsSubfolder=e}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}FetchBlob(e,t){return t=t||this._defaultLoadPolicy,C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(e):"playable-ad-single-file"===this._runtime.GetExportType()?self.c3_runtimeInterface._PlayableAdFetchBlob(e):("local"===t?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchBlob(e))):C33.FetchBlob(e)}FetchArrayBuffer(e){return C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(e):"playable-ad-single-file"===this._runtime.GetExportType()?C33.BlobToArrayBuffer(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("local"===this._defaultLoadPolicy?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchArrayBuffer(e))):C33.FetchArrayBuffer(e)}FetchText(e){return C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(e):"playable-ad-single-file"===this._runtime.GetExportType()?C33.BlobToString(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("local"===this._defaultLoadPolicy?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchText(e))):C33.FetchText(e)}async FetchJson(e){e=await this.FetchText(e);return JSON.parse(e)}_CordovaFetchLocalFileAs(e,t){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:e,as:t})}CordovaFetchLocalFileAsText(e){return this._CordovaFetchLocalFileAs(e,"text")}async CordovaFetchLocalFileAsBlob(e){var t=await this._CordovaFetchLocalFileAs(e,"buffer"),e=GetTypeFromFileExtension2(e);return new Blob([t],{type:e})}async CordovaFetchLocalFileAsBlobURL(e){"flat"===this._fileStructure&&(e=e.toLowerCase());var t,r=this._cordovaBlobUrlCache.get(e);return r||(t=await this.CordovaFetchLocalFileAsBlob(e),r=URL.createObjectURL(t),this._cordovaBlobUrlCache.set(e,r)),r}CordovaFetchLocalFileAsArrayBuffer(e){return this._CordovaFetchLocalFileAs(e,"buffer")}GetMediaFileUrl(e){"flat"===this._fileStructure&&(e=e.toLowerCase());let t=this._mediaSubfolder+e;return t="Gecko"===C33.Platform.BrowserEngine&&"preview"===this._runtime.GetExportType()?this._GetLocalBlobURLFromFileMap(t):t}GetProjectFileUrl(e){return C33.IsAbsoluteURL(e)?Promise.resolve(e):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(e):"playable-ad-single-file"===this._runtime.GetExportType()?URL.createObjectURL(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("flat"===this._fileStructure&&(e=e.toLowerCase()),Promise.resolve(e))}GetProjectFileIframeUrl(t){if(C33.IsAbsoluteURL(t)||"preview"!==this._runtime.GetExportType()||!this._swClientId||!t)return t;try{var e=new URL(t,location.href);return e.searchParams.set("__c3_client_id",this._swClientId),e.toString()}catch(e){return console.warn("Invalid iframe URL: "+t),t}}LoadProjectFileUrl(e){return this.GetProjectFileUrl(e)}LoadImage(e){if(e.loadPolicy&&!VALID_LOAD_POLICIES.has(e.loadPolicy))throw new Error("invalid load policy");let t=this._assetsByUrl.get(e.url);return t||(t=C33.New(C33.ImageAsset,this,{url:e.url,size:e.size||0,loadPolicy:e.loadPolicy||this._defaultLoadPolicy}),this._assetsByUrl.set(t.GetURL(),t),this._hasFinishedInitialLoad)||(this._totalAssetSizeToLoad+=t.GetSize(),this._loadPromises.push(t.Load().then(()=>this._AddLoadedSize(t.GetSize())))),t}_ReleaseAsset(e){this._assetsByUrl.delete(e.GetURL())}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(e){console.error("Error loading: ",e),this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(e){this._assetSizeLoaded+=e,this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){var e=C33.New(C33.Event,"loadingprogress");this._lastLoadProgress=C33.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1),e.progress=this._lastLoadProgress,this._runtime.Dispatcher().dispatchEvent(e)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(e){C33.shallowAssignArray(this._webFonts,e),this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){var i=[],s=[];for(let[e,t,r]of this._webFonts)this._totalAssetSizeToLoad+=r,i.push(this._LoadWebFont(e,t,s).then(()=>this._AddLoadedSize(r)));await Promise.all(i),this._runtime.IsInWorker()&&0<s.length&&await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{webfonts:s})}async _LoadWebFont(t,r,i){try{let e=await this.GetProjectFileUrl(r);"Gecko"===C33.Platform.BrowserEngine&&(t=`'${t}'`),("Gecko"===C33.Platform.BrowserEngine&&"preview"===this._runtime.GetExportType()||"playable-ad-single-file"===this._runtime.GetExportType())&&(e=this._GetLocalBlobURLFromFileMap(e));var s=new FontFace(t,`url('${e}')`);(this._runtime.IsInWorker()?self:document).fonts.add(s),await s.load(),this._runtime.IsInWorker()&&i.push({name:t,url:e})}catch(e){console.warn(`[C3 runtime] Failed to load web font '${t}': `,e)}}IsAudioFormatSupported(e){return!!this._supportedAudioFormats[e]}_SetAudioFiles(i,e){this._preloadSounds=!!e;for(let[t,e,r]of i)this._audioFiles.set(t,{fileName:t,formats:e.map(e=>({type:e[0],fileExtension:e[1],fullName:t+e[1],fileSize:e[2]})),isMusic:r})}GetPreferredAudioFile(e){"flat"===this._fileStructure&&(e=e.toLowerCase());var t,e=this._audioFiles.get(e);if(!e)return null;let r=null;for(t of e.formats)if(r||"audio/webm; codecs=opus"!==t.type||(r=t),this.IsAudioFormatSupported(t.type))return t;return r}GetProjectAudioFileUrl(e){e=this.GetPreferredAudioFile(e);return e?{url:this.GetMediaFileUrl(e.fullName),type:e.type}:null}GetAudioToPreload(){if(this._preloadSounds){var e,t,r=[];for(e of this._audioFiles.values())e.isMusic||(t=this.GetPreferredAudioFile(e.fileName))&&r.push({originalUrl:e.fileName,url:this.GetMediaFileUrl(t.fullName),type:t.type,fileSize:t.fileSize});return r}return[]}_GetLocalBlobFromFileMap(e){return"preview"===this._runtime.GetExportType()&&(e=new URL(e,location.href).toString()),this._fileMap.get(e)||null}_GetLocalBlobURLFromFileMap(e){var t=this._fileMapBlobUrls.get(e);if(!t){var r=this._GetLocalBlobFromFileMap(e);if(!r)return e;t=URL.createObjectURL(r),this._fileMapBlobUrls.set(e,t)}return t}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...e){var t,r=await Promise.all(e.map(e=>this.GetProjectFileUrl(e)));this._runtime.IsInWorker()?1===e.length?(t=e[0],await self.c3_import((C33.IsRelativeURL(t)?"./":"")+t)):(t=e.map(e=>`import "${C33.IsRelativeURL(e)?"./":""}${e}";`).join("\n"),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),await self.c3_import(e)):await Promise.all(r.map(e=>AddScript2(e)))}async CompileWebAssembly(e){var t;return WebAssembly.compileStreaming?(t=await this.GetProjectFileUrl(e),WebAssembly.compileStreaming(fetch(t))):(t=await C33.FetchArrayBuffer(e),WebAssembly.compile(t))}async LoadStyleSheet(e){e=await this.GetProjectFileUrl(e);return this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:e})}}}{let C33=self.C3;C33.Asset=class Asset extends C33.DefendedBase{constructor(e,t){super(),this._assetManager=e,this._runtime=e.GetRuntime(),this._url=t.url||"",this._size=t.size,this._loadPolicy=t.loadPolicy,this._blob=t.blob||null,this._isLoaded=!!this._blob,this._loadPromise=null}Release(){this._loadPromise=null,this._assetManager=null,this._runtime=null,this._blob=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):(this._loadPromise||(this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(e=>(this._isLoaded=!0,this._loadPromise=null,this._blob=e)).catch(e=>{console.error("Error loading resource: ",e),this._loadPromise=null})),this._loadPromise)}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise||this._assetManager.FetchBlob(this._url,this._loadPolicy)}}}{let C33=self.C3,promiseThrottle=new C33.PromiseThrottle,allImageAssets=new Set;C33.ImageAsset=class ImageAsset extends C33.Asset{constructor(e,t){super(e,t),this._texturePromise=null,this._webglTexture=null,this._refCount=0,this._imageWidth=-1,this._imageHeight=-1,allImageAssets.add(this)}Release(){if(0!==this._refCount)throw new Error("released image asset which still has texture references");this._assetManager._ReleaseAsset(this),this._texturePromise=null,allImageAssets.delete(this),super.Release()}static OnRendererContextLost(){for(var e of allImageAssets)e._texturePromise=null,e._webglTexture=null,e._refCount=0}LoadStaticTexture(e,t){return t=t||{},this._refCount++,this._webglTexture?Promise.resolve(this._webglTexture):(this._texturePromise||(t.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy(),this._texturePromise=this._DoLoadStaticTexture(e,t)),this._texturePromise)}async _DoLoadStaticTexture(r,i){try{let t=await this.GetBlob();return 0===this._refCount?this._texturePromise=null:await promiseThrottle.Add(async()=>{var e=await r.CreateStaticTextureAsync(t,i);return this._texturePromise=null,0===this._refCount?(r.DeleteTexture(e),null):(this._webglTexture=e,this._imageWidth=e.GetWidth(),this._imageHeight=e.GetHeight(),this._webglTexture)})}catch(e){throw console.error("Failed to load texture: ",e),e}}ReleaseTexture(){if(this._refCount<=0)throw new Error("texture released too many times");this._refCount--,0===this._refCount&&this._webglTexture&&(this._webglTexture.GetRenderer().DeleteTexture(this._webglTexture),this._webglTexture=null)}GetRefCount(){return this._refCount}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){var e=await this.GetBlob();return C33.Supports.ImageBitmap?createImageBitmap(e):C33.BlobToImage(e)}}}{let SortByInstLastCachedZIndex2=function(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()},C33=(SortByInstLastCachedZIndex=SortByInstLastCachedZIndex2,self.C3),assert=self.assert;C33.RenderCell=class RenderCell extends C33.DefendedBase{constructor(e,t,r){super(),this._grid=e,this._x=t,this._y=r,this._instances=[],this._isSorted=!0,this._pendingRemoval=new Set,this._isAnyPendingRemoval=!1}Release(){C33.clearArray(this._instances),this._pendingRemoval.clear(),this._grid=null}Reset(){C33.clearArray(this._instances),this._isSorted=!0,this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){if(this._instances.length){if(this._instances.length>this._pendingRemoval.size)return!1;this._FlushPending()}return!0}Insert(e){this._pendingRemoval.has(e)?(this._pendingRemoval.delete(e),0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1)):(this._instances.push(e),this._isSorted=1===this._instances.length)}Remove(e){this._pendingRemoval.add(e),this._isAnyPendingRemoval=!0,50<=this._pendingRemoval.size&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length===this._pendingRemoval.size?this.Reset():(C33.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1))}_EnsureSorted(){this._isSorted||(this._instances.sort(SortByInstLastCachedZIndex2),this._isSorted=!0)}Dump(e){this._FlushPending(),this._EnsureSorted(),this._instances.length&&e.push(this._instances)}}}{let C33=self.C3;C33.RenderGrid=class RenderGrid extends C33.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C33.New(C33.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(e,t,r){var i=this._cells.Get(e,t);return i||(r?(i=C33.New(C33.RenderCell,this,e,t),this._cells.Set(e,t,i),i):null)}XToCell(e){return Math.floor(e/this._cellWidth)}YToCell(e){return Math.floor(e/this._cellHeight)}Update(i,s,a){if(s)for(let r=s.getLeft(),e=s.getRight();r<=e;++r)for(let e=s.getTop(),t=s.getBottom();e<=t;++e){var n;a&&a.containsPoint(r,e)||(n=this.GetCell(r,e,!1))&&(n.Remove(i),n.IsEmpty())&&this._cells.Delete(r,e)}if(a)for(let r=a.getLeft(),e=a.getRight();r<=e;++r)for(let e=a.getTop(),t=a.getBottom();e<=t;++e)s&&s.containsPoint(r,e)||this.GetCell(r,e,!0).Insert(i)}QueryRange(e,t){let r=this.XToCell(e.getLeft());for(var i=this.YToCell(e.getTop()),s=this.XToCell(e.getRight()),a=this.YToCell(e.getBottom());r<=s;++r)for(let e=i;e<=a;++e){var n=this.GetCell(r,e,!1);n&&n.Dump(t)}}MarkRangeChanged(e){let t=e.getLeft();for(var r=e.getTop(),i=e.getRight(),s=e.getBottom();t<=i;++t)for(let e=r;e<=s;++e){var a=this.GetCell(t,e,!1);a&&a.SetChanged()}}}}{let SortByInstLastCachedZIndex2=function(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()},SortByInstZElevation2=function(e,t){return e.GetWorldInfo().GetZElevation()-t.GetWorldInfo().GetZElevation()},C33=(SortByInstLastCachedZIndex=SortByInstLastCachedZIndex2,SortByInstZElevation=SortByInstZElevation2,self.C3),assert=self.assert,tmpRect=new C33.Rect,tmpQuad=new C33.Quad,renderCellArr=[],tmpDestRect=new C33.Rect,tmpSrcRect=new C33.Rect,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempMat4=mat42.create(),tempVec3=vec32.create(),tempVec4=vec42.create(),camVector=vec32.create(),lookVector=vec32.create(),upVector=vec32.create(),tempVec2=C33.New(C33.Vector2),tempRect=C33.New(C33.Rect),tempInstanceList1=[],tempInstanceList2=[],tempInstancesByCameraDist=[],DEFAULT_LAYER_OPTIONS={name:"",sid:-1,isDynamic:!1,isVisible:!0,isInteractive:!0,isHTMLElementsLayer:!1,backgroundColor:[1,1,1,1],isTransparent:!0,parallax:[1,1],opacity:1,isForceOwnTexture:!1,renderAs3d:!1,useCameraDistanceDrawOrder:!1,useRenderCells:!1,scaleRate:1,blendMode:0,zElevation:0,initialInstancesData:[],effectListData:[],subLayersData:[]};C33.Layer=class Layer extends C33.DefendedBase{constructor(e,t,r){super(),r=Object.assign({},DEFAULT_LAYER_OPTIONS,r),this._layout=e,this._runtime=e.GetRuntime(),this._parentLayer=t,this._name=r.name,this._index=-1,this._isHTMLElementsLayer=!!r.isHTMLElementsLayer,this._htmlIndex=-1,this._sid=r.sid,this._isDynamic=!!r.isDynamic,this._isVisible=!!r.isVisible,this._isInteractive=!!r.isInteractive,this._backgroundColor=C33.New(C33.Color),this._backgroundColor.setFromJSON(r.backgroundColor),this._isTransparent=!!r.isTransparent,this._parallaxX=r.parallax[0],this._parallaxY=r.parallax[1],this._color=C33.New(C33.Color,1,1,1,r.opacity),this._premultipliedColor=C33.New(C33.Color),this._isForceOwnTexture=!!r.isForceOwnTexture,this._renderAs3d=!!r.renderAs3d,this._useCameraDistanceDrawOrder=!!r.useCameraDistanceDrawOrder,this._useRenderCells=!!r.useRenderCells,this._scaleRate=r.scaleRate,this._blendMode=r.blendMode,this._curRenderTarget=null,this._scale=1,this._zElevation=r.zElevation,this._angle=0,this._scrollX=0,this._scrollY=0,this._hasOwnScrollPosition=!1,this._viewport=C33.New(C33.Rect),this._viewportZ0=C33.New(C33.Rect),this._viewport3D=C33.New(C33.Rect),this._isViewportChanged=!0,this._projectionMatrix=mat42.create(),this._isProjectionMatrixChanged=!0,this._modelViewMatrix=mat42.create(),this._isMVMatrixChanged=!0,this._viewFrustum=C33.New(C33.Gfx.ViewFrustum),this._isViewFrustumChanged=!0,this._startupInitialInstances=[],this._initialInstancesData=r.initialInstancesData,this._initialInstances=[],this._createdGlobalUids=[],this._initialUIDsToInstanceData=new Map,this._instances=[],this._zIndicesUpToDate=!1,this._htmlZIndicesUpToDate=!1,this._anyInstanceZElevated=!1;let i=this._runtime.GetCanvasManager();this._effectList=C33.New(C33.EffectList,this,r.effectListData),this._effectChain=C33.New(C33.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{var t=t.GetContentObject(),r=t.GetRenderTarget();e.SetColor(t.GetPremultipliedColor()),e.DrawRenderTarget(r),e.InvalidateRenderTarget(r),i.ReleaseAdditionalRenderTarget(r)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasDefaultColor=!0,this._renderGrid=null,this._lastRenderList=[],this._isRenderListUpToDate=!1,this._lastRenderCells=C33.New(C33.Rect,0,0,-1,-1),this._curRenderCells=C33.New(C33.Rect,0,0,-1,-1),this._iLayer=new self.ILayer(this),this._UpdatePremultipliedColor(),this.UsesRenderCells()&&(this._renderGrid=C33.New(C33.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight())),this._subLayers=r.subLayersData.map(e=>C33.Layer.CreateFromExportData(this._layout,this,e))}_InitInitialInstances(){for(var e of this._initialInstancesData){var t=this._runtime.GetObjectClassByIndex(e[1]);this._layout._AddInitialObjectClass(t),t.GetDefaultInstanceData()||(t.SetDefaultInstanceData(e),t._SetDefaultLayerIndex(this._index)),this._initialInstances.push(e),this._initialUIDsToInstanceData.set(e[2],e)}C33.shallowAssignArray(this._startupInitialInstances,this._initialInstances),this._initialInstancesData=null}static CreateFromExportData(e,t,r){return C33.New(C33.Layer,e,t,{name:r[0],sid:r[2],isVisible:r[3],isInteractive:r[13],isHTMLElementsLayer:r[19],backgroundColor:r[4].map(e=>e/255),isTransparent:r[5],parallax:[r[6],r[7]],opacity:r[8],isForceOwnTexture:r[9],renderAs3d:r[17],useCameraDistanceDrawOrder:r[18],useRenderCells:r[10],scaleRate:r[11],blendMode:r[12],zElevation:r[16],initialInstancesData:r[14],effectListData:r[15],subLayersData:r[20]})}Release(){for(var e of this._subLayers)e.Release();C33.clearArray(this._subLayers);for(var t of this._instances)this._runtime.DestroyInstance(t);C33.clearArray(this._instances),this._effectList.Release(),this._effectList=null,this._effectChain.Release(),this._effectChain=null,this._iLayer=null,this._parentLayer=null,this._layout=null,this._runtime=null}GetInitialInstanceData(e){return this._initialUIDsToInstanceData.get(e)}CreateInitialInstances(r){var i=this._layout.IsFirstVisit();let s=0;var a=this._initialInstances;for(let t=0,e=a.length;t<e;++t){var n=a[t],o=this._runtime.GetObjectClassByIndex(n[1]);let e=!0;o.HasPersistBehavior()&&!i||(n=this._runtime.CreateInstanceFromData(n,this,!0),r.push(n),o.IsGlobal()&&(e=!1,this._createdGlobalUids.push(n.GetUID()))),e&&(a[s]=a[t],++s)}C33.truncateArray(a,s),this._runtime.FlushPendingInstances(),this.SetZIndicesChanged()}_AddInstance(e,t){if(!e.GetPlugin().IsWorldType())throw new Error("instance is not of world type");var r=e.GetWorldInfo();if(r.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.push(e),0!==r.GetZElevation()&&(this._anyInstanceZElevated=!0),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged(),this.SetZIndicesChanged(e)}_MaybeAddInstance(e){this._instances.includes(e)||(this._instances.push(e),0!==e.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(e))}_PrependInstance(e,t){var r=e.GetWorldInfo();if(r.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.unshift(e),0!==r.GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(e),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged()}_RemoveInstance(e,t){var r=this._instances.indexOf(e);r<0||(t&&this.UsesRenderCells()&&e.GetWorldInfo()._RemoveFromRenderCells(),this._instances.splice(r,1),this.SetZIndicesChanged(e),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(e){if(e){var t,r,i=new Set;for(t of this._instances){var s=t.GetWorldInfo()._GetLastCachedZIndex();0<=s&&i.add(s)}let e=-1;for(r of this._instances){var a=r.GetWorldInfo();if(!(0<=a._GetLastCachedZIndex())){for(++e;i.has(e);)++e;a._SetZIndex(e)}}}this._instances.sort(SortByInstLastCachedZIndex2)}_Start(){}_End(){for(var e of this._instances)e.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(e);this._runtime.FlushPendingInstances(),C33.clearArray(this._instances),this._anyInstanceZElevated=!1,this.SetZIndicesChanged()}RecreateInitialObjects(t,e,r,i,s,a){var n,o=this._runtime.GetEventSheetManager(),l=this._runtime.GetAllObjectClasses(),h=t.IsFamily(),u=[];for(n of this._initialInstances){var c=n[0],_=c[0];if(e.containsPoint(_,c[1])){_=l[n[1]];if(_!==t){if(!h)continue;if(!t.FamilyHasMember(_))continue}let e=s;e||(c=this._runtime.GetCurrentLayout(),e=this.GetLayout()===c?this:(e=c.GetLayerByName(this.GetName()))||c.GetLayerByIndex(this.GetIndex()));_=this._runtime.CreateInstanceFromData(n,e,!1,void 0,void 0,!1,a),c=(e.SortAndAddInstancesByZIndex(_),_.GetWorldInfo());c.OffsetXY(r,i),c.SetBboxChanged(),o.BlockFlushingInstances(!0),_._TriggerOnCreatedOnSelfAndRelated(),o.BlockFlushingInstances(!1),u.push(_)}}return u}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}_SetHTMLIndex(e){this._htmlIndex=e}GetHTMLIndex(){return this._htmlIndex}IsHTMLElementsLayer(){return this._isHTMLElementsLayer}SetIsHTMLElementsLayer(e){this._isHTMLElementsLayer!==(e=!!e)&&(this._isHTMLElementsLayer=e,this._layout._ReindexAndUpdateAllLayers(),this._runtime.UpdateRender())}_GetSiblingIndex(){let e=-1;var t=this.GetParentLayer();return e=(t?t.GetSubLayers():this.GetLayout()._GetRootLayers()).indexOf(this)}GetSID(){return this._sid}GetRuntime(){return this._runtime}IsDynamic(){return this._isDynamic}HasAnyDynamicParentLayer(){for(var e of this.parentLayers())if(e.IsDynamic())return!0;return!1}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){var e,t=this.HasDefaultColor();(this._needsRebuildEffectChainSteps||t!==this._wasDefaultColor||this._effectChain.NeedsRebuild())&&(e=this.GetEffectList().GetActiveEffectTypes(),this._effectChain.BuildSteps(e.map(e=>e.GetShaderProgram()),{indexMap:e.map(e=>e.GetIndex()),forcePreDraw:!t,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasDefaultColor=t)}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(var e of this.selfAndParentLayers())if(!e._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(e){this._isVisible!==(e=!!e)&&(this._isVisible=e,this._runtime.UpdateRender())}SetInteractive(e){this._isInteractive=!!e}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(var e of this.selfAndParentLayers())if(!e.IsInteractive())return!1;return!0}SetOwnScrollPositionEnabled(e){this._hasOwnScrollPosition!==(e=!!e)&&((this._hasOwnScrollPosition=e)&&(e=this.GetLayout(),this._scrollX=e.GetScrollX(),this._scrollY=e.GetScrollY()),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(e){var t=this.GetLayout(),r=t.GetScrollLeftBound(),t=t.GetScrollRightBound();this._scrollX!==(e=(e=t<e?t:e)<r?r:e)&&(this._scrollX=e,this.IsOwnScrollPositionEnabled())&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender())}SetScrollY(e){var t=this.GetLayout(),r=t.GetScrollTopBound(),t=t.GetScrollBottomBound();this._scrollY!==(e=(e=t<e?t:e)<r?r:e)&&(this._scrollY=e,this.IsOwnScrollPositionEnabled())&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){return this._MaybeUpdateViewport(),this._viewport}_GetViewportZ0(){return this._MaybeUpdateViewport(),this._viewportZ0}GetViewport3D(){return this._MaybeUpdateViewport(),this._viewport3D}_GetVanishingPoint(){var e=this.GetLayout();return[e.GetVanishingPointX(),e.GetVanishingPointY()]}GetDefaultCameraZ(e){return this._runtime.GetDefaultCameraZ(e)}GetViewportForZ(s,e){var t=this._GetViewportZ0();if(0===s)e.copy(t);else{let r=t.midX(),i=t.midY();var a=this.Get2DScaleFactorToZ(s),n=t.width()/a,t=t.height()/a,[a,o]=this._GetVanishingPoint();if(.5!==a||.5!==o){var l=this.Get2DCameraZ(),h=this._runtime,u=this.GetDefaultCameraZ()/l;let e=(a-.5)*h.GetViewportWidth()/u,t=(o-.5)*h.GetViewportHeight()/u;a=this.GetAngle(),o=(0!==a&&(tempVec2.set(e,t),tempVec2.rotate(a),e=tempVec2.getX(),t=tempVec2.getY()),C33.unlerp(l,0,s));r+=C33.lerp(e,0,o),i+=C33.lerp(t,0,o)}e.set(r-n/2,i-t/2,r+n/2,i+t/2)}}GetOpacity(){return this._color.getA()}SetOpacity(e){e=C33.clamp(e,0,1),this._color.getA()!==e&&(this._color.setA(e),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color),this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(e){this._scaleRate!==e&&(this._scaleRate=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(e,t){this._parallaxX===e&&this._parallaxY===t||(this._parallaxX=e,this._parallaxY=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}SetParallaxX(e){this.SetParallax(e,this.GetParallaxY())}SetParallaxY(e){this.SetParallax(this.GetParallaxX(),e)}SetZElevation(e){this._zElevation!==e&&(this._zElevation=e,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(e){e=C33.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return C33.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return 0<this._instances.length}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(C33.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances()),tempInstancesByCameraDist.sort((e,t)=>this._SortInstancesByCameraDistance(e,t)),tempInstancesByCameraDist):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(e){C33.appendArray(e,this._GetInstancesInDrawOrder());for(var t of this._subLayers)t.IsVisible()&&0<t.GetOpacity()&&t._AppendAllInstancesIncludingSubLayersInDrawOrder(e)}_SortInstancesByCameraDistance(e,t){var r=this.GetLayout().Get3DCameraPosition(),i=r[0],s=r[1],r=r[2],e=e.GetWorldInfo(),t=t.GetWorldInfo(),a=e.GetX()-i,n=e.GetY()-s,e=e.GetZElevation()-r,i=t.GetX()-i,s=t.GetY()-s,t=t.GetZElevation()-r;return i*i+s*s+t*t-(a*a+n*n+e*e)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(e){this._isTransparent!==(e=!!e)&&(this._isTransparent=e,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(e){this._isForceOwnTexture!==(e=!!e)&&(this._isForceOwnTexture=e,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(var e of this._subLayers)if(!e.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(e){this._blendMode!==e&&(this._blendMode=e,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}_SetParentLayer(e){this._parentLayer=e}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return 0<this._subLayers.length}_AddSubLayer(e,t=!0){t?this._subLayers.push(e):this._subLayers.unshift(e)}_InsertSubLayer(e,t,r){let i=this._subLayers.indexOf(t);if(-1===i)throw new Error("cannot find layer to insert by");r&&++i,this._subLayers.splice(i,0,e)}_RemoveSubLayer(e){e=this._subLayers.indexOf(e);if(-1===e)throw new Error("cannot find layer to remove");this._subLayers.splice(e,1)}HasAnyVisibleSubLayer(){for(var e of this._subLayers)if(e.ShouldDraw())return!0;return!1}*selfAndAllSubLayers(){for(var e of this._subLayers)yield*e.selfAndAllSubLayers();yield this}*parentLayers(){let e=this.GetParentLayer();for(;e;)yield e,e=e.GetParentLayer()}*selfAndParentLayers(){yield this,yield*this.parentLayers()}HasParentLayer(e){for(var t of this.parentLayers())if(t===e)return!0;return!1}IsTransformCompatibleWith(e){return this===e||this._parallaxX===e._parallaxX&&this._parallaxY===e._parallaxY&&this._scale===e._scale&&this._scaleRate===e._scaleRate&&this._angle===e._angle&&this.GetScrollX()===e.GetScrollX()&&this.GetScrollY()===e.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(e){this.SetParallax(e.parallaxX,e.parallaxY),this.SetOwnScale(e.scale),this.SetScaleRate(e.scaleRate),this.SetAngle(e.angle),this.SetOwnScrollPositionEnabled(e.hasOwnScroll),this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(e){0!==e.size&&0<C33.arrayRemoveAllInSet(this._instances,e)&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}SetZIndicesChanged(e){this._zIndicesUpToDate=!1,this._isRenderListUpToDate=!1,e&&!e.GetObjectClass().GetPlugin().IsHTMLElementType()||(this._htmlZIndicesUpToDate=!1)}_UpdateZIndices(){if(!this._zIndicesUpToDate){if(this._instances.sort(SortByInstZElevation2),this.UsesRenderCells())for(let e=0,t=this._instances.length;e<t;++e){var r=this._instances[e].GetWorldInfo();r._SetZIndex(e),this._renderGrid.MarkRangeChanged(r.GetRenderCellRange())}else for(let e=0,t=this._instances.length;e<t;++e)this._instances[e].GetWorldInfo()._SetZIndex(e);this._zIndicesUpToDate=!0}}_UpdateHTMLZIndices(){if(!this._htmlZIndicesUpToDate){var t;let e=0;for(t of this._layout.GetRootLayersForHTMLLayer(this.GetHTMLIndex()).map(e=>[...e.selfAndAllSubLayers()]).flat()){for(var r of t._GetInstances())r.GetObjectClass().GetPlugin().IsHTMLElementType()&&r.GetWorldInfo()._SetHTMLZIndex(e++);t._SetHTMLZIndicesUpToDate()}}}_SetHTMLZIndicesUpToDate(){this._htmlZIndicesUpToDate=!0}MoveInstanceAdjacent(e,t,r){var i=e.GetWorldInfo(),t=t.GetWorldInfo();if(i.GetLayer()!==this||t.GetLayer()!==this)throw new Error("can't arrange Z order unless both objects on this layer");i=i.GetZIndex();let s=t.GetZIndex();return i!==s+(r?1:-1)&&(C33.arrayRemove(this._instances,i),i<s&&s--,r&&s++,s===this._instances.length?this._instances.push(e):this._instances.splice(s,0,e),this.SetZIndicesChanged(e),!0)}_MergeSortedZArrays(e,t){var r=[];let i=0,s=0,a=e.length,n=t.length;for(;i<a&&s<n;){var o=e[i],l=t[s];o.GetWorldInfo()._GetLastCachedZIndex()<l.GetWorldInfo()._GetLastCachedZIndex()?(r.push(o),++i):(r.push(l),++s)}for(;i<a;++i)r.push(e[i]);for(;s<n;++s)r.push(t[s]);return r}_MergeAllSortedZArrays_pass(t){var r=[],i=t.length;for(let e=0;e<i-1;e+=2){var s=t[e],a=t[e+1];r.push(this._MergeSortedZArrays(s,a))}return i%2==1&&r.push(t[i-1]),r}_MergeAllSortedZArrays(e){for(;1<e.length;)e=this._MergeAllSortedZArrays_pass(e);return e[0]}_GetRenderCellInstancesToDraw(){return this._UpdateZIndices(),C33.clearArray(renderCellArr),this._renderGrid.QueryRange(this.GetViewport(),renderCellArr),renderCellArr.length?1===renderCellArr.length?renderCellArr[0]:this._MergeAllSortedZArrays(renderCellArr):[]}ShouldDraw(){return this.IsVisible()&&0<this.GetOpacity()&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;for(var e of this._subLayers)if(e._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(var e of this._subLayers)if(e.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(e){var t;return this._layout.IsOrthographicProjection()?1:(t=this.Get3DCameraZ())/(t-e)}GetResolutionScaleFactorToZ(e){var t,r=this._runtime.GetRenderScale();return this._layout.IsOrthographicProjection()?r:(t=this.Get3DCameraZ(),this.GetDefaultCameraZ()/Math.abs(t-e)*r)}_SetMVMatrixChanged(){this._isMVMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetModelViewMatrix(e){return this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(e,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1),this._modelViewMatrix}Get2DCameraZ(e){return this.GetDefaultCameraZ(e)/this.GetNormalScale()}Get3DCameraZ(){return this.Has3DCamera()?this.GetLayout().Get3DCameraPosition()[2]:this.Get2DCameraZ()}GetCameraPosition(){var e;return this.Has3DCamera()?[(e=this.GetLayout().Get3DCameraPosition())[0],e[1],e[2]]:this._Get2DCameraPosition()}_Get2DCameraPosition(r=0,i=0,s=0){var a=this._runtime,n=this.GetLayout(),o=a.GetParallaxXOrigin(),l=a.GetParallaxYOrigin();let e=(this.GetScrollX()-o)*this._parallaxX+o,t=(this.GetScrollY()-l)*this._parallaxY+l,h=(a.IsPixelRoundingEnabled()&&(e=Math.round(e),t=Math.round(t)),e+r),u=t+i;var o=n.IsOrthographicProjection()?this.GetDefaultCameraZ(s):this.Get2DCameraZ(s),[l,r]=this._GetVanishingPoint();if(.5!==l||.5!==r){i=this.GetDefaultCameraZ(s)/o;let e=(l-.5)*a.GetViewportWidth()/i,t=(r-.5)*a.GetViewportHeight()/i;n=this.GetAngle();0!==n&&(tempVec2.set(e,t),tempVec2.rotate(n),e=tempVec2.getX(),t=tempVec2.getY()),h+=e,u+=t}return[h,u,o]}_CalculateModelViewMatrix(e,t,r,i,s){var a,n,o,l,h=this._runtime,u=this.GetLayout();this.Has3DCamera()?(vec32.copy(camVector,u.Get3DCameraPosition()),vec32.copy(lookVector,u.Get3DCameraLookAt()),vec32.copy(upVector,u.Get3DCameraUpVector()),u=h.GetParallaxXOrigin(),n=h.GetParallaxYOrigin(),o=lookVector[0]-camVector[0],l=lookVector[1]-camVector[1],a=lookVector[2]-camVector[2],camVector[0]=(camVector[0]-u)*this._parallaxX+u,camVector[1]=(camVector[1]-n)*this._parallaxY+n,camVector[2]*=Math.max(this._parallaxX,this._parallaxY),lookVector[0]=camVector[0]+o,lookVector[1]=camVector[1]+l,lookVector[2]=camVector[2]+a):([u,n,o]=this._Get2DCameraPosition(r,i,s),vec32.set(camVector,u,n,o),vec32.set(lookVector,u,n,o-100),0===(l=this.GetAngle())?vec32.set(upVector,0,1,0):vec32.set(upVector,Math.sin(l),Math.cos(l),0)),e.CalculateLookAtModelView(t,camVector,lookVector,upVector,s||h.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isProjectionMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetProjectionMatrix(e){return this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(e),this._isProjectionMatrixChanged=!1),this._projectionMatrix}_CalculateProjectionMatrix(e){var t,r=this._runtime.GetCanvasManager(),[i,s]=this._GetVanishingPoint();this._layout.IsOrthographicProjection()?e.CalculateOrthographicMatrix(this._projectionMatrix,r.GetDrawWidth(),r.GetDrawHeight()):.5===i&&.5===s?mat42.copy(this._projectionMatrix,r.GetDefaultProjectionMatrix()):(t=r.GetDrawWidth(),r=r.GetDrawHeight(),e.CalculatePerspectiveMatrix(this._projectionMatrix,t/r,i,s))}_SetTransform(e,t=!0,r=0,i=0,s=0){t&&e.SetProjectionMatrix(this._GetProjectionMatrix(e));let a=null;a=0===r&&0===i&&0===s?this._GetModelViewMatrix(e):(this._CalculateModelViewMatrix(e,tempMat4,r,i,s),tempMat4),e.SetModelViewMatrix(a)}PrepareForDraw(e){this._SetTransform(e),e.SetBaseZ(this.GetZElevation())}_MaybeStartWebGLProfiling(e){let t=null;var r;return e.IsWebGL()&&this._runtime.IsGPUProfiling()&&(r=this._runtime.GetCanvasManager().GetLayerTimingsBuffer(this))&&(t=r.AddTimeElapsedQuery(),e.StartQuery(t)),t}_MaybeStartWebGPUProfiling(e){var t;e.IsWebGPU()&&this._runtime.IsGPUProfiling()&&(t=2*(this.GetIndex()+1),e.StartMeasuringRenderPassTime(t,1+t))}Draw(e,t,r){var i=this._runtime.GetCanvasManager(),s=this.UsesOwnTexture();let a=null;var n,o=this._MaybeStartWebGLProfiling(e);this._MaybeStartWebGPUProfiling(e),s?(n={sampling:this._runtime.GetSampling(),isSampled:!0,canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()},"low"===i.GetCurrentFullscreenScalingQuality()&&(n.width=i.GetDrawWidth(),n.height=i.GetDrawHeight()),a=this._runtime.GetAdditionalRenderTarget(n),this._curRenderTarget=a,e.SetRenderTarget(a),this.IsTransparent()&&e.ClearRgba(0,0,0,0)):(this._curRenderTarget=t,e.SetRenderTarget(t)),this.IsTransparent()||e.Clear(this._backgroundColor),this._layout._DrawLayerList(e,this._curRenderTarget,this._subLayers,s&&this.IsTransparent()),this._MaybeStartWebGPUProfiling(e),this._SetTransform(e),e.SetBaseZ(this.GetZElevation()),e.SetDepthEnabled(this.RendersIn3DMode()),this.GetNormalScale()>Number.EPSILON&&(this._UpdateZIndices(),i=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated,this.Has3DCamera()?this._DrawInstances_3DCamera(e):i?this._DrawInstances_RenderCells(e):this._DrawInstances(e,this._GetInstancesInDrawOrder())),e.SetBaseZ(0),e.SetCurrentZ(0),s&&(e.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(e,a,t,r)),o&&e.EndQuery(o),this._curRenderTarget=null}_DrawInstances(r,i){var s=this.GetViewport(),a=this._curRenderTarget,n=this.GetLayout().IsOrthographicProjection(),o=this.GetLayout().HasVanishingPointOutsideViewport();let l=null;for(let e=0,t=i.length;e<t;++e){var h,u=i[e];u!==l&&((h=(l=u).GetWorldInfo()).IsVisible()&&h.IsInViewport(s,o,n))&&this._DrawInstanceMaybeWithEffects(u,h,r,a)}}_DrawInstances_3DCamera(i){var s=this._curRenderTarget,a=this._GetViewFrustum(),n=tempInstanceList1,o=tempInstanceList2,l=this._GetInstancesInDrawOrder();for(let t=0,r=l.length;t<r;){var h=l[t],u=h.GetWorldInfo();if(u.IsVisible()&&u.IsInViewport3D(a)){(!h.RendersToOwnZPlane()||0<u.GetDepth())&&o.push(h);var c=h.GetWorldInfo().GetTotalZElevation();n.push(h);let e=t+1;for(;e<r;++e){var _=l[e],d=_.GetWorldInfo();if(d.IsVisible()&&d.IsInViewport3D(a)){if(d.GetTotalZElevation()!==c)break;(_.RendersToOwnZPlane()?(0<d.GetDepth()&&o.push(_),n):o).push(_)}}if(1!==n.length||n[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(i,n);for(let e=0,t=o.length;e<t;++e){var p=o[e],m=p.GetWorldInfo();m._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(p,m,i,s),m._SetDrawNonBackFacesOnly(!1)}}else{this._DrawInstanceMaybeWithEffects(h,u,i,s);for(let e=0,t=o.length;e<t;++e){var g,f=o[e];f!==h&&(g=f.GetWorldInfo()).GetLayer()._DrawInstanceMaybeWithEffects(f,g,i,s)}}t=e,C33.clearArray(n),C33.clearArray(o)}else++t}}_DrawCoplanarInstances_3DCamera(r,i){var s=this._curRenderTarget;r.CoplanarStartStencilPass();for(let e=0,t=i.length;e<t;++e){var a=i[e],n=a.GetWorldInfo();n._SetDrawBackFaceOnly(!0),this._DrawInstance(a,n,r)}r.CoplanarStartColorPass();for(let e=0,t=i.length;e<t;++e){var o=i[e],l=o.GetWorldInfo();this._DrawInstanceMaybeWithEffects(o,l,r,s),l._SetDrawBackFaceOnly(!1)}r.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(e){var t=this._renderGrid,r=this._curRenderCells,i=this._lastRenderCells,s=this.GetViewport();let a;r.set(t.XToCell(s.getLeft()),t.YToCell(s.getTop()),t.XToCell(s.getRight()),t.YToCell(s.getBottom())),this._isRenderListUpToDate&&r.equals(i)?a=this._lastRenderList:(a=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,i.copy(r)),this._DrawInstances(e,a),a!==this._lastRenderList&&C33.shallowAssignArray(this._lastRenderList,a)}_DrawInstanceMaybeWithEffects(e,t,r,i){t.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(e,t,r,i):this._DrawInstance(e,t,r)}_DrawInstance(e,t,r){t=t.GetRendererStateGroup();r.GetCurrentStateGroup()!==t&&t.Apply(),e.Draw(r)}_DrawInstanceWithEffectsAndRestore(e,t,r,i){this._DrawInstanceWithEffects(e,t,r,i,null)&&this._SetTransform(r)}_DrawInstanceWithEffects(e,t,r,i,s){var a=t.GetInstanceEffectList().GetEffectChain();return a.Render(r,i,{contentObject:e,blendMode:t.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:e.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:t.GetBoundingBox(),drawSurfaceRect:a.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(t),drawContentHook:s&&s.drawContentHook,compositOffX:s&&s.compositOffX,compositOffY:s&&s.compositOffY,updateOwnProjection:s&&s.updateOwnProjection}),r.SetBaseZ(this.GetZElevation()),a.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(e,t,r,i){var s=this._effectList.GetActiveEffectTypes(),a=this._runtime;0===s.length?(e.SetRenderTarget(r),e.SetTextureFillMode(),i&&0===this._blendMode&&this.HasDefaultColor()?e.CopyRenderTarget(t):(e.SetBlendMode(this._blendMode),e.SetColor(this._premultipliedColor),e.DrawRenderTarget(t)),e.InvalidateRenderTarget(t),a.ReleaseAdditionalRenderTarget(t)):this.GetEffectChain().Render(e,r,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:a.GetEffectDevicePixelRatioParam(),layerScale:a.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(e){this._scale!==e&&(this._scale=e,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1}_MaybeUpdateViewport(){if(this._isViewportChanged){this._isViewportChanged=!1;var r=this._runtime.GetParallaxXOrigin(),i=this._runtime.GetParallaxYOrigin(),r=(this.GetScrollX()-r)*this._parallaxX+r,i=(this.GetScrollY()-i)*this._parallaxY+i,s=this.GetNormalScale(),a=this._runtime.GetViewportWidth()/s,s=this._runtime.GetViewportHeight()/s;let e=r-a/2,t=i-s/2;this._runtime.IsPixelRoundingEnabled()&&(e=Math.round(e),t=Math.round(t));r=this._viewportZ0,i=(r.set(e,t,e+a,t+s),this.GetAngle()),a=(0!==i&&(tmpRect.copy(r),tmpRect.offset(-r.midX(),-r.midY()),tmpQuad.setFromRotatedRect(tmpRect,i),tmpQuad.getBoundingBox(tmpRect),tmpRect.offset(r.midX(),r.midY()),r.copy(tmpRect)),this._zElevation);this.GetViewportForZ(a,this._viewport),this.Has3DCamera()?this.CalculateViewport3D(a,this._viewport3D):this._viewport3D.copy(this._viewport)}}CalculateViewport3D(e,t){var r=this._runtime.GetCanvasManager(),i=r.GetCssWidth(),r=r.GetCssHeight(),[s,a]=this.CanvasCssToLayer(0,0,e),[n,o]=this.CanvasCssToLayer(i,0,e),[i,l]=this.CanvasCssToLayer(i,r,e),[r,e]=this.CanvasCssToLayer(0,r,e);let h=Math.min(s,n,i,r),u=Math.min(a,o,l,e),c=Math.max(s,n,i,r),_=Math.max(a,o,l,e);isFinite(h)||(h=-1/0),isFinite(u)||(u=-1/0),isFinite(c)||(c=1/0),isFinite(_)||(_=1/0),t.set(h,u,c,_)}CanvasCssToLayer(e,t,r=0){return this._CanvasToLayer(e,t,r,this.GetDisplayScale())}DrawSurfaceToLayer(e,t,r=0){return this._CanvasToLayer(e,t,r,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(e,t,r,i){var s=this._runtime,a=s.GetRenderer(),n=this.GetNormalScale(),o=s.GetViewportWidth()/n,s=s.GetViewportHeight()/n,n=tempVec4,o=(vec42.set(n,0,0,o,s),e/=i,t=n[3]-t/i,this._GetProjectionMatrix(a)),s=this._GetModelViewMatrix(a),i=tempVec3;return C33.Gfx.UnprojectScreenToWorldZ(e,t,r,s,o,n,i)?[i[0],i[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(e,t){var r=this._scale,i=this._scaleRate,s=this._parallaxX,a=this._parallaxY,n=this._angle,e=(this._scale=1,this._scaleRate=1,this._parallaxX=1,this._parallaxY=1,this._angle=0,this._SetMVMatrixChanged(),this.CanvasCssToLayer(e,t));return this._scale=r,this._scaleRate=i,this._parallaxX=s,this._parallaxY=a,this._angle=n,this._SetMVMatrixChanged(),e}LayerToCanvasCss(e,t,r=0){return this._LayerToCanvas(e,t,r,this.GetDisplayScale())}LayerToDrawSurface(e,t,r=0){return this._LayerToCanvas(e,t,r,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(e,t,r,i){var s=this._runtime,a=s.GetRenderer(),n=this.GetNormalScale(),o=s.GetViewportWidth()/n,s=s.GetViewportHeight()/n,n=tempVec4,o=(vec42.set(n,0,0,o,s),this._GetProjectionMatrix(a)),s=this._GetModelViewMatrix(a),a=tempVec3;return C33.Gfx.Project(e,t,r,s,o,n,a)?[a[0]*i,(n[3]-a[1])*i]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(e,t){return e*=this.GetRenderScale()*this.GetDevicePixelRatio(),0!==t&&(e*=this.Get2DScaleFactorToZ(t)),e}_InstanceBoxToDrawSurface(e){var t,r,i,s,a,n,o=e.GetBoundingBox(),l=e.GetTotalZElevation(),e=e.GetDepth(),h=l+e,u=o.getLeft(),c=o.getTop(),_=o.getRight(),o=o.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(u,c,l)||this._IsPointBehindNearPlane(_,c,l)||this._IsPointBehindNearPlane(_,o,l)||this._IsPointBehindNearPlane(u,o,l))return null;if(0<e&&(this._IsPointBehindNearPlane(u,c,h)||this._IsPointBehindNearPlane(_,c,h)||this._IsPointBehindNearPlane(_,o,h)||this._IsPointBehindNearPlane(u,o,h)))return null}else if(h>=this.Get2DCameraZ())return null;let[d,p]=this.LayerToDrawSurface(u,c,l),[m,g]=this.LayerToDrawSurface(_,o,l);return(0!==this.GetAngle()||0<e||this.Has3DCamera())&&([t,r]=this.LayerToDrawSurface(_,c,l),[l,i]=this.LayerToDrawSurface(u,o,l),p=0<e?([e,s]=this.LayerToDrawSurface(u,c,h),[c,a]=this.LayerToDrawSurface(_,c,h),[_,n]=this.LayerToDrawSurface(_,o,h),[u,o]=this.LayerToDrawSurface(u,o,h),h=Math.min(d,m,t,l,e,c,_,u),m=Math.max(d,m,t,l,e,c,_,u),d=h,h=Math.min(p,g,r,i,s,a,n,o),g=Math.max(p,g,r,i,s,a,n,o),h):(e=Math.min(d,m,t,l),m=Math.max(d,m,t,l),d=e,e=Math.min(p,g,r,i),g=Math.max(p,g,r,i),e)),tmpRect.set(d,p,m,g),tmpRect}_GetViewFrustum(){return this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1),this._viewFrustum}_UpdateViewFrustum(){var e=this._runtime.GetRenderer(),t=this._GetProjectionMatrix(e),e=this._GetModelViewMatrix(e);this._viewFrustum.CalculatePlanes(e,t)}_IsPointBehindNearPlane(e,t,r){return this._GetViewFrustum().IsBehindNearPlane(e,t,r)}_SaveToJson(){return{d:this.IsDynamic(),s:this.GetOwnScale(),a:this.GetOwnAngle(),v:this._IsVisibleFlagSet(),i:this.IsInteractive(),html:this.IsHTMLElementsLayer(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids}}_LoadFromJson(e){this._isDynamic=!!e.d,this._scale=e.s,this._angle=e.a,this._isVisible=!!e.v,this._isInteractive=!e.hasOwnProperty("i")||e.i,this._isHTMLElementsLayer=!!e.html,this._backgroundColor.setFromJSON(e.bc),this._isTransparent=!!e.t,e.hasOwnProperty("sx")&&(this._scrollX=e.sx),e.hasOwnProperty("sy")&&(this._scrollY=e.sy),e.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!e.hosp),this._parallaxX=e.px,this._parallaxY=e.py,this._color.setFromJSON(e.c),this._UpdatePremultipliedColor(),this._scaleRate=e.sr,C33.shallowAssignArray(this._createdGlobalUids,e.cg),C33.shallowAssignArray(this._initialInstances,this._startupInitialInstances);var r=new Set(this._createdGlobalUids);let i=0;for(let e=0,t=this._initialInstances.length;e<t;++e)r.has(this._initialInstances[e][2])||(this._initialInstances[i]=this._initialInstances[e],++i);C33.truncateArray(this._initialInstances,i),this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0}_LoadFromJsonAfterInstances(){this._SortInstancesByLastCachedZIndex(!1),this.SetZIndicesChanged(),this._SetMVMatrixChanged(),this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(e,t=!1){if(this._instances.includes(e))t&&this._instances.sort((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex());else if(e.HasChildren()){var r,i,s,a=[...e.allChildren()];a.push(e),a.sort((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex());for(r of a)if(r.IsInContainer())for(var n of r.siblings())a.includes(n)||((i=[...n.allChildren()]).push(n),i.sort((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex()),i&&i.length&&a.splice(a.length,0,...i));for(s of a)s.GetPlugin().IsWorldType()&&this._AddInstance(s,!0)}else if(e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0),e.IsInContainer())for(var o of e.siblings()){var l=[...o.allChildren()];if(l.push(o),l.sort((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex()),l&&l.length)for(var h of l)h.GetPlugin().IsWorldType()&&this._AddInstance(h,!0)}}}}{let vec3EqualsXYZ2=function(e,t,r,i){return e[0]===Math.fround(t)&&e[1]===Math.fround(r)&&e[2]===Math.fround(i)},MaybePrepareLayerDraw2=function(e,t){lastLayerPreparedForDrawing!==e&&(e.PrepareForDraw(t),lastLayerPreparedForDrawing=e)},C33=(vec3EqualsXYZ=vec3EqualsXYZ2,MaybePrepareLayerDraw=MaybePrepareLayerDraw2,self.C3),C3Debugger=self.C3Debugger,assert=self.assert,tempDestRect=C33.New(C33.Rect),tempSrcRect=C33.New(C33.Rect),tempLayoutRect=C33.New(C33.Rect),tempColor=C33.New(C33.Color),glMatrix=self.glMatrix,vec32=glMatrix.vec3,tempRender3dList=[],tempInstanceList1=[],tempInstanceList2=[],tempInstanceList3=[],lastLayerPreparedForDrawing=null;C33.Layout=class Layout extends C33.DefendedBase{constructor(e,t,r){super(),this._layoutManager=e,this._runtime=e.GetRuntime(),this._name=r[0],this._originalWidth=r[1],this._originalHeight=r[2],this._width=r[1],this._height=r[2],this._isUnboundedScrolling=!!r[3],this._isOrthographicProjection=!!r[4],this._vanishingPointX=r[5],this._vanishingPointY=r[6],this._eventSheetName=r[7],this._eventSheet=null,this._sid=r[8],this._index=t,this._scrollX=0,this._scrollY=0,this._scale=1,this._angle=0,this._initialObjectClasses=new Set,this._textureLoadedTypes=new Set,this._textureLoadPendingPromises=new Set,this._createdInstances=[],this._createdPersistedInstances=[],this._createdPersistedInstancesToDataMap=new Map,this._createdPersistedIndexToInstanceMap=new Map,this._initialNonWorld=[],this._is3dCameraEnabled=!1,this._cam3dposition=vec32.create(),this._cam3dlook=vec32.create(),this._cam3dup=vec32.create(),this._rootLayers=[],this._allLayersFlat=[],this._layersByName=new Map,this._layersBySid=new Map,this._pendingSetHTMLLayerCount=-1;let i=this._runtime.GetCanvasManager();this._effectList=C33.New(C33.EffectList,this,r[11]),this._effectChain=C33.New(C33.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{t=t.GetContentObject().GetRenderTarget();e.ResetColor(),e.DrawRenderTarget(t),e.InvalidateRenderTarget(t),i.ReleaseAdditionalRenderTarget(t)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasFullScreenQualityLow=!1,this._curRenderTarget=null,this._persistData={},this._persistedIntances=new Map,this._isFirstVisit=!0,this._iLayout=new self.ILayout(this),this._userScriptDispatcher=C33.New(C33.Event.Dispatcher);for(var s of r[9])this._rootLayers.push(C33.Layer.CreateFromExportData(this,null,s));this._ReindexLayers();for(var a of this.allLayers())a._InitInitialInstances();for(var n of r[10]){var o=this._runtime.GetObjectClassByIndex(n[1]);if(!o)throw new Error("missing nonworld object class");o.GetDefaultInstanceData()||o.SetDefaultInstanceData(n),this._initialNonWorld.push(n),this._AddInitialObjectClass(o)}}Release(){for(var e of this._allLayersFlat)e.Release();C33.clearArray(this._allLayersFlat),this._textureLoadPendingPromises.clear(),this._eventSheet=null,this._layoutManager=null,this._runtime=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){var e,t="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();(this._needsRebuildEffectChainSteps||this._wasFullScreenQualityLow!==t||this._effectChain.NeedsRebuild())&&(e=this.GetEffectList().GetActiveEffectTypes(),this._effectChain.BuildSteps(e.map(e=>e.GetShaderProgram()),{indexMap:e.map(e=>e.GetIndex()),forcePostDraw:t,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasFullScreenQualityLow=t)}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let r=this._allLayersFlat[0].GetNormalScale();for(let e=1,t=this._allLayersFlat.length;e<t;++e){var i=this._allLayersFlat[e];0===i.GetParallaxX()&&0===i.GetParallaxY()||(r=Math.min(r,i.GetNormalScale()))}return r}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?1/0:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?1/0:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(e){var t=this.GetScrollLeftBound(),r=this.GetScrollRightBound();this._scrollX!==(e=(e=r<e?r:e)<t?t:e)&&(this._scrollX=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(e){var t=this.GetScrollTopBound(),r=this.GetScrollBottomBound();this._scrollY!==(e=(e=r<e?r:e)<t?t:e)&&(this._scrollY=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX()),this.SetScrollY(this.GetScrollY());for(var e of this._allLayersFlat)e.IsOwnScrollPositionEnabled()&&(e.SetScrollX(e.GetScrollX()),e.SetScrollY(e.GetScrollY()))}SetVanishingPointXY(e,t){this._vanishingPointX===e&&this._vanishingPointY===t||(this._vanishingPointX=e,this._vanishingPointY=t,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender()))}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){var e=this.GetVanishingPointX(),t=this.GetVanishingPointY();return e<0||1<e||t<0||1<t}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){this._is3dCameraEnabled!==(e=!!e)&&(this._is3dCameraEnabled=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(e,t,r,i,s,a,n,o,l){vec3EqualsXYZ2(this._cam3dposition,e,t,r)&&vec3EqualsXYZ2(this._cam3dlook,i,s,a)&&vec3EqualsXYZ2(this._cam3dup,n,o,l)||(vec32.set(this._cam3dposition,e,t,r),vec32.set(this._cam3dlook,i,s,a),vec32.set(this._cam3dup,n,o,l),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged(),this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(e){this._scale!==e&&(this._scale=e,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(e){e=C33.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(e){!isFinite(e)||e<1||(this._width=e)}GetHeight(){return this._height}SetHeight(e){!isFinite(e)||e<1||(this._height=e)}GetEventSheet(){return this._eventSheet}_GetRootLayers(){return this._rootLayers}*allLayers(){for(var e of this._rootLayers)yield*e.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(e){return"number"==typeof e?this.GetLayerByIndex(e):this.GetLayerByName(e.toString())}GetLayerByIndex(e){return e=C33.clamp(Math.floor(e),0,this._allLayersFlat.length-1),this._allLayersFlat[e]}GetLayerByName(e){return this._layersByName.get(e.toLowerCase())||null}HasLayerByName(e){return!!this.GetLayerByName(e)}GetLayerBySID(e){return this._layersBySid.get(e)||null}_SetAllLayersProjectionChanged(){for(var e of this._allLayersFlat)e._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(var e of this._allLayersFlat)e._SetMVMatrixChanged()}AddLayer(e,t,r){if(this.HasLayerByName(e))throw new Error(`layer name '${e}' already in use`);if(!t&&r<2)throw new Error("invalid insert position");var i=2<=r?t:t.GetParentLayer(),i=C33.New(C33.Layer,this,i,{name:e,sid:Math.floor(1e15*Math.random()),isDynamic:!0});this._InsertLayer(i,t,r),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers()}MoveLayer(e,t,r){if(!t&&r<2)throw new Error("invalid insert position");e===t&&r<2||(this._RemoveLayer(e),this._InsertLayer(e,t,r),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers())}RemoveLayer(e){var t;this._RemoveLayer(e)&&((t=this._runtime.GetEventSheetManager()).BlockFlushingInstances(!0),e.Release(),t.BlockFlushingInstances(!1),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers())}RemoveAllDynamicLayers(){var e,t=new Set;for(e of this.allLayers())e.IsDynamic()&&!e.HasAnyDynamicParentLayer()&&t.add(e);if(0!==t.size){var r,i=this._runtime.GetEventSheetManager();i.BlockFlushingInstances(!0);for(r of t)this._RemoveLayer(r),r.Release();i.BlockFlushingInstances(!1),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers()}}_InsertLayer(t,r,i){if(2<=i)if(r){if(r===t||r.HasParentLayer(t))throw new Error(`cannot move layer '${t.GetName()}' to sub-layer of itself`);r._AddSubLayer(t,2===i),t._SetParentLayer(r)}else 2===i?this._rootLayers.push(t):this._rootLayers.unshift(t),t._SetParentLayer(null);else{var e=r.GetParentLayer();if(e){if(r.HasParentLayer(t))throw new Error(`cannot move layer '${t.GetName()}' to sub-layer of itself`);e._InsertSubLayer(t,r,0===i),t._SetParentLayer(e)}else{let e=this._rootLayers.indexOf(r);if(-1===e)throw new Error("cannot find layer to insert by");0===i&&++e,this._rootLayers.splice(e,0,t),t._SetParentLayer(null)}}}_RemoveLayer(e){var t=e.GetParentLayer();if(t)return t._RemoveSubLayer(e),!0;if(1<this._rootLayers.length){t=this._rootLayers.indexOf(e);if(-1===t)throw new Error("cannot find layer to remove");return this._rootLayers.splice(t,1),!0}return!1}_ReindexLayers(){this._allLayersFlat=[...this.allLayers()],this._layersByName.clear(),this._layersBySid.clear();for(let e=0,t=this._allLayersFlat.length;e<t;++e){var r=this._allLayersFlat[e];r._SetIndex(e),this._layersByName.set(r.GetName().toLowerCase(),r),this._layersBySid.set(r.GetSID(),r)}}_ReindexHTMLLayers(){let e=0;for(var t of this._rootLayers){for(var r of t.selfAndAllSubLayers())r._SetHTMLIndex(e);t.IsHTMLElementsLayer()&&e++}}GetHTMLLayerCount(){return this._rootLayers.at(-1).GetHTMLIndex()+1}async _ReindexAndUpdateAllLayers(){this._ReindexLayers(),this._ReindexHTMLLayers(),this._pendingSetHTMLLayerCount=this.GetHTMLLayerCount()}_GetPendingSetHTMLLayerCount(){return this._pendingSetHTMLLayerCount}_ResetPendingHTMLLayerCount(){this._pendingSetHTMLLayerCount=-1}GetRootLayersForHTMLLayer(e){var t,r=[];for(t of this._rootLayers){var i=t.GetHTMLIndex();if(i===e)r.push(t);else if(e<i)break}return r}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(e){this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this.SetScale(e.scale),this.SetAngle(e.angle),this.SetVanishingPointXY(e.vpX,e.vpY)}GetLayoutBackgroundColor(){let e=this._rootLayers.filter(e=>e.ShouldDraw())[0];for(;e;){if(!e.IsTransparent())return tempColor.copyRgb(e.GetBackgroundColor()),tempColor.setA(1),tempColor;if(e.UsesOwnTexture())return tempColor.setRgba(0,0,0,0),tempColor;e=e.GetSubLayers().filter(e=>e.ShouldDraw())[0]}return tempColor.setRgba(0,0,0,0),tempColor}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(e){if(e.IsInContainer())for(var t of e.GetContainer().GetObjectTypes())this._initialObjectClasses.add(t);else this._initialObjectClasses.add(e)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(e,t){if(e===this||!t)return Promise.resolve();e&&(C33.CopySet(this._textureLoadedTypes,e._textureLoadedTypes),e._textureLoadedTypes.clear());var r,i=[];for(r of this._initialObjectClasses)this._textureLoadedTypes.has(r)||(i.push(r.LoadTextures(t)),this._textureLoadedTypes.add(r));return Promise.all(i)}async MaybeLoadTexturesFor(e){if(e.IsFamily())throw new Error("cannot load textures for family");var t=this._runtime.GetRenderer();!t||t.IsContextLost()||this._textureLoadedTypes.has(e)||(this._textureLoadedTypes.add(e),t=e.LoadTextures(t),this._AddPendingTextureLoadPromise(t),await t,e.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender())}_AddPendingTextureLoadPromise(e){this._textureLoadPendingPromises.add(e),e.then(()=>this._textureLoadPendingPromises.delete(e)).catch(()=>this._textureLoadPendingPromises.delete(e))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(e){if(e.IsFamily()||0<e.GetInstanceCount())throw new Error("cannot unload textures");var t=this._runtime.GetRenderer();t&&this._textureLoadedTypes.has(e)&&(this._textureLoadedTypes.delete(e),e.ReleaseTextures(t))}_Unload(e,t){if(e!==this&&t)for(var r of this._textureLoadedTypes)r.IsGlobal()||e._initialObjectClasses.has(r)||(r.ReleaseTextures(),this._textureLoadedTypes.delete(r))}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(e){var t=this._runtime,r=this._layoutManager,i=t.GetEventSheetManager(),s=(this._eventSheetName&&(this._eventSheet=i.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes()),r._SetMainRunningLayout(this),this._width=this._originalWidth,this._height=this._originalHeight,this._scrollX=t.GetOriginalViewportWidth()/2,this._scrollY=t.GetOriginalViewportHeight()/2,this.BoundScrolling(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._ReindexHTMLLayers(),await this._runtime.GetCanvasManager().SetHTMLLayerCount(this.GetHTMLLayerCount(),!0),this._MoveGlobalObjectsToThisLayout(e),this._runtime.SetUsingCreatePromises(!0),this._CreateInitialInstances(),this._isFirstVisit||this._CreatePersistedInstances(),this._CreateAndLinkContainerInstances(this._createdInstances),this._CreateAndLinkContainerInstances(this._createdPersistedInstances),this._CreateInitialNonWorldInstances(),r.ClearPendingChangeLayout(),t.FlushPendingInstances(),this._runtime.SetUsingCreatePromises(!1),this._runtime.GetCreatePromises());if(await Promise.all(s),C33.clearArray(s),!t.IsLoadingState()){for(var a of this._createdInstances)a.SetupInitialSceneGraphConnections();for(var n of this._createdPersistedInstances)n.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(var[o,l]of Object.entries(this._persistData)){o=this._runtime.GetObjectClassBySID(parseInt(o,10));o&&!o.IsFamily()&&o.HasPersistBehavior()&&C33.clearArray(l)}for(var h of this._createdInstances)h._TriggerOnCreated();for(var u of this._createdPersistedInstances)u._TriggerOnCreated()}C33.clearArray(this._createdInstances),C33.clearArray(this._createdPersistedInstances),this._createdPersistedInstancesToDataMap.clear(),this._createdPersistedIndexToInstanceMap.clear(),await Promise.all([...this._initialObjectClasses].map(e=>e.PreloadTexturesWithInstances(this._runtime.GetRenderer()))),e&&(t.Dispatcher().dispatchEvent(new C33.Event("beforefirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C33.Event("beforeprojectstart"))),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("beforeanylayoutstart")),t.Dispatcher().dispatchEvent(new C33.Event("beforelayoutstart")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("beforelayoutstart")),t.IsLoadingState()||await t.TriggerAsync(C33.Plugins.System.Cnds.OnLayoutStart,null,null),t.Dispatcher().dispatchEvent(new C33.Event("afterlayoutstart")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("afterlayoutstart")),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("afteranylayoutstart")),e&&(t.Dispatcher().dispatchEvent(new C33.Event("afterfirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C33.Event("afterprojectstart"))),i._RunQueuedTriggers(r),await this.WaitForPendingTextureLoadsToComplete(),this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(e){for(var t of this._runtime.GetAllObjectClasses())if(!t.IsFamily()&&t.IsWorldType())for(var r of t.GetInstances()){var i=r.GetWorldInfo(),s=i.GetLayer(),s=C33.clamp(s.GetIndex(),0,this._allLayersFlat.length-1),s=this._allLayersFlat[s];i._SetLayer(s,!0),s._MaybeAddInstance(r)}if(!e)for(var a of this._allLayersFlat)a._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(var e of this._allLayersFlat)e.CreateInitialInstances(this._createdInstances),e._Start()}_CreatePersistedInstances(){let t=!1;for(var[e,r]of Object.entries(this._persistData)){var i,s=this._runtime.GetObjectClassBySID(parseInt(e,10));if(s&&!s.IsFamily()&&s.HasPersistBehavior())for(var a of r){let e=null;s.IsWorldType()&&!(e=a.hasOwnProperty("instJson")?this.GetLayerBySID(a.instJson.w.l):this.GetLayerBySID(a.w.l))||(i=this._runtime.CreateInstanceFromData(s,e,!1,0,0,!0),a.hasOwnProperty("instJson")?i.LoadFromJson(a.instJson):i.LoadFromJson(a),t=!0,this._createdPersistedInstances.push(i),a.hasOwnProperty("instJson")&&(this._createdPersistedInstancesToDataMap.set(i,a),this._createdPersistedIndexToInstanceMap.set(a.index,i)))}}for(var n of this._allLayersFlat)n._SortInstancesByLastCachedZIndex(!0),n.SetZIndicesChanged();t&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(t){for(var r of t)if(r.IsInContainer()){var i,s=r.GetWorldInfo(),e=r.GetIID();for(i of r.GetObjectClass().GetContainer().objectTypes())if(i!==r.GetObjectClass()){var a=i.GetInstances();if(a.length>e)r._AddSibling(a[e]);else{let e;e=s?this._runtime.CreateInstanceFromData(i,s.GetLayer(),!0,s.GetX(),s.GetY(),!0):this._runtime.CreateInstanceFromData(i,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),i._UpdateIIDs(),r._AddSibling(e),t.push(e)}}}}_CreateInitialNonWorldInstances(){for(var e of this._initialNonWorld)this._runtime.GetObjectClassByIndex(e[1]).IsInContainer()||this._runtime.CreateInstanceFromData(e,null,!0)}_CreateGlobalNonWorlds(){var r=[],i=this._initialNonWorld;let s=0;for(let e=0,t=i.length;e<t;++e){var a=i[e],n=this._runtime.GetObjectClassByIndex(a[1]);n.IsGlobal()?n.IsInContainer()&&n.GetContainer().HasAnyWorldType()||r.push(this._runtime.CreateInstanceFromData(a,null,!0)):(i[s]=a,++s)}C33.truncateArray(i,s),this._runtime.FlushPendingInstances(),this._CreateAndLinkContainerInstances(r)}RecreateInitialObjects(e,t,r,i,s,a,n){if(r)return r.RecreateInitialObjects(e,t,s,a,i,n);var o,l=[];for(o of this._allLayersFlat)l.push(o.RecreateInitialObjects(e,t,s,a,i,n));return l.flat()}async _StopRunning(){var e,t,r=this._layoutManager;this._runtime.IsLoadingState()||(await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("beforeanylayoutend")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("beforelayoutend")),await this._runtime.TriggerAsync(C33.Plugins.System.Cnds.OnLayoutEnd,null,null),await this.DispatchUserScriptEventAsyncWait(new C33.Event("afterlayoutend")),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("afteranylayoutend"))),r.SetIsEndingLayout(!0),this._runtime.GetEventSheetManager().ClearAllScheduledWaits(),this._isFirstVisit||this._SavePersistData();for(e of this._allLayersFlat)e._End();for(t of this._runtime.GetAllObjectClasses())if(!(t.IsGlobal()||t.IsWorldType()||t.GetPlugin().IsSingleGlobal()||t.IsFamily())){for(var i of t.GetInstances())this._runtime.DestroyInstance(i);this._runtime.FlushPendingInstances()}r.SetIsEndingLayout(!1),r.GetMainRunningLayout()===this&&r._SetMainRunningLayout(null)}_SaveInstanceToPersist(e,t){var r=e.GetObjectClass().GetSID().toString(),r=(this._persistData.hasOwnProperty(r)||(this._persistData[r]=[]),this._persistData[r]),t={index:t,instJson:e.SaveToJson(),sceneGraphJson:{children:[]}};r.push(t),this._persistedIntances.set(e,t)}_SaveSceneGraphInfoToPersist(e){var t,r=this._persistedIntances.get(e);for(t of e.GetChildren()){var i=this._persistedIntances.get(t);i&&r.sceneGraphJson.children.push({index:i.index,flags:C33.SceneGraphInfo._GetFlagsNumber(t.GetWorldInfo())})}}_SavePersistData(){this._persistedIntances.clear();let e=0;for(var t of this._allLayersFlat){t._UpdateZIndices();for(var r of t._GetInstances()){var i=r.GetObjectClass();!i.IsGlobal()&&i.HasPersistBehavior()&&(this._SaveInstanceToPersist(r,e),e++)}}for(var s of this._allLayersFlat)for(var a of s._GetInstances()){var n=a.GetObjectClass();!n.IsGlobal()&&n.HasPersistBehavior()&&this._SaveSceneGraphInfoToPersist(a)}this._persistedIntances.clear()}ResetPersistData(){this._persistData={},this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){var e=this._runtime,t=e.GetRenderer().IsWebGL();return"low"===e.GetCanvasManager().GetCurrentFullscreenScalingQuality()||t&&e.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect()||t&&e.Uses3DFeatures()}_MaybeStartDrawToOwnTexture(e){var t=this._runtime.GetCanvasManager();this.UsesOwnTexture()?(e.SetRenderTarget(null),e.ClearRgba(0,0,0,0),e={sampling:this._runtime.GetSampling(),isSampled:e.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()},"low"===t.GetCurrentFullscreenScalingQuality()&&(e.width=t.GetDrawWidth(),e.height=t.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(e)):this._curRenderTarget=null}_MaybeCopyOwnTextureToBackbuffer(e){this._runtime._NeedsHTMLLayerCompositing(e)&&(e.SetDepthEnabled(!1),e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(this._curRenderTarget))}_MaybeEndDrawToOwnTexture(e){this.UsesOwnTexture()&&(e.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(e,this._curRenderTarget))}DrawMain(e){e.SetRenderTarget(this._curRenderTarget),e.Clear(this.GetLayoutBackgroundColor()),this._runtime.Uses3DFeatures()&&e.ClearDepth();var t=this.GetRootLayersForHTMLLayer(0);this._DrawLayerList(e,this._curRenderTarget,t,!0),e.IsWebGPU()&&e.StartMeasuringRenderPassTime(0,1),this._MaybeEndDrawToOwnTexture(e),this._curRenderTarget=null}DrawForHTMLLayerIndex(e,t){let r=null;this._runtime._NeedsHTMLLayerCompositing(e)&&(r=this._curRenderTarget),e.SetRenderTarget(r),e.ClearRgba(0,0,0,0),this._runtime.Uses3DFeatures()&&e.ClearDepth();var i=this.GetRootLayersForHTMLLayer(t);this._DrawLayerList(e,r,i,!0),this._MaybeCopyOwnTextureToBackbuffer(e),e.EndBatch(),this._runtime.GetCanvasManager().BlitMainCanvasToHTMLLayerCanvas(t)}_DrawLayerList(e,i,t,s){var a=t.filter(e=>e.ShouldDraw());for(let t=0,r=a.length;t<r;){var n=a[t];if(n.SelfAndAllSubLayersHave3DCamera()&&!n.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(n);for(let e=t+1;e<r;++e){var o=a[e];if(!o.SelfAndAllSubLayersHave3DCamera()||o.SelfOrAnySubLayerUsesOwnTexture())break;tempRender3dList.push(a[e])}if(2<=tempRender3dList.length||1===tempRender3dList.length&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(e,i,tempRender3dList),t+=tempRender3dList.length,C33.clearArray(tempRender3dList);continue}C33.clearArray(tempRender3dList)}n.Draw(e,i,s&&0===t),++t}}_DrawLayoutOwnTextureToRenderTarget(e,t){var r=this._effectList.GetActiveEffectTypes(),i=this._runtime;0===r.length?(e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(t),e.InvalidateRenderTarget(t),i.ReleaseAdditionalRenderTarget(t)):(tempLayoutRect.set(0,0,i.GetViewportWidth(),i.GetViewportHeight()),this.GetEffectChain().Render(e,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(i,s,e){e[0].IsTransparent()||(tempColor.copyRgb(e[0].GetBackgroundColor()),tempColor.setA(1),i.Clear(tempColor));this._runtime.GetCanvasManager();i.SetDepthEnabled(!0);var t,a=tempInstanceList1,n=tempInstanceList2,o=tempInstanceList3;for(t of e)t._UpdateZIndices(),t._AppendAllInstancesIncludingSubLayersInDrawOrder(a);var e=e[0],r=e._MaybeStartWebGLProfiling(i);e._MaybeStartWebGPUProfiling(i);for(let t=0,r=a.length;t<r;){var l=a[t],h=l.GetWorldInfo(),u=h.GetLayer();if(h.IsVisible()&&h.IsInViewport3D(u._GetViewFrustum())){(!l.RendersToOwnZPlane()||0<h.GetDepth())&&o.push(l);var c=l.GetWorldInfo().GetTotalZElevation();n.push(l);let e=t+1;for(;e<r;++e){var _=a[e],d=_.GetWorldInfo();if(d.IsVisible()&&d.IsInViewport3D(d.GetLayer()._GetViewFrustum())){if(d.GetTotalZElevation()!==c)break;(_.RendersToOwnZPlane()?(0<d.GetDepth()&&o.push(_),n):o).push(_)}}if(1!==n.length||n[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(i,s,n);for(let e=0,t=o.length;e<t;++e){var p=o[e],m=p.GetWorldInfo(),g=m.GetLayer();m._SetDrawNonBackFacesOnly(!0),MaybePrepareLayerDraw2(g,i),g._DrawInstanceMaybeWithEffects(p,m,i,s),m._SetDrawNonBackFacesOnly(!1)}}else{MaybePrepareLayerDraw2(u,i),u._DrawInstanceMaybeWithEffects(l,h,i,s);for(let e=0,t=o.length;e<t;++e){var f,S,C=o[e];C!==l&&(S=(f=C.GetWorldInfo()).GetLayer(),MaybePrepareLayerDraw2(S,i),S._DrawInstanceMaybeWithEffects(C,f,i,s))}}t=e,C33.clearArray(n),C33.clearArray(o)}else++t}r&&i.EndQuery(r),C33.clearArray(a),lastLayerPreparedForDrawing=null}_Draw3DLayersCoplanarInstances(r,i,s){r.CoplanarStartStencilPass();for(let e=0,t=s.length;e<t;++e){var a=s[e],n=a.GetWorldInfo(),o=n.GetLayer();n._SetDrawBackFaceOnly(!0),MaybePrepareLayerDraw2(o,r),o._DrawInstance(a,n,r)}r.CoplanarStartColorPass();for(let e=0,t=s.length;e<t;++e){var l=s[e],h=l.GetWorldInfo(),u=h.GetLayer();MaybePrepareLayerDraw2(u,r),u._DrawInstanceMaybeWithEffects(l,h,r,i),h._SetDrawBackFaceOnly(!1)}r.CoplanarRestoreStandardRendering()}_SaveToJson(){var e,t,r={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{},dynamicLayers:[]};for(e of this._allLayersFlat)e.IsDynamic()?(t=e.GetParentLayer(),r.dynamicLayers.push({sid:e.GetSID(),name:e.GetName(),parentSid:t?t.GetSID():null,siblingIndex:e._GetSiblingIndex(),data:e._SaveToJson()})):r.layers[e.GetSID().toString()]=e._SaveToJson();return r}_LoadFromJson(e){this._scrollX=e.sx,this._scrollY=e.sy,this._scale=e.s,this._angle=e.a,this._width=e.w,this._height=e.h,this._isOrthographicProjection=!!e.ortho,e.hasOwnProperty("vpX")&&(this._vanishingPointX=e.vpX),e.hasOwnProperty("vpY")&&(this._vanishingPointY=e.vpY),this._isFirstVisit=!!e.fv,this._persistData=e.persist,this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0;for(var[t,r]of Object.entries(e.layers)){t=parseInt(t,10),t=this.GetLayerBySID(t);t&&t._LoadFromJson(r)}if(e.hasOwnProperty("dynamicLayers")){this.RemoveAllDynamicLayers(),this._runtime.FlushPendingInstances();var i,s,a=new Map,n=e.dynamicLayers;for(let e=n.length-1;0<=e;--e){var o=n[e],l=o.sid,h=o.name,u=o.parentSid,c=o.siblingIndex,o=o.data;if(this._ReindexLayers(),!this.HasLayerByName(h)&&!this.GetLayerBySID(l)){let e,t;if(null===u)e=null,t=this._rootLayers;else{if(!(e=this.GetLayerBySID(u)))continue;t=e.GetSubLayers()}u=C33.New(C33.Layer,this,e,{name:h,sid:l,isDynamic:!0});t.push(u);let r=a.get(t);r||(r=[],a.set(t,r)),r.push({layer:u,siblingIndex:c}),u._LoadFromJson(o)}}for([i,s]of a){s.sort((e,t)=>e.siblingIndex-t.siblingIndex);for(var _ of s){var d=_.layer,_=_.siblingIndex,p=i.indexOf(d);i.splice(p,1),i.splice(_,0,d)}}}this._ReindexAndUpdateAllLayers(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();var t=this._runtime,t=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine();t&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}DispatchRuntimeUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._runtime.DispatchUserScriptEventAsyncWait(e)}_LogLayerTree(){this._LogLayerList(this._rootLayers)}_LogLayerList(e,t=0){var r,e=e.slice(0);e.reverse();for(r of e)console.log("\t".repeat(t)+"- "+r.GetName()),this._LogLayerList(r.GetSubLayers(),t+1)}}}{let C33=self.C3;C33.LayoutManager=class LayoutManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._allLayouts=[],this._layoutsByName=new Map,this._layoutsBySid=new Map,this._mainRunningLayout=null,this._runningSubLayouts=[],this._firstLayout=null,this._isEndingLayout=0,this._pendingChangeLayout=null}Release(){this._runtime=null,this._mainRunningLayout=null,this._firstLayout=null,this._pendingChangeLayout=null,C33.clearArray(this._allLayouts),this._layoutsByName.clear(),this._layoutsBySid.clear(),C33.clearArray(this._runningSubLayouts)}Create(e){e=C33.New(C33.Layout,this,this._allLayouts.length,e);this._allLayouts.push(e),this._layoutsByName.set(e.GetName().toLowerCase(),e),this._layoutsBySid.set(e.GetSID(),e)}GetRuntime(){return this._runtime}SetFirstLayout(e){this._firstLayout=e}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw new Error("no first layout")}GetLayoutByName(e){return this._layoutsByName.get(e.toLowerCase())||null}GetLayoutBySID(e){return this._layoutsBySid.get(e)||null}GetLayoutByIndex(e){return e=C33.clamp(Math.floor(e),0,this._allLayouts.length-1),this._allLayouts[e]}GetLayout(e){return"number"==typeof e?this.GetLayoutByIndex(e):this.GetLayoutByName(e.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(e){this._mainRunningLayout=e}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(e){if(this._runningSubLayouts.includes(e))throw new Error("layout already running");this._runningSubLayouts.push(e)}_RemoveRunningSubLayout(e){e=this._runningSubLayouts.indexOf(e);if(-1===e)throw new Error("layout not running");this._runningSubLayouts.splice(e,1)}*runningLayouts(){this._mainRunningLayout&&(yield this._mainRunningLayout),this._runningSubLayouts.length&&(yield*this._runningSubLayouts)}IsLayoutRunning(e){return this._mainRunningLayout===e||this._runningSubLayouts.includes(e)}SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(this._isEndingLayout<=0)throw new Error("already unset");this._isEndingLayout--}}IsEndingLayout(){return 0<this._isEndingLayout}ChangeMainLayout(e){this._pendingChangeLayout=e}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){var e=this.GetMainRunningLayout();e&&e._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){var e=this.GetMainRunningLayout();e&&e._SetAllLayersMVChanged()}}}{let C33=self.C3,NAMES_REGEXP=new RegExp("<(.+?)>","g");C33.TimelineManager=class TimelineManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._timelineDataManager=C33.New(C33.TimelineDataManager),this._pluginInstance=null,this._timelines=[],this._timelinesByName=new Map,this._objectClassToTimelineMap=new Map,this._timelinesCreatedByTemplate=new Map,this._scheduledTimelines=[],this._playingTimelines=[],this._markedForRemovalTimelines=[],this._hasRuntimeListeners=!1,this._changingLayout=!1,this._isTickingTimelines=!1,this._tickFunc=()=>this._OnTick(),this._tick2Func=()=>this._OnTick2(),this._beforeLayoutChange=()=>this._OnBeforeChangeLayout(),this._layoutChange=()=>this._OnAfterChangeLayout(),this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance),this._beforeLoad=e=>this._OnBeforeLoad(),this._afterLoad=e=>this._OnAfterLoad(),this._afterLayoutStart=e=>this._OnAfterLayoutStart(),this._destroyedWhileLoadingState=[],this._renderChange=0}Release(){this.RemoveRuntimeListeners(),this._tickFunc=null,this._tick2Func=null,this._beforeLayoutChange=null,this._layoutChange=null,this._instanceDestroy=null,this._afterLoad=null;for(var e of this._timelines)e.Stop(),e.Release();C33.clearArray(this._timelines),this._timelines=null,this._timelineDataManager.Release(),this._timelineDataManager=null,C33.clearArray(this._scheduledTimelines),this._scheduledTimelines=null,C33.clearArray(this._playingTimelines),this._playingTimelines=null,C33.clearArray(this._markedForRemovalTimelines),this._markedForRemovalTimelines=null,this._timelinesByName.clear(),this._timelinesByName=null,this._objectClassToTimelineMap.clear(),this._objectClassToTimelineMap=null,this._timelinesCreatedByTemplate.clear(),this._timelinesCreatedByTemplate=null,C33.clearArray(this._destroyedWhileLoadingState),this._destroyedWhileLoadingState=null,this._runtime=null}AddRuntimeListeners(){var e=this._runtime.Dispatcher();e.addEventListener("pretick",this._tickFunc),e.addEventListener("tick2",this._tick2Func),e.addEventListener("beforelayoutchange",this._beforeLayoutChange),e.addEventListener("layoutchange",this._layoutChange),e.addEventListener("instancedestroy",this._instanceDestroy),e.addEventListener("beforeload",this._beforeLoad),e.addEventListener("afterload",this._afterLoad),e.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){var e=this._runtime.Dispatcher();e.removeEventListener("pretick",this._tickFunc),e.removeEventListener("tick2",this._tick2Func),e.removeEventListener("beforelayoutchange",this._beforeLayoutChange),e.removeEventListener("layoutchange",this._layoutChange),e.removeEventListener("instancedestroy",this._instanceDestroy),e.removeEventListener("beforeload",this._beforeLoad),e.removeEventListener("afterload",this._afterLoad),e.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(e){this._timelineDataManager.Add(e);e=C33.TimelineState.CreateInitial(e,this);this.Add(e),this.SetTimelineObjectClassesToMap(e),this._timelinesCreatedByTemplate.set(e.GetName(),0)}CreateFromTemplate(e){var t=this.GetTimelineDataManager(),e=e.GetTemplateName(),t=t.Get(e),t=C33.TimelineState.CreateFromTemplate(e+":"+this._timelinesCreatedByTemplate.get(e),t,this);return this._IncreaseTemplateTimelinesCount(e),this.Add(t),t}_IncreaseTemplateTimelinesCount(e){this._timelinesCreatedByTemplate.set(e,this._timelinesCreatedByTemplate.get(e)+1)}_SetCreatedTemplateTimelinesCount(){for(var e of this._timelines)e.IsTemplate()||(e=e.GetTemplateName(),this._IncreaseTemplateTimelinesCount(e))}_ClearCreatedTemplateTimelinesCount(){for(var e of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(e,0)}Add(e){this._timelines.push(e),this._timelinesByName.set(e.GetName().toLowerCase(),e)}Remove(e){e.Removed(),e.IsTemplate()||(C33.arrayFindRemove(this._timelines,e),C33.arrayFindRemove(this._scheduledTimelines,e),C33.arrayFindRemove(this._playingTimelines,e),C33.arrayFindRemove(this._markedForRemovalTimelines,e),this._timelinesByName.delete(e.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(e),e.IsReleased())||e.Release()}Trigger(e){this._runtime.Trigger(e,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(e){this._pluginInstance=e}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(var e of this._timelines)yield e}*GetPlayingTimelines(){for(var e of this._playingTimelines)yield e}SetTimelineObjectClassToMap(e,t){this._objectClassToTimelineMap.has(e)||this._objectClassToTimelineMap.set(e,new Set),this._objectClassToTimelineMap.get(e).add(t)}SetTimelineObjectClassesToMap(e){for(var t of e.GetObjectClasses())this.SetTimelineObjectClassToMap(t,e)}RemoveTimelineFromObjectClassMap(e){for(var[t,r]of this._objectClassToTimelineMap.entries())r.has(e)&&(r.delete(e),0===r.size)&&this._objectClassToTimelineMap.delete(t)}GetTimelinesForObjectClass(e){if(this._objectClassToTimelineMap.has(e))return this._objectClassToTimelineMap.get(e)}GetTimelineOfTemplateForInstances(e,r){if(r)for(let t of this._timelines){var i=r.every(e=>t.HasTrackInstance(e.instance,e.trackId));if(i&&t.GetName().includes(e.GetName()))return t}}GetTimelineByName(e){return this._timelinesByName.get(e.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(e){for(var t of this._scheduledTimelines)if(t.GetName()===e)return t;for(var r of this._playingTimelines)if(r.GetName()===e)return r;return null}*GetTimelinesByName(e){if(NAMES_REGEXP.test(e)){NAMES_REGEXP.lastIndex=0;var t,r=new Set;do{var i,s=NAMES_REGEXP.exec(e);if(s)for(i of s[1].split(","))r.add(i)}while(s);for(t of r.values()){var a=this.GetTimelineByName(t);a&&(yield a)}r.clear()}else{var n=this.GetTimelineByName(e);n&&(yield n)}}*GetTimelinesByTags(e){for(var t of this._timelines)t.HasTags(e)&&(yield t)}AddScheduledTimeline(e){this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e),this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(e){C33.arrayFindRemove(this._playingTimelines,e),this._MaybeDisableRuntimeListeners()}ScheduleTimeline(e){this._playingTimelines.includes(e)?(e.SetPlaying(!0),e.SetScheduled(!1),e.SetMarkedForRemoval(!1)):(e.SetPlaying(!1),e.SetScheduled(!0),e.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e)),this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),e.ResolvePlayPromise(),C33.arrayFindRemove(this._scheduledTimelines,e),this._MaybeDisableRuntimeListeners()}CompleteTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),this._playingTimelines.includes(e)&&(e.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(e),C33.arrayFindRemove(this._playingTimelines,e)),this._scheduledTimelines.includes(e)&&e.SetMarkedForRemoval(!0)}CompleteTimelineBeforeChangeOfLayout(e){e.SetPlaying(!1),e.SetScheduled(!1),e.SetMarkedForRemoval(!1),e.SetPlaybackRate(1),C33.arrayFindRemove(this._playingTimelines,e)}CompleteTimelineAndResolve(e){this.CompleteTimeline(e),e.ResolvePlayPromise()}_OnTick(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){var e=this._scheduledTimelines.pop();(e.IsMarkedForRemoval()?(e.SetInitialStateForce(),this._markedForRemovalTimelines):(e.SetInitialState(),this._playingTimelines)).push(e),0!==e.GetRenderChange()&&(this._renderChange=1)}var t=this._runtime._GetDtFast(),r=this._runtime.GetDt1(),i=this._runtime.GetTimeScale();for(let e=this._playingTimelines.length-1;0<=e;e--){var s=this._playingTimelines[e];s&&s.Tick(t,i,r)}this._isTickingTimelines=!1,0!==this._renderChange&&this.GetRuntime().UpdateRender()}}_OnTick2(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){let r;for(let e=0,t=this._markedForRemovalTimelines.length;e<t;e++){var i=this._markedForRemovalTimelines[e];r=r||new Set,i.Removed(),this._MaybeExecuteTimelineFinishTriggers(i),r.add(i)}if(r){C33.arrayRemoveAllInSet(this._markedForRemovalTimelines,r);for(let e=this._renderChange=0,t=this._playingTimelines.length;e<t;e++)if(0!==this._playingTimelines[e].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}}_MaybeExecuteTimelineFinishTriggers(e){e.IsReleased()||e.HasValidTracks()&&e.IsComplete()&&e.InitialStateSet()&&e.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());var e,t,r,i=new Set;for(e of this._playingTimelines)e._OnBeforeChangeLayout()&&(e.Removed(),i.add(e));C33.arrayRemoveAllInSet(this._playingTimelines,i),i.clear();for(t of this._markedForRemovalTimelines)t._OnBeforeChangeLayout()&&(t.Removed(),i.add(t));C33.arrayRemoveAllInSet(this._markedForRemovalTimelines,i),this._MaybeDisableRuntimeListeners();for(r of this._timelines)r.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(e){var t=e.GetObjectClass(),t=this.GetTimelinesForObjectClass(t);if(t)if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(e);else for(var r of t)r.IsTemplate()||(r.IsReleased()?this.Remove(r):r.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(r),this.Remove(r)))}_OnBeforeLoad(){for(var e of this._scheduledTimelines.map(e=>e))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e);for(var t of this._playingTimelines.map(e=>e))this._MaybeExecuteTimelineFinishTriggers(t),this.Remove(t)}_OnAfterLoad(){for(var e of this._destroyedWhileLoadingState)this._OnInstanceDestroy(e);C33.clearArray(this._destroyedWhileLoadingState);for(var t of this._timelines)t._OnAfterLoad()}_OnAfterLayoutStart(){var e=this._runtime.GetLayoutManager().GetMainRunningLayout();if(e)for(var t of this._timelines){var r=t.GetStartOnLayout();r&&e.GetName()===r&&this.ScheduleTimeline(t)}}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(e){e&&(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(e.timelinesJson),this._LoadScheduledTimelinesFromJson(e.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(e.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(e.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!e.hasRuntimeListeners,this._changingLayout=!!e.changingLayout,this._isTickingTimelines=!!e.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map(e=>e._SaveToJson())}_LoadTimelinesFromJson(e){for(var t of e){let e=this.GetTimelineByName(t.name);if(e)e._LoadFromJson(t);else{var r=this._GetTemplateNameFromJson(t);if(!r)continue;r=this.GetTimelineByName(r);(e=this.CreateFromTemplate(r))._LoadFromJson(t)}e.HasTracks()||this.Remove(e)}}_GetTemplateNameFromJson(e){e=e.name.split(":");return e&&2===e.length?e[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(e){this._LoadTimelines(e,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(e){this._LoadTimelines(e,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(e){this._LoadTimelines(e,this._markedForRemovalTimelines)}_IsTimelineInJson(e,t){if(t)for(var r of t)if(r===e.GetName())return!0;return!1}_SaveTimelines(e){return e.map(e=>e.GetName())}_LoadTimelines(e,t){var r,i=new Set;for(r of t)this._IsTimelineInJson(r,e)||i.add(r);if(C33.arrayRemoveAllInSet(t,i),e){var s;for(s of e){var a=this.GetTimelineByName(s);a&&!t.find((t=>e=>e.GetName()===t)(s))&&t.push(a)}}}}}{let C33=self.C3,STEPS=100,LENGTH_STEP_SIZE=.01,BEZIER_STEP_SIZE=25,REFINE_ITERATIONS=20,LOOKUP_STEPS_FROM_LAST=5,TANGENT_RESULT=[0,0],MAP_RESULT=[0,0],SHORT_PROJECTION_RESULT=[0,0],PROJECTION_RESULT=[0,0,0,0,0],REFINE_LUT=new Array(4),REFINE_LUT_OBJECTS=[{x:0,y:0,t:0,distance:0},{x:0,y:0,t:0,distance:0},{x:0,y:0,t:0,distance:0}],REFINE_RESULT={x:0,y:0,t:0,distance:0};C33.TimelineInfo=class TimelineInfo{constructor(e,t){this._initialized=!1,this._timeline=e,this._segments=[];let r=null;if(r=t?this._timeline.GetTrackById(t):C33.first(this._timeline.GetTracks())){e=r.GetPropertyTrack("offsetX"),t=r.GetPropertyTrack("offsetY");if(e&&t){this._xTrack=e,this._yTrack=t;var i=e.GetPropertyKeyframeDataItemArrayIncludingDisabled(),s=t.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(let e=1,t=Math.min(i.length,s.length);e<t;++e){var a=i[e],n=(a.GetNext(),a.GetPrevious()),o=s[e],l=(o.GetNext(),o.GetPrevious());n&&"cubic-bezier"===n.GetPathMode()&&l&&"cubic-bezier"===l.GetPathMode()?this._segments.push(C33.New(C33.TimelineCubicBezierSegmentInfo,n,l,a,o,this._segments.length)):(n&&"line"===n.GetPathMode()&&l&&l.GetPathMode(),this._segments.push(C33.New(C33.TimelineLineSegmentInfo,a,o,this._segments.length)))}this._initialized=!0}}}Release(){for(var e of this._segments)e.Release();C33.clearArray(this._segments),this._segments=null,this._timeline=null,this._xTrack=null,this._yTrack=null}WasInitialized(){return this._initialized}segments(){return this._segments}SetOrigin(e){var t,r="relative"===this._xTrack.GetResultMode()?e.GetX():0,i="relative"===this._yTrack.GetResultMode()?e.GetY():0;for(t of this._segments)t.SetOrigin(r,i)}Project(t,r,e){let i=NaN;var s=this._segments.length;for(let e=0;e<s;e++){var a,n=this._segments[e];"cubic-bezier"===n.GetType()&&(a=n.Project(t,r),isNaN(i)||a[3]<i)&&(i=a[3],SHORT_PROJECTION_RESULT[0]=a[2],SHORT_PROJECTION_RESULT[1]=n.GetIndex())}return SHORT_PROJECTION_RESULT}ProjectWithOptions(t,r,e){var i=e.tRange;C33.IsFiniteNumber(i[0])||(i[0]=0),C33.IsFiniteNumber(i[1])||(i[1]=1);let s=NaN;var a=this._segments.length;for(let e=0;e<a;e++){var n,o=this._segments[e];"cubic-bezier"===o.GetType()&&(n=o.ProjectWithRange(t,r,i),isNaN(s)||n[3]<s)&&(s=n[3],SHORT_PROJECTION_RESULT[0]=n[2],SHORT_PROJECTION_RESULT[1]=o.GetIndex())}return SHORT_PROJECTION_RESULT}Tangent(e,t){return this._segments[t].Tangent(e)}TangentAngle(e,t){return this._segments[t].TangentAngle(e)}},C33.TimelineCubicBezierSegmentInfo=class TimelineCubicBezierSegmentInfo{constructor(e,t,r,i,s){this._index=s;var s=e.GetAddOn("cubic-bezier"),a=r.GetAddOn("cubic-bezier"),n=t.GetAddOn("cubic-bezier"),o=i.GetAddOn("cubic-bezier");this._aX=e.GetValueWithResultMode(),this._aY=t.GetValueWithResultMode(),this._bX=e.GetValueWithResultMode()+s.GetStartAnchor(),this._bY=t.GetValueWithResultMode()+n.GetStartAnchor(),this._cX=r.GetValueWithResultMode()+a.GetEndAnchor(),this._cY=i.GetValueWithResultMode()+o.GetEndAnchor(),this._dX=r.GetValueWithResultMode(),this._dY=i.GetValueWithResultMode(),this._aXO=0,this._aYO=0,this._bXO=0,this._bYO=0,this._cXO=0,this._cYO=0,this._dXO=0,this._dYO=0,this._d0x=0,this._d0y=0,this._d1x=0,this._d1y=0,this._d2x=0,this._d2y=0,this._x1Factor=0,this._x2Factor=0,this._x3Factor=0,this._y1Factor=0,this._y2Factor=0,this._y3Factor=0,this._lutIndex=NaN,this._initialized=!1,this._len=STEPS,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._length=0,this._lut=[],this._lutObjects=[];for(let e=0;e<STEPS;e++)this._lutObjects.push({x:0,y:0,t:0,distance:0});this._CalculateLength()}Release(){C33.clearArray(this._arcLengths),this._arcLengths=null,C33.clearArray(this._lut),this._lut=null,C33.clearArray(this._lutObjects),this._lutObjects=null}GetType(){return"cubic-bezier"}GetIndex(){return this._index}GetStepCount(){return Math.floor(this._length/BEZIER_STEP_SIZE)}GetStepIncrement(){return 1/this.GetStepCount()}SetOrigin(e,t){this._originX=e,this._originY=t,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._CalculateLength(),this._aXO=this._aX+this._originX,this._aYO=this._aY+this._originY,this._bXO=this._bX+this._originX,this._bYO=this._bY+this._originY,this._cXO=this._cX+this._originX,this._cYO=this._cY+this._originY,this._dXO=this._dX+this._originX,this._dYO=this._dY+this._originY,this._d0x=3*(this._bXO-this._aXO),this._d0y=3*(this._bYO-this._aYO),this._d1x=3*(this._cXO-this._bXO),this._d1y=3*(this._cYO-this._bYO),this._d2x=3*(this._dXO-this._cXO),this._d2y=3*(this._dYO-this._cYO),this._x1Factor=3*(this._bXO-this._aXO),this._x2Factor=3*(this._aXO+this._cXO-2*this._bXO),this._x3Factor=this._dXO-this._aXO+3*(this._bXO-this._cXO),this._y1Factor=3*(this._bYO-this._aYO),this._y2Factor=3*(this._aYO+this._cYO-2*this._bYO),this._y3Factor=this._dYO-this._aYO+3*(this._bYO-this._cYO)}Map(e){return this._initialized?(e=this._Map(e),MAP_RESULT[0]=this._X(e),MAP_RESULT[1]=this._Y(e),MAP_RESULT):NaN}Project(e,t){var r=this._GenerateLUT(STEPS),i=this._FindClosestFromLUT(e,t,r),e=this._RefineProjection(e,t,r,i);return PROJECTION_RESULT[0]=e.x,PROJECTION_RESULT[1]=e.y,PROJECTION_RESULT[2]=e.t,PROJECTION_RESULT[3]=e.distance,PROJECTION_RESULT}ProjectWithRange(e,t,r){var i=this._GenerateLUT(STEPS),r=this._FindClosestFromLUTWithRange(e,t,i,r),e=this._RefineProjection(e,t,i,r);return PROJECTION_RESULT[0]=e.x,PROJECTION_RESULT[1]=e.y,PROJECTION_RESULT[2]=e.t,PROJECTION_RESULT[3]=e.distance,PROJECTION_RESULT}Tangent(e){var t=1-e,r=t*t,t=2*t*e,e=e*e,i=r*this._d0x+t*this._d1x+e*this._d2x,r=r*this._d0y+t*this._d1y+e*this._d2y,t=Math.hypot(i,r);return TANGENT_RESULT[0]=i/t,TANGENT_RESULT[1]=r/t,TANGENT_RESULT}TangentAngle(e){var t=1-e,r=t*t,t=2*t*e,e=e*e,i=r*this._d0x+t*this._d1x+e*this._d2x,r=r*this._d0y+t*this._d1y+e*this._d2y;return Math.atan2(r,i)}_Map(i){if(this._initialized){var s=i*this._arcLengths[this._len];let e=0,t=this._len,r=0;for(;e<t;)r=e+((t-e)/2|0),this._arcLengths[r]<s?e=r+1:t=r;this._arcLengths[r]>s&&r--;i=this._arcLengths[r];return i===s?r/this._len:(r+(s-i)/(this._arcLengths[r+1]-i))/this._len}}_X(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX):NaN}_Y(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY):NaN}_GenerateLUT(t){if(t=t||STEPS,!(this._lut.length>=t)){this._lut=new Array(t),t++;for(let e=0;e<t-1;e++){var r=e/(t-1),i=r**2,s=r**3,a=this._x1Factor*r,n=this._x2Factor*i,o=this._x3Factor*s,l=this._y1Factor*r,i=this._y2Factor*i,s=this._y3Factor*s,a=this._aXO+a+n+o,n=this._aYO+l+i+s;this._lutObjects[e].x=a,this._lutObjects[e].y=n,this._lutObjects[e].t=r,this._lutObjects[e].distance=0,this._lut[e]=this._lutObjects[e]}}return this._lut}_FindClosestFromLUT(t,r,i,e=0,s=Number.MAX_SAFE_INTEGER){let a=0;if(isNaN(this._lutIndex))for(let e=0;e<STEPS;e++){var n=i[e],o=n.x-t,l=n.y-r;n.distance=o*o+l*l,n.distance<s&&(s=n.distance,a=e)}else{for(let e=this._lutIndex;e<this._lutIndex+LOOKUP_STEPS_FROM_LAST&&!(e>=i.length);e++){var h=i[e],u=h.x-t,c=h.y-r;h.distance=u*u+c*c,h.distance<s&&(s=h.distance,a=e)}for(let e=this._lutIndex;e>this._lutIndex-LOOKUP_STEPS_FROM_LAST&&!(e<0);e--){var _=i[e],d=_.x-t,p=_.y-r;_.distance=d*d+p*p,_.distance<s&&(s=_.distance,a=e)}}return this._lutIndex=a}_FindClosestFromLUTWithRange(t,r,i,s,a=Number.MAX_SAFE_INTEGER){let n=0;if(isNaN(this._lutIndex))for(let e=0;e<STEPS;e++){var o=i[e],l=o.x-t,h=o.y-r;o.distance=l*l+h*h,o.t>=s[0]&&o.t<=s[1]&&o.distance<a&&(a=o.distance,n=e)}else{for(let e=this._lutIndex;e<this._lutIndex+LOOKUP_STEPS_FROM_LAST&&!(e>=i.length);e++){var u=i[e],c=u.x-t,_=u.y-r;u.distance=c*c+_*_,u.t>=s[0]&&u.t<=s[1]&&u.distance<a&&(a=u.distance,n=e)}for(let e=this._lutIndex;e>this._lutIndex-LOOKUP_STEPS_FROM_LAST&&!(e<0);e--){var d=i[e],p=d.x-t,m=d.y-r;d.distance=p*p+m*m,d.t>=s[0]&&d.t<=s[1]&&d.distance<a&&(a=d.distance,n=e)}}return this._lutIndex=n}_RefineProjection(t,r,e,i){let s=e[i],a=1,n=Number.MAX_SAFE_INTEGER;e:do{var o=e.length,l=0===i?0:i-1,o=i===o-1?o-1:i+1,h=e[l].t,u=(e[o].t-h)/4;if(u<.001)break;REFINE_LUT[0]=e[l];for(let e=1;e<=2;e++){var c=h+e*u,_=c**2,d=c**3,p=this._x1Factor*c,m=this._x2Factor*_,g=this._x3Factor*d,f=this._y1Factor*c,_=this._y2Factor*_,d=this._y3Factor*d,p=this._aXO+p+m+g,m=this._aYO+f+_+d,g=p-t,f=m-r,_=g*g+f*f;if(_<n){n=_,i=e,REFINE_RESULT.x=p,REFINE_RESULT.y=m,REFINE_RESULT.t=c,REFINE_RESULT.distance=_,s=REFINE_RESULT;break e}d=REFINE_LUT_OBJECTS[e-1];d.x=p,d.y=m,d.t=c,d.distance=_,REFINE_LUT[e]=d}REFINE_LUT[3]=e[o],e=REFINE_LUT}while(a++<REFINE_ITERATIONS);return s}_CalculateLength(){this._initialized=!0;let t=this._X(0),r=this._Y(0),i=0;for(let e=1;e<=this._len;e++){var s=this._X(e*LENGTH_STEP_SIZE),a=this._Y(e*LENGTH_STEP_SIZE),n=t-s,o=r-a;i+=Math.hypot(n,o),this._arcLengths[e]=i,t=s,r=a}this._length=i}},C33.TimelineLineSegmentInfo=class TimelineLineSegmentInfo{constructor(e,t,r){this._index=r,this._targetX=e.GetValueWithResultMode(),this._targetY=t.GetValueWithResultMode(),this._originX=0,this._originY=0}Release(){}GetType(){return"line"}GetIndex(){return this._index}SetOrigin(e,t){this._originX=e,this._originY=t}GetX(){return this._targetX+this._originX}GetY(){return this._targetY+this._originY}}}{let C33=self.C3,PING_PONG_BEGIN=0,PING_PONG_END=1;C33.TimelineState=class Timeline extends C33.DefendedBase{constructor(e,t,r){super(),this._runtime=r.GetRuntime(),this._timelineManager=r,this._timelineDataItem=t,this._name=e,this._tracks=[],this._tracksLength=0,this._beforeAndAfterTracks=null,this._beforeAndAfterTracksLength=0,this.CreateTrackStates(),this._playPromise=null,this._playResolve=null,this._playheadTime=0,this._overshoot=0,this._playbackRate=1,this._pingPongState=PING_PONG_BEGIN,this._currentRepeatCount=1,this._isPlaying=!1,this._isScheduled=!1,this._initialStateSet=!1,this._complete=!0,this._released=!1,this._markedForRemoval=!1,this._completedTick=-1,this._implicitPause=!1,this._isTemplate=!1,this._finishedTriggers=!1,this._firstTick=!1,this._lastDelta=NaN,this._tags=[""],this._stringTags="",this._tagsChanged=!1,this._renderChange=0,this._hasNestedContent=0,this._iTimelineState=null}static CreateInitial(e,t){var r=t.GetTimelineDataManager(),i=r.GetNameId(),r=r.Get(e[i]),e=C33.New(C33.TimelineState,e[i],r,t);return e.SetIsTemplate(!0),e}static CreateFromTemplate(e,t,r){return C33.New(C33.TimelineState,e,t,r)}Release(){if(!this.IsReleased()){var e,t=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this),this._timelineManager.CompleteTimelineAndResolve(this);for(e of this._tracks)e.Release();C33.clearArray(this._tracks),this._tracks=null,this._runtime=null,this._timelineManager=null,this._timelineDataItem=null,this._released=!0,this._playPromise=null,this._playResolve=null,this.FireReleaseEvent(t)}}FireReleaseEvent(e){var t=C33.New(C33.Event,"timelinestatereleased");t.timelineState=this,e.dispatchEvent(t)}GetType(){return 0}CreateTrackStates(){for(var e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(C33.TrackState.Create(this,e))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(r,i,s,a){if(this._hasNestedContent){let t;for(let e=0;e<this._tracks.length;e++){var n=this._tracks[e];r===n.GetInstance()&&((n=n.GetPropertyTrack(s))&&i.constructor===n.GetSourceAdapter().constructor&&n.GetResultMode()===a.GetResultMode())&&(t=t||[]).push(n)}return t}}HasTracks(){return!!this._tracks.length}GetTrackById(e){for(var t of this._tracks)if(C33.equalsNoCase(t.GetId(),e))return t;return null}GetTrackByName(e){for(var t of this._tracks)if(!t.IsInstanceTrack()&&C33.equalsNoCase(t.GetName(),e))return t;return null}SetName(e){this._name=e}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(e){this._timelineDataItem.SetTotalTime(e)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(e){this._timelineDataItem.SetStep(e)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._timelineDataItem.SetInterpolationMode(e)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(e){this._timelineDataItem.GetResultMode(e)}SetEase(e){for(var t of this.GetTracks())t.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(e){return this._timelineDataItem.SetLoop(e)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(e){return this._timelineDataItem.SetPingPong(e)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(e){return this._timelineDataItem.SetRepeatCount(e)}SetPlaybackRate(e){return this._playbackRate=e}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}GetPingPongState(){return this._pingPongState}IsForwardPlayBack(){return!this.IsPlaying()||0<this._playbackRate}GetPlayPromise(){return this._playPromise||(this._playPromise=new Promise(e=>{this._playResolve=e})),this._playPromise}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playPromise=null,this._playResolve=null)}SetTags(e){this._tags=C33.TimelineState._GetTagArray(e),this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){return this._tagsChanged&&(this._stringTags=this._tags.join(" ")),this._tagsChanged=!1,this._stringTags}HasTags(e){return!!(this._tags&&this._tags.length&&(e=C33.TimelineState._GetTagArray(e))&&e.length)&&e.every(C33.TimelineState._HasTag,this)}OnStarted(){C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnAnyTimelineStarted),C33.Plugins.Timeline.Cnds.PopTriggerTimeline())}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinishedByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnAnyTimelineFinished),C33.Plugins.Timeline.Cnds.PopTriggerTimeline()))}SetPlaying(e){this._isPlaying=e}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(e=!1){return!!this.IsCompletedTick()||!(!this.IsScheduled()||e)||this._isPlaying}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return!(this.IsReleased()||this.IsScheduled()||this._IsPlaying()||this.IsComplete())}SetScheduled(e){this._isScheduled=e}IsScheduled(){return this._isScheduled}SetComplete(e){this._complete=e;e=this.GetTime();(e<=0||e>=this.GetTotalTime())&&(this._complete=!0)}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(e){this._markedForRemoval=e}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(e){this._implicitPause=e}IsImplicitPause(){return this._implicitPause}SetIsTemplate(e){this._isTemplate=!!e}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(e){var t=this.GetTime();this._SetTime(e),this.SetComplete(!1),this.IsComplete()||this.SetImplicitPause(!0),!this._IsPlaying()&&!this.IsScheduled()&&this._initialStateSet||(this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime()),this._SetUpdateStateBefore(),this._Interpolate(this.GetTime(),!1,!0,!0,t),this._SetUpdateStateAfter(),this._renderChange&&this.GetRuntime().UpdateRender(),this._OnSetTime()}_SetTime(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e}_SetTimeAndReset(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e;for(var t of this._tracks)t.SetResetState()}_OnSetTime(){C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSetByTags),C33.Plugins.Timeline.Cnds.PopTriggerTimeline())}_CanResume(){if(!this.GetLoop())if(this.GetPingPong()&&this._pingPongState===PING_PONG_END){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(e=!1){return!this.IsReleased()&&!this.IsScheduled()&&(this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():!this._IsPlaying()&&!!(this.IsComplete()||e||this.IsImplicitPause())&&this._ScheduleStoppedTimeline())}_SchedulePlayingTimeline(){return this.SetImplicitPause(!1),this._timelineManager.RemovePlayingTimeline(this),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}_ScheduleStoppedTimeline(){return this.SetImplicitPause(!1),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}Stop(e=!1){this.IsReleased()||(this.SetComplete(e),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&this.ResolvePlayPromise())}Reset(e=!0,t=!1){if(!this.IsReleased()){if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);var r;this.IsComplete()||(this.Stop(!0),this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),r=this.GetTime(),this._SetUpdateStateBefore(),t?this._InterpolateBeforeChangeLayout(r):this._Interpolate(r,!1,!1,!0),e&&this._OnSetTime(),this._SetUpdateStateAfter(),this._renderChange&&e&&this.GetRuntime().UpdateRender())}}ResetBeforeChangeLayout(){this.Reset(!1,!0)}_InterpolateBeforeChangeLayout(e){this._Interpolate(e,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){if(!this.IsReleased()){if(!this.GetRuntime().IsLoadingState()&&this.HasValidGlobalTracks())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.GetRuntime().IsLoadingState()||this.ResetBeforeChangeLayout()}return!0}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialStateForce(){this.SetInitialState(!1,!0),this.SetPlaying(!1),this.SetScheduled(!1)}SetInitialState(e=!1,t=!1){if(!this.IsMarkedForRemoval()||t){if(e){this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this._SetUpdateStateBefore();for(var r of this._tracks)r.SetInitialState()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1,this._pingPongState!==PING_PONG_BEGIN&&(this._playbackRate=Math.abs(this._playbackRate)),this._pingPongState=PING_PONG_BEGIN,this._currentRepeatCount=1,this._complete=!1,this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),this._SetUpdateStateBefore();for(var i of this._tracks)i.SetInitialState()}else{this._firstTick=!0,this._finishedTriggers=!1,this._SetUpdateStateBefore();for(var s of this._tracks)s.SetResumeState()}this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(var e of this._tracks)e.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(var e of this._tracks)e._SetUpdateState(),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1),this._beforeAndAfterTracks||1!==e.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(e))}Tick(e,t,r){if(this.GetUseSystemTimescale()){if(0===e&&0===this._lastDelta)return;this._lastDelta=e,e=r}else{if(0===r&&0===this._lastDelta)return;e=this._lastDelta=r,t=1}var i=this._playheadTime+this._overshoot,r=i+e*t*this._playbackRate,s=this._timelineDataItem._totalTime;r<0?(this._playheadTime=0,this._overshoot=-r):s<=r?(this._playheadTime=s,this._overshoot=this._playheadTime-r):(this._playheadTime=r,this._overshoot=0);let a=!1,n=!1;e=this.GetLoop(),t=this.GetPingPong();e||t?e&&!t?0<this._playbackRate?this._playheadTime>=s&&(this._SetTimeAndReset(0),n=!0):this._playheadTime<=0&&(this._SetTimeAndReset(s),n=!0):!e&&t?0<this._playbackRate?this._playheadTime>=s&&(this._SetTime(s),this.SetPlaybackRate(-1*this.GetPlaybackRate()),n=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=PING_PONG_BEGIN):a=!0:this._pingPongState===PING_PONG_BEGIN&&(this._pingPongState=PING_PONG_END)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),n=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=PING_PONG_BEGIN):a=!0:this._pingPongState===PING_PONG_BEGIN&&(this._pingPongState=PING_PONG_END)):e&&t&&(0<this._playbackRate?this._playheadTime>=s&&(this._SetTime(s),this.SetPlaybackRate(-1*this.GetPlaybackRate()),n=!0,this._pingPongState++,C33.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),n=!0,this._pingPongState++,C33.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=s&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),n=!0):(this._SetTime(s),a=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(s),n=!0):(this._SetTime(0),a=!0));let o;var l=this._tracksLength;if(a){for(o=0;o<l;o++)this._tracks[o].SetEndState();this.Stop(!0),this.OnCompleted()}else{var h=this._beforeAndAfterTracksLength;for(o=0;o<h;o++)this._beforeAndAfterTracks[o].BeforeInterpolate();if(1===this._hasNestedContent)for(o=0;o<l;o++){var u=this._tracks[o],c=u.GetStartOffset();this._playheadTime-c<0&&0<i-c?(this._playheadTime=c<0?0:s<=c?s:c,u.Interpolate(c,!0,!1,n,this._firstTick,!1)):u.Interpolate(this._playheadTime,!0,!1,n,this._firstTick,!1)}else for(o=0;o<l;o++)this._tracks[o].Interpolate(this._playheadTime,!0,!1,n,this._firstTick,!1);for(o=0;o<h;o++)this._beforeAndAfterTracks[o].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}}_Interpolate(t,r=!1,i=!1,s=!1,a=NaN,e=!1,n=!1){for(var o of this._tracks)o.BeforeInterpolate();for(var l of this._tracks){let e=t;var h,u;"number"!=typeof a||isNaN(a)||(h=this.GetTime()-l.GetStartOffset(),u=a-l.GetStartOffset(),h<0&&0<u&&(e=l.GetStartOffset(),this._SetTime(e))),l.Interpolate(e,r,i,s,this._firstTick,n)}for(var c of this._tracks)c.AfterInterpolate();this._firstTick&&e&&(this._firstTick=!1)}AddTrack(){var e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),e=C33.TrackState.Create(this,e);return this._tracksLength=this._tracks.push(e),e}Removed(){if(!this.IsReleased())for(var e of this._tracks)e.TimelineRemoved()}CleanCaches(){for(var e of this._tracks)e.CleanCaches()}ClearTrackInstances(){for(var e of this._tracks)e.ClearInstance()}SetTrackInstance(e,t,r){if(t){var i;if("number"==typeof r&&0<=r)return(r=this._tracks[r])?(r.SetInstance(t),void this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this)):void 0;for(i of this._tracks)if(i.IsInstanceTrack())if(e){if(i.GetId()===e){i.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}else if(!i.HasInstance()){i.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}}HasTrackInstance(e,t){for(var r of this._tracks)if(r.IsInstanceTrack())if(t){if(t===r.GetId()&&e===r.GetInstance())return!0}else if(e===r.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some(e=>!e.IsInstanceTrack()||e.CanInstanceBeValid())}HasValidGlobalTracks(){return this._tracks.some(e=>!!e.IsInstanceTrack()&&!!e.CanInstanceBeValid()&&!!(e=e.GetObjectClass())&&e.IsGlobal())}GetPropertyTrack(e){for(var t of this.GetTracks())for(var r of t.GetPropertyTracks())if(r.GetPropertyName()===e)return r}GetTrackFromInstance(e){for(var t of this._tracks)if(e===t.GetInstance())return t;return null}GetKeyframeWithTags(e){let r=e?e.split(" "):[];var i,e=new Set(r.map(e=>e.toLowerCase().trim()));r=[...e.values()];for(i of this.GetTracks())for(let t of i.GetKeyframeDataItems())if(r.every(e=>t.HasTag(e)))return t}GetObjectClasses(){var e,t=[];for(e of this.GetTracks())t.push(e.GetObjectClass());return t.filter(e=>e)}_OnAfterLoad(){for(var e of this.GetTracks())e._OnAfterLoad()}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(e){e&&(this._LoadTracksFromJson(e.tracksJson),this._name=e.name,this._playheadTime=e.playheadTime,this._playbackRate=e.playbackRate,this._pingPongState=e.pingPongState,this._currentRepeatCount=e.currentRepeatCount,this._isPlaying=!!e.isPlaying,this._isScheduled=!!e.isScheduled,this._initialStateSet=!!e.initialStateSet,this._finishedTriggers=!!e.hasOwnProperty("finishedTriggers")&&!!e.finishedTriggers,this._complete=!!e.complete,this._released=!!e.released,this._markedForRemoval=!!e.markedForRemoval,this._completedTick=e.completedTick,this._implicitPause=!!e.implicitPause,this._isTemplate=!!e.isTemplate,this._tags=e.tags.split(" "),this._stringTags=e.stringTags,this._tagsChanged=!!e.tagsChanged,this._firstTick=!!e.firstTick)}_SaveTracksToJson(){return this._tracks.map(e=>e._SaveToJson())}_LoadTracksFromJson(e){this.ClearTrackInstances(),e.forEach((e,t)=>{this._tracks[t]._LoadFromJson(e)}),this._tracks.filter(e=>e.CanInstanceBeValid())}static _HasTag(e){var t=this.GetTags();return""===e?1===t.length&&""===t[0]:t.map(e=>e.toLowerCase()).includes(e.toLowerCase())}static _GetTagArray(e){if(C33.IsArray(e))return e.slice(0);if(C33.IsString(e))return e.split(" ");throw new Error("invalid tags")}GetITimelineState(){return this._iTimelineState||(this._iTimelineState=C33.New(self.ITimelineState,this)),this._iTimelineState}}}{let C33=self.C3,INSTANCE_TRACK=0,VALUE_TRACK=1,AUDIO_TRACK=2;C33.TrackState=class Track extends C33.DefendedBase{constructor(e,t){super(),this._timeline=e,this._trackDataItem=t,this._trackData=t.GetTrackData(),this._instanceUid=NaN,this._objectClassIndex=NaN,this._instance=null,this._worldInfo=null,this._cleared=!1,this._isNested=0<t.GetStartOffset(),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this._instanceUidToLoad=NaN,this._lastKeyframeDataItem=null,this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray(),this._propertyTracks=[],this.CreatePropertyTrackStates(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0}static Create(e,t){return C33.New(C33.TrackState,e,t)}Release(){this._keyframeDataItems=null;for(var e of this._propertyTracks)e.Release();C33.clearArray(this._propertyTracks),this._propertyTracks=null,this._timeline=null,this._instance=null,this._worldInfo=null,this._trackDataItem=null,this._lastKeyframeDataItem=null}CreatePropertyTrackStates(){for(var e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C33.PropertyTrackState.Create(this,e))}TimelineRemoved(){for(var e of this._propertyTracks)e.TimelineRemoved()}CleanCaches(){for(var e of this._propertyTracks)e.CleanCaches();this._instance=null,this._worldInfo=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems||(this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()),this._keyframeDataItems}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(t){for(let e=0;e<this._propertyTracks.length;e++){var r=this._propertyTracks[e];if(r.GetPropertyName()===t)return r}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return!!this._instance&&!this._instance.IsDestroyed()}CanInstanceBeValid(){var e;return!!this.IsInstanceTrack()&&(e=this.GetInstanceUID(),!!(e=this.GetRuntime().GetInstanceByUID(e)))&&!e.IsDestroyed()}GetObjectClass(){if(this.IsInstanceTrack()){var e=this.GetObjectClassIndex();if(-1!==e)return this.GetRuntime().GetObjectClassByIndex(e)}}GetTrackIndexInTimeline(){return this._timeline.GetTracks().indexOf(this)}ClearInstance(){this._instance=null,this._instanceUid=NaN,this._worldInfo=null,this._objectClassIndex=NaN,this._cleared=!0}HasInstance(){return!!this._instance}GetInstance(){var e;if(!this._cleared)return this._instance&&this.IsInstanceValid()||(e=this.GetInstanceUID(),this._instance=this.GetRuntime().GetInstanceByUID(e)),this._instance}SetInstance(e){if(this._cleared=!1,this._instance!==e){this.CleanCaches(),this._instance=e,this._objectClassIndex=e.GetObjectClass().GetIndex(),this._instanceUid=e.GetUID(),this._worldInfo=e.GetWorldInfo();for(var t of this.propertyTrackItems()){var r=t.propertyTrack,i=t.sourceAdapter;switch(r.GetSourceAdapterId()){case"instance-variable":i.GetEditorIndex();var s=e.GetObjectClass(),a=s.GetInstanceVariableIndexByName(t.name),n=s.GetInstanceVariableName(a),s=s.GetInstanceVariableType(a);n===t.name&&s===t.type&&i.UpdateInstanceVariableIndex(a);break;case"behavior":var o,n=t.behaviorType,s=this.GetObjectClass(),a=e.GetObjectClass(),l=i.GetBehaviorType(a);n&&l&&(o=n.GetName(),s.GetBehaviorIndexByName(o),a.GetBehaviorIndexByName(o),i.GetEditorIndex(),i.UpdateBehaviorTypeSid(l.GetSID()))}}}}*propertyTrackItems(){for(var e of this._propertyTracks){var t=e.GetSourceAdapter(),r=this.GetObjectClass(),i={propertyTrack:e,sourceAdapter:t};switch(e.GetSourceAdapterId()){case"world-instance":i.property=e.GetPropertyName();break;case"instance-variable":var s=t.GetEditorIndex();i.name=r.GetInstanceVariableName(s),i.type=r.GetInstanceVariableType(s);break;case"effect":var s=r.GetEffectList(),a=t.GetEffectType(s);i.effectType=a;break;case"behavior":a=t.GetBehaviorType(r);i.behaviorType=a;break;case"plugin":i.plugin=r.GetPlugin()}yield i}}GetWorldInfo(){var e;return this._worldInfo&&this.IsInstanceValid()||(e=this.GetInstance())&&(this._worldInfo=e.GetWorldInfo()),this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return isNaN(this._instanceUid)?this._trackDataItem.GetInstanceUID():this._instanceUid}SetInstanceUID(e){this._trackDataItem.SetInstanceUID(e)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._trackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(e){this._trackDataItem.SetLocalTotalTime(e)}SetResultMode(e){this._trackDataItem.SetResultMode(e)}SetEase(e){for(var t of this.GetKeyframeDataItems())t.SetEase(e);for(var r of this.GetPropertyTracks())r.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(e){this._trackDataItem.SetObjectClassIndex(e)}SetOriginalWidth(e){this._trackDataItem.SetOriginalWidth(e)}GetOriginalWidth(){var e=this.GetInstance();if(e&&e.GetSdkInstance().IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalWidth();return this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(e){this._trackDataItem.SetOriginalHeight(e)}GetOriginalHeight(){var e=this.GetInstance();if(e&&e.GetSdkInstance().IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalHeight();return this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return this.GetType()===INSTANCE_TRACK}IsValueTrack(){return this.GetType()===VALUE_TRACK}IsAudioTrack(){return this.GetType()===AUDIO_TRACK}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(var e of this._propertyTracks)e.SetResetState()}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e,t=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(e of this._propertyTracks)e.SetInitialState(t),0===this._worldInfoChange&&1===e.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(t),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(t),this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(t))}}SetResumeState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){this._timeline.IsForwardPlayBack();var e,t=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(t);for(e of this._propertyTracks)e.SetResumeState(t)}}SetEndState(){var e;this.GetTimeline().IsComplete()||(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack())||this._isNested||(e=this._timeline.GetTime(),this.GetStartOffset()+this.GetLocalTotalTime()<=e?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0,!1,!1,!0):e<=0&&this.Interpolate(0,!0,!1,!0,!1,!1,!0))}_SetUpdateState(){for(let e=0,t=this._propertyTracks.length;e<t;e++){var r=this._propertyTracks[e];r._SetUpdateState(),0===this._worldInfoChange&&1===r.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===r.GetRenderChange()&&(this._renderChange=1)}}BeforeInterpolate(){var t=this._propertyTracks.length;for(let e=0;e<t;e++)this._propertyTracks[e].BeforeInterpolate()}Interpolate(r,e=!1,i=!1,s=!1,t=!1,a=!1,n=!1){this._instance||this.GetInstance();var o=this._instance&&!this._instance.IsDestroyed(),l=this._trackDataItem._type===INSTANCE_TRACK;if((o||!l)&&!(a&&l&&this.GetObjectClass().IsGlobal()||(r-=this.GetStartOffset())<0)){this.MaybeSetInitialStateOfNestedTrack(r,e),this.MaybeTriggerKeyframeReachedConditions(r,e,t);for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].Interpolate(r,i,s,n);this.MaybeSetEndStateOfNestedTrack(r,e),0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo)&&this._worldInfo.SetBboxChanged()}}AfterInterpolate(){var t=this._propertyTracks.length;for(let e=0;e<t;e++)this._propertyTracks[e].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._initialStateOfNestedSet){var r;if(this.GetTimeline().IsForwardPlayBack()){if(e<0)return}else if(e>this.GetLocalTotalTime())return;for(r of this._propertyTracks)r.SetInitialState();this._initialStateOfNestedSet=!0}}MaybeSetEndStateOfNestedTrack(e,t){if(t&&(this._isNested&&!this._endStateOfNestedSet))if(this.GetTimeline().IsForwardPlayBack()){if(e>=this.GetLocalTotalTime()){for(var r of this._propertyTracks)r.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(e<=0){for(var i of this._propertyTracks)i.Interpolate(0,!1,!0);this._endStateOfNestedSet=!0}}MaybeTriggerKeyframeReachedConditions(e,t,r){var i,s;r||t&&C33.Plugins.Timeline&&(r=this.GetTimeline(),t=this._lastKeyframeDataItem.GetNext(),s=this._lastKeyframeDataItem.GetTime(),i=t?t.GetTime():r.GetTotalTime(),e<=s||i<=e)&&(this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem),r.IsForwardPlayBack()?t&&this.OnKeyframeReached(this._lastKeyframeDataItem):(s=this._lastKeyframeDataItem.GetNext())&&this.OnKeyframeReached(s))}_GetLastKeyFrameBeforeTime(e){var t=this._trackData.GetKeyFrameDataItemAtTime(e,this._trackDataItem);return t||this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem)}OnKeyframeReached(e){var t,r;C33.Plugins.Timeline&&(r=(t=this.GetTimeline()).GetTimelineManager(),C33.Plugins.Timeline.Cnds.PushTriggerTimeline(t),C33.Plugins.Timeline.Cnds.PushTriggerKeyframe(e),r.Trigger(C33.Plugins.Timeline.Cnds.OnAnyKeyframeReached),r.Trigger(C33.Plugins.Timeline.Cnds.OnKeyframeReached),C33.Plugins.Timeline.Cnds.PopTriggerTimeline(t),C33.Plugins.Timeline.Cnds.PopTriggerKeyframe(e))}AddKeyframe(){return this._trackDataItem.GetKeyframeData().AddEmptyKeyframeDataItem()}AddPropertyTrack(){var e=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem(),e=C33.PropertyTrackState.Create(this,e);return this._propertyTracks.push(e),e}DeleteKeyframes(e){this._trackDataItem.GetKeyframeData().DeleteKeyframeDataItems(e)}DeletePropertyKeyframes(e){for(var t of this._propertyTracks)t.DeletePropertyKeyframes(e)}SaveState(){for(var e of this._propertyTracks)e.SaveState()}CompareInitialStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())for(var e of this._propertyTracks)e.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){let e=!1;for(var t of this._propertyTracks){t=t.CompareSaveStateWithCurrent();!e&&t&&(e=!0)}var r;e&&((r=this.AddKeyframe()).SetTime(this.GetTimeline().GetTime()),r.SetEase("noease"),r.SetEnable(!0),r.SetTags(""))}}_OnAfterLoad(){isNaN(this._instanceUidToLoad)||this._LoadInstanceFromJson(this._instanceUidToLoad),this._instanceUidToLoad=NaN}_SaveToJson(){var e=this.GetInstance(),e=e?e.GetUID():this.GetInstanceUID();return{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:e,cleared:this._cleared}}_LoadFromJson(e){if(e){this._LoadPropertyTracksFromJson(e.propertyTracksJson),this._LoadLastKeyframeDataItemFromJson(e.lastKeyframeDataItemJson),this._instanceUidToLoad=e.instanceUid,this._initialStateOfNestedSet=!1,e.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=e.initialStateOfNestedSet),this._endStateOfNestedSet=!1,e.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=e.endStateOfNestedSet),this._cleared=!!e.hasOwnProperty("cleared")&&e.cleared;for(var t of this._propertyTracks)0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1)}}_SaveLastKeyframeDataItemToJson(){return this._trackDataItem.GetKeyframeData().GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map(e=>e._SaveToJson())}_LoadPropertyTracksFromJson(e){e.forEach((e,t)=>{this._propertyTracks[t]._LoadFromJson(e)})}_LoadInstanceFromJson(e){C33.IsFiniteNumber(e)&&(e=this.GetRuntime().GetInstanceByUID(e))&&this.GetTimeline().SetTrackInstance(this._trackDataItem.GetId(),e,this.GetTrackIndexInTimeline())}_LoadLastKeyframeDataItemFromJson(e){var t=this._trackDataItem.GetKeyframeData();this._lastKeyframeDataItem=t.GetKeyframeDataItemFromIndex(e)}}}{let C33=self.C3;C33.PropertyTrackState=class PropertyTrack extends C33.DefendedBase{constructor(e,t){super(),this._track=e,this._propertyTrackDataItem=t,this._propertyTrackData=t.GetPropertyTrackData(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0,this._sourceAdapter=this.GetSourceAdapter(),this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),this._lastPropertyKeyframeDataItem=null,this._absoluteValueObject=null}static Create(e,t){return C33.New(C33.PropertyTrackState,e,t)}Release(){this._track=null,this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null),this._propertyKeyframeDataItems=null,this._propertyTrackDataItem=null,this._propertyTrackData=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(e){this._absoluteValueObject=e}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(!this._sourceAdapter){let e;switch(this._propertyTrackDataItem.GetSourceAdapterId()){case"behavior":e=new C33.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":e=new C33.PropertyTrackState.EffectSourceAdapter(this),this._renderChange=1;break;case"instance-variable":e=new C33.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":e=new C33.PropertyTrackState.PluginSourceAdapter(this),this._renderChange=1;break;case"world-instance":e=new C33.PropertyTrackState.PropertySourceAdapter(this),this._renderChange=1,this._worldInfoChange=1;break;case"value":e=new C33.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":e=new C33.PropertyTrackState.AudioSourceAdapter(this)}this._sourceAdapter=e}return this._sourceAdapter}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(e){this._propertyTrackDataItem.SetSourceAdapterId(e)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(e){this._propertyTrackDataItem.SetSourceAdapterArguments(e)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(e){this._propertyTrackDataItem.SetProperty(e)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(e){this._propertyTrackDataItem.SetType(e)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(e){this._propertyTrackDataItem.SetMin(e)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(e){this._propertyTrackDataItem.SetMax(e)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._propertyTrackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(e){this._propertyTrackDataItem.SetResultMode(e)}SetEase(e){for(var t of this.GetPropertyKeyframeDataItems())t.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems||(this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()),this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled()}GetPropertyKeyFrameDataItemAtTime(e){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(e){let t=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem),r;return r=t?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(e,this._propertyTrackDataItem):(t=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem)),{start:t,end:r}}*GetPropertyKeyframeValues(){for(var e of this.GetPropertyKeyframeDataItems())yield e.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(var e of this.GetPropertyKeyframeDataItems())yield e.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(e){this.GetSourceAdapter().SetInitialState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e),this._SetUpdateState()}SetResumeState(e){this.GetSourceAdapter().SetResumeState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e)}_SetUpdateState(){var e,t,r,i=this.GetTrack();this._needsBeforeAndAfter=0,i.IsInstanceTrack()&&(r=this.GetTimeline(),i=i.GetInstance(),e=this.GetSourceAdapter(),t=this.GetPropertyName(),e.MayNeedBeforeAndAfterInterpolate()?(r=r.GetSimilarPropertyTracks(i,e,t,this))&&r.length&&(this._needsBeforeAndAfter=1):this._needsBeforeAndAfter=0)}_GetLastPropertyKeyFrameBeforeTime(e){var t=this.GetTimeline(),r=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return r||(t.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem))}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(e,t=!1,r=!1,i=!1){let s,a,n=!1;var o,l,h;(s=t?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):((!this._lastPropertyKeyframeDataItem||(o=this.GetTimeline(),h=this._lastPropertyKeyframeDataItem.GetNext(),l=this._lastPropertyKeyframeDataItem.GetTime(),h=h?h.GetTime():o.GetTotalTime(),e<=l)||h<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),n=!0),this._lastPropertyKeyframeDataItem))&&(a=s.GetNext()),this._sourceAdapter.Interpolate(e,s,a,t,r,i,n)}GetInterpolatedValue(e){(!this._lastPropertyKeyframeDataItem||(r=this.GetTimeline(),t=this._lastPropertyKeyframeDataItem.GetNext(),i=this._lastPropertyKeyframeDataItem.GetTime(),t=t?t.GetTime():r.GetTotalTime(),e<=i)||t<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem));var t,r=this._lastPropertyKeyframeDataItem,i=r.GetNext();return this._sourceAdapter.GetInterpolatedValue(e,r,i)}GetInterpolatedValueFast(e,t,r){return this._sourceAdapter.GetInterpolatedValue(e,t,r)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(e,t){var r=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,r)}static GetEndPropertyKeyframeForTime(e,t){var r=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,r)}AddPropertyKeyframe(){var e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){var e,t;this.GetSourceAdapter().CompareInitialStateWithCurrent()&&(e=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),t=this.GetSourceAdapter().GetCurrentState(),e.SetAbsoluteValue(t))}CompareSaveStateWithCurrent(){var e=this.GetSourceAdapter().CompareSaveStateWithCurrent();return e&&this.AddPropertyKeyframeAtCurrentTime(),this.GetSourceAdapter().ClearSaveState(),e}AddPropertyKeyframeAtCurrentTime(){var e=this.GetTimeline().GetTime(),t=this.GetSourceAdapter(),r=C33.PropertyTrackState.GetStartPropertyKeyframeForTime(e,this),i=this.AddPropertyKeyframe();i.SetType(r.GetType()),i.SetTime(e),i.SetEase(r.GetEase()),i.SetEnable(!0),i.SetValue(t.GetValueAtTime()),i.SetAbsoluteValue(t.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson)}}}{let C33=self.C3,NS=C33.PropertyTrackState;NS.PropertySourceAdapter=class PropertySourceAdapter{constructor(e){this._propertyTrack=e,this._propertyAdapter=null,this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null),this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter||(this._propertyAdapter=this._CreatePropertyAdapter()),this._propertyAdapter}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(e,t,r,i,s,a,n){let o;switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":o=NS.NumericTypeAdapter.Interpolate(e,t,r,this._propertyTrack);break;case"angle":o=NS.AngleTypeAdapter.Interpolate(e,t,r,this._propertyTrack);break;case"boolean":o=NS.BooleanTypeAdapter.Interpolate(e,t,r,this._propertyTrack);break;case"color":o=NS.ColorTypeAdapter.Interpolate(e,t,r,this._propertyTrack);break;case"text":o=NS.TextTypeAdapter.Interpolate(e,t,r,this._propertyTrack)}this._propertyAdapter.ChangeProperty(e,o,t,r,i,s,a,n)}GetInterpolatedValue(e,t,r){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(e,t,r,this._propertyTrack);case"angle":return NS.AngleTypeAdapter.Interpolate(e,t,r,this._propertyTrack);case"boolean":return NS.BooleanTypeAdapter.Interpolate(e,t,r,this._propertyTrack);case"color":return NS.ColorTypeAdapter.Interpolate(e,t,r,this._propertyTrack);case"text":return NS.TextTypeAdapter.Interpolate(e,t,r,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){var e=this._propertyTrack,t=e.GetTrack().GetTimeline().GetTime(),r=NS.GetStartPropertyKeyframeForTime(t,e),i=r.GetNext();switch(e.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(t,r,i,e);case"angle":return NS.AngleTypeAdapter.Interpolate(t,r,i,e);case"boolean":return NS.BooleanTypeAdapter.Interpolate(t,r,i,e);case"color":return NS.ColorTypeAdapter.Interpolate(t,r,i,e);case"text":return NS.TextTypeAdapter.Interpolate(t,r,i,e)}}_CreatePropertyAdapter(){var e=this._propertyTrack;switch(e.CanHavePropertyKeyframes()?e.GetPropertyKeyframeType():""){case"combo":case"boolean":case"text":case"string":return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case"numeric":case"number":case"angle":return new("combo"===this._propertyTrack.GetPropertyType()?NS.PropertyInterpolationAdapter.NoInterpolationAdapter:NS.PropertyInterpolationAdapter.NumericInterpolationAdapter)(this);case"color":case"offsetColor":return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);default:return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetPropertyAdapter()._LoadFromJson(e.propertyAdapterJson)}}}{let C33=self.C3,INDEX=0;class InstanceVariableSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetIndex(){return this._updatedIndex||super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]!==e&&(this._updatedIndex=e)}Interpolate(e,t,r,i,s,a,n){this.GetPropertyAdapter().CanChange(t.GetValue())&&super.Interpolate(e,t,r,i,s,a,n)}GetInterpolatedValue(e,t,r){if(this.GetPropertyAdapter().CanChange(t.GetValue()))return super.GetInterpolatedValue(e,t,r)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._updatedIndex=e.index)}}C33.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter}{let C33=self.C3,SID=0,INDEX=1,NAME=2;class BehaviorSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._sid=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){var e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetTrack(),e=this._sid||e.GetSourceAdapterArguments()[SID],t=t.GetInstance(),e=t.GetBehaviorIndexBySID(e);return t.GetBehaviorInstances()[e].GetSdkInstance()}GetBehaviorType(e){var t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[NAME];return e.GetBehaviorTypeByName(t)}UpdateBehaviorTypeSid(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[SID]!==e&&(this._sid=e)}Interpolate(e,t,r,i,s,a,n){var o=this._propertyTrack.GetTrack().GetInstance();this.GetBehaviorType(o.GetObjectClass())&&super.Interpolate(e,t,r,i,s,a,n)}GetInterpolatedValue(e,t,r){var i=this._propertyTrack.GetTrack().GetInstance();if(this.GetBehaviorType(i.GetObjectClass()))return super.GetInterpolatedValue(e,t,r)}_SaveToJson(){return Object.assign(super._SaveToJson(),{sid:this._sid})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._sid=e.sid)}}C33.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter}{let C33=self.C3,NAME=0,INDEX=1;class EffectSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){var e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList(),t=e.GetEffectList(),t=this.GetEffectType(t).GetIndex();return e.IsEffectIndexActive(t)?e.GetEffectParametersForIndex(t):null}GetEffectType(e){var t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[NAME];return e.GetEffectTypeByName(t)}Interpolate(e,t,r,i,s,a,n){this._IsEffectActive()&&super.Interpolate(e,t,r,i,s,a,n)}GetInterpolatedValue(e,t,r){if(this._IsEffectActive())return super.GetInterpolatedValue(e,t,r)}_IsEffectActive(){var e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList(),t=e.GetEffectList(),t=this.GetEffectType(t);if(t)return t=t.GetIndex(),e.IsEffectIndexActive(t)}}C33.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter}{let C33=self.C3,INDEX=0;class PluginSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(e,t,r,i,s,a,n){var o=this._propertyTrack.GetTrack();o.GetObjectClass().GetPlugin()===o.GetInstance().GetObjectClass().GetPlugin()&&super.Interpolate(e,t,r,i,s,a,n)}GetInterpolatedValue(e,t,r){var i=this._propertyTrack.GetTrack(),s=i.GetObjectClass().GetPlugin(),i=i.GetInstance().GetObjectClass().GetPlugin();if(s===i)return super.GetInterpolatedValue(e,t,r)}GetOptionalCallbacks(){var e=this._propertyTrack.GetTrack().GetObjectClass().GetPlugin();if(C33.Plugins.Sprite&&e instanceof C33.Plugins.Sprite&&("initial-frame"===this._propertyTrack.GetPropertyName()||"initial-animation"===this._propertyTrack.GetPropertyName()))switch(this._propertyTrack.GetResultMode()){case"relative":case"absolute":return null}}}C33.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter}{let C33=self.C3;class ValueSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._value=0,this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){var e=this._propertyTrack.GetPropertyTrackData(),t=this._propertyTrack.GetPropertyTrackDataItem(),t=e.GetFirstPropertyKeyframeDataItem(t);this._value=t.GetValueWithResultMode()}SetResumeState(){}GetValue(){return this._init||this._propertyTrack.Interpolate(0),this._value}Interpolate(e,t,r,i,s,a,n){this._value=C33.PropertyTrackState.NumericTypeAdapter.Interpolate(e,t,r,this._propertyTrack),this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(e){e&&(this._value=e.value,this._init=!e.hasOwnProperty("init")||e.init)}}C33.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter}{let C33=self.C3,PROJECT_FILE=0,PROJECT_FILE_NAME=0,PROJECT_FILE_TYPE=1,START_OFFSET=1,AUDIO_DURATION=2,AUDIO_TAG=3;class AudioSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._audioPlaybackStarted=!1,this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=this._propertyTrack.GetTimeline(),this._track=this._propertyTrack.GetTrack(),this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs(),this._fileArgs=this._sourceAdapterArgs[PROJECT_FILE],this._startOffsetTime=this._sourceAdapterArgs[START_OFFSET],this._sourceAdapterArgs[AUDIO_TAG]?this._audioTag=this._sourceAdapterArgs[AUDIO_TAG]:this._audioTag=Math.random().toString(36).slice(2),this._pauseTime=NaN,this._pauseVolume=NaN,this._volume=NaN,this._audioSource=null,this._Initialize()}Release(){super.Release(),this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=null,this._track=null,this._sourceAdapterArgs=null,this._fileArgs=null,this._audioSource=null}_Initialize(){var e;self.C3.Plugins.Audio&&((e=this._propertyTrack.GetRuntime().GetSingleGlobalObjectClassByCtor(self.C3.Plugins.Audio))&&(this._sdkInstance=e.GetSingleGlobalInstance().GetSdkInstance()),this._actions=self.C3.Plugins.Audio.Acts,this._expressions=self.C3.Plugins.Audio.Exps)}_MaybeSetAudioSource(){var e;this._audioSource||(e=this._propertyTrack.GetTrack().GetPropertyTrack("audioSource"))&&(this._audioSource=e.GetSourceAdapter())}_GetPauseVolume(){var e=this._propertyTrack.GetTrack().GetPropertyTrack("volume");return(e?e.GetSourceAdapter():this)._pauseVolume}TimelineRemoved(){super.TimelineRemoved(),this._audioPlaybackStarted=!1,this._sdkInstance&&(this._expressions&&(this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions)&&this._actions.Stop.call(this._sdkInstance,this._audioTag)}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(e){this._volume=e}SetInitialState(){super.SetInitialState(),this._pauseTime=NaN,this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();var e=this._propertyTrack.GetTimeline().GetTime();switch(this._pauseTime=e-this._startOffsetTime,this._propertyTrack.GetPropertyName()){case"audioSource":break;case"volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(e)}this._audioPlaybackStarted=!1}Interpolate(e,t,r,i,s,a,n){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":if(!this._timeline.IsForwardPlayBack())return;if(i)return void(this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag));if(e<this._startOffsetTime)return void(this._audioPlaybackStarted=!1);var o=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag),l=this._timeline.GetPlaybackRate();if(l!==o&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,l),this._audioPlaybackStarted)return;if(!this._propertyTrack.GetTimeline().IsPlaying())return;if(this._audioPlaybackStarted=!0,isNaN(this._pauseTime)){o=self.performance.now(),l=e-this._startOffsetTime;if("suspended"===this._sdkInstance.GetAudioContextState())return void(this._audioPlaybackStarted=!1);l=l+(self.performance.now()-o)/1e3;if(this._actions){let e=this.GetVolume();isNaN(e)?(this.SetVolume(0),e=0):this.SetVolume(e),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,e,this._audioTag,l)}}else{var o=this._pauseTime,l=(this._pauseTime=NaN,this._GetPauseVolume()),h=(this._pauseVolume=NaN,this._sdkInstance.GetAudioContextState());if("suspended"===h)return void(this._audioPlaybackStarted=!1);this._actions&&(this.SetVolume(l),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,l,this._audioTag,o))}break;case"volume":this._MaybeSetAudioSource(),super.Interpolate(e,t,r,i,s,a,n)}}GetInterpolatedValue(e,t,r){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":return;case"volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(e,t,r)}}Getter(e,t){return this._audioSource?this._audioSource.GetVolume():0}Setter(e,t,r,i){this._audioSource&&this._audioSource.SetVolume(this.Getter()+t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(e,t,r){this._audioSource&&this._audioSource.SetVolume(t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(e){e&&(this._audioPlaybackStarted=e.audioPlaybackStarted,this._audioTag=e.audioTag,this._pauseTime=e.pauseTime,this._pauseVolume=e.pauseVolume,this._volume=e.volume,this._Initialize())}}C33.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter}{let C33=self.C3;C33.PropertyTrackState.PropertyInterpolationAdapter=class PropertyInterpolationAdapter{constructor(e){this._sourceAdapter=e,this._propertyTrack=e.GetPropertyTrack(),this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo(),this._property=this._propertyTrack.GetPropertyName(),this._firstAbsoluteUpdate=!1,this._saveState=null,this._target=null}Release(){this._sourceAdapter=null,this._propertyTrack=null,this._worldInfo=null,this._saveState=null,this._target=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._worldInfo=null,this._saveState=null,this._target=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo||(this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()),this._worldInfo}SetFirstAbsoluteUpdate(e){this._firstAbsoluteUpdate=!!e}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(e){return typeof this._Getter()==typeof e}BeforeChangeProperty(){}ChangeProperty(e,t,r,i,s,a,n,o){}AfterChangeProperty(){}_FirstKeyframeGetter(){return this._PickTimelinePlaybackMode(()=>{var e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(e)},()=>{var e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)}).GetAbsoluteValue()}_CurrentKeyframeGetter(){let i=this._propertyTrack.GetTimeline().GetTime()-this._propertyTrack.GetTrack().GetStartOffset();return this._PickTimelinePlaybackMode(()=>{var e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(i,e)},()=>{var e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetPropertyTrackData(),r=t.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(i,e);return r||t.GetLastPropertyKeyframeDataItem(e)}).GetAbsoluteValue()}_PickTimelinePlaybackMode(e,t){return(this._propertyTrack.GetTimeline().IsForwardPlayBack()?e:t)()}_PickResultMode(e,t){return("relative"===this._propertyTrack.GetResultMode()?e:t)()}_PickFirstAbsoluteUpdate(e,t){return(this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),e):t)()}_GetAbsoluteInitialValue(e){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target||(this._target=this._sourceAdapter.GetTarget()),this._target}_PickSource(e,t,r,i,s,a){switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e();case"effect":return t();case"instance-variable":return r();case"plugin":return i();case"world-instance":return s();case"audio":return a()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(e){e&&(this._firstAbsoluteUpdate=e.firstAbsoluteUpdate,this._saveState=e.saveState)}_GetPropertyKeyframeStubs(e,t=!1){var r,i=[];for(r of e){var s,a=r.GetTrack().GetStartOffset();for(s of r.GetPropertyKeyframeDataItems())(!t||0!==s.GetTime())&&t||i.push({time:a+s.GetTime(),value:s.GetAbsoluteValue()})}return i.sort((e,t)=>e.time-t.time)}_GetLastPropertyKeyframeStub(e,t,r){return this._GetPropertyKeyframeStubLowerThanPlayhead(t,r)}_GetPropertyKeyframeStubLowerThanPlayhead(t,r){for(let e=r.length-1;0<=e;e--)if(r[e].time<=t)return r[e];return null}}}{let C33=self.C3,TMP_COLORS_MAP=new Map,TMP_COLOR=[0,0,0];class ColorInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){var e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),r=this._GetIndex();switch(e){case"behavior":return this._ToColorArray(t.GetPropertyValueByIndex(r));case"effect":return this._ToColorArray(t[r]);case"plugin":return this._ToColorArray(t.GetPropertyValueByIndex(r));case"world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){var e=this._FirstKeyframeGetter();return!this._CompareColors(e,this._Getter())}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&!this._CompareColors(this._saveState,this._Getter())}_CompareColors(e,t){return e=this._GetColorFromArray(e),t=this._GetColorFromArray(t),e.equalsIgnoringAlpha(t)}_FirstKeyframeGetter(){var e=super._FirstKeyframeGetter();return this._GetColorFromArray(e)}_CurrentKeyframeGetter(){var e=super._CurrentKeyframeGetter();return this._GetColorFromArray(e)}_GetAbsoluteInitialValue(e){}_ToColorArray(e){return(C33.IsInstanceOf(e,C33.Color)?e.toArray():e).slice(0,3)}_GetColorFromArray(e){return C33.IsInstanceOf(e,C33.Color)?e:new C33.Color(e[0],e[1],e[2],1)}CanChange(e){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){var e=this._propertyTrack.GetTimeline(),t=this._propertyTrack.GetInstance(),r=this._propertyTrack.GetSourceAdapter(),e=e.GetSimilarPropertyTracks(t,r,this._property,this._propertyTrack);e&&1<e.length&&(TMP_COLORS_MAP.has(t)||TMP_COLORS_MAP.set(t,new Map),r=TMP_COLORS_MAP.get(t),e=this._propertyTrack.GetSourceAdapterId(),r.has(e)||r.set(e,new Map),(t=r.get(e)).has(this._property)||t.set(this._property,{used:!1,color:new C33.Color(0,0,0,1)}))}_GetTmpColor(e,t,r){e=TMP_COLORS_MAP.get(e).get(t).get(r);return e.used=!0,e.color}ChangeProperty(e,t,r,i,s,a,n,o){var l=this._propertyTrack.GetTimeline(),h=this._propertyTrack.GetTrack(),u=this._propertyTrack.GetInstance(),c=this._propertyTrack.GetSourceAdapter(),_=this._propertyTrack.GetSourceAdapterId(),d=this._property,c=l.GetSimilarPropertyTracks(u,c,d,this._propertyTrack);c&&1<c.length?(d=this._GetPropertyKeyframeStubs(c,!0),(c=this._GetLastPropertyKeyframeStub(l,l.GetTime(),d))&&(l=h.GetStartOffset(),0==(d=c.time-l)?this._GetTmpColor(u,_,this._property).addRgb(t[0],t[1],t[2]):d<0||(h=t[0],c=t[1],l=t[2],d=this._propertyTrack.Interpolate(d,!1,!0),h=C33.Color.DiffChannel(h,d[0]),c=C33.Color.DiffChannel(c,d[1]),l=C33.Color.DiffChannel(l,d[2]),this._GetTmpColor(u,_,this._property).addRgb(h,c,l)))):this._Setter(t[0],t[1],t[2])}AfterChangeProperty(){var e,t,r,i,s,a=this._propertyTrack.GetInstance();TMP_COLORS_MAP.has(a)&&(e=TMP_COLORS_MAP.get(a),t=this._propertyTrack.GetSourceAdapterId(),e.has(t))&&(r=e.get(t)).has(this._property)&&(i=(s=r.get(this._property)).used,s=s.color,i&&this._Setter(s.getR(),s.getG(),s.getB()),0===r.size&&e.delete(t),0===e.size)&&TMP_COLORS_MAP.delete(a)}_Getter(){var e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),r=this._GetIndex();switch(e){case"behavior":return this._GetColorFromArray(t.GetPropertyValueByIndex(r));case"effect":return t[r].clone();case"plugin":return this._GetColorFromArray(t.GetPropertyValueByIndex(r));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(e,t,r){var i=this._propertyTrack.GetSourceAdapterId(),s=this._GetTarget(),a=this._GetIndex();switch(i){case"behavior":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=r,s.SetPropertyValueByIndex(a,TMP_COLOR);break;case"effect":s[a].setRgb(e,t,r);break;case"plugin":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=r,s.SetPropertyValueByIndex(a,TMP_COLOR);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(e,t,r)}}_SaveToJson(){}_LoadFromJson(e){}}C33.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter}{let C33=self.C3,NS=C33.PropertyTrackState;class NoInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(e,t,r,i,s,a,n,o){var l=this._propertyTrack,h=l.GetTrack(),u=l.GetSourceAdapterId(),c=l.GetTimeline(),_=h.GetInstance(),d=l.GetSourceAdapter(),p=this._property,_=c.GetSimilarPropertyTracks(_,d,p,l),e=(_&&1<_.length&&(d=this._GetPropertyKeyframeStubs(_),p=e+h.GetStartOffset(),_=this._GetLastPropertyKeyframeStub(c,p,d))&&(t=_.value),l.GetPropertyKeyframeType());switch(e){case"numeric":if(NS.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,u))break;return;case"angle":if(NS.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,u))break;return;case"boolean":if(NS.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,u))break;return;case"color":if(NS.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,u))break;return;case"text":if(!NS.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,u))return}this._Setter(t)}_Getter(){var e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),r=this._GetIndex();switch(e){case"behavior":return t.GetPropertyValueByIndex(r);case"effect":return t[r];case"instance-variable":return t.GetInstanceVariableValue(r);case"plugin":return t.GetPropertyValueByIndex(r)}}_Setter(e){var t=this._propertyTrack.GetSourceAdapterId(),r=this._GetTarget(),i=this._GetIndex();switch(t){case"behavior":r.SetPropertyValueByIndex(i,e);break;case"effect":r[i]=e;break;case"instance-variable":r.SetInstanceVariableValue(i,e);break;case"plugin":r.SetPropertyValueByIndex(i,e)}}}C33.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter}{let C33=self.C3,NS=C33.PropertyTrackState.PropertyInterpolationAdapter,INSTANCE_FUNC_MAP=new Map,add2=(e,t,r,i,s,a=!1,n=null,o=null)=>{INSTANCE_FUNC_MAP.set(e,{setter:t,absolute_setter:r,getter:i,round:s,fRound:a,init:n,reset:o})};add2("offsetX",(e,t,r,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetX(t,r.GetTimeline().GetTransformWithSceneGraph()):e.OffsetX(t)},(e,t)=>e.SetX(t),e=>e.GetX(),!0),add2("offsetY",(e,t,r,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetY(t,r.GetTimeline().GetTransformWithSceneGraph()):e.OffsetY(t)},(e,t)=>e.SetY(t),e=>e.GetY(),!0),add2("offsetWidth",(t,e,i,a,r)=>{if(0!==e){var n="relative"===a._propertyTrack.GetResultMode(),o=1===a._typeAdapter.GetType();if((n||o)&&t.HasParent()&&t.GetTransformWithParentWidth()){if(isNaN(a._absoluteToFactor)){var l=[];let e=t.GetParent();for(;e;)l.push(e),e=e.GetParent();l.reverse();let s=(e,t)=>t.GetTimeline().GetTrackFromInstance(e.GetInstance());var h=(e,t)=>{var t=s(e,t);return t||(t=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?t.GetOriginalWidth():e._GetSceneGraphInfo()._GetStartWidth()},u=(e,t,r,i=0)=>{var e=s(e,t);return e&&(t=e.GetPropertyTrack(r))&&(e=t.GetPropertyTrackDataItem().GetPropertyKeyframeData())&&(r=e.GetLastPropertyKeyframeDataItem())?r.GetValue():i};let r;if(o)r=l[l.length-1].GetWidth();else{let t=l[0];n=t._GetSceneGraphInfo()._GetStartWidth(),o=t._GetSceneGraphInfo().GetStartScaleX();r=n*o,r=(r+=u(t,i,"offsetWidth"))+h(t,i)*u(t,i,"offsetScaleX");for(let e=1;e<l.length;e++){var c=(t=l[e])._GetSceneGraphInfo().GetStartScaleX();r=(r=(r*=c)+u(t,i,"offsetWidth"))+h(t,i)*u(t,i,"offsetScaleX")}}a._absoluteToFactor=0===r?Number.EPSILON:r}r||t.OffsetWidth(e/a._absoluteToFactor,!0)}else t.OffsetWidth(e)}},(e,t)=>e.SetWidth(t),e=>e.GetWidth(),!0),add2("offsetHeight",(t,e,i,s,r)=>{if(0!==e){var a="relative"===s._propertyTrack.GetResultMode(),n=1===s._typeAdapter.GetType();if((a||n)&&t.HasParent()&&t.GetTransformWithParentHeight()){if(isNaN(s._absoluteToFactor)){var o=[];let e=t.GetParent();for(;e;)o.push(e),e=e.GetParent();o.reverse();var l=(e,t)=>{r=e;var r,t=t.GetTimeline().GetTrackFromInstance(r.GetInstance());return t?t.GetOriginalHeight():(r=e.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?r.GetOriginalHeight():e._GetSceneGraphInfo()._GetStartHeight()},h=(e,t,r,i=0)=>{var t=t.GetTimeline().GetTrackFromInstance(e.GetInstance());return t&&(e=t.GetPropertyTrack(r))&&(t=e.GetPropertyTrackDataItem().GetPropertyKeyframeData())&&(r=t.GetLastPropertyKeyframeDataItem())?r.GetValue():i};let r;if(n)r=o[o.length-1].GetHeight();else{let t=o[0];a=t._GetSceneGraphInfo()._GetStartHeight(),n=t._GetSceneGraphInfo().GetStartScaleY();r=a*n,r=(r+=h(t,i,"offsetHeight"))+l(t,i)*h(t,i,"offsetScaleY");for(let e=1;e<o.length;e++){var u=(t=o[e])._GetSceneGraphInfo().GetStartScaleY();r=(r=(r*=u)+h(t,i))+l(t,i)*h(t,i,"offsetScaleY")}}s._absoluteToFactor=0===r?Number.EPSILON:r}r||t.OffsetHeight(e/s._absoluteToFactor,!0)}else t.OffsetHeight(e)}},(e,t)=>e.SetHeight(t),e=>e.GetHeight(),!0),add2("offsetAngle",(e,t,r,i,s)=>{e.OffsetAngle(t)},(e,t)=>e.SetAngle(t),e=>e.GetAngle(),!1,!0),add2("offsetOpacity",(e,t,r,i,s)=>{t/=i._opacityFactor||1;var a=e.GetOpacity(),a=a+t;0===i._clampAccumulator?(1<a?i._clampAccumulator+=a-1:a<0&&(i._clampAccumulator+=a),e.OffsetOpacity(t)):(a=e.GetOpacity()+t,0<t&&0<i._clampAccumulator?1<a&&(i._clampAccumulator+=a-1):0<t&&i._clampAccumulator<0?(i._clampAccumulator+=t,0<i._clampAccumulator&&(e.OffsetOpacity(i._clampAccumulator),i._clampAccumulator=0)):t<0&&0<i._clampAccumulator?(i._clampAccumulator+=t,i._clampAccumulator<0&&(e.OffsetOpacity(i._clampAccumulator),i._clampAccumulator=0)):t<0&&i._clampAccumulator<0&&a<0&&(i._clampAccumulator+=a))},(e,t)=>{e.SetOpacity(t)},e=>e.GetOpacity(),!1,!0,(r,i,s)=>{switch(r._clampAccumulator=0,r._propertyTrack.GetResultMode()){case"relative":{r._propertyTrack.GetPropertyTrackData();var e,a=r._propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),n=r.GetWorldInfo().GetOpacity();let t=n;for(e of a){var o=e.GetTime(),o=r._propertyTrack.GetInterpolatedValue(o);t=n+o,t=C33.clamp(t,0,1)}r._totalForewardOpacityDelta=n-t,r._totalForewardOpacityDelta=Math.round(100*(r._totalForewardOpacityDelta+Number.EPSILON))/100,t=n;for(let e=a.length-1;0<=e;e--){var l=a[e].GetTime(),l=r._propertyTrack.GetInterpolatedValue(l);t-=l,t=C33.clamp(t,0,1)}r._totalBackwardOpacityDelta=t,r._totalBackwardOpacityDelta=Math.round(100*(r._totalBackwardOpacityDelta+Number.EPSILON))/100;break}}var t="relative"===r._propertyTrack.GetResultMode(),h=1===r._typeAdapter.GetType();if((t||h)&&i.HasParent()&&i.GetTransformWithParentOpacity()){var u=[];let e=i.GetParent();for(;e;)u.push(e),e=e.GetParent();u.reverse();var c=(e,t,r)=>{var t=t.GetTimeline().GetTrackFromInstance(e.GetInstance());return t&&(e=t.GetPropertyTrack(r))&&(t=e.GetPropertyTrackDataItem().GetPropertyKeyframeData())&&(r=t.GetLastPropertyKeyframeDataItem())?r.GetValue():0};let t=u[0]._GetSceneGraphInfo().GetStartOpacity();t+=c(u[0],s,"offsetOpacity");for(let e=1;e<u.length;e++)t+=c(u[e],s,"offsetOpacity");r._opacityFactor=0===t?1:t}},e=>{var t,r;"relative"===e._propertyTrack.GetResultMode()&&(e._clampAccumulator=0,r=(t=e.GetWorldInfo()).GetOpacity(),r=Math.round(100*(r+Number.EPSILON))/100,e._propertyTrack.GetTimeline().IsForwardPlayBack()?(t.SetOpacity(r+e._totalForewardOpacityDelta),e._lastValue=0):(t.SetOpacity(r-e._totalBackwardOpacityDelta),e._lastValue=e.GetSourceAdapter().GetValueAtTime()))}),add2("offsetOriginX",(e,t)=>e.OffsetOriginX(t),(e,t)=>e.SetOriginX(t),e=>e.GetOriginX(),!1),add2("offsetOriginY",(e,t)=>e.OffsetOriginY(t),(e,t)=>e.SetOriginY(t),e=>e.GetOriginY(),!1),add2("offsetZElevation",(e,t)=>e.OffsetZElevation(t),(e,t)=>e.SetZElevation(t),e=>e.GetZElevation(),!0),add2("offsetScaleX",(e,t,r,i)=>{var s,a;0!==t&&(s=e.GetWidth()<0?-1:1,"relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentWidth()?(a=r.GetOriginalWidth()*s*t,isNaN(i._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetWidth").setter(e,1,r,i,!0),e.OffsetWidth(a/i._absoluteToFactor,!0)):e.OffsetWidth(r.GetOriginalWidth()*s*t))},(e,t,r)=>{e.SetWidth(r.GetOriginalWidth()*t)},(t,r)=>{var i=t.GetWidth()<0?-1:1;if(t.GetTransformWithParentWidth()){var s=t.GetParent(),a=r.GetTimeline().GetTrackFromInstance(s.GetInstance());let e=NaN;return e=a?s.GetWidth()/a.GetOriginalWidth():(a=s.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?s.GetWidth()/a.GetOriginalWidth():1,t.GetWidth()*i/(r.GetOriginalWidth()*e)}return t.GetWidth()*i/r.GetOriginalWidth()},!1),add2("offsetScaleY",(e,t,r,i)=>{var s,a;0!==t&&(s=e.GetHeight()<0?-1:1,"relative"===i._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentHeight()?(a=r.GetOriginalHeight()*s*t,isNaN(i._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetHeight").setter(e,1,r,i,!0),e.OffsetHeight(a/i._absoluteToFactor,!0)):e.OffsetHeight(r.GetOriginalHeight()*s*t))},(e,t,r)=>{e.SetHeight(r.GetOriginalHeight()*t)},(t,r)=>{var i=t.GetHeight()<0?-1:1;if(t.GetTransformWithParentHeight()){var s=t.GetParent(),a=r.GetTimeline().GetTrackFromInstance(s.GetInstance());let e=NaN;return e=a?s.GetHeight()/a.GetOriginalHeight():(a=s.GetInstance().GetSdkInstance()).IsOriginalSizeKnown()?s.GetHeight()/a.GetOriginalHeight():1,t.GetHeight()*i/(r.GetOriginalHeight()*e)}return t.GetHeight()*i/r.GetOriginalHeight()},!1);class NumericInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e),this._lastValue=0,this._clampAccumulator=0,this._totalForewardOpacityDelta=0,this._totalBackwardOpacityDelta=0,this._opacityFactor=NaN,this._absoluteToFactor=NaN,this._angleReflectMirrorOrFlip=void 0,this._angleReflectMirrorAndFlip=void 0,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._reset_action=null,this._init_action=null,this._source_adapter_getter=null,this._source_adapter_setter=null,this._source_adapter_absolute_setter=null,this._round=!1,this._fRound=!1,C33.IsInstanceOf(this._propertyTrack.GetTimeline(),C33.TweenState)?this._typeAdapter=new C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);var t=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case"world-instance":var r=INSTANCE_FUNC_MAP.get(t);this._instance_getter=r.getter,this._instance_setter=r.setter,this._instance_absolute_setter=r.absolute_setter,this._round=r.round,this._fRound=r.fRound,this._init_action=r.init,this._reset_action=r.reset;break;case"audio":this._source_adapter_getter=e.Getter,this._source_adapter_setter=e.Setter,this._source_adapter_absolute_setter=e.AbsoluteSetter,this._round=!!e.DoesRounding(),this._fRound=!1}}Release(){this._typeAdapter=null,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._reset_action=null,this._init_action=null,this._source_adapter_getter=null,this._source_adapter_setter=null,this._source_adapter_absolute_setter=null,super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(e){this._lastValue=e}SetResetState(){this._reset_action&&this._reset_action(this)}SetInitialState(){var e,t=this._typeAdapter.SetInitialState();"number"==typeof t&&(this._lastValue=t),this._init_action&&(t=this.GetWorldInfo(),e=this._propertyTrack.GetTrack(),this._init_action(this,t,e))}SetResumeState(){var e=this._typeAdapter.SetResumeState();"number"==typeof e&&(this._lastValue=e)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(e,t,r,i,s,a,n,o){return this._typeAdapter.ChangeProperty(e,t,r,i,s,a,n,o)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){var e=this._GetTarget(),t=this._GetIndex(),r=this.GetWorldInfo(),i=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e.GetPropertyValueByIndex(t);case"effect":return e[t];case"instance-variable":return e.GetInstanceVariableValue(t);case"plugin":return e.GetPropertyValueByIndex(t);case"world-instance":return this._instance_getter(r,i);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),r,i)}}_Setter(e,t,r){var i=this._GetTarget(),s=this._GetIndex(),a=this.GetWorldInfo(),n=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":i.OffsetPropertyValueByIndex(s,e);break;case"effect":i[s]+=e;break;case"instance-variable":i.SetInstanceVariableOffset(s,e);break;case"plugin":i.OffsetPropertyValueByIndex(s,e,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_setter(a,e,n,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),a,e,n,this)}}_SetterAbsolute(e,t,r){var i=this._propertyTrack.GetInterpolationMode();if("discrete"!==(i="default"===i?"continuous":i)||t){if("discrete"===i&&r){t=this._propertyTrack.GetTimeline().GetTime();if(!this._propertyTrack.GetPropertyKeyFrameDataItemAtTime(t))return}var s=this._GetTarget(),a=this._GetIndex(),n=this.GetWorldInfo(),o=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":s.SetPropertyValueByIndex(a,e);break;case"effect":s[a]=e;break;case"instance-variable":s.SetInstanceVariableValue(a,e);break;case"plugin":s.SetPropertyValueByIndex(a,e,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_absolute_setter(n,e,o);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),n,e,o)}}}_MaybeEnsureValue(e,t,r,i,s,a,n,o){this._typeAdapter._MaybeEnsureValue(e,t,r,i,s,a,n,o)}_AddDelta(e,t,r,i,s){var e=((e="angle"===this._propertyTrack.GetPropertyType()?C33.toDegrees(e):e).toString().split(".")[1]||"").length,a=this._Getter();let n;switch(n=0===e?this._round?Math.round(a):this._fRound?"angle"===this._propertyTrack.GetPropertyType()?C33.toRadians(Math.round(C33.toDegrees(a))):Number(C33.toFixed(a,2)):a:this._round?Number(C33.toFixed(a,e)):(this._fRound,a),this._Setter(n-a,t,r),this._propertyTrack.GetPropertyName()){case"offsetWidth":case"offsetScaleX":var o=this.GetWorldInfo(),l=o.GetWidth(),h=Number(C33.toFixed(l,2));o.OffsetWidth(h-l);break;case"offsetHeight":case"offsetScaleY":o=this.GetWorldInfo(),h=o.GetHeight(),l=Number(C33.toFixed(h,2));o.OffsetHeight(l-h)}}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator,fod:this._totalForewardOpacityDelta,bod:this._totalBackwardOpacityDelta,of:this._opacityFactor,sf:this._absoluteToFactor,armorf:this._angleReflectMirrorOrFlip,armandf:this._angleReflectMirrorAndFlip})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._lastValue=e.v,this._clampAccumulator=e.a,this._totalForewardOpacityDelta=C33.IsFiniteNumber(e.fod)?e.fod:0,this._totalBackwardOpacityDelta=C33.IsFiniteNumber(e.bod)?e.bod:0,this._opacityFactor=C33.IsFiniteNumber(e.of)?e.of:NaN,this._absoluteToFactor=C33.IsFiniteNumber(e.sf)?e.sf:NaN,this._angleReflectMirrorOrFlip=C33.IsFiniteNumber(e.armorf)?e.armorf:void 0,this._angleReflectMirrorAndFlip=C33.IsFiniteNumber(e.armandf)?e.armandf:void 0)}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter}{let C33=self.C3;class AbsoluteValueObject{constructor(e){this._used=!1,this._value=0,this._propertyKeyframeReached=!1,this._endState=!1,this._propertyTracks=e;for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(e){this._value=e}GetValue(){return this._value}SetPropertyKeyframeReached(e){this._propertyKeyframeReached=e}GetPropertyKeyframeReached(){return this._propertyKeyframeReached}SetEndState(e){this._endState=e}GetEndState(){return this._endState}Reset(){this._used=!1,this._value=0,this._propertyKeyframeReached=!1,this._endState=!1}}class NumericInterpolationAdapterForTimeline{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 0}SetInitialState(){let e=this._numericInterpolationAdapter;this._numericInterpolationAdapter.GetPropertyTrack();return e._PickResultMode(()=>e._PickTimelinePlaybackMode(()=>0,()=>e.GetSourceAdapter().GetValueAtTime()),()=>{})}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){this._numericInterpolationAdapter;switch(this._numericInterpolationAdapter.GetPropertyTrack().GetResultMode()){case"relative":return!1;case"absolute":return!0}}BeforeChangeProperty(){this._numericInterpolationAdapter;var e,t,r,i=this._numericInterpolationAdapter.GetPropertyTrack(),s=i.GetPropertyName();switch(i.GetResultMode()){case"relative":break;case"absolute":i.HasAbsoluteValueObject()?i.GetAbsoluteValueObject().Reset():(r=i.GetTimeline(),e=i.GetInstance(),t=i.GetSourceAdapter(),(r=r.GetSimilarPropertyTracks(e,t,s,i))&&1<r.length&&new AbsoluteValueObject(r))}}ChangeProperty(e,t,r,i,s,a,n,o){var l=this._numericInterpolationAdapter,h=this._numericInterpolationAdapter.GetPropertyTrack();switch(h.GetResultMode()){case"relative":var u=l.GetLastValue();l._Setter(t-u,r,i),a&&this._MaybeEnsureValue(e,r,i,s,u,t),l.SetLastValue(t);break;case"absolute":var u=h.GetTimeline(),c=h.GetTrack();h.GetInstance(),h.GetSourceAdapter();if(h.HasAbsoluteValueObject()){var _=h.GetAbsoluteValueObject(),d=_.GetPropertyTracks(),d=l._GetPropertyKeyframeStubs(d,!0),u=l._GetLastPropertyKeyframeStub(u,u.GetTime(),d);if(u){d=c.GetStartOffset(),c=u.time-d;if(0==c)_.SetEndState(n),_.SetPropertyKeyframeReached(o),_.SetUsed(),_.SetValue(_.GetValue()+t);else{if(c<0)return;u=h.GetInterpolatedValue(c);_.SetEndState(n),_.SetPropertyKeyframeReached(o),_.SetUsed(),_.SetValue(_.GetValue()+(t-u))}}}else l._SetterAbsolute(t,o,n)}}AfterChangeProperty(){var e,t=this._numericInterpolationAdapter,r=this._numericInterpolationAdapter.GetPropertyTrack();switch(r.GetResultMode()){case"relative":break;case"absolute":r.HasAbsoluteValueObject()&&(e=r.GetAbsoluteValueObject()).GetUsed()&&t._SetterAbsolute(e.GetValue(),e.GetPropertyKeyframeReached(),e.GetEndState())}}_MaybeEnsureValue(e,t,r,i,s,a){var n=this._numericInterpolationAdapter;i||(t&&e===t.GetTime()?n._AddDelta(t.GetValueWithResultMode(),t,r):r&&e===r.GetTime()?n._AddDelta(r.GetValueWithResultMode(),t,r):a-s==0&&n._AddDelta(t.GetValueWithResultMode(),t,r))}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline}{let C33=self.C3;class NumericInterpolationAdapterForTween{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 1}SetInitialState(){var e=this._numericInterpolationAdapter;return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._FirstKeyframeGetter())}SetResumeState(){var e=this._numericInterpolationAdapter;if(e._FirstKeyframeGetter()!==e._CurrentKeyframeGetter())return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(e,t,r,i,s,a,n,o){var l=this._numericInterpolationAdapter,h=l.GetLastValue();switch(l.GetPropertyTrack().GetResultMode()){case"relative":l._Setter(t-h,r,i),a&&this._MaybeEnsureValue(e,r,i,s,h,t,!1,n);break;case"absolute":l.GetFirstAbsoluteUpdate()?(l.SetFirstAbsoluteUpdate(!1),l._Setter(h,r,i)):0===e&&0===l.GetPropertyTrack().GetTimeline().GetTotalTime()?l._SetterAbsolute(t,!0,!1):(l._Setter(t-h,r,i),a&&this._MaybeEnsureValue(e,r,i,s,h,t,this._ForceEndValue(),n))}l.SetLastValue(t)}AfterChangeProperty(){}_GetAbsoluteInitialValue(e){return e-this._numericInterpolationAdapter.GetCurrentState()}_ForceEndValue(){var e,t=this._numericInterpolationAdapter,r=t.GetWorldInfo().GetInstance();let i=0;for(e of t.GetPropertyTrack().GetRuntime().GetTimelineManager().GetPlayingTimelines())0===e.GetType()?e.HasTrackInstance(r)&&i++:1===e.GetType()&&e.GetInstance()===r&&i++;return i<=1}_MaybeEnsureValue(e,t,r,i,s,a,n,o){var l=this._numericInterpolationAdapter;i?t&&e===t.GetTime()?l._AddDelta(t.GetValueWithResultMode(),t,r,n,o):r&&e===r.GetTime()?l._AddDelta(r.GetValueWithResultMode(),t,r,n,o):r||l._AddDelta(t.GetValueWithResultMode(),t,r,n,o):t&&e===t.GetTime()?l._AddDelta(t.GetValueWithResultMode(),t,r,n,o):r&&e===r.GetTime()?l._AddDelta(r.GetValueWithResultMode(),t,r,n,o):a-s==0&&l._AddDelta(t.GetValueWithResultMode(),t,r,n,o)}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween}{let C33=self.C3,Ease=self.Ease;C33.PropertyTrackState.NumericTypeAdapter=class NumericTypeAdapter{constructor(){}static WillChange(e,t,r,i){let s;switch(i){case"behavior":s=t.GetPropertyValueByIndex(e);break;case"effect":s=t[e];break;case"instance-variable":s=t.GetInstanceVariableValue(e);break;case"plugin":s=t.GetPropertyValueByIndex(e)}return s!==r}static Interpolate(t,r,i,s){if(!i)return n=s.GetPropertyTrackDataItem(),(n=s.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(n)).GetValueWithResultMode();let a=s.GetInterpolationMode();if("default"===a&&(a="continuous"),"discrete"===(a="combo"===s.GetPropertyType()?"discrete":a))return r.GetValueWithResultMode();if("continuous"===a||"step"===a){var n=s.GetTimeline().GetStep(),o=("step"===a&&0!==n&&(o=1/n,t=Math.floor(t*o)/o),r.GetValueWithResultMode()),l=i.GetValueWithResultMode(),h=r.GetAddOn("cubic-bezier"),u=i.GetAddOn("cubic-bezier"),c=h&&h.GetStartEnable()&&u&&u.GetEndEnable();if(!c&&o===l)return o;var _=r.GetTime(),i=i.GetTime(),n=("step"===a&&0!==n&&(t=C33.clamp(t,_,i)),C33.normalize(t,_,i)),t=r.GetEase();let e;return e=c?(r=i-_,e=Ease.GetRuntimeEase(t)(r*n,0,1,r),Ease.GetRuntimeEase("cubicbezier")(e,o,o+h.GetStartAnchor(),l+u.GetEndAnchor(),l)):Ease.GetRuntimeEase(t)((i-_)*n,o,l-o,i-_),"integer"===s.GetPropertyType()?Math.floor(e):e}}}}{let C33=self.C3;C33.PropertyTrackState.AngleTypeAdapter=class AngleTypeAdapter{constructor(){}static WillChange(e,t,r,i){let s;switch(i){case"behavior":s=t.GetPropertyValueByIndex(e);break;case"effect":s=t[e];break;case"instance-variable":s=t.GetInstanceVariableValue(e);break;case"plugin":s=t.GetPropertyValueByIndex(e)}return s!==r}static Interpolate(e,t,r,i){if(!r)return a=i.GetPropertyTrackDataItem(),(a=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(a)).GetValueWithResultMode();let s=i.GetInterpolationMode();if("default"===s&&(s="continuous"),"discrete"===(s="combo"===i.GetPropertyType()?"discrete":s))return t.GetValueWithResultMode();if("continuous"===s||"step"===s){var a=i.GetTimeline().GetStep(),i=("step"===s&&0!==a&&(i=1/a,e=Math.floor(e*i)/i),t.GetTime()),n=r.GetTime(),o=t.GetValueWithResultMode(),l=r.GetValueWithResultMode(),r=("step"===s&&0!==a&&(e=C33.clamp(e,i,n)),t.GetAddOn("angle"));if(!r)return o===l?o:(a=C33.normalize(e,i,n),u=self.Ease.GetRuntimeEase(t.GetEase()),C33.angleLerp(o,l,u(a,0,1,1)));var h=r.GetRevolutions();if(o===l&&0===h)return o;var u=C33.normalize(e,i,n),c=self.Ease.GetRuntimeEase(t.GetEase())(u,0,1,1);switch(r.GetDirection()){case"closest":return C33.angleLerp(o,l,c,h);case"clockwise":return C33.angleLerpClockwise(o,l,c,h);case"anti-clockwise":return C33.angleLerpAntiClockwise(o,l,c,h)}}}}}{let C33=self.C3;C33.PropertyTrackState.BooleanTypeAdapter=class BooleanTypeAdapter{constructor(){}static WillChange(e,t,r,i){let s;switch(i){case"behavior":s=t.GetPropertyValueByIndex(e);break;case"effect":s=t[e];break;case"instance-variable":s=t.GetInstanceVariableValue(e);break;case"plugin":s=t.GetPropertyValueByIndex(e)}return!!s!=!!r}static Interpolate(e,t,r,i){return r?t.GetValueWithResultMode()?1:0:(r=i.GetPropertyTrackDataItem(),(r=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(r)).GetValueWithResultMode()?1:0)}}}{let C33=self.C3,TEMP_COLOR_ARRAY=[0,0,0],TEMP_COLOR_ARRAY_2=[0,0,0],TEMP_COLOR_ARRAY_3=[0,0,0];C33.PropertyTrackState.ColorTypeAdapter=class ColorTypeAdapter{constructor(){}static WillChange(e,t,r,i){let s;switch(i){case"behavior":s=t.GetPropertyValueByIndex(e);break;case"effect":s=t[e];break;case"instance-variable":s=t.GetInstanceVariableValue(e);break;case"plugin":s=t.GetPropertyValueByIndex(e)}return Array.isArray(r)?(TEMP_COLOR_ARRAY[0]=r[0],TEMP_COLOR_ARRAY[1]=r[1],TEMP_COLOR_ARRAY[2]=r[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(r),TEMP_COLOR_ARRAY[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),Array.isArray(s)?(TEMP_COLOR_ARRAY_2[0]=s[0],TEMP_COLOR_ARRAY_2[1]=s[1],TEMP_COLOR_ARRAY_2[2]=s[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(s),TEMP_COLOR_ARRAY_2[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY_2[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY_2[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0]||TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1]||TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2]}static Interpolate(e,t,r,i){var s,a,n,o,l,h;if(!r)return s=i.GetPropertyTrackDataItem(),s=(s=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(s)).GetValueWithResultMode(),TEMP_COLOR_ARRAY[0]=s[0],TEMP_COLOR_ARRAY[1]=s[1],TEMP_COLOR_ARRAY[2]=s[2],TEMP_COLOR_ARRAY;let u=i.GetInterpolationMode();return"discrete"===(u="default"===u?"continuous":u)?(s=t.GetValueWithResultMode(),TEMP_COLOR_ARRAY[0]=s[0],TEMP_COLOR_ARRAY[1]=s[1],TEMP_COLOR_ARRAY[2]=s[2],TEMP_COLOR_ARRAY):"continuous"===u||"step"===u?(s=i.GetTimeline().GetStep(),"step"===u&&0!==s&&(i=1/s,e=Math.floor(e*i)/i),i=t.GetTime(),h=r.GetTime(),n=t.GetValueWithResultMode(),r=r.GetValueWithResultMode(),"step"===u&&0!==s&&(e=C33.clamp(e,i,h)),s=C33.normalize(e,i,h),e=t.GetEase(),t=n[0],a=n[1],n=n[2],o=r[0],l=r[1],r=r[2],e=self.Ease.GetRuntimeEase(e),i=(h=h-i)*s,TEMP_COLOR_ARRAY[0]=t===o?t:e(i,t,o-t,h),TEMP_COLOR_ARRAY[1]=a===l?a:e(i,a,l-a,h),TEMP_COLOR_ARRAY[2]=n===r?n:e(i,n,r-n,h),TEMP_COLOR_ARRAY):void 0}}}{let C33=self.C3;C33.PropertyTrackState.TextTypeAdapter=class TextTypeAdapter{constructor(){}static WillChange(e,t,r,i){let s;switch(i){case"behavior":s=t.GetPropertyValueByIndex(e);break;case"effect":s=t[e];break;case"instance-variable":s=t.GetInstanceVariableValue(e);break;case"plugin":s=t.GetPropertyValueByIndex(e)}return s!==r}static Interpolate(e,t,r,i){return(r?t:(r=i.GetPropertyTrackDataItem(),r=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(r))).GetValueWithResultMode()}}}{let C33=self.C3;C33.TimelineDataManager=class TimelineDataManager{constructor(){this._timelineDataItems=new Map}Release(){for(var e of this._timelineDataItems.values())e.Release();this._timelineDataItems.clear(),this._timelineDataItems=null}Add(e){var e=new C33.TimelineDataItem(e),t=e.GetName();this._timelineDataItems.set(t,e)}Get(e){return this._timelineDataItems.get(e)}GetNameId(){return 0}static _CreateDataItems(e,t,r,i){if(t)for(var s of t)C33.TimelineDataManager._CreateDataItem("create",s,e,r,i)}static _CreateDataItemsIncludingDisabled(e,t,r,i){if(t)for(var s of t)C33.TimelineDataManager._CreateDataItem("create-including-disabled",s,e,r,i)}static _LoadDataItemsFromJson(r,e,t,i){r.length?e.forEach((e,t)=>{r[t]._LoadFromJson(e)}):e.forEach(e=>{C33.TimelineDataManager._CreateDataItem("load",e,r,t,i)})}static _CreateDataItem(e,t,r,i,s){let a;if("function"==typeof i)switch(e){case"load":a=new i(null,s);break;case"create":case"create-including-disabled":a=new i(t,s)}else if("object"==typeof i){var n=t[i.prop],o=i.map.get(n);switch(e){case"load":a=new o(null,s);break;case"create":case"create-including-disabled":a=new o(t,s)}}switch(e){case"load":a._LoadFromJson(t),r.push(a);break;case"create":if("function"==typeof a.GetEnable&&!a.GetEnable())return a.Release();r.push(a);break;case"create-including-disabled":r.push(a)}}}}{let C33=self.C3,NAME=0,TOTAL_TIME=1,STEP=2,INTERPOLATION_MODE=3,RESULT_MODE=4,TRACKS=5,LOOP=6,PING_PONG=7,REPEAT_COUNT=8,START_ON_LAYOUT=9,TRANSFORM_WITH_SCENE_GRAPH=10,USE_SYSTEM_TIMESCALE=11;C33.TimelineDataItem=class TimelineDataItem{constructor(e){this._name="",this._totalTime=NaN,this._step=0,this._interpolationMode="default",this._resultMode="default",this._loop=!1,this._pingPong=!1,this._repeatCount=1,this._trackData=null,this._startOnLayout="",this._transformWithSceneGraph=!1,this._useSystemTimescale=!0,e&&(this._name=e[NAME],this._totalTime=e[TOTAL_TIME],this._step=e[STEP],this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._loop=!!e[LOOP],this._pingPong=!!e[PING_PONG],this._repeatCount=e[REPEAT_COUNT],this._startOnLayout=e[START_ON_LAYOUT],this._transformWithSceneGraph=!!e[TRANSFORM_WITH_SCENE_GRAPH],this._useSystemTimescale=!!e[USE_SYSTEM_TIMESCALE],this._trackData=new C33.TrackData(e[TRACKS],this))}Release(){this._trackData.Release(),this._trackData=null}GetTrackData(){return this._trackData||(this._trackData=new C33.TrackData(null,this)),this._trackData}GetName(){return this._name}SetName(e){this._name=e}GetTotalTime(){return this._totalTime}SetTotalTime(e){this._totalTime=e}GetStep(){return this._step}SetStep(e){this._step=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetLoop(){return this._loop}SetLoop(e){this._loop=e}GetPingPong(){return this._pingPong}SetPingPong(e){this._pingPong=e}GetRepeatCount(){return this._repeatCount}SetRepeatCount(e){this._repeatCount=e}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount,startOnLayout:this._startOnLayout,transformWithSceneGraph:!!this._transformWithSceneGraph,useSystemTimescale:this._useSystemTimescale}}_LoadFromJson(e){e&&(this.GetTrackData()._LoadFromJson(e.trackDataJson),this._name=e.name,this._totalTime=e.totalTime,this._step=e.step,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._loop=e.loop,this._pingPong=e.pingPong,this._repeatCount=e.repeatCount,this._startOnLayout=e.startOnLayout,this._transformWithSceneGraph=!!e.transformWithSceneGraph,this._useSystemTimescale=!!e.useSystemTimescale)}}}{let C33=self.C3,WI_DATA=0,OC_INDEX=1,WI_UID=2,INTERPOLATION_MODE=1,RESULT_MODE=2,ENABLED=3,KEYFRAMES=4,PROPERTY_TRACKS=5,ID=6,NESTED_DATA=7,START_OFFSET=0,LOCAL_TOTAL_TIME=1,WI_ADDITIONAL_DATA=8,ORIGINAL_WIDTH=0,ORIGINAL_HEIGHT=1,TRACK_TYPE=9,TRACK_NAME=10;class TrackDataItem{constructor(e,t){this._trackData=t,this._instanceData=null,this._additionalInstanceData=null,this._instanceUid=NaN,this._objectClassIndex=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._keyframeData=null,this._propertyTrackData=null,this._id="",this._nestedData=null,this._startOffset=0,this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),this._type=0,this._name="",e&&(e[WI_DATA]&&(this._instanceData=e[WI_DATA],this._instanceUid=e[WI_DATA][WI_UID],this._objectClassIndex=e[WI_DATA][OC_INDEX]),this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._enabled=!!e[ENABLED],e[ID]&&(this._id=e[ID]),e[NESTED_DATA]&&(this._nestedData=e[NESTED_DATA],this._startOffset=e[NESTED_DATA][START_OFFSET],this._localTotalTime=e[NESTED_DATA][LOCAL_TOTAL_TIME]),e[WI_ADDITIONAL_DATA]&&(this._additionalInstanceData=e[WI_ADDITIONAL_DATA]),e[WI_ADDITIONAL_DATA]&&(this._additionalInstanceData=e[WI_ADDITIONAL_DATA]),e[TRACK_TYPE]&&(this._type=e[TRACK_TYPE]),e[TRACK_NAME]&&(this._name=e[TRACK_NAME]),this._keyframeData=new C33.KeyframeData(e[KEYFRAMES],this),this._propertyTrackData=new C33.PropertyTrackData(e[PROPERTY_TRACKS],this))}Release(){this._instanceData=null,this._trackData=null,this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null),this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null),this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){return this._keyframeData||(this._keyframeData=new C33.KeyframeData(null,this)),this._keyframeData}GetPropertyTrackData(){return this._propertyTrackData||(this._propertyTrackData=new C33.PropertyTrackData(null,this)),this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(e){this._objectClassIndex=e}GetInstanceUID(){return this._instanceUid}SetInstanceUID(e){this._instanceUid=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(e){this._localTotalTime=e}GetOriginalWidth(){return this._additionalInstanceData[ORIGINAL_WIDTH]}SetOriginalWidth(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_WIDTH]=e}GetOriginalHeight(){return this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_HEIGHT]}SetOriginalHeight(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_HEIGHT]=e}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(e){e&&(this._instanceData=e.instanceData,this._instanceUid=e.instanceUid,this._objectClassIndex=e.objectClassIndex,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._id=e.id,this._type=e.type||0,this._name=e.name||"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),e.nestedData&&(this._nestedData=e.nestedData,this._startOffset=this._nestedData[START_OFFSET],this._localTotalTime=this._nestedData[LOCAL_TOTAL_TIME]),e.additionalInstanceData&&(this._additionalInstanceData=e.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(e.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(e.propertyTrackDataJson))}}C33.TrackData=class TrackData{constructor(e,t){this._timelineDataItem=t,this._trackDataItems=[],C33.TimelineDataManager._CreateDataItems(this._trackDataItems,e,TrackDataItem,this)}Release(){this._timelineDataItem=null;for(var e of this._trackDataItems)e.Release();C33.clearArray(this._trackDataItems),this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){var e=new TrackDataItem(null,this);return this._trackDataItems.push(e),e}GetFirstKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray().at(-1)}GetKeyFrameDataItemAtTime(t,e){var r=e.GetKeyframeData().GetKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()===t)return s}}GetFirstKeyFrameDataItemHigherThan(t,e){var r=e.GetKeyframeData().GetKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()>t)return s}}GetFirstKeyFrameDataItemHigherOrEqualThan(t,e){var r=e.GetKeyframeData().GetKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()>=t)return s}}GetFirstKeyFrameDataItemLowerOrEqualThan(t,e){var r=e.GetKeyframeData().GetKeyframeDataItemArray();for(let e=r.length-1;0<=e;e--){var i=r[e];if(i.GetTime()<=t)return i}}*trackDataItems(){for(var e of this._trackDataItems)yield e}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,e.trackDataItemsJson,TrackDataItem,this)}}}{let C33=self.C3,SOURCE_DATA=0,SOURCE=0,PROPERTY=1,TYPE=2,MIN=3,MAX=4,INTERPOLATION_MODE=5,RESULT_MODE=6,ENABLED=7,PROPERTY_KEYFRAMES=8,CAN_HAVE_PROPERTY_KEYFRAMES=9;class PropertyTrackDataItem{constructor(e,t){this._propertyTrackData=t,this._sourceAdapterId="",this._sourceAdapterArguments=null,this._property=null,this._type=null,this._min=NaN,this._max=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._propertyKeyframeData=null,this._canHavePropertyKeyframes=!0,e&&(this._sourceAdapterId=e[SOURCE_DATA][SOURCE],this._sourceAdapterArguments=e[SOURCE_DATA].slice(1),this._property=e[PROPERTY],this._type=e[TYPE],this._min=e[MIN],this._max=e[MAX],this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._enabled=!!e[ENABLED],this._propertyKeyframeData=new C33.PropertyKeyframeData(e[PROPERTY_KEYFRAMES],this),this._canHavePropertyKeyframes=e[CAN_HAVE_PROPERTY_KEYFRAMES])}Release(){this._propertyKeyframeData.Release(),this._propertyKeyframeData=null,this._propertyTrackData=null,this._sourceAdapterArguments=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){return this._propertyKeyframeData||(this._propertyKeyframeData=new C33.PropertyKeyframeData(null,this)),this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(e){this._sourceAdapterId=e}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(e){this._sourceAdapterArguments=e}GetProperty(){return this._property}SetProperty(e){this._property=e}GetType(){return this._type}SetType(e){this._type=e}GetMin(){return this._min}SetMin(e){this._min=e}GetMax(){return this._max}SetMax(e){this._max=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(e){e&&(this._sourceAdapterId=e.sourceAdapterId,this._sourceAdapterArguments=e.sourceAdapterArguments,this._property=e.property,this._type=e.type,this._min=e.min,this._max=e.max,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._canHavePropertyKeyframes=e.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(e.propertyKeyframeDataJson))}}C33.PropertyTrackData=class PropertyTrackData{constructor(e,t){this._trackDataItem=t,this._propertyTrackDataItems=[],C33.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,e,PropertyTrackDataItem,this)}Release(){this._trackDataItem=null;for(var e of this._propertyTrackDataItems)e.Release();C33.clearArray(this._propertyTrackDataItems),this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){var e=new PropertyTrackDataItem(null,this);return this._propertyTrackDataItems.push(e),e}GetFirstPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray().at(-1)}GetPropertyKeyFrameDataItemAtTime(t,e){var r=e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()===t)return s}}GetFirstPropertyKeyFrameDataItemHigherThan(t,e){var r=e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()>t)return s}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(t,e){var r=e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetTime()>=t)return s}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(t,e){var r=e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();for(let e=r.length-1;0<=e;e--){var i=r[e];if(i.GetTime()<=t)return i}}*propertyTrackDataItems(){for(var e of this._propertyTrackDataItems)yield e}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,e.propertyTrackDataItemsJson,PropertyTrackDataItem,this)}}}{let C33=self.C3,TIME=0,EASE=1,ENABLE=2,TAGS=3;class KeyframeDataItem{constructor(e,t){this._keyframeData=t,this._time=-1,this._ease="noease",this._enable=!1,this._tags=null,this._lowerTags=null,e&&(this._time=e[TIME],this._ease=e[EASE],this._enable=!!e[ENABLE],t=e[TAGS],this._tags=t?t.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())),this._next=null)}Release(){this._keyframeData=null,C33.clearArray(this._tags),this._tags=null,this._lowerTags.clear(),this._lowerTags=null,this._next=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(e){this._next=e}GetTime(){return this._time}SetTime(e){this._time=e,this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(e){this._tags=e?e.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase()))}GetLowerTags(){return this._lowerTags}HasTag(e){return this._lowerTags.has(e.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,tags:this._tags}}_LoadFromJson(e){e&&(this._time=e.time,this._ease=e.ease,this._enable=e.enable,this._tags=e.tags,this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())))}}C33.KeyframeData=class KeyframeData{constructor(e,t){this._trackDataItem=t,this._keyframeDataItems=[],C33.TimelineDataManager._CreateDataItems(this._keyframeDataItems,e,KeyframeDataItem,this),this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(var e of this._keyframeDataItems)e.Release();C33.clearArray(this._keyframeDataItems),this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<this._keyframeDataItems.length;e++)this._keyframeDataItems[e].SetNext(this._keyframeDataItems[e+1])}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){var e=new KeyframeDataItem(null,this);return this._keyframeDataItems.push(e),this._LinkKeyframeDataItems(),e}DeleteKeyframeDataItems(e){for(var t of this._keyframeDataItems){var r;e(t)&&-1!==(r=this._keyframeDataItems.indexOf(t))&&(t.Release(),this._keyframeDataItems.splice(r,1))}this.SortKeyframeDataItems(),this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetKeyframeDataItemIndex(e){return this._keyframeDataItems.indexOf(e)}GetKeyframeDataItemFromIndex(e){return this._keyframeDataItems[e]}*keyframeDataItems(){for(var e of this._keyframeDataItems)yield e}*keyframeDataItemsReverse(){for(let e=this._keyframeDataItems.length-1;0<=e;e--)yield this._keyframeDataItems[e]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&(C33.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,e.keyframeDataItemsJson,KeyframeDataItem,this),this._LinkKeyframeDataItems())}}}{let C33=self.C3,VALUE_DATA=0,VALUE_DATA_VALUE=0,VALUE_DATA_ABSOLUTE_VALUE=1,VALUE_DATA_TYPE=2,TIME=1,EASE=2,ENABLE=3,ADDONS=4,PATH_MODE=5;class PropertyKeyframeDataItem{constructor(e,t){this._propertyKeyframeData=t,this._value=null,this._aValue=null,this._type="",this._time=NaN,this._ease="noease",this._enable=!1,this._addonData=null,this._addonInstance=void 0,this._pathMode="line",e&&(this._value=e[VALUE_DATA][VALUE_DATA_VALUE],this._aValue=e[VALUE_DATA][VALUE_DATA_ABSOLUTE_VALUE],this._type=e[VALUE_DATA][VALUE_DATA_TYPE],this._time=e[TIME],this._ease=e[EASE],this._enable=!!e[ENABLE],this._pathMode=e[PATH_MODE],this._addonData=null,e[ADDONS]&&(this._addonData=new C33.AddonData(e[ADDONS],this)),this._next=null,this._prev=null)}Release(){this._propertyKeyframeData=null,this._addonData&&(this._addonData.Release(),this._addonData=null),this._next=null,this._prev=null}GetAddonData(){return this._addonData}SetNext(e){this._next=e}GetNext(){return this._next}SetPrevious(e){this._prev=e}GetPrevious(){return this._prev}GetValue(){return this._value}SetValue(e){"color"===this._type&&C33.IsFiniteNumber(e)?(this._value[0]=C33.GetRValue(e),this._value[1]=C33.GetGValue(e),this._value[2]=C33.GetBValue(e)):this._value=e}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(e){"color"===this._type&&C33.IsFiniteNumber(e)?(this._aValue[0]=C33.GetRValue(e),this._aValue[1]=C33.GetGValue(e),this._aValue[2]=C33.GetBValue(e)):this._aValue=e}GetValueWithResultMode(){var e=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();return"relative"===e?this.GetValue():"absolute"===e?this.GetAbsoluteValue():void 0}GetType(){return this._type}SetType(e){this._type=e}GetTime(){return this._time}SetTime(e){this._time=e,this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetPathMode(){return this._pathMode}GetAddOn(t){if(this._addonData){if(!this._addonInstance&&null!==this._addonInstance){var r=this._addonData.GetAddDataItemArray();if(r){var i=r.length;for(let e=0;e<i;e++){var s=r[e];if(s.GetId()===t)return this._addonInstance=s,this._addonInstance}}this._addonInstance=null}return this._addonInstance}}_SaveToJson(){var e=this._addonData;return{addonDataJson:e&&e._SaveToJson(),value:this._value,aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(e){e&&(e.addonDataJson&&this._addonData._SetFromJson(e.addonDataJson),this._value=e.value,this._aValue=e.aValue,this._type=e.type,this._time=e.time,this._ease=e.ease,this._enable=e.enable)}}C33.PropertyKeyframeData=class PropertyKeyframeData{constructor(e,t){this._propertyTrackDataItem=t,this._propertyKeyframeDataItems=[],this._propertyKeyframeDataItemsIncludingDisabled=[],C33.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,e,PropertyKeyframeDataItem,this),C33.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,e,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(var e of this._propertyKeyframeDataItems)e.Release();C33.clearArray(this._propertyKeyframeDataItems),this._propertyKeyframeDataItems=null;for(var t of this._propertyKeyframeDataItemsIncludingDisabled)t.Release();C33.clearArray(this._propertyKeyframeDataItemsIncludingDisabled),this._propertyKeyframeDataItemsIncludingDisabled=null}_LinkPropertyKeyframeDataItems(){let t=this._propertyKeyframeDataItems;t.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<t.length;e++){var r=t[e];e+1<t.length&&r.SetNext(t[e+1]),0<=e-1&&r.SetPrevious(t[e-1])}(t=this._propertyKeyframeDataItemsIncludingDisabled).sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<t.length;e++){var i=t[e];e+1<t.length&&i.SetNext(t[e+1]),0<=e-1&&i.SetPrevious(t[e-1])}}AddEmptyPropertyKeyframeDataItem(){var e=new PropertyKeyframeDataItem(null,this);return this._propertyKeyframeDataItems.push(e),this._LinkPropertyKeyframeDataItems(),e}DeletePropertyKeyframeDataItems(e){for(var t of this._propertyKeyframeDataItems){var r;e(t)&&-1!==(r=this._propertyKeyframeDataItems.indexOf(t))&&(t.Release(),this._propertyKeyframeDataItems.splice(r,1))}this.SortPropertyKeyFrameDataItems(),this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled}*propertyKeyframeDataItems(){for(var e of this._propertyKeyframeDataItems)yield e}*propertyKeyframeDataItemsReverse(){for(let e=this._propertyKeyframeDataItems.length-1;0<=e;e--)yield this._propertyKeyframeDataItems[e]}_SaveToJson(){var e=this._propertyKeyframeDataItems,t=this._propertyKeyframeDataItemsIncludingDisabled;return{propertyKeyframeDataItemsJson:e.map(e=>e._SaveToJson()),propertyKeyframeDataItemsIncludingDisabledJson:t.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&(C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,e.propertyKeyframeDataItemsJson,PropertyKeyframeDataItem,this),C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,e.propertyKeyframeDataItemsIncludingDisabledJson,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems())}}}{let C33=self.C3,ADDON_ID=0,ADDON_DATA=1;class AddonDataItem{constructor(e,t){this._addonData=t,this._id=e[ADDON_ID],this._data=e[ADDON_DATA]}Release(){this._addonData=null,this._data=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(e){e&&(this._id=e.id,this._data=e.data)}}let START_ANCHOR=0,START_ENABLE=1,END_ANCHOR=2,END_ENABLE=3;class AddonDataCubicBezierItem extends AddonDataItem{constructor(e,t){super(e,t),this._startAnchor=this._data[START_ANCHOR],this._startEnable=!!this._data[START_ENABLE],this._endAnchor=this._data[END_ANCHOR],this._endEnable=!!this._data[END_ENABLE]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._startAnchor=e.startAnchor,this._startEnable=!!e.startEnable,this._endAnchor=e.endAnchor,this._endEnable=!!e.endEnable)}}let DIRECTION=0,REVOLUTIONS=1;class AddonDataAngleItem extends AddonDataItem{constructor(e,t){super(e,t),this._direction=this._data[DIRECTION],this._revolutions=this._data[REVOLUTIONS]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._direction=e.direction,this._revolutions=e.revolutions)}}C33.AddonData=class AddonData{constructor(e,t){this._propertyKeyframeDataItem=t,this._addonDataItems=[],C33.TimelineDataManager._CreateDataItems(this._addonDataItems,e,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}Release(){this._propertyKeyframeDataItem=null;for(var e of this._addonDataItems)e.Release();C33.clearArray(this._addonDataItems),this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(var e of this._addonDataItems)yield e}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,e.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}}}{let C33=self.C3,INITIAL_VALUE_MODE_START_VALUE="start-value",INITIAL_VALUE_MODE_CURRENT_STATE="current-state",PING_PONG_BEGIN=0,PING_PONG_END=1,createdTweens=0;C33.TweenState=class Tween extends C33.TimelineState{constructor(e,t){super("tween-"+createdTweens++,e,t),this._id="",this._destroyInstanceOnComplete=!1,this._initialValueMode=INITIAL_VALUE_MODE_START_VALUE,this._instance=null,this._on_completed_callbacks=null,this._on_started_callbacks=null,this._track=null,this._iTweenState=null}FireReleaseEvent(e){var t=C33.New(C33.Event,"tweenstatereleased");t.tweenState=this,e.dispatchEvent(t)}GetType(){return 1}CreateTrackStates(){for(var e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(C33.TweenTrackState.Create(this,e));this._track=this._tracks[0]}AddTrack(){var e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),e=C33.TweenTrackState.Create(this,e);return this._tracks.push(e),this._CacheTrack(),e}_CacheTrack(){this._track=this._tracks[0]}GetPropertyTrack(e){return this._track.GetPropertyTracks()[0]}SetPropertyType(e){this._propertyType=e}GetInstance(){var e=this.GetTracks();if(e&&e.length){var t,e=e[0];if(this._track=e)return t=e.GetInstance(),e.IsInstanceValid()?t:void 0}}AddStartedCallback(e){this._on_started_callbacks||(this._on_started_callbacks=[]),this._on_started_callbacks.push(e)}AddCompletedCallback(e){this._on_completed_callbacks||(this._on_completed_callbacks=[]),this._on_completed_callbacks.push(e)}RemoveStartedCallback(e){this._on_started_callbacks&&-1!==(e=this._on_started_callbacks.indexOf(e))&&this._on_started_callbacks.splice(e,1)}RemoveCompletedCallback(e){this._on_completed_callbacks&&-1!==(e=this._on_completed_callbacks.indexOf(e))&&this._on_completed_callbacks.splice(e,1)}SetStartValue(e,t){for(var r of this._tracks)for(var i of r._propertyTracks){var s;i.GetPropertyName()===t&&(s=i.GetPropertyTrackData(),i=i.GetPropertyTrackDataItem(),(s=s.GetFirstPropertyKeyframeDataItem(i)).SetValue(e),s.SetAbsoluteValue(e))}}_GetPropertyTrackState(e){for(var t of this._tracks)for(var r of t._propertyTracks)if(r.GetPropertyName()===e)return r}BeforeSetEndValues(e){for(var t of e){var r=this._GetPropertyTrackState(t);this.SetStartValue(r.GetCurrentState(),t)}if(this.IsForwardPlayBack()){var i,s=this.GetTotalTime()-this.GetTime();this.SetTotalTime(s);for(i of this._tracks)i.SetLocalTotalTime(s);this._SetTime(0)}else{var a,n=this.GetTime();this.SetTotalTime(n);for(a of this._tracks)a.SetLocalTotalTime(n);this._SetTime(n)}this.SetInitialStateFromSetTime()}SetEndValue(e,t){var t=this._GetPropertyTrackState(t),r=t.GetPropertyTrackData(),t=t.GetPropertyTrackDataItem(),r=r.GetLastPropertyKeyframeDataItem(t);r.SetTime(this.GetTotalTime()),r.SetValue(e),r.SetAbsoluteValue(e)}SetId(e){this._id=e}GetId(){return this._id}SetInitialValueMode(e){this._initialValueMode=e}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(e){this._destroyInstanceOnComplete=e}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(var e of this._on_started_callbacks)e(this);if(!this.IsComplete())for(var t of this._tracks)t.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(var e of this._on_completed_callbacks)e(this)}SetTime(e){this._DeleteIntermediateKeyframes(),super.SetTime(e)}_SetTimeAndReset(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e,this._track.SetResetState()}SetInitialState(e){if(!this.InitialStateSet()&&this.GetInitialValueMode()===INITIAL_VALUE_MODE_CURRENT_STATE)for(var t of this._tracks)t.CompareInitialStateWithCurrent();super.SetInitialState(e)}Stop(e=!1){if(super.Stop(e),!this.IsComplete())for(var t of this._tracks)t.SaveState()}Reset(e=!0,t=!1){this._DeleteIntermediateKeyframes(),super.Reset(e,t)}_DeleteIntermediateKeyframes(){for(var e of this._tracks){var t=e=>{var e=e.GetTime(),t=this.GetTotalTime();return 0!==e&&e!==t};e.DeleteKeyframes(t),e.DeletePropertyKeyframes(t)}}_OnBeforeChangeLayout(){if(!this.IsReleased()){var e=this.GetInstance();if(e&&e.GetObjectClass().IsGlobal())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout()}return!0}Tick(r,e,i){if(this._instance||(this._instance=this.GetInstance()),!this._instance||this._instance.IsDestroyed())this.Stop(!0),this.OnCompleted();else{var s=this._instance.GetTimeScale();if(0!==(r=-1!==s?i*s:r)||0!==this._lastDelta){this._lastDelta=r;i=this._playheadTime+this._overshoot+r*this._playbackRate,s=this._timelineDataItem._totalTime;i<0?(this._playheadTime=0,this._overshoot=-i):s<=i?(this._playheadTime=s,this._overshoot=this._playheadTime-i):(this._playheadTime=i,this._overshoot=0);let e=!1,t=!1;r=this.GetLoop(),i=this.GetPingPong();r||i?r&&!i?0<this._playbackRate?this._playheadTime>=s&&(this._SetTimeAndReset(0),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):this._playheadTime<=0&&(this._SetTimeAndReset(s),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):!r&&i?0<this._playbackRate?this._playheadTime>=s&&(this._SetTime(s),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_BEGIN):(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),e=!0):this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_END)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_BEGIN):(e=!0,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)):this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_END)):r&&i&&(0<this._playbackRate?this._playheadTime>=s&&(this._SetTime(s),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState===PING_PONG_END&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C33.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState===PING_PONG_END&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C33.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=s&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):(this._SetTime(s),e=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(s),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):(this._SetTime(0),e=!0)),e?(this._track.SetEndState(),this.Stop(!0),this.OnCompleted()):(this._track.Interpolate(this._playheadTime,!0,!1,t,this._firstTick,!1),this._firstTick&&(this._firstTick=!1))}}}_TweenTrigger(e){var t=this.GetInstance(),r=t.GetBehaviorSdkInstanceFromCtor(C33.Behaviors.Tween);r.PushTriggerTween(this),this._runtime.Trigger(e,t,r.GetBehaviorType()),r.PopTriggerTween()}_SaveToJson(){var e=super._SaveToJson(),t=this.GetTimelineDataItem();return Object.assign(e,{tweenDataItemJson:t._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(e){e&&(this.GetTimelineDataItem()._LoadFromJson(e.tweenDataItemJson),super._LoadFromJson(e),this._id=e.id,this._destroyInstanceOnComplete=e.destroyInstanceOnComplete,this._initialValueMode=e.initialValueMode,this._CacheTrack())}static IsPlaying(e){return e.IsPlaying()}static IsPaused(e){return e.IsPaused()}static IsPing(e){return!!e.GetPingPong()&&e.GetPingPongState()===PING_PONG_BEGIN}static IsPong(e){return!!e.GetPingPong()&&e.GetPingPongState()===PING_PONG_END}static Build(e){var t=e.runtime.GetTimelineManager(),r=new C33.TimelineDataItem;if(e.json)return r._LoadFromJson(e.json.tweenDataItemJson),(s=new C33.TweenState(r,t))._LoadFromJson(e.json),s;var i,s=new C33.TweenState(r,t),a=(C33.IsArray(e.propertyTracksConfig)||(e.propertyTracksConfig=[e.propertyTracksConfig]),s.SetId(e.id),s.SetTags(e.tags),s.SetInitialValueMode(e.initialValueMode),s.SetDestroyInstanceOnComplete(e.releaseOnComplete),s.SetLoop(e.loop),s.SetPingPong(e.pingPong),s.SetTotalTime(e.time),s.SetStep(0),s.SetInterpolationMode("default"),s.SetResultMode(e.propertyTracksConfig[0].resultMode),s.SetRepeatCount(e.repeatCount),s.AddTrack()),r=(a.SetInstanceUID(e.instance.GetUID()),a.SetInterpolationMode("default"),a.SetResultMode(e.propertyTracksConfig[0].resultMode),a.SetEnable(!0),a.SetObjectClassIndex(e.instance.GetObjectClass().GetIndex()),e.instance.GetSdkInstance()),t=r.IsOriginalSizeKnown()?r.GetOriginalWidth():e.instance.GetWorldInfo().GetWidth(),r=r.IsOriginalSizeKnown()?r.GetOriginalHeight():e.instance.GetWorldInfo().GetHeight(),t=(a.SetOriginalWidth(t),a.SetOriginalHeight(r),a.AddKeyframe()),r=(t.SetTime(0),t.SetEase("noease"),t.SetEnable(!0),t.SetTags(""),a.AddKeyframe());r.SetTime(e.time),r.SetEase("noease"),r.SetEnable(!0),r.SetTags("");for(i of e.propertyTracksConfig){var n=a.AddPropertyTrack(),o=(n.SetSourceAdapterId(i.sourceId),n.SetSourceAdapterArgs(i.sourceArgs),n.SetPropertyName(i.property),n.SetPropertyType(i.type),n.SetMin(NaN),n.SetMax(NaN),n.SetInterpolationMode("default"),n.SetResultMode(i.resultMode),n.SetEnable(!0),n.AddPropertyKeyframe()),o=(o.SetType(i.valueType),o.SetTime(0),o.SetEase(i.ease),o.SetEnable(!0),o.SetValue(i.startValue),o.SetAbsoluteValue(i.startValue),n.AddPropertyKeyframe());o.SetType(i.valueType),o.SetTime(e.time),o.SetEase(i.ease),o.SetEnable(!0),o.SetValue(i.endValue),o.SetAbsoluteValue(i.endValue),n.GetSourceAdapter()}return s}static SetInstanceUID(e,t){if(!isNaN(t))for(var r of e.GetTracks())r.SetInstanceUID(t)}GetITweenState(e,t){return this._iTweenState||(this._iTweenState=C33.New(self.ITweenState,this,e,t)),this._iTweenState}}}{let C33=self.C3;C33.TweenTrackState=class TweenTrack extends C33.TrackState{constructor(e,t){super(e,t),this._firstPropertyTrack=null,this._secondPropertyTrack=null}static Create(e,t){return C33.New(C33.TweenTrackState,e,t)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(var e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C33.TweenPropertyTrackState.Create(this,e));this._CachePropertyTracks()}AddPropertyTrack(){var e=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem(),e=C33.TweenPropertyTrackState.Create(this,e);return this._propertyTracks.push(e),this._CachePropertyTracks(),e}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e,t=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(e of this._propertyTracks)e.SetInitialState(t),0===this._worldInfoChange&&1===e.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(t),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(t)}}BeforeInterpolate(){}Interpolate(e,t=0,r=!1,i=!1,s,a=!1,n=!1){if(this._instance||this.GetInstance(),this._instance)return!(this._instance.IsDestroyed()||a&&this.GetObjectClass().IsGlobal())&&((this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(e,r,i,n),this._secondPropertyTrack):this._firstPropertyTrack).Interpolate(e,r,i,n),void(0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo)&&this._worldInfo.SetBboxChanged()))}AfterInterpolate(){}_LoadFromJson(e){super._LoadFromJson(e),this._CachePropertyTracks()}}}{let C33=self.C3;C33.TweenPropertyTrackState=class TweenPropertyTrackState extends C33.PropertyTrackState{constructor(e,t){super(e,t),this._basic=!1}static Create(e,t){return C33.New(C33.TweenPropertyTrackState,e,t)}Interpolate(e,t=!1,r=!1,i=!1){let s,a;var n,o,l;a=this._basic?(s=this._propertyKeyframeDataItems[0],this._propertyKeyframeDataItems[1]):(s=t?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):((!this._lastPropertyKeyframeDataItem||(n=this.GetTimeline(),l=this._lastPropertyKeyframeDataItem.GetNext(),o=this._lastPropertyKeyframeDataItem.GetTime(),l=l?l.GetTime():n.GetTotalTime(),e<=o)||l<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem)),this._lastPropertyKeyframeDataItem)).GetNext(),this._sourceAdapter.Interpolate(e,s,a,t,r,i)}AddPropertyKeyframe(){var e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,this._basic=this.GetPropertyKeyframeDataItems().length<=2,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e),this._basic=this.GetPropertyKeyframeDataItems().length<=2}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),basic:this._basic}}_LoadFromJson(e){e&&(this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson),this._basic=e.basic)}}}{let C33=self.C3,Ease=self.Ease,NAME=0,TRANSITION_KEYFRAMES=1,LINEAR=2;C33.Transition=class Transition extends C33.DefendedBase{constructor(e,t=!0){super(),this._name=e[NAME],this._linear=e[LINEAR],this._transitionKeyframes=[];for(var r of e[TRANSITION_KEYFRAMES]){r=C33.TransitionKeyframe.Create(this,r);this._transitionKeyframes.push(r)}for(let e=0;e<this._transitionKeyframes.length;e++){var i=this._transitionKeyframes[e],s=this._transitionKeyframes[e+1],a=this._transitionKeyframes[e-1];i.SetNext(s),i.SetPrevious(a)}this._precalculatedSamples=new Map,this._transitionKeyframeCache=new Map,this._PreCalcSamples(),t&&Ease.AddCustomEase(this._name,(e,t,r,i)=>this.Interpolate(e,t,r,i),null,{transition:this})}static Create(e){return C33.New(C33.Transition,e)}Release(){for(var e of this._transitionKeyframes)e.Release();C33.clearArray(this._transitionKeyframes),this._transitionKeyframes=null,this._precalculatedSamples.clear(),this._precalculatedSamples=null,this._transitionKeyframeCache.clear(),this._transitionKeyframeCache=null}MakeLinear(e){this._linear=!!e}GetTransitionKeyFrameAt(e){var t,r=this._transitionKeyframeCache.get(e);if(r)return r;for(t of this._transitionKeyframes)if(t.GetValueX()===e)return this._transitionKeyframeCache.set(e,t),t}GetFirstTransitionKeyFrameLowerOrEqualThan(t){for(let e=this._transitionKeyframes.length-1;0<=e;e--){var r=this._transitionKeyframes[e],i=r.GetValueX();if(i<=t){let e=r;if(i<t)return e;if(i===t){for(;e;){var s=e.GetPrevious();if(!s)break;if(s.GetValueX()!==e.GetValueX())break;e=s}return e}}}}Interpolate(e,t,r,i){let s=e/i;if(this._linear)return o=this.GetTransitionKeyFrameAt(0),d=this.GetTransitionKeyFrameAt(1),o=t+(t+r)*o.GetValueY(),d=(t+r)*d.GetValueY()-o,0===i?o+d:Ease.NoEase(e,o,d,i);0===i&&(s=1);let a=this.GetFirstTransitionKeyFrameLowerOrEqualThan(s),n=a.GetNext();n||(e=a.GetPrevious(),o=a,a=e,n=o);var o,l,h,u,c,_,d=n.GetValueX()-a.GetValueX(),i=C33.mapToRange(s,a.GetValueX(),n.GetValueX(),0,d);return a.IsSegmentLinear()||0==d?(e=t+(t+r)*a.GetValueY(),o=(t+r)*n.GetValueY()-e,0==d?1===i?e+o:e:Ease.NoEase(i,e,o,d)):(e=a.GetValueX(),o=a.GetValueY(),d=a.GetValueX()+a.GetStartAnchorX(),l=a.GetValueY()+a.GetStartAnchorY(),h=n.GetValueX()+n.GetEndAnchorX(),u=n.GetValueY()+n.GetEndAnchorY(),c=n.GetValueX(),_=n.GetValueY(),i=Ease.GetRuntimeEase("spline")(i,e,o,d,l,h,u,c,_,this._precalculatedSamples.get(a)),(1-(i+=a.GetValueY()))*t+i*(t+r))}_PreCalcSamples(){this._precalculatedSamples.clear();for(let e=0;e<this._transitionKeyframes.length-1;e++){var t,r,i,s,a=this._transitionKeyframes[e];a.GetStartEnable()&&(a=a,(s=this._transitionKeyframes[e+1]).GetEndEnable())&&(t=a.GetValueX(),r=a.GetValueX()+a.GetStartAnchorX(),i=s.GetValueX()+s.GetEndAnchorX(),s=s.GetValueX(),this._precalculatedSamples.set(a,Ease.GetBezierSamples(t,r,i,s)))}}}}{let C33=self.C3,VALUE_X=0,VALUE_Y=1,START_ANCHOR_X=2,START_ANCHOR_Y=3,END_ANCHOR_X=4,END_ANCHOR_Y=5,START_ENABLE=6,END_ENABLE=7,SEGMENT_MODE=8;C33.TransitionKeyframe=class TransitionKeyframe extends C33.DefendedBase{constructor(e,t){super(),this._transition=e,this._valueX=t[VALUE_X],this._valueY=t[VALUE_Y],this._startAnchorX=t[START_ANCHOR_X],this._startAnchorY=t[START_ANCHOR_Y],this._endAnchorX=t[END_ANCHOR_X],this._endAnchorY=t[END_ANCHOR_Y],this._startEnable=t[START_ENABLE],this._endEnable=t[END_ENABLE],this._segmentMode=t[SEGMENT_MODE],this._next=null,this._prev=null}Release(){this._transition=null}static Create(e,t){return C33.New(C33.TransitionKeyframe,e,t)}SetNext(e){this._next=e}GetNext(){return this._next}SetPrevious(e){this._prev=e}GetPrevious(){return this._prev}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}IsSegmentLinear(){return"linear"===this._segmentMode}IsSegmentCubic(){return"cubic"===this._segmentMode}}}{let C33=self.C3;C33.TransitionManager=class TransitionManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._transitions=[]}Release(){for(var e of this._transitions)e.Release();C33.clearArray(this._transitions),this._transitions=null}Create(e){this._transitions.push(C33.Transition.Create(e))}}}{let C33=self.C3;C33.TemplateManager=class TemplateManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._templateDataMap=null,this._instanceToTemplateNameMap=null,this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance)}Release(){if(this.RemoveRuntimeListeners(),this._templateDataMap){for(var e of this._templateDataMap.values())e.clear();this._templateDataMap.clear()}this._templateDataMap=null,this._runtime=null}Create(e){var t,r;this._templateDataMap||(this._templateDataMap=new Map),e&&(t=e[0][16][0],this._templateDataMap.has(r=e[1])||this._templateDataMap.set(r,new Map),this._templateDataMap.get(r).set(t,e))}AddRuntimeListeners(){var e=this._runtime.Dispatcher();e&&e.addEventListener("instancedestroy",this._instanceDestroy)}RemoveRuntimeListeners(){var e=this._runtime.Dispatcher();e&&e.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){return!!this._templateDataMap&&0!==this._templateDataMap.size}GetTemplateData(e,t){let r=0;return r=e instanceof C33.ObjectClass?e.GetIndex():e,this._templateDataMap.has(r)&&(e=this._templateDataMap.get(r).get(t))?JSON.parse(JSON.stringify(e)):void 0}MapInstanceToTemplateName(e,t){this._instanceToTemplateNameMap||(this._instanceToTemplateNameMap=new WeakMap),this._instanceToTemplateNameMap.has(e)||this._instanceToTemplateNameMap.set(e,t)}GetInstanceTemplateName(e){return this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.get(e)||""}_OnInstanceDestroy(e){this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.has(e)&&this._instanceToTemplateNameMap.delete(e)}}}{let C33=self.C3;C33.FlowchartManager=class FlowchartManager{constructor(e){this._runtime=e,this._flowchartDataManager=new C33.FlowchartDataManager}Release(){this._flowchartDataManager.Release(),this._flowchartDataManager=null,this._runtime=null}GetRuntime(){return this._runtime}Create(e){this._flowchartDataManager.Add(e)}GetFlowchartDataItemByName(e){return this._flowchartDataManager.Get(e)}HasFlowcharts(){return this._flowchartDataManager.HasFlowcharts()}}}{let C33=self.C3;C33.FlowchartState=class Flowchart{constructor(e,t,r,i,s,a,n){this._runtime=s.GetRuntime(),this._flowchartManager=s,this._flowchartName=e,this._startNodeTag=r,this._flowchartDataItem=i,this._tag=t,this._pluginInstance=a,this._pluginUID=n??a.GetInstance().GetUID(),this._SetStartFlowchartNode(),this._currentFlowchartNodeId=this._startFlowchartNode?.GetFlowchartId()??-1,this._previousFlowchartNodeIds=[],this._previousFlowchartState=null,this._previousFlowchartStateStartNodeId=NaN,this._referenceFlowchartStates=null,this._currentReferenceFlowchartState=null,this._rootFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._triggerCount=0,this._markForRelease=!1,this._released=!1}Release(){this._released||(C33.clearArray(this._previousFlowchartNodeIds),this._previousFlowchartNodeIds=null,this._runtime=null,this._flowchartManager=null,this._flowchartDataItem=null,this._pluginInstance=null,this._previousFlowchartState=null,this._previousFlowchartStateStartNodeId=NaN,this._referenceFlowchartStates&&this._referenceFlowchartStates.clear(),this._referenceFlowchartStates=null,this._currentReferenceFlowchartState=null,this._rootFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._released=!0)}WasReleased(){return this._released}GetFlowchartManager(){return this._flowchartManager}GetRuntime(){return this._runtime}GetName(){return this._flowchartName}GetFlowchartDataItem(){return this._flowchartDataItem}GetTag(){return this._tag}GetPluginInstance(){return this._pluginInstance||(this._pluginInstance=this._runtime.GetInstanceByUID(this._pluginUID).GetSdkInstance()),this._pluginInstance}GetCurrentNode(){return this.GetFlowchartElementById(this._currentFlowchartNodeId)}GetCurrentNodeTag(){var e=this.GetCurrentNode();return e?e.GetTag():""}GetCurrentNodeParent(e){var t=this.GetCurrentNode();if(t){if(C33.IsFiniteNumber(e)){var r=t.GetParentFlowchartIds(),r=r?r[e]:void 0;if(C33.IsFiniteNumber(r))return this.GetFlowchartElementById(r)}if("string"==typeof e)for(var i of t.GetParentFlowchartIds()){i=this.GetFlowchartElementById(i);if(i.GetTag()===e)return this.GetFlowchartElementById(i.GetFlowchartId())}}}GetCurrentNodeParentTag(e){e=this.GetCurrentNodeParent(e);return e?e.GetTag():""}GetCurrentNodeParentIndex(e){var t,e=this.GetCurrentNodeParent(e);return e&&(t=e.GetParentFlowchartIds())?t.indexOf(e.GetFlowchartId()):-1}GetCurrentNodeParentCount(){var e=this.GetCurrentNode();return(e=e&&e.GetParentFlowchartIds())?e.length:0}GetFlowchartElementById(e){return this._flowchartDataItem.GetFlowchartElementById(e)}Reset(){this._GetRootFlowchartState()._Reset(!0)}_Reset(e){if(this._GetReferenceFlowchartStates()){for(var[t,r]of this._GetReferenceFlowchartStates().entries())r._Reset(!1);this._GetReferenceFlowchartStates().clear()}this._referenceFlowchartStates=null,this._previousFlowchartState=null,this._previousFlowchartStateStartNode=null,this._currentReferenceFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._previousFlowchartNodeIds=[],e?(this._flowchartManager.SetCurrentFlowchartState(this),(e=this._startFlowchartNode.GetFlowchartId())!==this._currentFlowchartNodeId&&this._GotoFlowchartNode(e)):this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId()}GetCurrentNodeOutputCount(){var e=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return e?e.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemCount():0}GetCurrentNodeOutputNameAt(e){e=this._GetFlowchartNodeOutputAt(e);return e?e.GetName():""}GetCurrentNodeOutputValueAt(e){let t;return C33.IsFiniteNumber(e)&&(t=this._GetFlowchartNodeOutputAt(e)),"string"==typeof e&&(t=this._GetFlowchartNodeOutputByName(e)),"number"!=typeof e&&"string"!=typeof e&&console.warn("[Flowcharts] unexpected argument type in GetCurrentNodeOutputValueAt expression"),t?t.GetValue():""}GotoNextFlowchartNode(e){let t;C33.IsFiniteNumber(e)&&(t=this._GetFlowchartNodeOutputAt(e));e=(t="string"==typeof e?this._GetFlowchartNodeOutputByName(e):t).GetConnectedFlowchartNodeFlowchartId();C33.IsFiniteNumber(e)&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(e))}GotoAnyFlowchartNode(e){var e=this._flowchartDataItem.GetFlowchartNodeByTag(e);e&&(e=this._flowchartDataItem.GetFlowchartElementById(e.GetFlowchartId()))&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(e.GetFlowchartId()))}GotoPreviousFlowchartNode(){var e=this._previousFlowchartNodeIds.pop();C33.IsFiniteNumber(e)?this._GotoFlowchartNode(e):this._GetPreviousFlowchartState()&&(this._flowchartManager.SetCurrentFlowchartState(this._GetPreviousFlowchartState(),!0,!1,!1),this._GetPreviousFlowchartState()._GotoFlowchartNode(this._GetPreviousFlowchartStateStartNodeId()),this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(this._GetPreviousFlowchartState()))}GotoParentFlowchartNode(e){var t=this.GetCurrentNode();t&&(t.GetFlowchartId(),t=this.GetCurrentNodeParent(e))&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(t.GetFlowchartId()))}HasOutput(t){if(C33.IsFiniteNumber(t))return!!this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId).GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems()[t];if("string"==typeof t){var r=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId).GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();for(let e=0;e<r.length;e++)if(r[e].GetName()===t)return!0}return!1}MarkForRelease(){this._markForRelease=!0}IsInTriggerState(){return 0<this._triggerCount}PushIsTriggerState(){this._triggerCount++}PopIsTriggerState(){this._triggerCount--,0===this._triggerCount&&this._markForRelease&&this._flowchartManager.RemoveFlowchartState(this)}_GotoFlowchartNode(e){var r=this._currentFlowchartNodeId,i=this.GetPluginInstance().GetInstance();if(this.PushIsTriggerState(),this._flowchartManager.PushFlowchartState(this),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChange,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChange,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChangeInFlowchart,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChangeInFlowchart,i),this._currentFlowchartNodeId=e,this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChange,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChange,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChangeInFlowchart,i),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChangeInFlowchart,i),this._flowchartManager.PopFlowchartState(),this.PopIsTriggerState(),!this.WasReleased()){e=this.GetFlowchartElementById(this._currentFlowchartNodeId);if("reference"===e.GetType()){i=e.GetReferenceFlowchartName();if(this._HasReferenceFlowchartState(e)){this._previousFlowchartNodeIds.pop();var s=this._GetReferenceFlowchartState(e);this._flowchartManager.SetCurrentFlowchartState(s,!0,!0,!1),s._SetPreviousFlowchart(this,r),this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(s)}else{s=e.GetReferenceFlowchartStartNodeTag();if(i){this._previousFlowchartNodeIds.pop();let t=e.GetReferenceFlowchartTag();if(t){let e=this._flowchartManager.GetFlowchartState(t);for(;e;)t=C33.IncrementNumberAtEndOf(t),e=this._flowchartManager.GetFlowchartState(t)}else{t=i+"-ref";let e=this._flowchartManager.GetFlowchartState(t);for(;e;)t=C33.IncrementNumberAtEndOf(t),e=this._flowchartManager.GetFlowchartState(t)}i=this._flowchartManager.AddFlowchartState(i,s,t,this._pluginInstance,!0),s=(i._SetPreviousFlowchart(this,r),this._SetReferenceFlowchartState(e,i),this._GetRootFlowchartState());i._SetRootFlowchartState(s),s._SetCurrentReferenceFlowchart(i)}}}}}_GetFlowchartNodeOutputAt(e){var t=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return(t=t&&t.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems())&&t[e]||null}_GetFlowchartNodeOutputByName(e){var t=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return t&&t.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemByName(e)||null}_SetStartFlowchartNode(t){if("number"==typeof t){let e=this.GetFlowchartElementById(t);e=e||this._flowchartDataItem.GetFlowchartStartNode(),this._startFlowchartNode=e}else{let e=this._flowchartDataItem.GetFlowchartNodeByTag(this._startNodeTag);e=e||this._flowchartDataItem.GetFlowchartStartNode(),this._startFlowchartNode=e}}_SaveToJson(){return this._markForRelease?null:{flowchartName:this._flowchartName,flowchartTag:this._tag,startNodeTag:this._startNodeTag,currentNodeId:this._currentFlowchartNodeId,previousNodeIds:this._previousFlowchartNodeIds,pluginUID:this._pluginInstance.GetInstance().GetUID(),reference:{previousFlowchartTag:this._GetPreviousFlowchartState()?this._GetPreviousFlowchartState().GetTag():"",previousStartNodeId:C33.IsFiniteNumber(this._GetPreviousFlowchartStateStartNodeId())?this._GetPreviousFlowchartStateStartNodeId():NaN,referencesJson:this._GetFlowchartReferencesJson(),currentReferenceFlowchartTag:this.GetCurrentReferenceFlowchart()?this.GetCurrentReferenceFlowchart().GetTag():"",rootFlowchartTag:this._GetRootFlowchartState()?this._GetRootFlowchartState().GetTag():""}}}_GetFlowchartReferencesJson(){if(!this._HasReferenceFlowchartStates())return null;var e,t,r=[];for([e,t]of this._GetReferenceFlowchartStates().entries())r.push({flowchartElementId:e.GetFlowchartId(),flowchartStateTag:t.GetTag()});return r.length?r:null}_LoadFromJson(e){e&&(this._flowchartName=e.flowchartName,this._tag=e.flowchartTag,this._startNodeTag=e.startNodeTag,this._currentFlowchartNodeId=e.currentNodeId,this._previousFlowchartNodeIds=e.previousNodeIds,this._pluginUID=e.pluginUID,e.hasOwnProperty("reference")&&(e=e.reference,this._previousFlowchartStateTag=e.previousFlowchartTag,this._previousFlowchartStateStartNodeId=e.previousStartNodeId,this._referenceFlowchartStatesJson=e.referencesJson,this._currentReferenceFlowchartStateTag=e.currentReferenceFlowchartTag,this._rootFlowchartStateTag=e.rootFlowchartTag),this._SetStartFlowchartNode())}_GetPreviousFlowchartState(){return"string"==typeof this._previousFlowchartStateTag&&this._previousFlowchartStateTag&&(this._previousFlowchartState=this._flowchartManager.GetFlowchartState(this._previousFlowchartStateTag),this._previousFlowchartStateTag=""),this._previousFlowchartState}_GetPreviousFlowchartStateStartNodeId(){return this._previousFlowchartStateStartNodeId}_SetPreviousFlowchart(e,t){this._previousFlowchartState=e,this._previousFlowchartStateStartNodeId=t}GetCurrentReferenceFlowchart(){return"string"==typeof this._currentReferenceFlowchartStateTag&&this._currentReferenceFlowchartStateTag&&(this._currentReferenceFlowchartState=this._flowchartManager.GetFlowchartState(this._currentReferenceFlowchartStateTag),this._currentReferenceFlowchartStateTag=""),this._currentReferenceFlowchartState}_SetCurrentReferenceFlowchart(e){this._currentReferenceFlowchartState=e,this._currentReferenceFlowchartState===this&&(this._currentReferenceFlowchartState=null)}_GetRootFlowchartState(){return"string"==typeof this._rootFlowchartStateTag&&this._rootFlowchartStateTag&&(this._rootFlowchartState=this._flowchartManager.GetFlowchartState(this._rootFlowchartStateTag),this._rootFlowchartStateTag=""),this._rootFlowchartState||this}_SetRootFlowchartState(e){this._rootFlowchartState=e}_HasReferenceFlowchartStates(){return this._RebuildReferenceFlowchartStates(),!!this._referenceFlowchartStates}_HasReferenceFlowchartState(e){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates&&this._referenceFlowchartStates.has(e)}_RebuildReferenceFlowchartStates(){if(this._referenceFlowchartStatesJson){this._referenceFlowchartStates&&this._referenceFlowchartStates.clear(),this._referenceFlowchartStates||(this._referenceFlowchartStates=new Map);for(var e of this._referenceFlowchartStatesJson){var t=this._flowchartManager.GetFlowchartState(e.flowchartStateTag),e=t.GetFlowchartElementById(e.flowchartElementId);this._referenceFlowchartStates.set(e,t)}this._referenceFlowchartStatesJson=null}}_GetReferenceFlowchartStates(){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates}_GetReferenceFlowchartState(e){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates.get(e)}_SetReferenceFlowchartState(e,t){this._referenceFlowchartStates||(this._referenceFlowchartStates=new Map),this._referenceFlowchartStates.set(e,t)}}}{let C33=self.C3;C33.FlowchartStateManager=class FlowchartStateManager{constructor(e){this._runtime=e,this._flowchartStates=new Map,this._currentFlowchartState=null,this._flowchartStateStack=[],this._on_after_load=()=>this._OnAfterLoad(),this._loadJson=null}Release(){C33.clearArray(this._flowchartStateStack),this._flowchartStateStack=null,this._flowchartStates.clear(),this._flowchartStates=null,this._currentFlowchartState=null,this._runtime=null,this._loadJson=null}GetRuntime(){return this._runtime}AddFlowchartState(e,t,r,i,s,a){var n=this._runtime.GetFlowchartManager().GetFlowchartDataItemByName(e);if(n){if(!this._flowchartStates.has(r))return t=new C33.FlowchartState(e,r,t,n,this,i,a),this._flowchartStates.set(r,t),s&&this.SetCurrentFlowchartState(t,!0),t;console.warn(`[Flowcharts] there already is a flowchart with the tag '${r}'`)}else console.warn(`[Flowcharts] no flowchart found with name '${e}'`)}RemoveFlowchartState(e){var t;e.MarkForRelease(),e.IsInTriggerState()||(t=e.GetTag(),this._flowchartStates.delete(t),e.Release(),this._currentFlowchartState===e&&(this._currentFlowchartState=null))}ResetFlowchartState(e){e.Reset()}GetFlowchartState(e){return this._flowchartStates.get(e)}PushFlowchartState(e){this._flowchartStateStack.push(e)}PopFlowchartState(){this._flowchartStateStack.pop()}SetCurrentFlowchartState(e,t=!1,r=!1,i=!0){(e=i&&e.GetCurrentReferenceFlowchart()||e)!==this._currentFlowchartState&&(this._TriggerBeforeFlowchartChange(),this._TriggerAfterFlowchartChange(e,t,r))}GetCurrentFlowchartState(e){return"string"==typeof e?this.GetFlowchartState(e):this._flowchartStateStack.length?this._flowchartStateStack[this._flowchartStateStack.length-1]:this._currentFlowchartState}_TriggerBeforeFlowchartChange(){var e;this._currentFlowchartState&&!this._currentFlowchartState.WasReleased()&&(e=this._currentFlowchartState.GetPluginInstance().GetInstance(),this._currentFlowchartState.PushIsTriggerState(),this.PushFlowchartState(this._currentFlowchartState),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeFlowchartChange,e),this.PopFlowchartState(),this._currentFlowchartState.PopIsTriggerState())}_TriggerAfterFlowchartChange(e,t=!1,r=!1){this._currentFlowchartState=e,this._currentFlowchartState&&!this._currentFlowchartState.WasReleased()&&(e=this._currentFlowchartState.GetPluginInstance().GetInstance(),this._currentFlowchartState.PushIsTriggerState(),this.PushFlowchartState(this._currentFlowchartState),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnFlowchartChange,e),!0!==r&&"number"!=typeof r||this._currentFlowchartState._SetStartFlowchartNode(r),t&&(this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChange,e),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChange,e)),this.PopFlowchartState(),this._currentFlowchartState.PopIsTriggerState())}_SaveToJson(){return{flowchartJsonObjects:[...this._flowchartStates.values()].map(e=>e._SaveToJson()),currentFlowchartTag:this._currentFlowchartState?this._currentFlowchartState.GetTag():null}}_LoadFromJson(e){if(e){this._loadJson=e;var t,r,i,s=new Map;for(t of this._loadJson.flowchartJsonObjects){var a,n=t.flowchartTag;this._flowchartStates.has(n)?((a=this._flowchartStates.get(n))._LoadFromJson(t),s.set(n,a)):((n=this.AddFlowchartState(t.flowchartName,t.startNodeTag,t.flowchartTag,null,!1,t.pluginUID))._LoadFromJson(t),s.set(t.flowchartTag,n))}for([r,i]of this._flowchartStates.entries())s.has(r)||i.Release();this._flowchartStates.clear(),this._flowchartStates=s,this._runtime.IsLoadingState()?this._runtime.Dispatcher().addEventListener("afterload",this._on_after_load):this._OnAfterLoad()}}_OnAfterLoad(){this._runtime.Dispatcher().removeEventListener("afterload",this._on_after_load);var e=this._flowchartStates.get(this._loadJson.currentFlowchartTag);e&&this.SetCurrentFlowchartState(e,!0),this._loadJson=null}}}{let C33=self.C3;C33.FlowchartDataManager=class FlowchartDataManager{constructor(){this._flowchartDataItems=new Map}Release(){for(var e of this._flowchartDataItems.values())e.Release();this._flowchartDataItems.clear(),this._flowchartDataItems=null}Add(e){var e=new C33.FlowchartDataItem(e),t=e.GetName();this._flowchartDataItems.set(t,e)}Get(e){return this._flowchartDataItems.get(e)}HasFlowcharts(){return!!this._flowchartDataItems.size}static CreateDataItems(e,t,r,i){if(t)for(var s of t){s=new r(s,i);e.push(s)}}}}{let C33=self.C3,NAME=0,NODES=1;C33.FlowchartDataItem=class FlowchartDataItem{constructor(e){this._name=e[NAME],this._flowchartNodeData=new C33.FlowchartNodeData(e[NODES],this)}Release(){this._flowchartNodeData.Release(),this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartElementById(e){return this._flowchartNodeData.GetFlowchartElementById(e)}GetFlowchartNodeByTag(e){return this._flowchartNodeData.GetFlowchartNodeByTag(e)}GetFlowchartStartNode(){return this._flowchartNodeData.GetFlowchartStartNode()}GetName(){return this._name}}}{let C33=self.C3,FLOWCHART_ID=0,TAG=1,PARENT_FLOWCHART_IDS=2,PARENT_OUTPUT_FLOWCHART_IDS=3,CHILDREN_FLOWCHART_IDS=4,OUTPUTS=5,IS_START=6,TYPE=7,REFERENCE_FLOWCHART=8,REFERENCE_FLOWCHART_START_NODE=9,REFERENCE_FLOWCHART_TAG=10;class FlowchartNodeDataItem{constructor(e,t){this._flowchartNodeData=t,this._type=e[TYPE],this._flowchartId=e[FLOWCHART_ID],this._tag=e[TAG],this._parentFlowchartIds=e[PARENT_FLOWCHART_IDS],this._parentOutputFlowchartIds=null,this._childrenFlowchartIds=null,"dictionary"===this._type&&(this._parentOutputFlowchartIds=e[PARENT_OUTPUT_FLOWCHART_IDS],this._childrenFlowchartIds=e[CHILDREN_FLOWCHART_IDS]),this._isStart=e[IS_START],this._referenceFlowchartName=null,this._referenceFlowchartStartNodeTag=null,this._referenceFlowchartTag=null,"reference"===this._type&&(this._referenceFlowchartName=e[REFERENCE_FLOWCHART],this._referenceFlowchartStartNodeTag=e[REFERENCE_FLOWCHART_START_NODE],this._referenceFlowchartTag=e[REFERENCE_FLOWCHART_TAG]),this._flowchartNodeOutputData=new C33.FlowchartNodeOutputData(e[OUTPUTS],this)}Release(){this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetTag(){return this._tag}GetIsStart(){return this._isStart}GetParentFlowchartIds(){return this._parentFlowchartIds}GetParentOutputFlowchartIds(){return this._parentOutputFlowchartIds}GetChildrenFlowchartIds(){return this._childrenFlowchartIds}GetType(){return this._type}GetReferenceFlowchartName(){return this._referenceFlowchartName}GetReferenceFlowchartStartNodeTag(){return this._referenceFlowchartStartNodeTag}GetReferenceFlowchartTag(){return this._referenceFlowchartTag}}C33.FlowchartNodeData=class FlowchartNodeData{constructor(e,t){this._flowchartDataItem=t,this._flowchartNodeItems=[],this._flowchartNodeItemsIdMap=new Map,this._flowchartNodeItemsTagMap=new Map,this._flowchartNodeStartItem=null,C33.FlowchartDataManager.CreateDataItems(this._flowchartNodeItems,e,FlowchartNodeDataItem,this);for(var r of this._flowchartNodeItems){var i,s=r.GetFlowchartId(),a=r.GetTag(),n=r.GetIsStart();this._flowchartNodeItemsIdMap.set(s,r),a&&this._flowchartNodeItemsTagMap.set(a,r),n&&(this._flowchartNodeStartItem=r);for(i of r.GetFlowchartNodeOutputData().flowchartNodeOutputDataItems()){var o=i.GetFlowchartId();this._flowchartNodeItemsIdMap.set(o,i)}}}Release(){this._flowchartDataItem=null;for(var e of this._flowchartNodeItems)e.Release();C33.clearArray(this._flowchartNodeItems),this._flowchartNodeItems=null}GetFlowchartDataItem(){return this._flowchartDataItem}GetFlowchartElementById(e){return this._flowchartNodeItemsIdMap.get(e)}GetFlowchartNodeByTag(e){return this._flowchartNodeItemsTagMap.get(e)}GetFlowchartStartNode(){return this._flowchartNodeStartItem}*flowchartNodeDataItems(){for(var e of this._flowchartNodeItems)yield e}}}{let C33=self.C3,FLOWCHART_ID=0,NAME=1,VALUE=2,CONNECTED_FLOWCHART_NODE_FLOWCHART_ID=3;class FlowchartNodeDataOutputItem{constructor(e,t){this._flowchartNodeOutputData=t,this._flowchartId=e[FLOWCHART_ID],this._name=e[NAME],this._value=e[VALUE],this._connectedFlowchartNodeFlowchartId=e[CONNECTED_FLOWCHART_NODE_FLOWCHART_ID]}Release(){this._flowchartNodeOutputData=null}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetName(){return this._name}GetValue(){return this._value}GetConnectedFlowchartNodeFlowchartId(){return this._connectedFlowchartNodeFlowchartId}}C33.FlowchartNodeOutputData=class FlowchartNodeOutputData{constructor(e,t){this._flowchartDataNodeItem=t,this._flowchartNodeOutputItems=[],this._flowchartNodeOutputItemsNameMap=new Map,C33.FlowchartDataManager.CreateDataItems(this._flowchartNodeOutputItems,e,FlowchartNodeDataOutputItem,this);for(var r of this._flowchartNodeOutputItems)this._flowchartNodeOutputItemsNameMap.set(r.GetName(),r)}Release(){this._flowchartDataNodeItem=null;for(var e of this._flowchartNodeOutputItems)e.Release();C33.clearArray(this._flowchartNodeOutputItems),this._flowchartNodeOutputItems=null}GetFlowchartNodeDataItem(){return this._flowchartDataNodeItem}GetFlowchartNodeOutputDataItemCount(){return this._flowchartNodeOutputItems.length}GetFlowchartNodeOutputDataItems(){return this._flowchartNodeOutputItems}GetFlowchartNodeOutputDataItemByName(e){return this._flowchartNodeOutputItemsNameMap.get(e)}*flowchartNodeOutputDataItems(){for(var e of this._flowchartNodeOutputItems)yield e}}}{let C33=self.C3;C33.SolStack=class SolStack extends C33.DefendedBase{constructor(e){super(),this._objectClass=e,this._stack=[],this._stack.push(C33.New(C33.Sol,this)),this._index=0,this._current=this._stack[0]}Release(){for(var e of this._stack)e.Release();C33.clearArray(this._stack),this._current=null,this._objectClass=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}GetOneBelowCurrentSol(){return this._stack[this._index-1]}Clear(){this.GetCurrentSol().Clear()}PushClean(){var e,t=this._stack,r=++this._index;r===t.length?(e=C33.New(C33.Sol,this),t.push(e),this._current=e):((e=t[r]).Reset(),this._current=e)}PushCopy(){var e=this._stack,t=++this._index,r=(t===e.length&&e.push(C33.New(C33.Sol,this)),e[t]);r.Copy(e[t-1]),this._current=r}Pop(){this._current=this._stack[--this._index]}RemoveInstances(r){var i=this._stack;for(let e=0,t=i.length;e<t;++e)i[e].RemoveInstances(r)}}}{let C33=self.C3;C33.Sol=class Sol extends C33.DefendedBase{constructor(e){super(),this._stack=e,this._objectClass=this._stack.GetObjectClass(),this._eventStack=this._objectClass.GetRuntime().GetEventStack(),this._selectAll=!0,this._instances=[],this._elseInstances=[]}Release(){this.ClearArrays(),this._stack=null,this._objectClass=null,this._eventStack=null}ClearArrays(){C33.clearArray(this._instances),C33.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){var e=this.GetInstances();return e.length?e:this._elseInstances}Reset(){this._selectAll=!0,C33.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(e){e.IsSelectAll()?this.Reset():(this._selectAll=!1,C33.shallowAssignArray(this._instances,e._instances),C33.clearArray(this._elseInstances))}_PushInstance(e){this._instances.push(e)}_PushElseInstance(e){this._elseInstances.push(e)}_SetSelectAll(e){this._selectAll=!!e}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(e){this._selectAll=!1,C33.clearArray(this._instances),this._instances.push(e)}SetArrayPicked(e){this._selectAll=!1,C33.shallowAssignArray(this._instances,e)}SetSetPicked(e){this._selectAll=!1,C33.clearArray(this._instances);for(var t of e)this._instances.push(t)}AddElseInstances(e,t){for(var r of t)e.has(r)||this._elseInstances.push(r)}TransferElseInstancesToOwn(e){for(var t of e)this._instances.push(t);C33.arrayRemoveAllInSet(this._elseInstances,e)}ClearElseInstances(){C33.clearArray(this._elseInstances)}PickOne(e){var t;e&&(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()?(this.IsSelectAll()&&(C33.clearArray(this._instances),C33.shallowAssignArray(this._elseInstances,e.GetObjectClass().GetInstances()),this._selectAll=!1),-1!==(t=this._elseInstances.indexOf(e))&&(this._instances.push(this._elseInstances[t]),this._elseInstances.splice(t,1))):this.SetSinglePicked(e))}RemoveInstances(e){C33.arrayRemoveAllInSet(this._instances,e),C33.arrayRemoveAllInSet(this._elseInstances,e)}}}{let C33=self.C3;C33.EventStack=class EventStack extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._stack.push(C33.New(C33.EventStackFrame,this,null)),this._index=0,this._expFuncStack=[]}Release(){for(var e of this._stack)e.Release();C33.clearArray(this._stack),C33.clearArray(this._expFuncStack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}GetAllStackFrames(){return this._stack}GetCurrentStackFrameIndex(){return this._index}Push(e){var t,r=this._stack,i=++this._index;return i===r.length?(t=C33.New(C33.EventStackFrame,this,e),r.push(t),t):((t=r[i]).Reset(e),t)}Pop(){--this._index}PushExpFunc(e){this._expFuncStack.push(e)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){var e=this._expFuncStack;return 0===e.length?null:e.at(-1)}}}{let C33=self.C3;C33.EventStackFrame=class EventStackFrame extends C33.DefendedBase{constructor(e,t){super(),this._stack=e,this._runtime=this._stack.GetRuntime(),this._currentEvent=t,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._expressionObjectClass=null,this._functionReturnType=0,this._functionReturnValue=0,this._dynamicSolModifiers=null}Release(){this.Reset(null),this._stack=null,this._runtime=null}Reset(e){this._currentEvent=e,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._dynamicSolModifiers=null}_Restore(e,t){this._currentEvent=e,this._cndIndex=0,this._actIndex=t}ResetQuick(){this._cndIndex=0,this._actIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(e){this._currentEvent=e}GetConditionIndex(){return this._cndIndex}SetConditionIndex(e){this._cndIndex=e}GetActionIndex(){return this._actIndex}SetActionIndex(e){this._actIndex=e}SetLastEventTrue(e){this._lastEventTrue=!!e}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(e){this._elseBranchRan=!!e}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(e){this._expressionObjectClass=e}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(e,t){this._functionReturnType=e,this._functionReturnValue=t}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(e){this._functionReturnValue=e}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){var e=this._currentEvent;return!!e.IsSolWriterAfterCnds()||this._cndIndex<e.GetConditionCount()-1&&!!e.GetSolModifiers().length}SetDynamicSolModifiers(e){this._dynamicSolModifiers=e}GetDynamicSolModifiers(){return this._dynamicSolModifiers}}}{let C33=self.C3;C33.LocalVarStack=class LocalVarStack extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1,this._current=null,this._initialValues=[]}Release(){C33.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}_SetInitialValues(e){this._initialValues=e;e=this._initialValues.slice(0);this._stack.push(e),this._index=0,this._current=e}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){var e=++this._index,t=this._stack;e===t.length?t.push(this._initialValues.slice(0)):C33.shallowAssignArray(t[e],this._initialValues),this._current=t[e]}Pop(){this._current=this._stack[--this._index]}}}{let C33=self.C3;C33.LoopStack=class LoopStack extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1}Release(){C33.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return 0<=this._index}GetCurrent(){return this._stack[this._index]}Push(){var e;return++this._index,this._index===this._stack.length?(e=C33.New(C33.Loop,this),this._stack.push(e),e):((e=this._stack[this._index]).Reset(),e)}Pop(){--this._index}FindByName(t){var r=this._stack;for(let e=this._index;0<=e;--e){var i=r[e];if(i.GetName()===t)return i}return null}_GetStack(){return this._stack.slice(0,this._index+1)}}}{let C33=self.C3;C33.Loop=class Loop extends C33.DefendedBase{constructor(e){super(),this._loopStack=e,this._name="",this._index=0,this._isStopped=!1,this._end=NaN}Reset(){this._name="",this._index=0,this._isStopped=!1,this._end=NaN}SetName(e){this._name=e}GetName(){return this._name}SetIndex(e){this._index=e}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}}}{let C33=self.C3;C33.ArrayStack=class ArrayStack extends C33.DefendedBase{constructor(){super(),this._stack=[],this._index=-1}Release(){C33.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){var e;return++this._index,this._index===this._stack.length?(this._stack.push(e=[]),e):this._stack[this._index]}Pop(){--this._index}}}{let SortSolArray2=function(e,t){return e.GetIndex()-t.GetIndex()},IsSolArrayIdentical2=function(r,i){for(let e=0,t=r.length;e<t;++e)if(r[e]!==i[e])return!1;return!0},C33=(SortSolArray=SortSolArray2,IsSolArrayIdentical=IsSolArrayIdentical2,self.C3),assert=self.assert;C33.EventSheetManager=class EventSheetManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._allSheets=[],this._sheetsByName=new Map,this._allGroups=[],this._groupsByName=new Map,this._blocksBySid=new Map,this._cndsBySid=new Map,this._actsBySid=new Map,this._allUniqueSolModifiers=new Map,this._eventVarsBySid=new Map,this._nextLocalVarIndex=0,this._allGlobalVars=[],this._allLocalVars=[],this._localVarInitialValues=[],this._functionBlocksByName=new Map,this._customActionBlocksMap=new Map,this._eventStack=C33.New(C33.EventStack,this),this._localVarStack=C33.New(C33.LocalVarStack,this),this._loopStack=C33.New(C33.LoopStack,this),this._triggersToPostInit=[],this._queuedTriggers=[],this._queuedDebugTriggers=[],this._runningEventsDepth=0,this._executingTriggerDepth=0,this._blockFlushingDepth=0,this._scheduledWaits=[],this._asyncActionPromises=[],this._signalTags=[],this._signalPromises=new Map,this._instSignals=new Map,self.c3_callFunction=(e,t)=>this._InvokeFunctionFromJS(e,t)}Release(){this.ClearAllScheduledWaits(),this._eventStack.Release(),this._eventStack=null,this._localVarStack.Release(),this._localVarStack=null,C33.clearArray(this._queuedTriggers),C33.clearArray(this._queuedDebugTriggers),this._runtime=null,C33.clearArray(this._allSheets),this._sheetsByName.clear()}Create(e){e=C33.New(C33.EventSheet,this,e);this._allSheets.push(e),this._sheetsByName.set(e.GetName().toLowerCase(),e)}_AddTriggerToPostInit(e){this._triggersToPostInit.push(e)}_PostInit(){for(var e of this._customActionBlocksMap.values())e._CheckOverrideState();for(var t of this._functionBlocksByName.values())t._PostInit();for(var r of this._customActionBlocksMap.values())r._PostInit();for(var i of this._allSheets)i._PostInit();for(var s of this._allSheets)s._UpdateDeepIncludes();for(var a of this._triggersToPostInit)a._PostInit(!1);C33.clearArray(this._triggersToPostInit),this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(e){return this._sheetsByName.get(e.toLowerCase())||null}_RegisterGroup(e){this._allGroups.push(e),this._groupsByName.set(e.GetGroupName(),e)}_RegisterEventBlock(e){this._blocksBySid.set(e.GetSID(),e)}_RegisterCondition(e){this._cndsBySid.set(e.GetSID(),e)}_RegisterAction(e){this._actsBySid.set(e.GetSID(),e)}_RegisterFunctionBlock(e){switch(e.GetFunctionType()){case 0:this._functionBlocksByName.set(e.GetFunctionName().toLowerCase(),e);break;case 1:this._customActionBlocksMap.set(e.GetFunctionName().toLowerCase(),e)}}_RegisterEventVariable(e){this._eventVarsBySid.set(e.GetSID(),e),(e.IsGlobal()?this._allGlobalVars:this._allLocalVars).push(e)}_DeduplicateSolModifierList(r){2<=r.length&&r.sort(SortSolArray2);let i=this._allUniqueSolModifiers.get(r.length);i||(i=[],this._allUniqueSolModifiers.set(r.length,i));for(let e=0,t=i.length;e<t;++e){var s=i[e];if(IsSolArrayIdentical2(r,s))return s}return i.push(r),r}_GetNextLocalVarIndex(e){return this._localVarInitialValues.push(e.GetInitialValue()),this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){var e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetConditionAt(e.GetConditionIndex())}GetCurrentAction(){var e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetActionAt(e.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(e){var t=[];for(e=e.GetScopeParent();e;)C33.appendArray(t,e._GetAllLocalVariablesInScope()),e=e.GetScopeParent();return t}_GetLocalVariablesScriptInterface(e){var t,r={};for(t of this.GetAllLocalVariablesInScope(e))r[t.GetJsPropName()]=t._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,r)}GetEventVariableBySID(e){return this._eventVarsBySid.get(e)||null}GetEventBlockBySID(e){return this._blocksBySid.get(e)||null}GetConditionBySID(e){return this._cndsBySid.get(e)||null}GetActionBySID(e){return this._actsBySid.get(e)||null}GetFunctionBlockByName(e){return this._functionBlocksByName.get(e.toLowerCase())||null}GetCustomActionBlockByName(e,t){let r=this._customActionBlocksMap.get((e.GetName()+"."+t).toLowerCase());if(r)return r;if(!e.IsFamily())for(var i of e.GetFamilies())if(r=this._customActionBlocksMap.get((i.GetName()+"."+t).toLowerCase()))return r;return null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(e){for(var t of this._allGlobalVars)t.ResetToInitialValue();if(e)for(var r of this._allLocalVars)r.IsStatic()&&r.ResetToInitialValue()}GetEventGroupByName(e){return this._groupsByName.get(e.toLowerCase())||null}GetEventGroupBySID(e){e=this._blocksBySid.get(e);return e&&e.IsGroup()?e:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(var e of this._allGroups)e.ResetInitialActivation()}_ResetAllHasRunFlags(){for(var e of this._allSheets)e._ResetHasRunFlag()}RunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(var t of e.runningLayouts()){var r=t.GetEventSheet();r&&(this._runtime.PushCurrentLayout(t),r.Run(),this._runtime.PopCurrentLayout())}this._runningEventsDepth--}async DebugRunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(var t of this._DebugRunEventsGen(e))await this._runtime.DebugBreak(t);this._runningEventsDepth--}*_DebugRunEventsGen(e){for(var t of e.runningLayouts()){var r=t.GetEventSheet();r&&(this._runtime.PushCurrentLayout(t),yield*r.DebugRun(),this._runtime.PopCurrentLayout())}}_Trigger(e,t,r,i){let s=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,r,i);this._executingTriggerDepth++;for(var a of e.runningLayouts()){var n=a.GetEventSheet();if(n){this._runtime.PushCurrentLayout(a);for(var o of n.deepIncludes()){o=o._Trigger(t,r,i);s=s||o}a=n._Trigger(t,r,i);s=s||a,this._runtime.PopCurrentLayout()}}return this._executingTriggerDepth--,s}*_DebugTrigger(e,t,r,i){let s=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,r,i);this._executingTriggerDepth++;for(var a of e.runningLayouts()){var n=a.GetEventSheet();if(n){this._runtime.PushCurrentLayout(a);for(var o of n.deepIncludes()){o=yield*o._DebugTrigger(t,r,i);s=s||o}a=yield*n._DebugTrigger(t,r,i);s=s||a,this._runtime.PopCurrentLayout()}}return this._executingTriggerDepth--,s}QueueTrigger(e,t,r){return this._queuedTriggers.push([e,t,r]),!1}QueueDebugTrigger(e,t,r){let i=null;var s=new Promise(e=>i=e);return this._queuedDebugTriggers.push([e,t,r,i]),s}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw new Error("should not be in breakpoint");for(var e=this._runtime.GetLayoutManager();this._queuedDebugTriggers.length;){var[t,r,i,s]=this._queuedDebugTriggers.shift();s(yield*this._DebugTrigger(e,t,r,i))}}async RunQueuedDebugTriggersAsync(){for(var e of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(e)}_FastTrigger(e,r,i,s){let a=!1;var e=e.GetMainRunningLayout(),t=e.GetEventSheet();if(t){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(e);var n=t.deepIncludes();for(let e=0,t=n.length;e<t;++e){var o=n[e]._FastTrigger(r,i,s);a=a||o}e=t._FastTrigger(r,i,s);return a=a||e,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,a}}*_DebugFastTrigger(e,r,i,s){let a=!1;var e=e.GetMainRunningLayout(),t=e.GetEventSheet();if(t){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(e);var n=t.deepIncludes();for(let e=0,t=n.length;e<t;++e){var o=yield*n[e]._DebugFastTrigger(r,i,s);a=a||o}e=yield*t._DebugFastTrigger(r,i,s);return a=a||e,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,a}}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return 0<this.GetTriggerDepth()}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return 0<this._runningEventsDepth}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(e){for(var[t,r,i]of this._queuedTriggers)this._Trigger(e,t,r,i);C33.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){e?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return 0<this._blockFlushingDepth}ClearSol(r){for(let e=0,t=r.length;e<t;++e)r[e].GetSolStack().Clear()}PushCleanSol(r){for(let e=0,t=r.length;e<t;++e)r[e].GetSolStack().PushClean()}PushCopySol(r){for(let e=0,t=r.length;e<t;++e)r[e].GetSolStack().PushCopy()}PopSol(r){for(let e=0,t=r.length;e<t;++e)r[e].GetSolStack().Pop()}GetDynamicSolModifiersSet(t){var r=new Set,i=this._eventStack.GetAllStackFrames(),s=this._eventStack.GetCurrentStackFrameIndex();for(let e=0;e<=s;++e){var a=i[e].GetDynamicSolModifiers();if(a)for(var n of a)t&&t.has(n)||r.add(n)}return r}PushCleanSolDynamic(e){e=new Set([...e]),e=this.GetDynamicSolModifiersSet(e);if(0<e.size){for(var t of e)t.GetSolStack().PushClean();return[...e]}return null}AddScheduledWait(){var e=C33.New(C33.ScheduledWait,this);return this._scheduledWaits.push(e),e}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(this._scheduledWaits.length){var i=this.GetCurrentEventStackFrame();let r=!1;this._runningEventsDepth++;for(let e=0,t=this._scheduledWaits.length;e<t;++e){var s=this._scheduledWaits[e];s._ShouldRun()&&s._Run(i),s.ShouldRelease()&&(r=!0)}r&&(this._FilterScheduledWaitsToRelease(),i.Reset(null)),this._runningEventsDepth--}}async DebugRunScheduledWaits(){if(this._scheduledWaits.length){var i=this.GetCurrentEventStackFrame();let r=!1;this._runningEventsDepth++;for(let e=0,t=this._scheduledWaits.length;e<t;++e){var s=this._scheduledWaits[e];s._ShouldRun()&&await s._DebugRun(i),s.ShouldRelease()&&(r=!0)}r&&(this._FilterScheduledWaitsToRelease(),i.Reset(null)),this._runningEventsDepth--}}_FilterScheduledWaitsToRelease(){var e;for(e of C33.arrayFilterOut(this._scheduledWaits,e=>e.ShouldRelease()))e.Release()}ClearAllScheduledWaits(){for(var e of this._scheduledWaits)e.Release();C33.clearArray(this._scheduledWaits)}_OnInstancesReleased(e){for(var t of this._scheduledWaits)t.RemoveInstances(e);for(var r of e){var i=this._instSignals.get(r);if(this._instSignals.delete(r),i)for(var{resolve:s}of i.signalPromises.values())s(!0)}}AddAsyncActionPromise(e){this._asyncActionPromises.push(e)}ClearAsyncActionPromises(){C33.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){var e=Promise.all(this._asyncActionPromises);return this._asyncActionPromises=[],e}Signal(e){var t,r=e.toLowerCase();this._signalTags.push(r),this._runtime.Trigger(C33.Plugins.System.Cnds.OnSignal,null),this._signalTags.pop();for(t of this._runtime.GetEventSheetManager().scheduledWaits())t.IsSignal()&&t.GetSignalTag()===r&&t.SetSignalled();e=this._signalPromises.get(r);e&&(e.resolve(),this._signalPromises.delete(r))}WaitForSignal(e){var e=e.toLowerCase(),r=this._signalPromises.get(e);if(r)return r.promise;{let t=null;r=new Promise(e=>t=e);return this._signalPromises.set(e,{promise:r,resolve:t}),r}}GetCurrentSignalTag(){if(0===this._signalTags.length)throw new Error("not in a signal");return this._signalTags.at(-1)}_GetInstanceSignalState(e){let t=this._instSignals.get(e);return t||(t={signalTags:[],signalPromises:new Map},this._instSignals.set(e,t)),t}InstanceSignal(e,t){var r,i=this._GetInstanceSignalState(e),s=t.toLowerCase();i.signalTags.push(s),this._runtime.Trigger(e.GetPlugin().GetConstructor().Cnds.OnInstanceSignal,e),i.signalTags.pop();for(r of this._runtime.GetEventSheetManager().scheduledWaits())r.IsInstanceSignals()&&r.GetSignalTag()===s&&r.SetInstanceSignalled(e);t=i.signalPromises.get(s);t&&(t.resolve(!1),i.signalPromises.delete(s)),0===i.signalTags.length&&0===i.signalPromises.size&&this._instSignals.delete(e)}WaitForInstanceSignal(e,r){var e=this._GetInstanceSignalState(e),r=r.toLowerCase(),i=e.signalPromises.get(r);if(i)return i.promise;{let t=null;i=new Promise(e=>t=e);return e.signalPromises.set(r,{promise:i,resolve:t}),i}}GetCurrentInstanceSignalTag(e){e=this._GetInstanceSignalState(e);if(e&&0!==e.signalTags.length)return e.signalTags.at(-1);throw new Error("not in a signal")}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(e){this._LoadGroupsFromJson(e.groups),this._LoadCndsFromJson(e.cnds),this._LoadActsFromJson(e.acts),this._LoadVarsFromJson(e.vars),this._LoadScheduledWaitsFromJson(e.waits)}_SaveGroupsToJson(){var e,t={};for(e of this.GetAllGroups())t[e.GetSID().toString()]=e.IsGroupActive();return t}_LoadGroupsFromJson(e){for(var[t,r]of Object.entries(e)){t=parseInt(t,10),t=this.GetEventGroupBySID(t);t&&t.SetGroupActive(r)}}_SaveCndsToJson(){var e,t,r={};for([e,t]of this._cndsBySid){var i=t._SaveToJson();i&&(r[e.toString()]=i)}return r}_LoadCndsFromJson(e){var t,r,i,s,a=new Map;for([t,r]of Object.entries(e))a.set(parseInt(t,10),r);for([i,s]of this._cndsBySid)s._LoadFromJson(a.get(i)||null)}_SaveActsToJson(){var e,t,r={};for([e,t]of this._actsBySid){var i=t._SaveToJson();i&&(r[e.toString()]=i)}return r}_LoadActsFromJson(e){var t,r,i,s,a=new Map;for([t,r]of Object.entries(e))a.set(parseInt(t,10),r);for([i,s]of this._actsBySid)s._LoadFromJson(a.get(i)||null)}_SaveVarsToJson(){var e,t,r={};for([e,t]of this._eventVarsBySid)t.IsConstant()||!t.IsGlobal()&&!t.IsStatic()||(r[e.toString()]=t.GetValue());return r}_LoadVarsFromJson(e){for(var[t,r]of Object.entries(e)){t=parseInt(t,10),t=this.GetEventVariableBySID(t);t&&t.SetValue(r)}}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(e=>!e.IsPromise()).map(e=>e._SaveToJson())}_LoadScheduledWaitsFromJson(e){this.ClearAllScheduledWaits();for(var t of e){t=C33.ScheduledWait._CreateFromJson(this,t);t&&this._scheduledWaits.push(t)}}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map(e=>e.GetEventSheet()).filter(e=>e).map(e=>e._GetPerfRecord())}FindFirstFunctionBlockParent(e){for(;e;){var t=e.GetScopeParent();if(t instanceof C33.FunctionBlock)return t;e=t}return null}_InvokeFunctionFromJS(e,t){Array.isArray(t)||(t=[]);e=this.GetFunctionBlockByName(e.toLowerCase());if(!e)return null;if(!e.IsEnabled())return e.GetDefaultReturnValue();var r=e.GetFunctionParameters();if(t.length<r.length)for(t=t.slice(0);t.push(r[t.length].GetInitialValue()),t.length<r.length;);var i=e.GetEventBlock();return i.RunAsExpressionFunctionCall(i.GetSolModifiersIncludingParents(),!1,e.GetReturnType(),e.GetDefaultReturnValue(),...t)}}}{let C33=self.C3;C33.EventSheet=class EventSheet extends C33.DefendedBase{constructor(e,t){super(),this._eventSheetManager=e,this._runtime=e.GetRuntime(),this._name=t[0],this._events=[],this._triggers=new Map,this._fastTriggers=new Map,this._eventsByDisplayNumber=new Map,this._hasRun=!1,this._shallowIncludes=[],this._deepIncludes=[],this._alreadyIncludedSheets=new Set;for(var r of t[1])this._CreateEvent(r,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._eventSheetManager=null,this._runtime=null}_CreateEvent(e,t,r){switch(e[0]){case 0:case 3:this._CreateEventBlock(e,t,r);break;case 1:this._CreateEventVariable(e,t,r);break;case 2:this._CreateInclude(e,t,r);break;case 4:this._CreateFunctionBlock(e,t);break;case 5:this._CreateScriptBlock(e,t,r);break;case 6:this._CreateCustomACEBlock(e,t);break;default:throw new Error("invalid event type")}}_CreateEventBlock(e,t,r){var i=C33.EventBlock.Create(this,t,e);if(i.IsOrBlock()){r.push(i);var s=i.GetConditions();for(let e=0,t=s.length;e<t;++e)s[e].IsTrigger()&&this._InitTrigger(i,e)}else i.IsTrigger()?this._InitTrigger(i,0):r.push(i)}_CreateFunctionBlock(e,t){t=C33.FunctionBlock.CreateFunctionBlock(this,t,e);this._eventSheetManager._RegisterFunctionBlock(t)}_CreateCustomACEBlock(e,t){t=C33.FunctionBlock.CreateCustomACEBlock(this,t,e);this._eventSheetManager._RegisterFunctionBlock(t)}_CreateEventVariable(e,t,r){t=C33.EventVariable.Create(this,t,e);r.push(t)}_CreateInclude(e,t,r){t=C33.EventInclude.Create(this,t,e);r.push(t)}_CreateScriptBlock(e,t,r){t=C33.EventScript.Create(this,t,e);r.push(t)}_InitTrigger(i,s){i.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(i);var a=i.GetConditionAt(s),n=a._GetFunc(),o=a.GetObjectClass();if(a.IsFastTrigger()){let e=this._fastTriggers.get(o);e||(e=new Map,this._fastTriggers.set(o,e));var l=a.GetFastTriggerValue().toLowerCase();let t=e.get(n),r=(t||(t=new Map,e.set(n,t)),t.get(l));r||(r=[],t.set(l,r)),r.push([i,s])}else{let e=this._triggers.get(o);e||(e={methodMap:new Map,behaviors:new Map},this._triggers.set(o,e));l=a.GetBehaviorType();let t,r=(l?(t=e.behaviors.get(l))||(t=new Map,e.behaviors.set(l,t)):t=e.methodMap,t.get(n));r||(r=[],t.set(n,r)),r.push([i,s])}}_PostInit(){var r=this._events;for(let e=0,t=r.length;e<t;++e){var i=e<t-1&&r[e+1]instanceof C33.EventBlock&&r[e+1].IsElseBlock();r[e]._PostInit(i)}}_AddShallowInclude(e){this._shallowIncludes.push(e)}_UpdateDeepIncludes(){C33.clearArray(this._deepIncludes),this._AddDeepIncludes(this),this._alreadyIncludedSheets.clear()}_AddDeepIncludes(e){var t,r=e._deepIncludes,i=e._alreadyIncludedSheets;for(t of this._shallowIncludes){var s=t.GetIncludeSheet();t.IsActive()&&e!==s&&!i.has(s)&&(i.add(s),s._AddDeepIncludes(e),r.push(s))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(e,t){this._eventsByDisplayNumber.set(t,e)}_GetEventByDisplayNumber(e){return this._eventsByDisplayNumber.get(e)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(!this._hasRun){var e,t=this._runtime,r=t.IsCPUProfiling(),i=r?performance.now():0,s=(this._hasRun=!0,this.GetEventSheetManager()),a=s.GetCurrentEventStackFrame();for(e of this._events)e.Run(a),s.ClearSol(e.GetSolModifiers()),s.ClearAsyncActionPromises(),t.FlushPendingInstances();a.Reset(null),r&&(this._perfRecord.totalTimeCounter+=performance.now()-i)}}*DebugRun(){if(!this._hasRun){this._hasRun=!0;var e,t=this._runtime,r=this.GetEventSheetManager(),i=r.GetCurrentEventStackFrame();for(e of this._events)yield*e.DebugRun(i),r.ClearSol(e.GetSolModifiers()),r.ClearAsyncActionPromises(),t.FlushPendingInstances();i.Reset(null)}}_Trigger(r,i,s){if(!i)return this._TriggerForClass(r,i,null,null);{var a,n=i.GetObjectClass();let e=!1,t=this._TriggerForClass(r,i,n,s);e=e||t;for(a of n.GetFamilies())t=this._TriggerForClass(r,i,a,s),e=e||t}}_TriggerForClass(e,t,r,i){r=this._triggers.get(r);if(!r)return!1;i=i?r.behaviors.get(i):r.methodMap;if(!i)return!1;var s,a,r=i.get(e);if(!r)return!1;let n=!1;for([s,a]of r){var o=this._ExecuteTrigger(t,s,a);n=n||o}return n}*_DebugTrigger(r,i,s){if(!i)return yield*this._DebugTriggerForClass(r,i,null,null);{var a,n=i.GetObjectClass();let e=!1,t=yield*this._DebugTriggerForClass(r,i,n,s);e=e||t;for(a of n.GetFamilies())t=yield*this._DebugTriggerForClass(r,i,a,s),e=e||t}}*_DebugTriggerForClass(e,t,r,i){r=this._triggers.get(r);if(!r)return!1;i=i?r.behaviors.get(i):r.methodMap;if(!i)return!1;var s,a,r=i.get(e);if(!r)return!1;let n=!1;for([s,a]of r){let e;e=s.DebugCanRunFast()?this._ExecuteTrigger(t,s,a):yield*this._DebugExecuteTrigger(t,s,a),n=n||e}return n}_FastTrigger(e,t,r){t=t.GetObjectClass(),t=this._fastTriggers.get(t);if(!t)return!1;t=t.get(e);if(!t)return!1;var i=t.get(r);if(!i)return!1;let s=!1;for(let e=0,t=i.length;e<t;++e){var a=i[e],a=this._ExecuteTrigger(null,a[0],a[1]);s=s||a}return s}*_DebugFastTrigger(e,t,r){t=t.GetObjectClass(),t=this._fastTriggers.get(t);if(!t)return!1;t=t.get(e);if(!t)return!1;var i=t.get(r);if(!i)return!1;let s=!1;for(let t=0,e=i.length;t<e;++t){var a=i[t],n=a[0],a=a[1];let e;e=n.DebugCanRunFast()?this._ExecuteTrigger(null,n,a):yield*this._DebugExecuteTrigger(null,n,a),s=s||e}return s}_ExecuteTrigger(e,t,r){var i=this._runtime,s=this._eventSheetManager,a=s.GetCurrentEvent(),n=s.GetEventStack(),o=s.GetTriggerDepth();let l=!1;a&&s.PushCleanSol(a.GetSolModifiersIncludingParents()),s.PushCleanSol(t.GetSolModifiersIncludingParents());var h=1<o,u=(h&&s.GetLocalVarStack().Push(),n.Push(t));e&&(t.GetConditions()[r].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer())&&e.SetSiblingsSinglePicked();let c=!0;if(t.GetParent()){var _=t.GetTriggerParents();for(let e=0,t=_.length;e<t;++e)if(!_[e].RunPreTrigger(u)){c=!1;break}}return c&&(t.IsOrBlock()?t.RunOrBlockTrigger(u,r):t.Run(u),l=u.GetLastEventTrue()),n.Pop(),h&&s.GetLocalVarStack().Pop(),s.PopSol(t.GetSolModifiersIncludingParents()),a&&s.PopSol(a.GetSolModifiersIncludingParents()),a||1!==o||(s.ClearAsyncActionPromises(),s.IsFlushingBlocked())||i.FlushPendingInstances(),l}*_DebugExecuteTrigger(e,t,r){var i=this._runtime,s=this._eventSheetManager,a=s.GetCurrentEvent(),n=s.GetEventStack(),o=s.GetTriggerDepth();let l=!1;a&&s.PushCleanSol(a.GetSolModifiersIncludingParents()),s.PushCleanSol(t.GetSolModifiersIncludingParents());var h=1<o,u=(h&&s.GetLocalVarStack().Push(),n.Push(t));e&&(t.GetConditions()[r].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer())&&e.SetSiblingsSinglePicked();let c=!0;if(t.GetParent()){var _=t.GetTriggerParents();for(let e=0,t=_.length;e<t;++e)if(!(yield*_[e].DebugRunPreTrigger(u))){c=!1;break}}return c&&(t.IsOrBlock()?yield*t.DebugRunOrBlockTrigger(u,r):yield*t.DebugRun(u),l=u.GetLastEventTrue()),n.Pop(),h&&s.GetLocalVarStack().Pop(),s.PopSol(t.GetSolModifiersIncludingParents()),a&&s.PopSol(a.GetSolModifiersIncludingParents()),a||1!==o||(s.ClearAsyncActionPromises(),s.IsFlushingBlocked())||i.FlushPendingInstances(),l}_GetPerfRecord(){return this._perfRecord}}}{let NoActions2=function(e,t){return!0},C33=(NoActions=NoActions2,self.C3),EMPTY_ARRAY=[];function*DebugNoActions(e,t){return!0}C33.EventBlock=class EventBlock extends C33.DefendedBase{constructor(e,t,r){super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t,this._scopeParent=null,this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._solModifiers=[],this._solModifiersIncludingParents=[],this._hasGotSolModifiersIncludingParents=!1,this._isSolWriterAfterCnds=!1,this._isTopLevelGroup=!1,this._hasElseBlock=!1,this._isOrBlock=!!r[2],this._isElseBlock=!1,this._triggerParents=null,this._conditions=[],this._actions=[],this._subEvents=[],this._RunActions=NoActions2,this._DebugRunActions=DebugNoActions,this._isGroup=!1,this._isInitiallyActive=!1,this._groupName="",this._isGroupActive=!1,this._containedIncludes=null,this._perfRecord=null,this._sid=r[4],this._displayNumber=r[5],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=this._runtime.IsDebug()?{isBreakpoint:r[3][0],isBreakable:r[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,canRunSelfFast:!1}:null,this.GetEventSheetManager()._RegisterEventBlock(this),3===r[0]&&this._InitGroup(r[1]);let i=0;for(var s of r[6]){s=C33.Condition.Create(this,s,i++);this._conditions.push(s),this._AddSolModifier(s.GetObjectClass())}i=0;for(var a of r[7]){a=C33.Action.Create(this,a,i++);this._actions.push(a)}var n;if(9===r.length)for(n of r[8])this._eventSheet._CreateEvent(n,this,this._subEvents);this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&this._conditions[0]._GetFunc()===C33.Plugins.System.Cnds.Else),0===this._conditions.length&&(this._conditions=EMPTY_ARRAY),0===this._actions.length&&(this._actions=EMPTY_ARRAY),0===this._subEvents.length&&(this._subEvents=EMPTY_ARRAY)}static Create(e,t,r){return C33.New(C33.EventBlock,e,t,r)}_InitGroup(e){this._isGroup=!0,this._isInitiallyActive=!!e[0],this._isGroupActive=this._isInitiallyActive,this._groupName=e[1].toLowerCase(),this._containedIncludes=[],this.GetEventSheetManager()._RegisterGroup(this),this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:e[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(e){this._containedIncludes.push(e)}_AddContainerSolModifierToList(e,t){for(var r of e.GetContainer().objectTypes())t.includes(r)||t.push(r)}_AddSolModifierToList(e,t){if(e)if(t.includes(e)||t.push(e),e.IsFamily())for(var r of e.GetFamilyMembers())r.IsInContainer()&&this._AddContainerSolModifierToList(r,t);else e.IsInContainer()&&this._AddContainerSolModifierToList(e,t)}_AddSolModifier(e){this._AddSolModifierToList(e,this._solModifiers)}_AddParentSolModifier(e){this._AddSolModifierToList(e,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(e){this._hasElseBlock=!!e,this._IdentifyTopLevelGroup(),this._IdentifyTriggerParents();for(var t of this._conditions)t._PostInit();if(0<this._actions.length){let e=!1;for(var r of this._actions)r._PostInit(),r.HasReturnType()&&(e=!0);e?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}var i=this._subEvents;for(let e=0,t=i.length;e<t;++e){var s=e<t-1&&i[e+1]instanceof C33.EventBlock&&i[e+1].IsElseBlock();i[e]._PostInit(s)}this._debugData&&this._UpdateCanRunFast(),this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let e=this.GetParent();for(;e;){if(e.IsGroup())return e;e=e.GetParent()}return this._eventSheet}_UpdateCanRunFast(){var e=this._debugData;e.canRunAllConditionsFast=this._conditions.every(e=>e.DebugCanRunFast()),e.canRunAllActionsFast=this._actions.every(e=>e.DebugCanRunFast()),e.canRunAllSubEventsFast=this._subEvents.every(e=>e.DebugCanRunFast()),e.canRunSelfFast=e.canRunAllConditionsFast&&e.canRunAllActionsFast&&e.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;for(;e._UpdateCanRunFast(),e=e.GetParent(););}_IdentifyTopLevelGroup(){if(this.IsGroup()){let e=this.GetParent();for(this._isTopLevelGroup=!0;e;){if(!e.IsGroup()){this._isTopLevelGroup=!1;break}e=e.GetParent()}}}_IdentifySolModifiersIncludingParents(){var t=this._runtime.GetAllObjectClasses();if(this._solModifiers===t)this._solModifiersIncludingParents=t;else{this._solModifiersIncludingParents=C33.cloneArray(this._solModifiers);let e=this.GetParent();for(;e;){for(var r of e._solModifiers)this._AddParentSolModifier(r);e=e.GetParent()}t=this.GetEventSheetManager();this._solModifiers=t._DeduplicateSolModifierList(this._solModifiers),this._solModifiersIncludingParents=t._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(this.HasAnyTriggeredCondition()){this._triggerParents=[];let e=this.GetParent();for(;e;)this._triggerParents.push(e),e=e.GetParent();this._triggerParents.reverse()}}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0,this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){return this._hasGotSolModifiersIncludingParents||(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents()),this._solModifiersIncludingParents}HasSolModifier(e){return this._solModifiers.includes(e)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(e){this._scopeParent=e}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e,this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(e){if(e=!!e,!this._isGroup)throw new Error("not a group");if(this._isGroupActive!==e){this._isGroupActive=e;for(var t of this._containedIncludes)t.UpdateActive();this._containedIncludes.length&&(e=this._runtime.GetCurrentLayout().GetEventSheet())&&e._UpdateDeepIncludes()}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof C33.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some(e=>e.IsTrigger())}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(e){if((e=Math.floor(e))<0||e>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[e]}GetConditionByDebugIndex(e){return this.GetConditionAt(e)}IsFirstConditionOfType(e){let t=e.GetIndex();if(0!==t){--t;for(var r=e.IsSystemOrSingleGlobalCondition()?e.GetFirstObjectParameterObjectClass():e.GetObjectClass();0<=t;--t){var i=this._conditions[t];if(r===i.GetObjectClass()||i.IsSystemOrSingleGlobalCondition()&&i.GetFirstObjectParameterObjectClass()===r)return!1}}return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(e){if((e=Math.floor(e))<0||e>=this._actions.length)throw new RangeError("invalid action index");return this._actions[e]}GetActionByDebugIndex(t){t=Math.floor(t);var e=this._actions.find(e=>e.GetDebugIndex()===t);if(e)return e;throw new RangeError("invalid action debug index")}_HasActionIndex(e){return 0<=(e=Math.floor(e))&&e<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter(e=>e instanceof C33.EventVariable)}RunPreTrigger(r){r.SetCurrentEvent(this);var i=this._conditions;let s=0===i.length;for(let e=0,t=i.length;e<t;++e){var a=i[e];if(r.SetConditionIndex(e),a.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(a.Run())s=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||s}RunOrBlockTrigger(e,t){e.SetCurrentEvent(this),e.SetConditionIndex(t),this._conditions[t].Run()&&(this._RunActions(e,0)&&this._RunSubEvents(e),e.SetLastEventTrue(!0))}*DebugRunPreTrigger(r){r.SetCurrentEvent(this);var i=this._conditions;let s=0===i.length;for(let t=0,e=i.length;t<e;++t){var a=i[t];if(r.SetConditionIndex(t),a.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");let e;if(e=a.DebugCanRunFast()?a.Run():yield*a.DebugRun())s=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||s}*DebugRunOrBlockTrigger(t,e){t.SetCurrentEvent(this),t.SetConditionIndex(e);e=this._conditions[e];let r;if(r=e.DebugCanRunFast()?e.Run():yield*e.DebugRun()){let e;(e=this.DebugCanRunActionsFast()?this._RunActions(t,0):yield*this._DebugRunActions(t,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),t.SetLastEventTrue(!0)}}Run(e){e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?this._RunOrBlock(e):this._RunAndBlock(e)}*DebugRun(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?yield*this._DebugRunOrBlock(e):yield*this._DebugRunAndBlock(e)}_RunOrBlock(r){var i=this._conditions;let s=0===i.length;for(let e=0,t=i.length;e<t;++e){var a=i[e];a.IsTrigger()||(r.SetConditionIndex(e),a=a.Run(),s=s||a)}r.SetLastEventTrue(s),s&&(this._RunActions(r,0)&&this._RunSubEvents(r),this._hasElseBlock)&&r.SetElseBranchRan(!0)}*_DebugRunOrBlock(r){var i=this._conditions;let s=0===i.length;for(let t=0,e=i.length;t<e;++t){var a=i[t];if(!a.IsTrigger()){r.SetConditionIndex(t);let e;e=a.DebugCanRunFast()?a.Run():yield*a.DebugRun(),s=s||e}}if(r.SetLastEventTrue(s),s){let e;(e=this.DebugCanRunActionsFast()?this._RunActions(r,0):yield*this._DebugRunActions(r,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&r.SetElseBranchRan(!0)}}_RunAndBlock(r){var i=this._conditions;for(let e=0,t=i.length;e<t;++e){var s=i[e],s=(r.SetConditionIndex(e),s.Run());if(!s)return void r.SetLastEventTrue(!1)}r.SetLastEventTrue(!0),this._RunActions(r,0)&&this._RunSubEvents(r),r.GetLastEventTrue()&&this._hasElseBlock&&r.SetElseBranchRan(!0)}*_DebugRunAndBlock(r){var i=this._conditions;for(let t=0,e=i.length;t<e;++t){var s=i[t];r.SetConditionIndex(t);let e;if(!(e=s.DebugCanRunFast()?s.Run():yield*s.DebugRun()))return void r.SetLastEventTrue(!1)}r.SetLastEventTrue(!0);let e;(e=this.DebugCanRunActionsFast()?this._RunActions(r,0):yield*this._DebugRunActions(r,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),r.GetLastEventTrue()&&this._hasElseBlock&&r.SetElseBranchRan(!0)}_RunActions_Fast(r,i){var s=this._actions;for(let e=i,t=s.length;e<t;++e){var a=s[e];r.SetActionIndex(e),a.Run()}return!0}*_DebugRunActions_Fast(r,i){var s=this._actions;for(let e=i,t=s.length;e<t;++e){var a=s[e];r.SetActionIndex(e),a.DebugCanRunFast()?a.Run():yield*a.DebugRun()}return!0}_RunActions_ReturnValue(r,i){var s=this.GetEventSheetManager(),a=this._actions;for(let e=i,t=a.length;e<t;++e){var n=a[e],o=(r.SetActionIndex(e),n.Run());if(n.CanBailOut()&&!0===o)return!1;n.IsAsync()&&o instanceof Promise&&s.AddAsyncActionPromise(o)}return!0}*_DebugRunActions_ReturnValue(r,i){var s=this.GetEventSheetManager(),a=this._actions;for(let t=i,e=a.length;t<e;++t){var n=a[t];r.SetActionIndex(t);let e;if(e=n.DebugCanRunFast()?n.Run():yield*n.DebugRun(),n.CanBailOut()&&!0===e)return!1;n.IsAsync()&&e instanceof Promise&&s.AddAsyncActionPromise(e)}return!0}_ResumeActionsAndSubEvents(e){this._RunActions(e,e.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(e){(yield*this._DebugRunActions(e,e.GetActionIndex()))&&(yield*this._DebugRunSubEvents())}_RunSubEvents(){var e,t,r,i;this._subEvents.length&&(t=(e=this.IsGroup()&&this._runtime.IsCPUProfiling())?performance.now():0,i=(r=this._eventStack).Push(this),this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(i):this._RunSubEvents_Fast(i),r.Pop(),e)&&(this._perfRecord.totalTimeCounter+=performance.now()-t)}_RunSubEvents_SolWriterAfterCnds(i){var s=this._isGroup,a=this._isTopLevelGroup,n=this.GetEventSheetManager(),o=this._subEvents;for(let e=0,t=o.length,r=t-1;e<t;++e){var l=o[e],h=l.GetSolModifiers(),u=!a||!s&&e<r;u&&n.PushCopySol(h),l.Run(i),u?n.PopSol(h):n.ClearSol(h)}}_RunSubEvents_Fast(r){var i=this._subEvents;for(let e=0,t=i.length;e<t;++e)i[e].Run(r)}*_DebugRunSubEvents(){var e,t;this._subEvents.length&&(t=(e=this._eventStack).Push(this),this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(t):yield*this._DebugRunSubEvents_Fast(t),e.Pop())}*_DebugRunSubEvents_SolWriterAfterCnds(i){var s=this._isGroup,a=this._isTopLevelGroup,n=this.GetEventSheetManager(),o=this._subEvents;for(let e=0,t=o.length,r=t-1;e<t;++e){var l=o[e],h=l.GetSolModifiers(),u=!a||!s&&e<r;u&&n.PushCopySol(h),yield*l.DebugRun(i),u?n.PopSol(h):n.ClearSol(h)}}*_DebugRunSubEvents_Fast(r){var i=this._subEvents;for(let e=0,t=i.length;e<t;++e)yield*i[e].DebugRun(r)}Retrigger(r,i){i.ResetQuick();var s=this._conditions;if(!this.IsOrBlock())for(let e=r.GetConditionIndex()+1,t=s.length;e<t;++e){var a=s[e],a=(i.SetConditionIndex(e),a.Run());if(!a)return!1}return this._RunActions(i,0)&&this._RunSubEvents(i),!0}*DebugRetrigger(r,i){i.ResetQuick();var s=this._conditions;if(!this.IsOrBlock())for(let t=r.GetConditionIndex()+1,e=s.length;t<e;++t){var a=s[t];i.SetConditionIndex(t);let e;if(!(e=a.DebugCanRunFast()?a.Run():yield*a.DebugRun()))return!1}let e;return(e=this.DebugCanRunActionsFast()?this._RunActions(i,0):yield*this._DebugRunActions(i,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(r){if(this.GetParent()){var i=this.GetTriggerParents();for(let e=0,t=i.length;e<t;++e)if(!i[e].RunPreTrigger(r))return!1}return!0}*_DebugCheckParentsOKToRun(r){if(this.GetParent()){var i=this.GetTriggerParents();for(let e=0,t=i.length;e<t;++e)if(!(yield*i[e].DebugRunPreTrigger(r)))return!1}return!0}_EvaluateFunctionCallParameters(e,t,r){var i;0<t.length?r?(i=t.map(e=>e.Get(0)),e.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(i)):this._scopeParent.EvaluateFunctionParameters(t):r&&e.GetLocalVarStack().Push()}RunAsFunctionCall(e,t,r,i){let s,a;var n=0<e.length;let o=null;var l=this._runtime,h=this._eventStack,l=l.GetEventSheetManager(),u=1<l._IncTriggerDepth(),c=(this._EvaluateFunctionCallParameters(l,t,u),n&&(r?l.PushCopySol(e):l.PushCleanSol(e)),null!==i&&(i.copyFromObjectClass?(t=r?i.copyFromObjectClass.GetCurrentSol():i.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol(),(c=i.copyToObjectClass.GetCurrentSol()).SetArrayPicked(t.GetInstances()),c.ClearElseInstances(),r||i.copyToObjectClass.ApplySolToContainer()):i.pickObjectClass&&((t=i.pickObjectClass.GetCurrentSol()).SetArrayPicked(i.pickInstances),t.ClearElseInstances()),i.pushCleanSolDynamic)&&(o=l.PushCleanSolDynamic(e)),h.Push(this));return r&&c.SetDynamicSolModifiers(e),this._CheckParentsOKToRun(c)&&(c.SetCurrentEvent(this),(t=this._scopeParent.IsAsync())&&([a,s]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(c),t)&&this._scopeParent.MaybeFinishAsyncFunctionCall(a),h.Pop(),u&&l.GetLocalVarStack().Pop(),null!==o&&l.PopSol(o),n&&l.PopSol(e),l._DecTriggerDepth(),s}*DebugRunAsFunctionCall(e,t,r,i){let s,a;(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);var n=0<e.length;let o=null;var l=this._runtime,h=this._eventStack,l=l.GetEventSheetManager(),u=1<l._IncTriggerDepth(),c=(this._EvaluateFunctionCallParameters(l,t,u),n&&(r?l.PushCopySol(e):l.PushCleanSol(e)),null!==i&&(i.copyFromObjectClass?(t=r?i.copyFromObjectClass.GetCurrentSol():i.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol(),(c=i.copyToObjectClass.GetCurrentSol()).SetArrayPicked(t.GetInstances()),c.ClearElseInstances(),r||i.copyToObjectClass.ApplySolToContainer()):i.pickObjectClass&&((t=i.pickObjectClass.GetCurrentSol()).SetArrayPicked(i.pickInstances),t.ClearElseInstances()),i.pushCleanSolDynamic)&&(o=l.PushCleanSolDynamic(e)),h.Push(this));return r&&c.SetDynamicSolModifiers(e),(yield*this._DebugCheckParentsOKToRun(c))&&(c.SetCurrentEvent(this),(t=this._scopeParent.IsAsync())&&([a,s]=this._scopeParent.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(c),t)&&this._scopeParent.MaybeFinishAsyncFunctionCall(a),h.Pop(),u&&l.GetLocalVarStack().Pop(),null!==o&&l.PopSol(o),n&&l.PopSol(e),l._DecTriggerDepth(),s}RunAsMappedFunctionCall(e,t){var r=this.GetSolModifiersIncludingParents(),i=0<r.length,s=this._runtime,a=this._eventStack,s=s.GetEventSheetManager(),n=1<s._IncTriggerDepth(),e=(n&&s.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?s.PushCopySol(r):s.PushCleanSol(r)),a.Push(this));this._CheckParentsOKToRun(e)&&(e.SetCurrentEvent(this),this._RunAndBlock(e)),a.Pop(),n&&s.GetLocalVarStack().Pop(),i&&s.PopSol(r),s._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(e,t){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);var r=this.GetSolModifiersIncludingParents(),i=0<r.length,s=this._runtime,a=this._eventStack,s=s.GetEventSheetManager(),n=1<s._IncTriggerDepth(),e=(n&&s.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?s.PushCopySol(r):s.PushCleanSol(r)),a.Push(this));(yield*this._DebugCheckParentsOKToRun(e))&&(e.SetCurrentEvent(this),yield*this._DebugRunAndBlock(e)),a.Pop(),n&&s.GetLocalVarStack().Pop(),i&&s.PopSol(r),s._DecTriggerDepth()}RunAsExpressionFunctionCall(e,t,r,i,...s){let a,n;var o=0<e.length,l=this._runtime,h=this._eventStack,u=l.GetEventSheetManager(),c=1<u._IncTriggerDepth(),s=(c&&u.GetLocalVarStack().Push(),0<s.length&&this._scopeParent.SetFunctionParameters(s),o&&(t?u.PushCopySol(e):u.PushCleanSol(e)),h.Push(this));return s.InitCallFunctionExpression(r,i),h.PushExpFunc(s),l.SetDebuggingEnabled(!1),this._CheckParentsOKToRun(s)&&(s.SetCurrentEvent(this),(t=this._scopeParent.IsAsync())&&([n,a]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(s),t)&&this._scopeParent.MaybeFinishAsyncFunctionCall(n),l.SetDebuggingEnabled(!0),h.Pop(),h.PopExpFunc(),c&&u.GetLocalVarStack().Pop(),o&&u.PopSol(e),u._DecTriggerDepth(),a||s.GetFunctionReturnValue()}}}{let C33=self.C3,EMPTY_SOL_MODIFIERS=[],hadUserScriptException=!1;C33.EventScript=class EventScript extends C33.DefendedBase{constructor(e,t,r){super();var i=e.GetRuntime(),s=e.GetEventSheetManager(),s=(this._eventSheet=e,this._eventSheetManager=s,this._runtime=e.GetRuntime(),this._parent=t,i.GetObjectReference(r[1]));this._func=s,this._displayNumber=r[2],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=i.IsDebug()?{isBreakpoint:r[3][0],isBreakable:r[3][1]}:null}static Create(e,t,r){return C33.New(C33.EventScript,e,t,r)}_PostInit(){var e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e}IsElseBlock(){return!1}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():EMPTY_SOL_MODIFIERS}Run(e){e.SetCurrentEvent(this),this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(e){console.error(`Unhandled exception running script %c${this.GetEventSheet().GetName()}, event ${this.GetDisplayNumber()}:`,"font-size: 1.2em; font-weight: bold;",e),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),hadUserScriptException||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),hadUserScriptException=!0)}}*DebugRun(e){e.SetCurrentEvent(this),(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.Run(e)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return hadUserScriptException}static SetHadUserScriptException(){hadUserScriptException=!0}}}{let C33=self.C3,assert=self.assert;C33.FunctionBlock=class FunctionBlock extends C33.DefendedBase{constructor(e,t,r){super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t,this._functionType=0,this._functionName="",this._returnType=0,this._functionParameters=[],this._isEnabled=!0,this._aceName="",this._objectClass=null,this._hasOverrides=!1,this._innerLocalVariables=[],this._isCopyPicked=!1,this._isAsync=!1,this._nextAsyncId=0,this._currentAsyncId=-1,this._asyncMap=new Map,this._eventBlock=C33.EventBlock.Create(e,t,r),this._eventBlock._SetScopeParent(this)}InitFunctionBlock(e){this._functionType=0,this._functionName=e[0],this._returnType=e[1],this._functionParameters=e[2].map(e=>C33.EventVariable.Create(this._eventSheet,this,e)),this._isEnabled=e[3],this._isAsync=e[4],this._isCopyPicked=e[5]}InitCustomACEBlock(e){this._functionType=1,this._aceName=e[1],this._objectClass=this._runtime.GetObjectClassByIndex(e[2]),this._eventBlock._AddSolModifier(this._objectClass),this._functionName=this._objectClass.GetName()+"."+this._aceName,this._returnType=e[3],this._functionParameters=e[4].map(e=>C33.EventVariable.Create(this._eventSheet,this,e)),this._isEnabled=e[5],this._isAsync=e[6],this._isCopyPicked=e[7],this._objectClass.AddCustomAction(this)}static CreateFunctionBlock(e,t,r){e=C33.New(C33.FunctionBlock,e,t,r),t=r[1];return e.InitFunctionBlock(t),e}static CreateCustomACEBlock(e,t,r){e=C33.New(C33.FunctionBlock,e,t,r),t=r[1];return e.InitCustomACEBlock(t),e}_CheckOverrideState(){if(this._objectClass&&this._objectClass.IsFamily())for(var e of this._objectClass.GetFamilyMembers())if(e.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=!0;break}}_PostInit(){for(var e of this._functionParameters)e._PostInit();this._eventBlock._PostInit(!1)}GetFunctionType(){return this._functionType}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(e){this._innerLocalVariables.push(e)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(r){var i=this._functionParameters;for(let e=0,t=i.length;e<t;++e)i[e].SetValue(r[e].Get(0))}SetFunctionParameters(r){var i=this._functionParameters;for(let e=0,t=i.length;e<t;++e)i[e].SetValue(r[e])}CaptureFunctionParameters(){return this._functionParameters.map(e=>e.GetValue())}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetACEName(){return this._aceName}HasCustomACEOverrides(){return this._hasOverrides}GetReturnType(){return this._returnType}GetObjectClass(){return this._objectClass}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){var e=this._nextAsyncId++;this._currentAsyncId=e;let t;var r=new Promise(e=>t=e);return this._asyncMap.set(e,{resolve:t,pauseCount:0}),[e,r]}MaybeFinishAsyncFunctionCall(e){var t=this._asyncMap.get(e);0===t.pauseCount&&(t.resolve(),this._asyncMap.delete(e)),this._currentAsyncId=-1}PauseCurrentAsyncFunction(){return this._asyncMap.get(this._currentAsyncId).pauseCount++,this._currentAsyncId}ResumeAsyncFunction(e){this._currentAsyncId=e,this._asyncMap.get(e).pauseCount--}RunAsFamilyCustomActionWithOverrides(e,t){var r,i=new Map,s=[];for(r of this._objectClass.GetCurrentSol().GetInstances()){var a,n=r.GetObjectClass();n.HasOwnCustomActionByName(this._aceName)?(a=i.get(n),Array.isArray(a)?a.push(r):i.set(n,[r])):s.push(r)}if(0<s.length&&this._eventBlock.RunAsFunctionCall(e,t,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:s}),0<i.size)for(var[o,l]of i){var h=o.GetOwnCustomActionByName(this._aceName).GetEventBlock(),u=[...new Set([...e,...h.GetSolModifiers()])];h.RunAsFunctionCall(u,t,this._isCopyPicked,{pickObjectClass:o,pickInstances:l})}}*DebugRunAsFamilyCustomActionWithOverrides(e,t){var r,i=new Map,s=[];for(r of this._objectClass.GetCurrentSol().GetInstances()){var a,n=r.GetObjectClass();n.HasOwnCustomActionByName(this._aceName)?(a=i.get(n),Array.isArray(a)?a.push(r):i.set(n,[r])):s.push(r)}if(0<s.length&&(yield*this._eventBlock.DebugRunAsFunctionCall(e,t,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:s})),0<i.size)for(var[o,l]of i){var h=o.GetOwnCustomActionByName(this._aceName).GetEventBlock(),u=[...new Set([...e,...h.GetSolModifiers()])];yield*h.DebugRunAsFunctionCall(u,t,this._isCopyPicked,{pickObjectClass:o,pickInstances:l})}}}}{let C33=self.C3,EMPTY_SOL_MODIFIERS=[];C33.EventVariable=class EventVariable extends C33.DefendedBase{constructor(e,t,r){super();var i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._localVarStack=i.GetLocalVarStack(),this._name=r[1],this._type=r[2],this._initialValue=r[3],this._isStatic=!!r[4],this._isConstant=!!r[5],this._isFunctionParameter=t instanceof C33.FunctionBlock,this._sid=r[6],this._jsPropName=this._runtime.GetJsPropName(r[8]),this._scriptSetter=e=>this.SetValue(e),this._scriptGetter=()=>this.GetValue(),this._hasSingleValue=!this._parent||this._isStatic||this._isConstant,this._value=this._initialValue,this._localIndex=-1,this.IsBoolean()&&(this._value=this._value?1:0),!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=i._GetNextLocalVarIndex(this)),i._RegisterEventVariable(this)}static Create(e,t,r){return C33.New(C33.EventVariable,e,t,r)}_PostInit(){var e;!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.IsFunctionParameter()||(e=this._eventSheetManager.FindFirstFunctionBlockParent(this))&&e._RegisterLocalVariable(this)}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}Run(e){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(e){this.Run(e)}SetValue(e){this.IsNumber()?"number"!=typeof e&&(e=parseFloat(e)):this.IsString()?"string"!=typeof e&&(e=e.toString()):this.IsBoolean()&&(e=e?1:0),this._hasSingleValue?this._value=e:this._localVarStack.GetCurrent()[this._localIndex]=e}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let e=this.GetValue();return e=this.IsBoolean()?!!e:e}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}}}{let C33=self.C3,assert=self.assert,EMPTY_SOL_MODIFIERS=[];C33.EventInclude=class EventInclude extends C33.DefendedBase{constructor(e,t,r){super();var i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._includeSheet=null,this._includeSheetName=r[1],this._isActive=!0}static Create(e,t,r){return C33.New(C33.EventInclude,e,t,r)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName),this._eventSheet._AddShallowInclude(this);let e=this.GetParent();for(;e;)e instanceof C33.EventBlock&&e.IsGroup()&&e._AddContainedInclude(this),e=e.GetParent();this.UpdateActive(),this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetIncludeSheet(){return this._includeSheet}Run(e){var t=!!this.GetParent(),r=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(r),this._includeSheet.Run(),t&&this._eventSheetManager.PopSol(r)}*DebugRun(e){var t=!!this.GetParent(),r=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(r),yield*this._includeSheet.DebugRun(),t&&this._eventSheetManager.PopSol(r)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let e=this.GetParent();for(;e;){if(e instanceof C33.EventBlock&&e.IsGroup()&&!e.IsGroupActive())return void(this._isActive=!1);e=e.GetParent()}this._isActive=!0}}}{let WrapIndex2=function(e,t){return t<=e?e%t:(e<0&&(e<=-t&&(e%=t),e<0)&&(e+=t),e)},C33=(WrapIndex=WrapIndex2,self.C3),assert=self.assert;C33.ExpNode=class ExpNode extends C33.DefendedBase{constructor(e){super(),this._owner=e,this._runtime=e.GetRuntime()}_PostInit(){}static CreateNode(e,t){var r=t[0],i=[BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode];return C33.New(i[r],e,t)}};class SystemExpressionExpNode extends C33.ExpNode{constructor(e,t){super(e),this._systemPlugin=this._runtime.GetSystemPlugin(),this._func=this._runtime.GetObjectReference(t[1]),this._func!==C33.Plugins.System.Exps.random&&this._func!==C33.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}class CallFunctionExpressionExpNode extends C33.ExpNode{constructor(e,t){super(e),this._functionBlock=null,this._functionName=t[1],this._owner.SetVariesPerInstance()}_PostInit(){var e=this._runtime.GetEventSheetManager(),t=(this._functionBlock=e.GetFunctionBlockByName(this._functionName),this._functionName=null,this._owner.GetEventBlock()),r=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...new Set([...t.GetSolModifiersIncludingParents(),...r.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=e._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){var e,t=this._functionBlock;if(t.IsEnabled())return e=t.GetEventBlock(),C33.EventBlock.prototype.RunAsExpressionFunctionCall.bind(e,this._combinedSolModifiers,t.IsCopyPicked(),t.GetReturnType(),t.GetDefaultReturnValue());{let e=t.GetDefaultReturnValue();return()=>e}}}class ObjectExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._func=this._runtime.GetObjectReference(t[2]),this._returnsString=!!t[3],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...e){var t=this._objectClass,r=t.GetCurrentSol().GetExpressionInstances(),i=r.length;return 0===i?this._returnsString?"":0:(i=WrapIndex2(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),this._func.apply(r[i].GetSdkInstance(),e))}ExpObject_InstExpr(e,...t){var r=this._objectClass,i=r.GetInstances(),s=i.length;return 0===s?this._returnsString?"":0:(e=WrapIndex2(e,s),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(r),this._func.apply(i[e].GetSdkInstance(),t))}}class InstVarExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._varIndex=t[3],this._returnsString=!!t[2],this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){var e=this._objectClass.GetCurrentSol().GetExpressionInstances(),t=e.length;return 0===t?this._returnsString?"":0:e[WrapIndex2(this._owner.GetSolIndex(),t)]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){var e=this._objectClass,t=e.GetCurrentSol().GetExpressionInstances(),r=t.length;return 0===r?this._returnsString?"":0:(r=(t=t[WrapIndex2(this._owner.GetSolIndex(),r)]).GetObjectClass().GetFamilyInstanceVariableOffset(e.GetFamilyIndex()),t._GetInstanceVariableValueUnchecked(this._varIndex+r))}ExpInstVar_InstExpr(e){var t=this._objectClass,r=t.GetInstances(),i=r.length;if(0===i)return this._returnsString?"":0;r=r[WrapIndex2(e,i)];let s=0;return t.IsFamily()&&(s=r.GetObjectClass().GetFamilyInstanceVariableOffset(t.GetFamilyIndex())),r._GetInstanceVariableValueUnchecked(this._varIndex+s)}}class BehaviorExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]),this._func=this._runtime.GetObjectReference(t[3]),this._returnsString=!!t[4],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...e){var t=this._objectClass,r=t.GetCurrentSol().GetExpressionInstances(),i=r.length;if(0===i)return this._returnsString?"":0;i=WrapIndex2(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),r=r[i];let s=0;return t.IsFamily()&&(s=r.GetObjectClass().GetFamilyBehaviorOffset(t.GetFamilyIndex())),this._func.apply(r.GetBehaviorInstances()[this._behaviorIndex+s].GetSdkInstance(),e)}ExpBehavior_InstExpr(e,...t){var r=this._objectClass,i=r.GetInstances(),s=i.length;if(0===s)return this._returnsString?"":0;e=WrapIndex2(e,s),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(r),s=i[e];let a=0;return r.IsFamily()&&(a=s.GetObjectClass().GetFamilyBehaviorOffset(r.GetFamilyIndex())),this._func.apply(s.GetBehaviorInstances()[this._behaviorIndex+a].GetSdkInstance(),t)}}class EventVarExpNode extends C33.ExpNode{constructor(e,t){super(e),this._eventVar=null,this._eventVarSid=t[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}}{let GetExpressionFunc2=function(e){e=self.C3_ExpressionFuncs[e];if(e)return e;throw new Error("invalid expression number")},C33=(GetExpressionFunc=GetExpressionFunc2,self.C3),assert=self.assert;C33.Parameter=class Parameter extends C33.DefendedBase{constructor(e,t,r){super(),this._owner=e,this._index=r,this._type=t,this.Get=null,this._variesPerInstance=!1,this._isConstant=!1}static Create(e,t,r){var i=t[0],s=[ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,VariadicParameter,StringExpressionParameter,TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter,FlowchartParameter];return C33.New(s[i],e,i,r,t)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(e){this._variesPerInstance||!e||e.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0)}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}IsObjectParameter(){return 4===this._type}};class ExpressionParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._solIndex=0;var s=i[1];this._expressionNumber=s[0],this._numberedNodes=[],this._expressionFunc=null;for(let e=1,t=s.length;e<t;++e)this._numberedNodes.push(C33.ExpNode.CreateNode(this,s[e]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=GetExpressionFunc2(this._expressionNumber),this._isConstant=!0)}_GetNode(e){if(e<0||e>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[e]}_PostInit(){for(var e of this._numberedNodes)e._PostInit();var t=GetExpressionFunc2(this._expressionNumber);this._numberedNodes.length?this._expressionFunc=t(this):this._expressionFunc=t}GetSolIndex(){return this._solIndex}GetExpression(e){return this._solIndex=e,this._expressionFunc()}}class StringExpressionParameter extends ExpressionParameter{constructor(e,t,r,i){super(e,t,r,i),this.Get=this.GetStringExpression,14===t&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof C33.Action)&&this.GetEventBlock().SetSolWriterAfterCnds()}GetStringExpression(e){this._solIndex=e;e=this._expressionFunc();return"string"==typeof e?e:""}_GetFastTriggerValue(){return GetExpressionFunc2(this._expressionNumber)()}}class LayerExpressionParameter extends ExpressionParameter{constructor(e,t,r,i){super(e,t,r,i),2<=e.GetImplementationSdkVersion()?this.Get=this.GetILayer:this.Get=this.GetLayer,this._isConstant=!1}GetLayer(e){this._solIndex=e;e=this._expressionFunc();return this.GetRuntime().GetCurrentLayout().GetLayer(e)}GetILayer(e){e=this.GetLayer(e);return e?e.GetILayer():null}}class ComboParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._combo=i[1],this.Get=this.GetCombo,this._isConstant=!0}GetCombo(){return this._combo}}class BooleanParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._bool=i[1],this.Get=this.GetBoolean,this._isConstant=!0}GetBoolean(){return this._bool}}class ObjectParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._objectClass=this.GetRuntime().GetObjectClassByIndex(i[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetIObjectClass:this.Get=this.GetObjectClass;t=this.GetEventBlock();t._AddSolModifier(this._objectClass),this._owner instanceof C33.Action?t.SetSolWriterAfterCnds():t.GetParent()&&t.GetParent().SetSolWriterAfterCnds(),this._isConstant=!0}GetObjectClass(){return this._objectClass}GetIObjectClass(){return this._objectClass?this._objectClass.GetIObjectClass():null}}class LayoutParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(i[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetILayout:this.Get=this.GetLayout,this._isConstant=!0}GetLayout(){return this._layout}GetILayout(){return this._layout?this._layout.GetILayout():null}}class TimelineParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(i[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetITimelineState:this.Get=this.GetTimeline,this._isConstant=!0}GetTimeline(){return this._timeline}GetITimelineState(){return this._timeline?this._timeline.GetITimelineState():null}}class FileParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._fileInfo=i[1],this.Get=this.GetFile,this._isConstant=!0}GetFile(){return this._fileInfo}}class InstVarParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._instVarIndex=i[1];e=this._owner.GetObjectClass();!(this._owner instanceof C33.Condition&&this._owner.IsStatic())&&e&&e.IsFamily()?(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance()):(this.Get=this.GetInstanceVariable,this._isConstant=!0)}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(e){e=e||0;var t=this._owner.GetObjectClass(),r=t.GetCurrentSol(),i=r.GetInstances();let s=null;if(i.length)s=i[e%i.length].GetObjectClass();else if(r.HasAnyElseInstances()){i=r.GetElseInstances();s=i[e%i.length].GetObjectClass()}else{if(!(0<t.GetInstanceCount()))return 0;r=t.GetInstances();s=r[e%r.length].GetObjectClass()}return this._instVarIndex+s.GetFamilyInstanceVariableOffset(t.GetFamilyIndex())}}class EventVarParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._eventVarSid=i[1],this._eventVar=null,2<=e.GetImplementationSdkVersion()?this.Get=this.GetIEventVariable:this.Get=this.GetEventVariable,this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}GetIEventVariable(){return null}}class FunctionParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._functionBlockName=i[1],this._functionBlock=null,2<=e.GetImplementationSdkVersion()?this.Get=this.GetIFunction:this.Get=this.GetFunction,this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName),this._functionBlockName=null}GetFunction(){return this._functionBlock}GetIFunction(){return null}}class VariadicParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._subParams=[],this._variadicRet=[],this._isConstant=!0;for(let e=1,t=i.length;e<t;++e){var s=C33.Parameter.Create(this._owner,i[e],0);this._subParams.push(s),this._variadicRet.push(0),s.IsConstant()||(this._isConstant=!1)}this.Get=this.GetVariadic}_PostInit(){for(var e of this._subParams)e._PostInit()}GetVariadic(){var r=this._subParams,i=this._variadicRet;for(let e=0,t=r.length;e<t;++e)i[e]=r[e].Get(0);return i}}class EaseParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._easeIndex=i[1],this.Get=this.GetEase,this._isConstant=!0}GetEase(){return this._easeIndex}}class TilemapBrushParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._brushIndex=i[1],this.Get=this.GetTilemapBrush,this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}class TemplateExpressionParameter extends ExpressionParameter{constructor(e,t,r,i){super(e,t,r,i),this.Get=this.GetTemplateName,this._isConstant=!1}GetTemplateName(){return this._expressionFunc()}}class FlowchartParameter extends C33.Parameter{constructor(e,t,r,i){super(e,t,r),this._flowchartDataItem=this.GetRuntime().GetFlowchartManager().GetFlowchartDataItemByName(i[1]),this.Get=this.GetFlowchartName,this._isConstant=!0}GetFlowchartName(){return this._flowchartDataItem.GetName()}}}{let EvalParams2=function(r,i){for(let e=0,t=r.length;e<t;++e)i[e]=r[e].Get(0)},C33=(EvalParams=EvalParams2,self.C3),assert=self.assert,EMPTY_PARAMS_ARRAY=[],noop=function(){};C33.Condition=class Condition extends C33.DefendedBase{constructor(e,t,r){var i;if(super(),this._eventBlock=e,this._runtime=e.GetRuntime(),this._index=r,this._func=this._runtime.GetObjectReference(t[1]),this._isTrigger=0<t[3],this._isFastTrigger=2===t[3],this._isLooping=!!t[4],this._isInverted=!!t[5],this._isStatic=!!t[6],this._sid=t[7],this._isInOrBlock=this._eventBlock.IsOrBlock(),this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this.Run=noop,this.DebugRun=noop,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null,this._debugData=this._runtime.IsDebug()?{isBreakpoint:t[8][0],canDebug:t[8][1]}:null,-1===t[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(t[0]),t[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds()),10===t.length)for(i of t[9])this._parameters.push(C33.Parameter.Create(this,i,this._parameters.length)),this._results.push(0);0===this._parameters.length&&(this._parameters=EMPTY_PARAMS_ARRAY,this._results=EMPTY_PARAMS_ARRAY),this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(e,t,r){return C33.New(C33.Condition,e,t,r)}_PostInit(){for(var e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){var e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){var e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(s,a,e){var n=this._func;let o=this._isInverted;var l=this._parameters;if(0===l.length){let e=s._GetBoundACEMethod(n,a);o?this.Run=function(){return C33.xor(e(),o)}:this.Run=e}else if(1===l.length){let t=l[0];if(!o&&t.IsConstant())this.Run=s._GetBoundACEMethod_1param(n,a,t.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return C33.xor(e(t.Get(0)),o)}}}else if(2===l.length){let t=l[0],r=l[1];if(!o&&t.IsConstant()&&r.IsConstant())this.Run=s._GetBoundACEMethod_2params(n,a,t.Get(0),r.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return C33.xor(e(t.Get(0),r.Get(0)),o)}}}else if(3===l.length){let t=l[0],r=l[1],i=l[2];if(!o&&t.IsConstant()&&r.IsConstant()&&i.IsConstant())this.Run=s._GetBoundACEMethod_3params(n,a,t.Get(0),r.Get(0),i.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return C33.xor(e(t.Get(0),r.Get(0),i.Get(0)),o)}}}else this.Run=e}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){var e=this.GetImplementationAddon();return e?e.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}IsSystemCondition(){return!!this._systemPlugin}IsSystemOrSingleGlobalCondition(){return this.IsSystemCondition()||this._objectClass.GetPlugin().IsSingleGlobal()}GetFirstObjectParameterObjectClass(){for(var e of this._parameters)if(e.IsObjectParameter())return e.GetObjectClass();return null}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){var e=this._results;return EvalParams2(this._parameters,e),C33.xor(this._func.apply(this._systemPlugin,e),this._isInverted)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._systemPlugin,t);return C33.IsIterator(e)&&(e=yield*e),C33.xor(e,this._isInverted)}return this.Run()}_RunSingleGlobal(){var e=this._results,t=(EvalParams2(this._parameters,e),this._objectClass.GetSingleGlobalInstance().GetSdkInstance());return C33.xor(this._func.apply(t,e),this._isInverted)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results,r=(EvalParams2(this._parameters,t),this._objectClass.GetSingleGlobalInstance().GetSdkInstance());let e=this._func.apply(r,t);return C33.IsIterator(e)&&(e=yield*e),C33.xor(e,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),!0}_GetStaticConditionThis(){if(this._behaviorType){if(2<=this._behaviorType.GetBehavior().GetSdkVersion())throw new Error("not yet implemented");return this._behaviorType}return 2<=this._objectClass.GetPlugin().GetSdkVersion()?this._objectClass.GetIObjectClass():this._objectClass}_RunStatic(){var e=this._results,e=(EvalParams2(this._parameters,e),this._func.apply(this._GetStaticConditionThis(),e));return this._objectClass.ApplySolToContainer(),e}*_DebugRunStatic(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._GetStaticConditionThis(),t);return C33.IsIterator(e)&&(e=yield*e),this._objectClass.ApplySolToContainer(),e}return this.Run()}_RunObject(){var r=this._parameters,i=this._results,e=this._objectClass.GetCurrentSol();for(let e=0,t=r.length;e<t;++e){var s=r[e];s.VariesPerInstance()||(i[e]=s.Get(0))}return e.IsSelectAll()?this._RunObject_FirstFilter(e):this._RunObject_NextFilter(e)}*_DebugRunObject(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._RunObject()}_EvaluateVaryingParameters(r){var i=this._parameters,s=this._results;for(let e=0,t=i.length;e<t;++e){var a=i[e];a.VariesPerInstance()&&(s[e]=a.Get(r))}}_RunObject_FirstFilter(r){var e=this._objectClass,i=e.IsFamily(),s=e.GetFamilyIndex(),a=this._behaviorIndex,n=0<=a,o=e.GetInstances(),l=this._anyParamVariesPerInstance,h=this._results,u=this._func,c=this._isInverted,_=this._isInOrBlock&&!this._isTrigger;r.ClearArrays();for(let t=0,e=o.length;t<e;++t){var d,p=o[t];l&&this._EvaluateVaryingParameters(t);let e;e=n?(d=i?p.GetObjectClass().GetFamilyBehaviorOffset(s):0,u.apply(p.GetBehaviorInstances()[a+d].GetSdkInstance(),h)):u.apply(p.GetSdkInstance(),h),C33.xor(e,c)?r._PushInstance(p):_&&r._PushElseInstance(p)}return e.FinishCondition(!0),r._SetSelectAll(!1),e.ApplySolToContainer(),r.HasAnyInstances()}_RunObject_NextFilter(e){var t=this._objectClass,r=t.IsFamily(),i=t.GetFamilyIndex(),s=t.IsInContainer(),a=this._behaviorIndex,n=0<=a,o=this._anyParamVariesPerInstance,l=this._results,h=this._func,u=this._isInverted,c=this._isInOrBlock&&!this._isTrigger,_=e._GetOwnInstances(),d=e._GetOwnElseInstances(),p=c&&!this._eventBlock.IsFirstConditionOfType(this),m=p?d:_;let g=0,f=!1;for(let t=0,e=m.length;t<e;++t){var S,C=m[t];o&&this._EvaluateVaryingParameters(t);let e;e=n?(S=r?C.GetObjectClass().GetFamilyBehaviorOffset(i):0,h.apply(C.GetBehaviorInstances()[a+S].GetSdkInstance(),l)):h.apply(C.GetSdkInstance(),l),C33.xor(e,u)?(f=!0,p?(_.push(C),s&&C._PushSiblingsToSolInstances()):(m[g]=C,s&&C._SetSiblingsToSolInstancesIndex(g),++g)):p?(m[g]=C,s&&C._SetSiblingsToSolElseInstancesIndex(g),++g):c&&(d.push(C),s)&&C._PushSiblingsToSolElseInstances()}C33.truncateArray(m,g),s&&t._TruncateContainerSols(p,g);var y=f;return p&&!f&&(f=this._OrBlockCheckInstances(_)),t.FinishCondition(y||c),c?f:e.HasAnyInstances()}_OrBlockCheckInstances(r){var e=this._objectClass,i=e.IsFamily(),s=e.GetFamilyIndex(),a=this._anyParamVariesPerInstance,n=this._behaviorIndex,o=0<=n,l=this._results,h=this._func,u=this._isInverted;for(let t=0,e=r.length;t<e;++t){var c,_=r[t];a&&this._EvaluateVaryingParameters(t);let e;if(e=o?(c=i?_.GetObjectClass().GetFamilyBehaviorOffset(s):0,h.apply(_.GetBehaviorInstances()[n+c].GetSdkInstance(),l)):h.apply(_.GetSdkInstance(),l),C33.xor(e,u))return!0}return!1}ReevaluateParameter(e,t){return this._parameters[e].Get(t)}GetFastTriggerValue(){var e=this._parameters;if(e.length)return e[0]._GetFastTriggerValue();throw new Error("no parameters")}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;var t,r,i={};for([t,r]of this._savedData.entries()){let e=r;"collmemory"===t&&(e=[...r.entries()].map(e=>[e[0].GetUID(),e[1].GetUID(),e[2]])),i[t]=e}return{ex:i}}_LoadFromJson(e){if(this._savedData&&(this._savedData.clear(),this._savedData=null),e){let t=this._runtime;e=e.ex;if(e){var r,i,s=this.GetSavedDataMap();s.clear();for([r,i]of Object.entries(e)){let e=i;"collmemory"===r&&(e=C33.New(C33.PairMap,i.map(e=>[t.GetInstanceByUID(e[0]),t.GetInstanceByUID(e[1]),e[2]]).filter(e=>e[0]&&e[1]))),s.set(r,e)}}}}}}{let EvalParams2=function(r,i){for(let e=0,t=r.length;e<t;++e)i[e]=r[e].Get(0)},C33=(EvalParams=EvalParams2,self.C3),assert=self.assert,EMPTY_PARAMS_ARRAY=[],noop=function(){},noopGenerator=function*(){},FLAG_CANPICKANYOBJECTCLASS=1,FLAG_COPYPICKED=2,FLAG_CUSTOM_ACE=4,FLAG_IS_ASYNC=8,FLAG_CAN_BAIL_OUT=16;C33.Action=class Action extends C33.DefendedBase{constructor(e,t,r){super();var i,e=(this._eventBlock=e).GetRuntime(),r=(this._runtime=e,this._index=r,this._sid=4<=t.length?t[3]:-1,this._actionType=5<=t.length?255&t[4]:0,this._flags=5<=t.length?t[4]>>8:0,this._func=null,this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this._callFunctionName="",this._callCustomAceObjectClass=null,this._callEventBlock=null,this.Run=noop,this.DebugRun=noop,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null,-3===t[0]),s=r?t[2]:t[5];if(this._debugData=e.IsDebug()||r?{isBreakpoint:s[0],canDebug:s[1],index:s[2]}:null,-1===t[0]?(this._systemPlugin=e.GetSystemPlugin(),this._func=e.GetObjectReference(t[1])):-2===t[0]?this._callFunctionName=t[1]:r?(s=e.GetObjectReference(t[1]),this._func=s,this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._flags|=FLAG_IS_ASYNC):(this._objectClass=e.GetObjectClassByIndex(t[0]),this._flags&FLAG_CUSTOM_ACE?(this._callFunctionName=t[1],this._callCustomAceObjectClass=e.GetObjectClassByIndex(t[2])):(t[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2])),this._func=e.GetObjectReference(t[1]))),7===t.length)for(i of t[6])this._parameters.push(C33.Parameter.Create(this,i,this._parameters.length)),this._results.push(0);0===this._parameters.length&&(this._parameters=EMPTY_PARAMS_ARRAY,this._results=EMPTY_PARAMS_ARRAY),this.CanPickAnyObjectClass()&&(this._eventBlock.SetAllSolModifiers(),this._eventBlock.SetSolWriterAfterCnds()),this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(e,t,r){return C33.New(C33.Action,e,t,r)}_PostInit(){for(var e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);var t,r;this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._callFunctionName?(this._flags&FLAG_CUSTOM_ACE?this._SetCallCustomActionRunMethod():this._SetCallFunctionRunMethod(),this._callFunctionName="",this._callCustomAceObjectClass=null):this.Run===this.RunUserScript?(t=this._func,r=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock),this._func=t.bind(null,this._runtime.GetIRuntime(),r)):this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsStatic()?(this.Run=this._RunObject_Static,this.DebugRun=this._DebugRunObject_Static):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this.CallBeforeAfterHooks()?(this.Run=this._RunObject_BeforeAfterHooks,this.DebugRun=this._DebugRunObject_BeforeAfterHooks):this._parameters.length?this._parameters.every(e=>e.VariesPerInstance())?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every(e=>e.IsConstant())?(EvalParams2(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){var e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){var e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){var e=this._eventBlock.GetEventSheetManager(),s=e.GetFunctionBlockByName(this._callFunctionName);if(s.IsEnabled()){let t=0!=(this._flags&FLAG_COPYPICKED),r=(this._callEventBlock=s.GetEventBlock(),[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()])]),i=(r=e._DeduplicateSolModifierList(r),!s.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:!0}:null);if(this.Run=C33.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,r,this._parameters,t,i),this._runtime.IsDebug()){let e=this;this.DebugRun=function*(){return(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e),yield*e._callEventBlock.DebugRunAsFunctionCall(r,e._parameters,t,i)}}else this.DebugRun=noopGenerator}else this.Run=noop,this.DebugRun=noopGenerator}_SetCallCustomActionRunMethod(){var s=this._eventBlock.GetEventSheetManager();let a=s.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(a.IsEnabled()){let t=0!=(this._flags&FLAG_COPYPICKED),r=(this._callEventBlock=a.GetEventBlock(),[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents(),this._objectClass,a.GetObjectClass()])]);r=s._DeduplicateSolModifierList(r);var s=!this._objectClass.IsFamily()&&!a.GetObjectClass().IsFamily(),n=!this._objectClass.IsFamily()&&a.GetObjectClass().IsFamily(),o=this._objectClass.IsFamily();let i=null;if(!a.IsCopyPicked()&&this._HasCopyPickedParent()&&((i=i||{}).pushCleanSolDynamic=!0),!n&&t||((i=i||{}).copyFromObjectClass=this._objectClass,i.copyToObjectClass=a.GetObjectClass()),s||n||o&&!a.HasCustomACEOverrides()?this.Run=C33.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,r,this._parameters,t,i):o&&(this.Run=C33.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(a,r,this._parameters)),this._runtime.IsDebug()){let e=this;s||n||o&&!a.HasCustomACEOverrides()?this.DebugRun=function*(){return(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e),yield*e._callEventBlock.DebugRunAsFunctionCall(r,e._parameters,t,i)}:o&&(this.DebugRun=function*(){return(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e),yield*a.DebugRunAsFamilyCustomActionWithOverrides(r,e._parameters)})}else this.DebugRun=noopGenerator}else this.Run=noop,this.DebugRun=noopGenerator}_SetRunMethodForBoundFunc(s,a,e){var n=this._func,o=this._parameters;if(0===o.length)this.Run=s._GetBoundACEMethod(n,a);else if(1===o.length){let t=o[0];if(t.IsConstant())this.Run=s._GetBoundACEMethod_1param(n,a,t.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return e(t.Get(0))}}}else if(2===o.length){let t=o[0],r=o[1];if(t.IsConstant()&&r.IsConstant())this.Run=s._GetBoundACEMethod_2params(n,a,t.Get(0),r.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return e(t.Get(0),r.Get(0))}}}else if(3===o.length){let t=o[0],r=o[1],i=o[2];if(t.IsConstant()&&r.IsConstant()&&i.IsConstant())this.Run=s._GetBoundACEMethod_3params(n,a,t.Get(0),r.Get(0),i.Get(0));else{let e=s._GetBoundACEMethod(n,a);this.Run=function(){return e(t.Get(0),r.Get(0),i.Get(0))}}}else this.Run=e}GetSID(){return this._sid}IsAsync(){return 0!=(this._flags&FLAG_IS_ASYNC)}CanBailOut(){return 0!=(this._flags&FLAG_CAN_BAIL_OUT)}CallBeforeAfterHooks(){return 1===this._actionType}IsStatic(){return 2===this._actionType}CanPickAnyObjectClass(){return 0!=(this._flags&FLAG_CANPICKANYOBJECTCLASS)}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){var e=this.GetImplementationAddon();return e?e.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}_HasCopyPickedParent(){let e=this._eventBlock;do{if(e instanceof C33.FunctionBlock&&e.IsCopyPicked())return!0}while(e=e.GetScopeParent());return!1}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){var e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._systemPlugin,e)}*_DebugRunSystem(){var e;return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()?(e=this._results,EvalParams2(this._parameters,e),yield*this._func.apply(this._systemPlugin,e)):this.Run()}_RunSingleGlobal(){var e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}*_DebugRunSingleGlobal(){var e;return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()?(e=this._results,EvalParams2(this._parameters,e),yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)):this.Run()}_RunObject_ParamsConst(){var r=this._results,i=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e)this._func.apply(i[e].GetSdkInstance(),r)}*_DebugRunObject_ParamsConst(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var r=this._results,i=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e)yield*this._func.apply(i[e].GetSdkInstance(),r)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){var r=this._results,i=(EvalParams2(this._parameters,r),this._objectClass.GetCurrentSol().GetInstances());for(let e=0,t=i.length;e<t;++e)this._func.apply(i[e].GetSdkInstance(),r)}*_DebugRunObject_ParamsDontVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var r=this._results,i=(EvalParams2(this._parameters,r),this._objectClass.GetCurrentSol().GetInstances());for(let e=0,t=i.length;e<t;++e)yield*this._func.apply(i[e].GetSdkInstance(),r)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);t.apply(n.GetSdkInstance(),s)}}*_DebugRunObject_AllParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);yield*t.apply(n.GetSdkInstance(),s)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){var r=i[e];r.VariesPerInstance()||(s[e]=r.Get(0))}for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e){var o=i[e];o.VariesPerInstance()&&(s[e]=o.Get(r))}t.apply(n.GetSdkInstance(),s)}}*_DebugRunObject_SomeParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){var r=i[e];r.VariesPerInstance()||(s[e]=r.Get(0))}for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e){var o=i[e];o.VariesPerInstance()&&(s[e]=o.Get(r))}yield*t.apply(n.GetSdkInstance(),s)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){var i=this._parameters,s=this._results,t=this._func,e=this._objectClass,r=e.GetSdkType(),a=e.GetCurrentSol().GetInstances();r.BeforeRunAction(t);for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);t.apply(n.GetSdkInstance(),s)}r.AfterRunAction(t)}*_DebugRunObject_BeforeAfterHooks(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var i=this._parameters,s=this._results,t=this._func,e=this._objectClass,r=e.GetSdkType(),a=e.GetCurrentSol().GetInstances();r.BeforeRunAction(t);for(let r=0,e=a.length;r<e;++r){var n=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);yield*t.apply(n.GetSdkInstance(),s)}r.AfterRunAction(t)}else this._RunObject_BeforeAfterHooks()}_RunObject_Static(){var e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._behaviorType||this._objectClass,e)}*_DebugRunObject_Static(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._behaviorType||this._objectClass,t);return e=C33.IsIterator(e)?yield*e:e}return this._RunObject_Static()}_RunBehavior(){var e=this._objectClass,t=e.IsFamily(),i=e.GetFamilyIndex(),s=this._parameters,a=this._anyParamVariesPerInstance,n=this._results,o=this._func,l=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=s.length;e<t;++e){var r=s[e];r.VariesPerInstance()||(n[e]=r.Get(0))}for(let r=0,e=h.length;r<e;++r){var u=h[r];if(a)for(let e=0,t=s.length;e<t;++e){var c=s[e];c.VariesPerInstance()&&(n[e]=c.Get(r))}var _=t?u.GetObjectClass().GetFamilyBehaviorOffset(i):0;o.apply(u.GetBehaviorInstances()[l+_].GetSdkInstance(),n)}}*_DebugRunBehavior(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass,t=e.IsFamily(),i=e.GetFamilyIndex(),s=this._parameters,a=this._anyParamVariesPerInstance,n=this._results,o=this._func,l=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=s.length;e<t;++e){var r=s[e];r.VariesPerInstance()||(n[e]=r.Get(0))}for(let r=0,e=h.length;r<e;++r){var u=h[r];if(a)for(let e=0,t=s.length;e<t;++e){var c=s[e];c.VariesPerInstance()&&(n[e]=c.Get(r))}var _=t?u.GetObjectClass().GetFamilyBehaviorOffset(i):0;yield*o.apply(u.GetBehaviorInstances()[l+_].GetSdkInstance(),n)}}else this._RunBehavior()}_RunObject_Async(){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances(),n=[];for(let r=0,e=a.length;r<e;++r){var o=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);n.push(t.apply(o.GetSdkInstance(),s))}return Promise.all(n)}*_DebugRunObject_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var i=this._parameters,s=this._results,t=this._func,a=this._objectClass.GetCurrentSol().GetInstances(),n=[];for(let r=0,e=a.length;r<e;++r){var o=a[r];for(let e=0,t=i.length;e<t;++e)s[e]=i[e].Get(r);n.push(yield*t.apply(o.GetSdkInstance(),s))}return Promise.all(n)}return this._RunObject_Async()}_RunBehavior_Async(){var e=this._objectClass,t=e.IsFamily(),i=e.GetFamilyIndex(),s=this._parameters,a=this._results,n=this._func,o=this._behaviorIndex,l=e.GetCurrentSol().GetInstances(),h=[];for(let r=0,e=l.length;r<e;++r){var u=l[r];for(let e=0,t=s.length;e<t;++e)a[e]=s[e].Get(r);var c=t?u.GetObjectClass().GetFamilyBehaviorOffset(i):0;h.push(n.apply(u.GetBehaviorInstances()[o+c].GetSdkInstance(),a))}return Promise.all(h)}*_DebugRunBehavior_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass,t=e.IsFamily(),i=e.GetFamilyIndex(),s=this._parameters,a=this._results,n=this._func,o=this._behaviorIndex,l=e.GetCurrentSol().GetInstances(),h=[];for(let r=0,e=l.length;r<e;++r){var u=l[r];for(let e=0,t=s.length;e<t;++e)a[e]=s[e].Get(r);var c=t?u.GetObjectClass().GetFamilyBehaviorOffset(i):0;h.push(yield*n.apply(u.GetBehaviorInstances()[o+c].GetSdkInstance(),a))}return Promise.all(h)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(e){console.error(`Unhandled exception running script %c${this._eventBlock.GetEventSheet().GetName()}, event ${this._eventBlock.GetDisplayNumber()}, action ${this.GetDebugIndex()+1}:`,"font-size: 1.2em; font-weight: bold;",e),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),C33.EventScript.HadUserScriptException()||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),C33.EventScript.SetHadUserScriptException())}}*DebugRunUserScript(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.RunUserScript()}_SaveToJson(){return this._savedData&&this._savedData.size?{ex:C33.ToSuperJSON(this._savedData)}:null}_LoadFromJson(e){this._savedData&&(this._savedData.clear(),this._savedData=null),e&&(e=e.ex)&&(this._savedData=C33.FromSuperJSON(e))}}}{let GetInst2=function(e){return e instanceof self.IInstance?runtime._UnwrapScriptInterface(e):e.GetInstance()},GetWorldInfo2=function(e){return GetInst2(e).GetWorldInfo()},CompareX2=function(e,t){return C33.compare(GetWorldInfo2(this).GetX(),e,t)},CompareY2=function(e,t){return C33.compare(GetWorldInfo2(this).GetY(),e,t)},IsOnScreen2=function(){return GetWorldInfo2(this).IsInViewport2()},IsOutsideLayout2=function(){var e=GetWorldInfo2(this),t=e.GetLayout(),e=e.GetBoundingBox();return e.getRight()<0||e.getBottom()<0||e.getLeft()>t.GetWidth()||e.getTop()>t.GetHeight()},PickDistance2=function(r,i,s){var e=this.GetCurrentSol(),a=e.GetInstances();if(!a.length)return!1;let n=a[0],o=n.GetWorldInfo(),l=n,h=C33.distanceSquared(o.GetX(),o.GetY(),i,s);for(let e=1,t=a.length;e<t;++e){n=a[e],o=n.GetWorldInfo();var u=C33.distanceSquared(o.GetX(),o.GetY(),i,s);(0===r&&u<h||1===r&&u>h)&&(h=u,l=n)}return e.PickOne(l),!0},SetX2=function(e){var t=GetWorldInfo2(this);t.GetX()!==e&&(t.SetX(e),t.SetBboxChanged())},SetY2=function(e){var t=GetWorldInfo2(this);t.GetY()!==e&&(t.SetY(e),t.SetBboxChanged())},SetPos2=function(e,t){var r=GetWorldInfo2(this);r.EqualsXY(e,t)||(r.SetXY(e,t),r.SetBboxChanged())},SetPosToObject2=function(e,t){var r;e&&(r=GetInst2(this),e=e.GetPairedInstance(r))&&([e,t]=e.GetImagePoint(t),(r=r.GetWorldInfo()).GetX()===e&&r.GetY()===t||(r.SetXY(e,t),r.SetBboxChanged()))},MoveForward2=function(e){var t;0!==e&&((t=GetWorldInfo2(this)).OffsetXY(t.GetCosAngle()*e,t.GetSinAngle()*e),t.SetBboxChanged())},MoveAtAngle2=function(e,t){var r;0!==t&&(r=GetWorldInfo2(this),e=C33.toRadians(e),r.OffsetXY(Math.cos(e)*t,Math.sin(e)*t),r.SetBboxChanged())},GetX2=function(){return GetWorldInfo2(this).GetX()},GetY2=function(){return GetWorldInfo2(this).GetY()},GetDt2=function(){var e=GetInst2(this);return e.GetRuntime().GetDt(e)},CompareWidth2=function(e,t){return C33.compare(GetWorldInfo2(this).GetWidth(),e,t)},CompareHeight2=function(e,t){return C33.compare(GetWorldInfo2(this).GetHeight(),e,t)},SetWidth2=function(e){var t=GetWorldInfo2(this);t.GetWidth()!==e&&(t.SetWidth(e),t.SetBboxChanged())},SetHeight2=function(e){var t=GetWorldInfo2(this);t.GetHeight()!==e&&(t.SetHeight(e),t.SetBboxChanged())},SetSize2=function(e,t){var r=GetWorldInfo2(this);r.GetWidth()===e&&r.GetHeight()===t||(r.SetSize(e,t),r.SetBboxChanged())},GetWidth2=function(){return GetWorldInfo2(this).GetWidth()},GetHeight2=function(){return GetWorldInfo2(this).GetHeight()},GetBboxLeft2=function(){return GetWorldInfo2(this).GetBoundingBox().getLeft()},GetBboxTop2=function(){return GetWorldInfo2(this).GetBoundingBox().getTop()},GetBboxRight2=function(){return GetWorldInfo2(this).GetBoundingBox().getRight()},GetBboxBottom2=function(){return GetWorldInfo2(this).GetBoundingBox().getBottom()},GetBboxMidX2=function(){var e=GetWorldInfo2(this).GetBoundingBox();return(e.getLeft()+e.getRight())/2},GetBboxMidY2=function(){var e=GetWorldInfo2(this).GetBoundingBox();return(e.getTop()+e.getBottom())/2},IsAngleWithin2=function(e,t){return C33.angleDiff(GetWorldInfo2(this).GetAngle(),C33.toRadians(t))<=C33.toRadians(e)},IsAngleClockwiseFrom2=function(e){return C33.angleClockwise(GetWorldInfo2(this).GetAngle(),C33.toRadians(e))},IsBetweenAngles2=function(e,t){var e=C33.toRadians(e),t=C33.toRadians(t),r=GetWorldInfo2(this).GetAngle();return!C33.angleClockwise(t,e)?!(!C33.angleClockwise(r,e)&&C33.angleClockwise(r,t)):C33.angleClockwise(r,e)&&!C33.angleClockwise(r,t)},SetAngle2=function(e){var t=GetWorldInfo2(this),e=C33.clampAngle(C33.toRadians(e));isNaN(e)||t.GetAngle()===e||(t.SetAngle(e),t.SetBboxChanged())},RotateClockwise2=function(e){var t;isNaN(e)||0===e||((t=GetWorldInfo2(this)).SetAngle(t.GetAngle()+C33.toRadians(e)),t.SetBboxChanged())},RotateCounterclockwise2=function(e){var t;isNaN(e)||0===e||((t=GetWorldInfo2(this)).SetAngle(t.GetAngle()-C33.toRadians(e)),t.SetBboxChanged())},RotateTowardAngle2=function(e,t){var r=GetWorldInfo2(this),i=r.GetAngle(),t=C33.angleRotate(i,C33.toRadians(t),C33.toRadians(e));isNaN(t)||i===t||(r.SetAngle(t),r.SetBboxChanged())},RotateTowardPosition2=function(e,t,r){var i=GetWorldInfo2(this),s=i.GetAngle(),t=t-i.GetX(),r=r-i.GetY(),r=Math.atan2(r,t),t=C33.angleRotate(s,r,C33.toRadians(e));isNaN(t)||s===t||(i.SetAngle(t),i.SetBboxChanged())},SetTowardPosition2=function(e,t){var r=GetWorldInfo2(this),i=r.GetAngle(),e=e-r.GetX(),t=t-r.GetY(),t=Math.atan2(t,e);isNaN(t)||i===t||(r.SetAngle(t),r.SetBboxChanged())},GetAngle2=function(){return C33.toDegrees(GetWorldInfo2(this).GetAngle())},CompareOpacity2=function(e,t){return C33.compare(C33.roundToDp(100*GetWorldInfo2(this).GetOpacity(),6),e,t)},IsVisible2=function(){return GetWorldInfo2(this).IsVisible()},SetVisible2=function(e){var t=GetInst2(this),r=t.GetWorldInfo();e=2===e?!r.IsVisible():0!==e,r.IsVisible()!==e&&(r.SetVisible(e),t.GetRuntime().UpdateRender())},SetOpacity2=function(e){var e=C33.clamp(e/100,0,1),t=GetInst2(this),r=t.GetWorldInfo();if(r.GetTransformWithParentOpacity()){if(r._GetSceneGraphInfo().GetOwnOpacity()===e)return}else if(r.GetOpacity()===e)return;r.SetOpacity(e),t.GetRuntime().UpdateRender()},SetDefaultColor2=function(e){tempColor.setFromRgbValue(e);var e=GetInst2(this),t=e.GetWorldInfo();t.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor)||(t.SetUnpremultipliedColor(tempColor),e.GetRuntime().UpdateRender())},GetColor2=function(){var e=GetWorldInfo2(this).GetUnpremultipliedColor();return C33.PackRGBAEx(e.getR(),e.getG(),e.getB(),e.getA())},GetOpacity2=function(){return C33.roundToDp(100*GetWorldInfo2(this).GetOpacity(),6)},IsOnLayer2=function(e){return!!e&&GetWorldInfo2(this).GetLayer()===e},PickTopBottom2=function(r){var e=this.GetCurrentSol(),i=e.GetInstances();if(!i.length)return!1;let s=i[0];for(let e=1,t=i.length;e<t;++e){var a=i[e],n=a.GetWorldInfo(),o=s.GetWorldInfo(),l=n.GetLayer().GetIndex(),h=o.GetLayer().GetIndex();0===r?(h<l||l===h&&n.GetZIndex()>o.GetZIndex())&&(s=a):(l<h||l===h&&n.GetZIndex()<o.GetZIndex())&&(s=a)}return e.PickOne(s),!0},CompareZElevation2=function(e,t,r){var i=GetWorldInfo2(this),e=0===e?i.GetZElevation():i.GetTotalZElevation();return C33.compare(e,t,r)},MoveToTop2=function(){GetWorldInfo2(this).ZOrderMoveToTop()},MoveToBottom2=function(){GetWorldInfo2(this).ZOrderMoveToBottom()},MoveToLayer2=function(e){e&&GetWorldInfo2(this).ZOrderMoveToLayer(e)},ZMoveToObject2=function(e,t){var r,e=0===e;t&&(r=GetInst2(this),t=t.GetFirstPicked(r))&&r.GetWorldInfo().ZOrderMoveAdjacentToInstance(t,e)},SetZElevation2=function(e){var t=GetInst2(this),r=t.GetWorldInfo();r.GetZElevation()!==e&&(r.SetZElevation(e),t.GetRuntime().UpdateRender())},LayerNumber2=function(){return GetWorldInfo2(this).GetLayer().GetIndex()},LayerName2=function(){return GetWorldInfo2(this).GetLayer().GetName()},ZIndex2=function(){return GetWorldInfo2(this).GetZIndex()},ZElevation2=function(){return GetWorldInfo2(this).GetZElevation()},TotalZElevation2=function(){return GetWorldInfo2(this).GetTotalZElevation()},IsEffectEnabled2=function(e){var t=GetInst2(this),e=t.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(e)return e=e.GetIndex(),t.GetWorldInfo().GetInstanceEffectList().IsEffectIndexActive(e)},SetEffectEnabled2=function(e,t){var r,i=GetInst2(this),t=i.GetObjectClass().GetEffectList().GetEffectTypeByName(t);t&&(t=t.GetIndex(),e=1===e,(r=i.GetWorldInfo().GetInstanceEffectList()).IsEffectIndexActive(t)!==e)&&(r.SetEffectIndexActive(t,e),r.UpdateActiveEffects(),i.GetRuntime().UpdateRender())},SetEffectParam2=function(e,t,r){var i,s=GetInst2(this),e=s.GetObjectClass().GetEffectList().GetEffectTypeByName(e);e&&(t=Math.floor(t),i=e.GetShaderProgram().GetParameterType(t))&&("color"===i?(tempColor.setFromRgbValue(r),r=tempColor):"percent"===i&&(r/=100),i=e.GetIndex(),(e=s.GetWorldInfo().GetInstanceEffectList()).SetEffectParameter(i,t,r))&&e.IsEffectIndexActive(i)&&s.GetRuntime().UpdateRender()},CollMemory_Add2=function(e,t,r,i){t.GetUID()<r.GetUID()?e.Set(t,r,i):e.Set(r,t,i)},CollMemory_Remove2=function(e,t,r){t.GetUID()<r.GetUID()?e.Delete(t,r):e.Delete(r,t)},CollMemory_RemoveInstance2=function(e,t){e.DeleteEither(t)},CollMemory_Get2=function(e,t,r){return t.GetUID()<r.GetUID()?e.Get(t,r):e.Get(r,t)},DoOverlapCondition2=function(e,t,r,i){if(!t)return!1;var s,a=0!==r||0!==i,n=e.GetWorldInfo(),o=e.GetRuntime(),l=o.GetCollisionEngine(),h=o.GetCurrentCondition(),u=h.GetEventBlock().IsOrBlock(),c=h.GetObjectClass(),_=h.IsInverted(),h=t.GetCurrentSol(),d=c!==t;rPickType=t,needsCollisionFinish=d&&!_;let p,m=0,g=0,f=rPickFromElseInstances=!1;h.IsSelectAll()?(tempRect.copy(n.GetBoundingBox()),tempRect.offset(r,i),l.GetCollisionCandidates(n.GetLayer(),t,tempRect,tempCandidates2),p=tempCandidates2):!u||o.IsCurrentConditionFirst()&&!h._GetOwnElseInstances().length&&h._GetOwnInstances().length?p=h._GetOwnInstances():(p=h._GetOwnElseInstances(),rPickFromElseInstances=!0),a&&(m=n.GetX(),g=n.GetY(),n.OffsetXY(r,i),n.SetBboxChanged());for(s of p)if(l.TestOverlap(e,s)){if(f=!0,_)break;d&&rToPick.add(s)}return a&&(n.SetXY(m,g),n.SetBboxChanged()),C33.clearArray(tempCandidates2),f},FinishCollisionConditionPicking2=function(e){var e=e.GetRuntime().GetCurrentEvent().IsOrBlock(),t=rPickType.GetCurrentSol(),r=t._GetOwnInstances(),i=t._GetOwnElseInstances();t.IsSelectAll()?(t.SetSetPicked(rToPick),e&&(C33.clearArray(i),t.AddElseInstances(rToPick,rPickType.GetInstances()))):e?rPickFromElseInstances?t.TransferElseInstancesToOwn(rToPick):(t.AddElseInstances(rToPick,r),t.SetSetPicked(rToPick)):t.SetSetPicked(rToPick),rPickType.ApplySolToContainer()},FinishCollisionCondition2=function(e,t){needsCollisionFinish&&(t&&FinishCollisionConditionPicking2(e),rToPick.clear(),rPickType=null,needsCollisionFinish=!1)},OnCollision2=function(i){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,i);if(i){var e=this._runtime,s=e.GetCollisionEngine(),a=e.GetEventSheetManager(),n=a.GetEventStack(),o=a.GetCurrentCondition(),l=o.GetObjectClass(),h=o.GetSavedDataMap(),o=o.GetUnsavedDataMap(),u=n.GetCurrentStackFrame(),c=e.GetTickCount(),_=c-1,d=u.GetCurrentEvent(),p=n.Push(d);let r=h.get("collmemory");r||(r=C33.New(C33.PairMap),h.set("collmemory",r)),o.get("collisionCreatedDestroyCallback")||(o.set("collisionCreatedDestroyCallback",!0),e.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance2(r,e.instance)));var h=l.GetCurrentSol(),m=i.GetCurrentSol(),g=h.GetInstances();let t=null;for(let e=0;e<g.length;++e){var f=g[e];m.IsSelectAll()?(s.GetCollisionCandidates(f.GetWorldInfo().GetLayer(),i,f.GetWorldInfo().GetBoundingBox(),tempCandidates1),t=tempCandidates1,s.AddRegisteredCollisionCandidates(f,i,t)):t=m.GetInstances();for(let e=0;e<t.length;++e){var S=t[e];if(s.TestOverlap(f,S)||s.CheckRegisteredCollision(f,S)){var C=CollMemory_Get2(r,f,S);let e=!1,t=-2;"number"==typeof C&&(e=!0,t=C);var y,G,I,C=!e||t<_;CollMemory_Add2(r,f,S,c),C&&(C=d.GetSolModifiers(),a.PushCopySol(C),I=l.GetCurrentSol(),y=i.GetCurrentSol(),I._SetSelectAll(!1),y._SetSelectAll(!1),(l===i?(G=I._GetOwnInstances(),C33.clearArray(G),G.push(f),G.push(S),l):(G=I._GetOwnInstances(),I=y._GetOwnInstances(),C33.clearArray(G),C33.clearArray(I),G.push(f),I.push(S),l.ApplySolToContainer(),i)).ApplySolToContainer(),d.Retrigger(u,p),a.PopSol(C))}else CollMemory_Remove2(r,f,S)}C33.clearArray(tempCandidates1)}n.Pop()}return!1},IsOverlapping2=function(e){return DoOverlapCondition2(GetInst2(this),e,0,0)},IsOverlappingOffset2=function(e,t,r){return DoOverlapCondition2(GetInst2(this),e,t,r)},HasParent2=function(){return GetWorldInfo2(this).HasParent()},HasChildren2=function(){return GetWorldInfo2(this).HasChildren()},PickParent2=function(r,i){var s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;var e,t=r.GetCurrentSol();let a=t.GetInstances();if(0===(a=t.IsSelectAll()&&0<(e=[...this._runtime.instancesPendingCreateForObjectClass(r)]).length?a.concat(e):a).length)return!1;var n=new Set(a),o=new Set;for(let e=0,t=s.length;e<t;++e){var l=s[e];if(1===i)for(var h of l.parents())h.BelongsToObjectClass(r)&&n.has(h)&&o.add(h);else{let e;if(0===i){if(null===(e=l.GetParent()))continue}else e=l.GetTopParent();e.BelongsToObjectClass(r)&&n.has(e)&&o.add(e)}}return 0!==o.size&&(t.SetSetPicked(o),r.ApplySolToContainer(),!0)},PickChildren2=function(r,i){var s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;var e,t=r.GetCurrentSol();let a=t.GetInstances();if(0===(a=t.IsSelectAll()&&0<(e=[...this._runtime.instancesPendingCreateForObjectClass(r)]).length?a.concat(e):a).length)return!1;var n=new Set(a),o=new Set;for(let e=0,t=s.length;e<t;++e){var l,h=s[e];2===i&&!h.HasChildren()&&h.BelongsToObjectClass(r)&&n.has(h)&&o.add(h);for(l of 0===i?h.children():h.allChildren())2===i&&l.HasChildren()||l.BelongsToObjectClass(r)&&n.has(l)&&o.add(l)}return 0!==o.size&&(t.SetSetPicked(o),r.ApplySolToContainer(),!0)},PickNthChild2=function(r,i,s){var a=this.GetCurrentSol().GetInstances();if(0===a.length)return!1;var e,t=r.GetCurrentSol();let n=t.GetInstances();if(0===(n=t.IsSelectAll()&&0<(e=[...this._runtime.instancesPendingCreateForObjectClass(r)]).length?n.concat(e):n).length)return!1;var o=new Set(n),l=[];for(let e=0,t=a.length;e<t;++e){var h=a[e];if(0===i){var u=h.GetChildAt(s);null!==u&&u.BelongsToObjectClass(r)&&o.has(u)&&l.push(u)}else if(1===i)for(var c of h.children())if(c.BelongsToObjectClass(r)){if(0===s){o.has(c)&&l.push(c);break}--s}}return 0!==l.length&&(t.SetArrayPicked(l),r.ApplySolToContainer(),!0)},CompareChildCount2=function(e,t,r){var i=GetInst2(this);switch(e){case 0:default:return C33.compare(i.GetChildCount(),t,r);case 1:return C33.compare(i.GetAllChildCount(),t,r)}},AddChild2=function(e,t,r,i,s,a,n,o,l,h){var u,c=GetInst2(this),_=c.GetRuntime().GetCurrentAction().GetObjectClass();for(u of e.allCorrespondingInstances(c,_)){if(!u.GetPlugin().SupportsSceneGraph())return;c.AddChild(u,{transformX:t,transformY:r,transformWidth:i,transformHeight:s,transformAngle:a,transformOpacity:n,transformZElevation:o,transformVisibility:l,destroyWithParent:h})}},RemoveChild2=function(e){var t,r=GetInst2(this),i=r.GetRuntime().GetCurrentAction().GetObjectClass();for(t of e.allCorrespondingInstances(r,i))r.RemoveChild(t)},RemoveFromParent2=function(){var e=GetInst2(this);e.HasParent()&&e.GetParent().RemoveChild(e)},ChildCount2=function(){return GetInst2(this).GetChildCount()},AllChildCount2=function(){return GetInst2(this).GetAllChildCount()},SetMeshSize2=function(e,t){e=Math.floor(e),t=Math.floor(t);var r=GetWorldInfo2(this);e<2||t<2||!isFinite(e)||!isFinite(t)?(r.ReleaseMesh(),r.SetBboxChanged()):r.CreateMesh(e,t)},SetMeshPoint2=function(e,t,r,i,s,a,n,o){var l=GetWorldInfo2(this);l.SetMeshPoint(e,t,{mode:0===r?"absolute":"relative",x:i,y:s,zElevation:a,u:n,v:o})&&l.SetBboxChanged()},MeshColumns2=function(){var e=GetWorldInfo2(this);return e.HasMesh()?e.GetSourceMesh().GetHSize():0},MeshRows2=function(){var e=GetWorldInfo2(this);return e.HasMesh()?e.GetSourceMesh().GetVSize():0},SetElementVisible2=function(e){var t=GetWorldInfo2(this);e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&t.SetVisible(e)},SetElementCSSStyle2=function(e,t){this instanceof self.IInstance?this.setElementCSSStyle(e,t):this.SetElementCSSStyle(e,t)},SetElementAttribute2=function(e,t){this instanceof self.IInstance?this.setElementAttribute(e,""+t):this.SetElementAttribute(e,""+t)},RemoveElementAttribute2=function(e){this instanceof self.IInstance?this.removeElementAttribute(e):this.RemoveElementAttribute(e)},SetElementFocus2=function(){this instanceof self.IInstance?this.focusElement():this.FocusElement()},SetElementBlur2=function(){this instanceof self.IInstance?this.blurElement():this.BlurElement()},IsElementFocused2=function(){return this instanceof self.IInstance?this.isElementFocused():this.IsElementFocused()},SetElementEnabled2=function(e){this instanceof self.IInstance?this._setEnabled(0!==e):this._SetEnabled(0!==e)},IsElementEnabled2=function(){return this instanceof self.IInstance?this._isEnabled():this._IsEnabled()},CompareInstanceVar2=function(e,t,r){return C33.compare(GetInst2(this).GetInstanceVariableValue(e),t,r)},IsBoolInstanceVarSet2=function(e){return!!GetInst2(this).GetInstanceVariableValue(e)},PickInstVarHiLow2=function(r,i){var e=this.GetCurrentSol(),s=e.GetInstances();if(!s.length)return!1;var a=this.IsFamily();let n=null,o=0;for(let e=0,t=s.length;e<t;++e){var l=s[e],h=a?l.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0,h=l.GetInstanceVariableValue(h+i);(null===n||0===r&&h<o||1===r&&h>o)&&(o=h,n=l)}return e.PickOne(n),!0},PickByUID2=function(e){return(this._runtime.GetCurrentCondition().IsInverted()?PickByUID_Inverted2:PickByUID_Normal2)(this,e)},PickByUID_Normal2=function(e,t){t=e.GetRuntime().GetInstanceByUID(t);if(t){var r=e.GetCurrentSol();if(r.IsSelectAll()||r._GetOwnInstances().includes(t))if(e.IsFamily()){if(t.GetObjectClass().BelongsToFamily(e))return r.PickOne(t),e.ApplySolToContainer(),!0}else if(t.GetObjectClass()===e)return r.PickOne(t),e.ApplySolToContainer(),!0}return!1},PickByUID_Inverted2=function(e,i){var s=e.GetCurrentSol();if(s.IsSelectAll()){s._SetSelectAll(!1),s.ClearArrays();var r=e.GetInstances();for(let e=0,t=r.length;e<t;++e){var a=r[e];a.GetUID()===i?s._PushElseInstance(a):s._PushInstance(a)}return e.ApplySolToContainer(),!!s._GetOwnInstances().length}{var n=s._GetOwnInstances();let r=0;for(let e=0,t=n.length;e<t;++e){var o=n[e];(n[r]=o).GetUID()===i?s._PushElseInstance(o):++r}return C33.truncateArray(n,r),e.ApplySolToContainer(),!!n.length}},HasTags2=function(e){var e=new Set(C33.splitStringAndNormalize(e)),t=GetInst2(this).GetTagsSet();return e.isSubsetOf(t)},Tags2=function(){return GetInst2(this).GetTagsString()},TagsCount2=function(){return GetInst2(this).GetTagsSet().size},TagAt2=function(e){return GetInst2(this).GetTagAt(e)},ChangeTags2=function(e,t){t=C33.splitStringAndNormalize(t);if(0!==t.length){var r=GetInst2(this),i=new Set(r.GetTagsSet());if(0===e)for(var s of t)i.add(s);else if(1===e)for(var a of t)i.delete(a);r.SetTagsSet(i)}},Destroy2=function(){var e=GetInst2(this);e.GetRuntime().DestroyInstance(e)},OnCreated2=function(){return!0},OnDestroyed2=function(){return!0},SetInstanceVar2=function(e,t){GetInst2(this).SetInstanceVariableValue(e,t)},AddInstanceVar2=function(e,t){var r=GetInst2(this),i=r.GetInstanceVariableValue(e);"number"==typeof i&&"number"!=typeof t?t=parseFloat(t):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),r.SetInstanceVariableValue(e,i+t)},SubInstanceVar2=function(e,t){var r=GetInst2(this),i=r.GetInstanceVariableValue(e);"number"==typeof i&&("number"!=typeof t&&(t=parseFloat(t)),r.SetInstanceVariableValue(e,i-t))},SetBoolInstanceVar2=function(e,t){GetInst2(this).SetInstanceVariableValue(e,t?1:0)},ToggleBoolInstanceVar2=function(e){var t=GetInst2(this);t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)},LoadFromJsonString2=function(e){let t;try{t=JSON.parse(e)}catch(e){return void console.error("Failed to load from JSON string: ",e)}e=GetInst2(this);e.GetRuntime().ClearIntancesNeedingAfterLoad(),e._OnBeforeLoad("state"),e.LoadFromJson(t,"state"),e.GetRuntime().DoAfterLoad("state",{setFromJson:!0})},AsJSON2=function(){return JSON.stringify(GetInst2(this).SaveToJson("state"))},ObjectTypeName2=function(){return GetInst2(this).GetObjectClass().GetName()},Count2=function(){var e,t=GetInst2(this).GetRuntime(),r=t.GetCurrentEventStackFrame().GetExpressionObjectClass();let i=r.GetInstanceCount();for(e of t.instancesPendingCreateForObjectClass(r))++i;return i},PickedCount2=function(){return GetInst2(this).GetRuntime().GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length},GetIID2=function(){return GetInst2(this).GetIID()},GetUID2=function(){return GetInst2(this).GetUID()},OnInstanceSignal2=function(e){var t=GetInst2(this);return e.toLowerCase()===t.GetRuntime().GetEventSheetManager().GetCurrentInstanceSignalTag(t)},InstanceSignal2=function(e){var t=GetInst2(this);t.GetRuntime().GetEventSheetManager().InstanceSignal(t,e)},InstanceWaitForSignal2=function(e){return this.GetRuntime().GetEventSheetManager().AddScheduledWait().InitInstanceSignals(this.GetCurrentSol().GetInstances(),e),!0},TemplateName2=function(){return GetInst2(this).GetTemplateName()},C33=(GetInst=GetInst2,GetWorldInfo=GetWorldInfo2,CompareX=CompareX2,CompareY=CompareY2,IsOnScreen=IsOnScreen2,IsOutsideLayout=IsOutsideLayout2,PickDistance=PickDistance2,SetX=SetX2,SetY=SetY2,SetPos=SetPos2,SetPosToObject=SetPosToObject2,MoveForward=MoveForward2,MoveAtAngle=MoveAtAngle2,GetX=GetX2,GetY=GetY2,GetDt=GetDt2,CompareWidth=CompareWidth2,CompareHeight=CompareHeight2,SetWidth=SetWidth2,SetHeight=SetHeight2,SetSize=SetSize2,GetWidth=GetWidth2,GetHeight=GetHeight2,GetBboxLeft=GetBboxLeft2,GetBboxTop=GetBboxTop2,GetBboxRight=GetBboxRight2,GetBboxBottom=GetBboxBottom2,GetBboxMidX=GetBboxMidX2,GetBboxMidY=GetBboxMidY2,IsAngleWithin=IsAngleWithin2,IsAngleClockwiseFrom=IsAngleClockwiseFrom2,IsBetweenAngles=IsBetweenAngles2,SetAngle=SetAngle2,RotateClockwise=RotateClockwise2,RotateCounterclockwise=RotateCounterclockwise2,RotateTowardAngle=RotateTowardAngle2,RotateTowardPosition=RotateTowardPosition2,SetTowardPosition=SetTowardPosition2,GetAngle=GetAngle2,CompareOpacity=CompareOpacity2,IsVisible=IsVisible2,SetVisible=SetVisible2,SetOpacity=SetOpacity2,SetDefaultColor=SetDefaultColor2,GetColor=GetColor2,GetOpacity=GetOpacity2,IsOnLayer=IsOnLayer2,PickTopBottom=PickTopBottom2,CompareZElevation=CompareZElevation2,MoveToTop=MoveToTop2,MoveToBottom=MoveToBottom2,MoveToLayer=MoveToLayer2,ZMoveToObject=ZMoveToObject2,SetZElevation=SetZElevation2,LayerNumber=LayerNumber2,LayerName=LayerName2,ZIndex=ZIndex2,ZElevation=ZElevation2,TotalZElevation=TotalZElevation2,IsEffectEnabled=IsEffectEnabled2,SetEffectEnabled=SetEffectEnabled2,SetEffectParam=SetEffectParam2,CollMemory_Add=CollMemory_Add2,CollMemory_Remove=CollMemory_Remove2,CollMemory_RemoveInstance=CollMemory_RemoveInstance2,CollMemory_Get=CollMemory_Get2,DoOverlapCondition=DoOverlapCondition2,FinishCollisionConditionPicking=FinishCollisionConditionPicking2,FinishCollisionCondition=FinishCollisionCondition2,OnCollision=OnCollision2,IsOverlapping=IsOverlapping2,IsOverlappingOffset=IsOverlappingOffset2,HasParent=HasParent2,HasChildren=HasChildren2,PickParent=PickParent2,PickChildren=PickChildren2,PickNthChild=PickNthChild2,CompareChildCount=CompareChildCount2,AddChild=AddChild2,RemoveChild=RemoveChild2,RemoveFromParent=RemoveFromParent2,ChildCount=ChildCount2,AllChildCount=AllChildCount2,SetMeshSize=SetMeshSize2,SetMeshPoint=SetMeshPoint2,MeshColumns=MeshColumns2,MeshRows=MeshRows2,SetElementVisible=SetElementVisible2,SetElementCSSStyle=SetElementCSSStyle2,SetElementAttribute=SetElementAttribute2,RemoveElementAttribute=RemoveElementAttribute2,SetElementFocus=SetElementFocus2,SetElementBlur=SetElementBlur2,IsElementFocused=IsElementFocused2,SetElementEnabled=SetElementEnabled2,IsElementEnabled=IsElementEnabled2,CompareInstanceVar=CompareInstanceVar2,IsBoolInstanceVarSet=IsBoolInstanceVarSet2,PickInstVarHiLow=PickInstVarHiLow2,PickByUID=PickByUID2,PickByUID_Normal=PickByUID_Normal2,PickByUID_Inverted=PickByUID_Inverted2,HasTags=HasTags2,Tags=Tags2,TagsCount=TagsCount2,TagAt=TagAt2,ChangeTags=ChangeTags2,Destroy=Destroy2,OnCreated=OnCreated2,OnDestroyed=OnDestroyed2,SetInstanceVar=SetInstanceVar2,AddInstanceVar=AddInstanceVar2,SubInstanceVar=SubInstanceVar2,SetBoolInstanceVar=SetBoolInstanceVar2,ToggleBoolInstanceVar=ToggleBoolInstanceVar2,LoadFromJsonString=LoadFromJsonString2,AsJSON=AsJSON2,ObjectTypeName=ObjectTypeName2,Count=Count2,PickedCount=PickedCount2,GetIID=GetIID2,GetUID=GetUID2,OnInstanceSignal=OnInstanceSignal2,InstanceSignal=InstanceSignal2,InstanceWaitForSignal=InstanceWaitForSignal2,TemplateName=TemplateName2,self.C3),tempColor=new C33.Color,runtime=null,tempRect=(C33.CommonACES_SetRuntime=function(e){runtime=e},C33.New(C33.Rect)),tempCandidates1=[],tempCandidates2=[],needsCollisionFinish=!1,rPickType=null,rPickFromElseInstances=!1,rToPick=new Set;function*DebugOnCollision(i){if(i){var e=this._runtime,s=e.GetCollisionEngine(),a=e.GetEventSheetManager(),n=a.GetEventStack(),o=a.GetCurrentCondition(),l=o.GetObjectClass(),h=o.GetSavedDataMap(),o=o.GetUnsavedDataMap(),u=n.GetCurrentStackFrame(),c=e.GetTickCount(),_=c-1,d=u.GetCurrentEvent(),p=n.Push(d);let r=h.get("collmemory");r||(r=C33.New(C33.PairMap),h.set("collmemory",r)),o.get("collisionCreatedDestroyCallback")||(o.set("collisionCreatedDestroyCallback",!0),e.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance2(r,e.instance)));var h=l.GetCurrentSol(),m=i.GetCurrentSol(),g=h.GetInstances();let t=null;for(let e=0;e<g.length;++e){var f=g[e];m.IsSelectAll()?(s.GetCollisionCandidates(f.GetWorldInfo().GetLayer(),i,f.GetWorldInfo().GetBoundingBox(),tempCandidates1),t=tempCandidates1,s.AddRegisteredCollisionCandidates(f,i,t)):t=m.GetInstances();for(let e=0;e<t.length;++e){var S=t[e];if(s.TestOverlap(f,S)||s.CheckRegisteredCollision(f,S)){var C=CollMemory_Get2(r,f,S);let e=!1,t=-2;"number"==typeof C&&(e=!0,t=C);var y,G,I,C=!e||t<_;CollMemory_Add2(r,f,S,c),C&&(C=d.GetSolModifiers(),a.PushCopySol(C),I=l.GetCurrentSol(),y=i.GetCurrentSol(),I._SetSelectAll(!1),y._SetSelectAll(!1),(l===i?(G=I._GetOwnInstances(),C33.clearArray(G),G.push(f),G.push(S),l):(G=I._GetOwnInstances(),I=y._GetOwnInstances(),C33.clearArray(G),C33.clearArray(I),G.push(f),I.push(S),l.ApplySolToContainer(),i)).ApplySolToContainer(),yield*d.DebugRetrigger(u,p),a.PopSol(C))}else CollMemory_Remove2(r,f,S)}C33.clearArray(tempCandidates1)}n.Pop()}return!1}C33.AddCommonACEs=function(e,t){var r=e[1],i=e[4],s=e[5],a=e[6],n=e[7],o=e[8],l=e[10],h=e[11],u=e[12],c=e[13],_=e[14],d=e[15],p=e[16],m=t.Cnds,g=t.Acts,f=t.Exps;e[3]&&(m.CompareX=CompareX2,m.CompareY=CompareY2,m.IsOnScreen=IsOnScreen2,m.IsOutsideLayout=IsOutsideLayout2,m.PickDistance=PickDistance2,g.SetX=SetX2,g.SetY=SetY2,g.SetPos=SetPos2,g.SetPosToObject=SetPosToObject2,g.MoveForward=MoveForward2,g.MoveAtAngle=MoveAtAngle2,f.X=GetX2,f.Y=GetY2,f.dt=GetDt2),i&&(m.CompareWidth=CompareWidth2,m.CompareHeight=CompareHeight2,g.SetWidth=SetWidth2,g.SetHeight=SetHeight2,g.SetSize=SetSize2,f.Width=GetWidth2,f.Height=GetHeight2,f.BBoxLeft=GetBboxLeft2,f.BBoxTop=GetBboxTop2,f.BBoxRight=GetBboxRight2,f.BBoxBottom=GetBboxBottom2,f.BBoxMidX=GetBboxMidX2,f.BBoxMidY=GetBboxMidY2),s&&(m.AngleWithin=IsAngleWithin2,m.IsClockwiseFrom=IsAngleClockwiseFrom2,m.IsBetweenAngles=IsBetweenAngles2,g.SetAngle=SetAngle2,g.RotateClockwise=RotateClockwise2,g.RotateCounterclockwise=RotateCounterclockwise2,g.RotateTowardAngle=RotateTowardAngle2,g.RotateTowardPosition=RotateTowardPosition2,g.SetTowardPosition=SetTowardPosition2,f.Angle=GetAngle2),a&&(m.IsVisible=IsVisible2,m.CompareOpacity=CompareOpacity2,g.SetVisible=SetVisible2,g.SetOpacity=SetOpacity2,g.SetDefaultColor=SetDefaultColor2,f.Opacity=GetOpacity2,f.ColorValue=GetColor2),n&&(m.IsOnLayer=IsOnLayer2,m.PickTopBottom=PickTopBottom2,m.CompareZElevation=CompareZElevation2,g.MoveToTop=MoveToTop2,g.MoveToBottom=MoveToBottom2,g.MoveToLayer=MoveToLayer2,g.ZMoveToObject=ZMoveToObject2,g.SetZElevation=SetZElevation2,f.LayerNumber=LayerNumber2,f.LayerName=LayerName2,f.ZIndex=ZIndex2,f.ZElevation=ZElevation2,f.TotalZElevation=TotalZElevation2),o&&(m.IsEffectEnabled=IsEffectEnabled2,g.SetEffectEnabled=SetEffectEnabled2,g.SetEffectParam=SetEffectParam2),c&&(m.HasParent=HasParent2,m.HasChildren=HasChildren2,m.PickParent=PickParent2,m.PickChildren=PickChildren2,m.PickNthChild=PickNthChild2,m.CompareChildCount=CompareChildCount2,g.AddChild=AddChild2,g.RemoveChild=RemoveChild2,g.RemoveFromParent=RemoveFromParent2,f.ChildCount=ChildCount2,f.AllChildCount=AllChildCount2),_&&(g.SetMeshSize=SetMeshSize2,g.SetMeshPoint=SetMeshPoint2,f.MeshColumns=MeshColumns2,f.MeshRows=MeshRows2),l&&(m.IsVisible=IsVisible2,g.SetVisible=SetElementVisible2,g.SetCSSStyle=SetElementCSSStyle2,g.SetElemAttribute=SetElementAttribute2,g.RemoveElemAttribute=RemoveElementAttribute2),h&&(m.IsFocused=IsElementFocused2,g.SetFocus=SetElementFocus2,g.SetBlur=SetElementBlur2),u&&(m.IsEnabled=IsElementEnabled2,g.SetEnabled=SetElementEnabled2),d&&(m.OnCollision=OnCollision2,m.IsOverlapping=IsOverlapping2,m.IsOverlappingOffset=IsOverlappingOffset2,t.FinishCollisionCondition=FinishCollisionCondition2),r||(m.CompareInstanceVar=CompareInstanceVar2,m.IsBoolInstanceVarSet=IsBoolInstanceVarSet2,m.PickInstVarHiLow=PickInstVarHiLow2,m.PickByUID=PickByUID2,m.HasTags=HasTags2,g.SetInstanceVar=SetInstanceVar2,g.AddInstanceVar=AddInstanceVar2,g.SubInstanceVar=SubInstanceVar2,g.SetBoolInstanceVar=SetBoolInstanceVar2,g.ToggleBoolInstanceVar=ToggleBoolInstanceVar2,g.ChangeTags=ChangeTags2,m.OnCreated=OnCreated2,m.OnDestroyed=OnDestroyed2,g.Destroy=Destroy2,g.LoadFromJsonString||(g.LoadFromJsonString=LoadFromJsonString2),f.AsJSON||(f.AsJSON=AsJSON2),f.Count=Count2,f.PickedCount=PickedCount2,f.IID=GetIID2,f.UID=GetUID2,f.ObjectTypeName=ObjectTypeName2,f.Tags=Tags2,f.TagsCount=TagsCount2,f.TagAt=TagAt2,m.OnInstanceSignal=OnInstanceSignal2,g.InstanceSignal=InstanceSignal2,g.InstanceWaitForSignal=InstanceWaitForSignal2),p&&(f.TemplateName=TemplateName2)}}{let C33=self.C3;C33.ScheduledWait=class ScheduledWait extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._type="",this._time=-1,this._signalTag="",this._isSignalled=!1,this._event=null,this._actIndex=0,this._solModifiers=[],this._dynamicSolModifiers=null,this._sols=new Map,this._pendingInstances=null,this._callingFunctionBlock=null,this._asyncId=-1,this._functionParameters=null,this._functionInnerLocalVars=null,this._shouldRelease=!1}Release(){this._type="",this._time=-1,this._signalTag="",this._event=null,this._callingFunctionBlock=null,this._functionParameters=null,this._functionInnerLocalVars=null,this._asyncId=-1,C33.clearArray(this._solModifiers),this._dynamicSolModifiers&&(this._dynamicSolModifiers.clear(),this._dynamicSolModifiers=null);for(var e of this._sols.values())e.Release();this._sols.clear(),this._pendingInstances=null}_Init(){var e,t=this._eventSheetManager,r=t.GetRuntime().GetAllObjectClasses(),i=t.GetCurrentEventStackFrame(),i=(this._event=i.GetCurrentEvent(),this._actIndex=i.GetActionIndex()+1,t.FindFirstFunctionBlockParent(this._event));i&&(this._callingFunctionBlock=i,this._functionParameters=i.CaptureFunctionParameters(),this._functionInnerLocalVars=i._GetAllInnerLocalVariables().map(e=>e.GetValue()),i.IsAsync())&&(this._asyncId=i.PauseCurrentAsyncFunction());for(e of r){var s=e.GetCurrentSol();s.IsSelectAll()&&!this._event.HasSolModifier(e)||(this._solModifiers.push(e),this._sols.set(e,C33.New(C33.SolState,s)))}i=t.GetDynamicSolModifiersSet();this._dynamicSolModifiers=0<i.size?i:null}InitTimer(e){this._type="timer",this._Init(),this._time=this._eventSheetManager.GetRuntime().GetGameTime()+e}InitSignal(e){this._type="signal",this._Init(),this._signalTag=e.toLowerCase()}InitInstanceSignals(e,t){this._type="instance-signals",this._Init(),this._signalTag=t.toLowerCase(),this._pendingInstances=new Set(e)}InitPromise(e){this._type="promise",this._Init(),e.then(()=>this.SetSignalled()).catch(e=>{console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",e),this.SetSignalled()})}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsInstanceSignals(){return"instance-signals"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=!0}SetInstanceSignalled(e){this._pendingInstances.delete(e),0===this._pendingInstances.size&&this.SetSignalled()}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(e){e._Restore(this._event,this._actIndex);for(var[t,r]of this._sols.entries()){t=t.GetCurrentSol();r._Restore(t)}this._dynamicSolModifiers&&e.SetDynamicSolModifiers([...this._dynamicSolModifiers]);e=this._callingFunctionBlock;e&&(e.SetFunctionParameters(this._functionParameters),e._GetAllInnerLocalVariables().map((e,t)=>e.SetValue(this._functionInnerLocalVars[t])),e.IsAsync())&&e.ResumeAsyncFunction(this._asyncId)}_Run(e){this._RestoreState(e),this._event._ResumeActionsAndSubEvents(e),this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}async _DebugRun(e){this._RestoreState(e);for(var t of this._event._DebugResumeActionsAndSubEvents(e))await this._eventSheetManager.GetRuntime().DebugBreak(t);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(e){for(var t of this._sols.values())t.RemoveInstances(e);if("instance-signals"===this._type){for(var r of e)this._pendingInstances.delete(r);0===this._pendingInstances.size&&this.SetSignalled()}}_SaveToJson(){var e,t,r={},i={wt:this._type,t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map(e=>e.GetSID()),dsm:this._dynamicSolModifiers?[...this._dynamicSolModifiers].map(e=>e.GetSID()):null,sols:r};this._event._HasActionIndex(this._actIndex)&&(i.act=this._event.GetActionAt(this._actIndex).GetSID());for([e,t]of this._sols)r[e.GetSID().toString()]=t._SaveToJson();return"instance-signals"===this._type&&(i.pi=[...this._pendingInstances].map(e=>e.GetUID())),i}static _CreateFromJson(e,t){var r=e.GetRuntime(),i=e.GetEventBlockBySID(t.ev);if(!i)return null;let s=0;if(t.hasOwnProperty("act")){var a=e.GetActionBySID(t.act);if(!a)return null;s=a.GetIndex()}var n,o,l,h=C33.New(C33.ScheduledWait,e);h._time=t.t,t.hasOwnProperty("wt")?h._type=t.wt:h._type=-1===h._time?"signal":"timer",h._signalTag=t.st,h._isSignalled=t.s,h._event=i,h._actIndex=s;for(n of t.sm){var u=r.GetObjectClassBySID(n);u&&h._solModifiers.push(u)}if(Array.isArray(t.dsm))for(var c of t.dsm){c=r.GetObjectClassBySID(c);c&&(h._dynamicSolModifiers||(h._dynamicSolModifiers=new Set),h._dynamicSolModifiers.add(c))}for([o,l]of Object.entries(t.sols)){var _,d=parseInt(o,10),d=r.GetObjectClassBySID(d);d&&((_=C33.New(C33.SolState,null))._LoadFromJson(e,l),h._sols.set(d,_))}if("instance-signals"===h._type){h._pendingInstances=new Set;for(var p of t.pi){p=r.GetInstanceByUID(p);p&&h._pendingInstances.add(p)}}return h}}}{let C33=self.C3;C33.SolState=class SolState extends C33.DefendedBase{constructor(e){super(),this._objectClass=null,this._isSelectAll=!0,this._instances=[],e&&(this._objectClass=e.GetObjectClass(),this._isSelectAll=e.IsSelectAll(),C33.shallowAssignArray(this._instances,e._GetOwnInstances()))}Release(){this._objectClass=null,C33.clearArray(this._instances)}_Restore(e){e._SetSelectAll(this._isSelectAll),C33.shallowAssignArray(e._GetOwnInstances(),this._instances)}RemoveInstances(e){C33.arrayRemoveAllInSet(this._instances,e)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map(e=>e.GetUID())}}_LoadFromJson(e,t){var r,i=e.GetRuntime();this._isSelectAll=!!t.sa,C33.clearArray(this._instances);for(r of t.insts){var s=i.GetInstanceByUID(r);s&&this._instances.push(s)}}}}{let GetNextParamMap2=function(e,t){let r=e.get(t);return r||(r=new Map,e.set(t,r)),r},C33=(GetNextParamMap=GetNextParamMap2,self.C3);C33.SDKPluginBase=class SDKPluginBase extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._isSingleGlobal=!!e.isSingleGlobal,this._isWorldType=!!e.isWorld,this._isRotatable=!!e.isRotatable,this._mustPredraw=!!e.mustPredraw,this._hasEffects=!!e.hasEffects,this._supportsSceneGraph=!!e.supportsSceneGraph,this._supportsMesh=!!e.supportsMesh,this._isHTMLElementType=!!e.isHTMLElementType,this._is3d=!!e.is3d,this._sdkVersion=e.sdkVersion,this._singleGlobalObjectClass=null,this._boundACEMethodCache=new Map,this._boundACEMethodCache_1param=new Map,this._boundACEMethodCache_2params=new Map,this._boundACEMethodCache_3params=new Map,this._scriptInterfaceClass=e.scriptInterfaceClass,this._iPlugin=null}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetConstructor(){return(2<=this.GetSdkVersion()?this._iPlugin:this).constructor}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(e=!1){let t=this._scriptInterfaceClass;return t=e&&"function"!=typeof t&&2<=this.GetSdkVersion()?globalThis.ISDKPluginBase:t}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsHTMLElementType(){return this._isHTMLElementType}Is3D(){return this._is3d}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(e,t){var r;if(t)return(r=this._boundACEMethodCache.get(e))||(r=e.bind(t),this._boundACEMethodCache.set(e,r)),r;throw new Error("missing 'this' binding")}_GetBoundACEMethod_1param(e,t,r){var i,s;if(t)return(s=(i=GetNextParamMap2(this._boundACEMethodCache_1param,e)).get(r))||(s=e.bind(t,r),i.set(r,s)),s;throw new Error("missing 'this' binding")}_GetBoundACEMethod_2params(e,t,r,i){var s,a;if(t)return s=GetNextParamMap2(this._boundACEMethodCache_2params,e),(a=(s=GetNextParamMap2(s,r)).get(i))||(a=e.bind(t,r,i),s.set(i,a)),a;throw new Error("missing 'this' binding")}_GetBoundACEMethod_3params(e,t,r,i,s){var a,n;if(t)return a=GetNextParamMap2(this._boundACEMethodCache_3params,e),a=GetNextParamMap2(a,r),(n=(a=GetNextParamMap2(a,i)).get(s))||(n=e.bind(t,r,i,s),a.set(s,n)),n;throw new Error("missing 'this' binding")}_SetSingleGlobalObjectClass(e){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");this._singleGlobalObjectClass=e}GetSingleGlobalObjectClass(){if(this.IsSingleGlobal())return this._singleGlobalObjectClass;throw new Error("must be single-global plugin")}GetSingleGlobalInstance(){if(this.IsSingleGlobal())return this._singleGlobalObjectClass.GetSingleGlobalInstance();throw new Error("must be single-global plugin")}_InitScriptInterface(){var e=this.GetSdkVersion(),t=(C33.AddonManager._PushInitObject(this,e),this.GetScriptInterfaceClass(!0));if(t){if(this._iPlugin=new t,!(this._iPlugin instanceof self.IPlugin))throw new TypeError("plugin class must derive from IPlugin")}else this._iPlugin=new self.IPlugin;C33.AddonManager._PopInitObject(e)}GetIPlugin(){return this._iPlugin}}}{let C33=self.C3;C33.SDKDOMPluginBase=class SDKDOMPluginBase extends C33.SDKPluginBase{constructor(e,t){super(e),this._domComponentId=t,this._nextElementId=0,this._instMap=new Map,this.AddElementMessageHandler("elem-focused",e=>e._OnElemFocused()),this.AddElementMessageHandler("elem-blurred",e=>{e&&e._OnElemBlurred()})}Release(){super.Release()}_AddElement(e){var t=this._nextElementId++;return this._instMap.set(t,e),t}_RemoveElement(e){this._instMap.delete(e)}AddElementMessageHandler(e,r){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,e=>{var t=this._instMap.get(e.elementId);r(t,e)})}}}{let C33=self.C3;C33.SDKTypeBase=class SDKTypeBase extends C33.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(e){}BeforeRunAction(e){}AfterRunAction(e){}LoadTextures(e){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(e){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,r){e=C33.New(C33.Event,e,t);e.objectClass=this,r&&Object.assign(e,r),this.GetObjectClass().DispatchUserScriptEvent(e)}}}{let C33=self.C3;C33.SDKInstanceBase=class SDKInstanceBase extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._domComponentId=t,this._wrapperComponentId=null,this._runtime=e.GetRuntime(),this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._tickFunc=null,this._tick2Func=null,this._isTicking=!1,this._isTicking2=!1,this._disposables=null,this._wasReleased=!1}Release(){this._wasReleased=!0,this._StopTicking(),this._StopTicking2(),this._tickFunc=null,this._tick2Func=null,this._disposables&&(this._disposables.Release(),this._disposables=null),this._inst=null,this._runtime=null,this._objectClass=null,this._sdkType=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(e){return this._runtime.Trigger(e,this._inst,null)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,null)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,null)}FastTrigger(e,t){return this._runtime.FastTrigger(e,this._inst,t)}DebugFastTrigger(e,t){return this._runtime.DebugFastTrigger(e,this._inst,t)}ScheduleTriggers(e){return this._runtime.ScheduleTriggers(e)}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}AddDOMMessageHandlers(e){for(var[t,r]of e)this.AddDOMMessageHandler(t,r)}PostToDOM(e,t){this._runtime.PostComponentMessageToDOM(this._domComponentId,e,t)}PostToDOMAsync(e,t){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,e,t)}_PostToDOMMaybeSync(e,t){if(!this._runtime.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:e,data:t,responseId:null});this.PostToDOM(e,t)}SetWrapperExtensionComponentId(e){if(!e)throw new Error("cannot set empty component id");this._wrapperComponentId=e}IsWrapperExtensionAvailable(){if(this._wrapperComponentId)return this._runtime.HasWrapperComponentId(this._wrapperComponentId);throw new Error("wrapper extension component id not set")}AddWrapperExtensionMessageHandler(e,t){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.AddWrapperExtensionMessageHandler(this._wrapperComponentId,e,t)}AddWrapperExtensionMessageHandlers(e){for(var[t,r]of e)this.AddWrapperExtensionMessageHandler(t,r)}SendWrapperExtensionMessage(e,t){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.SendWrapperExtensionMessage(this._wrapperComponentId,e,t)}SendWrapperExtensionMessageAsync(e,t){if(this._wrapperComponentId)return this._runtime.SendWrapperExtensionMessageAsync(this._wrapperComponentId,e,t);throw new Error("wrapper extension component id not set")}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=()=>this.Tick()),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=()=>this.Tick2()),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t,r){if(0!==t){var i=this.GetPropertyValueByIndex(e);if("number"!=typeof i)throw new Error("expected number");this.SetPropertyValueByIndex(e,i+t,r)}}SetPropertyColorOffsetValueByIndex(e,t,r,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,r){var i;this._inst.HasScriptInterface()&&(i=this.GetScriptInterface(),(e=C33.New(C33.Event,e,t)).instance=i,r&&Object.assign(e,r),i.dispatchEvent(e))}MustPreDraw(){return!1}}}{let C33=self.C3;C33.SDKWorldInstanceBase=class SDKWorldInstanceBase extends C33.SDKInstanceBase{constructor(e,t){super(e,t),this._worldInfo=e.GetWorldInfo(),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null}Release(){var e;this._renderercontextlost_handler&&((e=this._runtime.Dispatcher()).removeEventListener("renderercontextlost",this._renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null),this._worldInfo=null,super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){var e;this._renderercontextlost_handler||(this._renderercontextlost_handler=()=>this.OnRendererContextLost(),this._renderercontextrestored_handler=()=>this.OnRendererContextRestored(),(e=this._runtime.Dispatcher()).addEventListener("renderercontextlost",this._renderercontextlost_handler),e.addEventListener("renderercontextrestored",this._renderercontextrestored_handler))}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");var e=this.GetCurrentImageInfo();if(e)return e.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");var e=this.GetCurrentImageInfo();if(e)return e.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){var e=this.GetCurrentImageInfo();if(e){e=e.GetTexture();if(e)return[e.GetWidth(),e.GetHeight()]}return[100,100]}GetCurrentTexRect(){var e=this.GetCurrentImageInfo();return e?e.GetTexRect():null}GetCurrentTexQuad(){var e=this.GetCurrentImageInfo();return e?e.GetTexQuad():null}IsCurrentTexRotated(){var e=this.GetCurrentImageInfo();return!!e&&e.IsRotated()}GetImagePoint(e){var t=this._inst.GetWorldInfo();return[t.GetX(),t.GetY(),t.GetTotalZElevation()]}LoadTilemapData(e,t,r){}TestPointOverlapTile(e,t){}RendersToOwnZPlane(){return!0}}}{let C33=self.C3,tempRect=C33.New(C33.Rect);C33.SDKDOMInstanceBase=class SDKDOMInstanceBase extends C33.SDKWorldInstanceBase{constructor(e,t){super(e,t),this._elementId=this.GetPlugin()._AddElement(this),this._isElementShowing=!0,this._elemHasFocus=!1,this._autoFontSize=!1,this._autoFontSizeOffset=-.2,this._lastRect=C33.New(C33.Rect,0,0,-1,-1);e=this._runtime.GetCanvasManager();this._lastWindowWidth=e.GetLastWidth(),this._lastWindowHeight=e.GetLastHeight(),this._lastHTMLIndex=-1,this._lastHTMLZIndex=-1,this._isPendingUpdateState=!1,this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId),this.PostToDOMElement("destroy"),this._elementId=-1,super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw new Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(e,t){(t=t||{}).elementId=this._elementId,this.PostToDOM(e,t)}_PostToDOMElementMaybeSync(e,t){return(t=t||{}).elementId=this._elementId,this._PostToDOMMaybeSync(e,t)}PostToDOMElementAsync(e,t){return(t=t||{}).elementId=this._elementId,this.PostToDOMAsync(e,t)}CreateElement(e){e=e||{};var t=this.GetWorldInfo();e.elementId=this._elementId,e.isVisible=t.IsVisible(),e.htmlIndex=t.GetLayer().GetHTMLIndex(),e.htmlZIndex=t.GetHTMLZIndex(),Object.assign(e,this.GetElementState()),this._isElementShowing=!!e.isVisible,this._PostToDOMMaybeSync("create",e),this._UpdatePosition(!0)}SetElementVisible(e){this._isElementShowing!==(e=!!e)&&(this._isElementShowing=e,this.PostToDOMElement("set-visible",{isVisible:e}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){var e=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===C33.Platform.OS&&("scale-inner"===e||"scale-outer"===e||"crop"===e)}_UpdatePosition(e){if(!this.GetInstance().IsDestroyed()){var t=this.GetWorldInfo(),r=t.GetLayer(),i=t.GetBoundingBox(),[s,a]=r.LayerToCanvasCss(i.getLeft(),i.getTop()),[i,n]=r.LayerToCanvasCss(i.getRight(),i.getBottom()),o=this._runtime.GetCanvasManager(),l=o.GetCssWidth(),h=o.GetCssHeight();if(t.IsVisible()&&r.IsVisible())if(!this._ShouldPreserveElement()&&(i<=0||n<=0||l<=s||h<=a))this.SetElementVisible(!1);else{tempRect.set(s,a,i,n);l=o.GetLastWidth(),h=o.GetLastHeight(),s=r.GetHTMLIndex(),a=t.GetHTMLZIndex();if(!e&&tempRect.equals(this._lastRect)&&this._lastWindowWidth===l&&this._lastWindowHeight===h&&this._lastHTMLIndex===s&&this._lastHTMLZIndex===a)this.SetElementVisible(!0);else{this._lastRect.copy(tempRect),this._lastWindowWidth=l,this._lastWindowHeight=h,this._lastHTMLIndex=s,this._lastHTMLZIndex=a,this.SetElementVisible(!0);let e=null;this._autoFontSize&&(e=r.GetDisplayScale()+this._autoFontSizeOffset),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft()),top:Math.round(this._lastRect.getTop()),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),htmlIndex:s,htmlZIndex:a,fontSize:e})}}else this.SetElementVisible(!1)}}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(e,t){this.PostToDOMElement("set-css-style",{prop:C33.CSSToCamelCase(e),val:t})}SetElementAttribute(e,t){this.PostToDOMElement("set-attribute",{name:e,val:t})}RemoveElementAttribute(e){this.PostToDOMElement("remove-attribute",{name:e})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then(()=>{this._isPendingUpdateState=!1,this.PostToDOMElement("update-state",this.GetElementState())}))}GetElementState(){}GetElementId(){return this._elementId}}}{let C33=self.C3,IBehavior=self.IBehavior;C33.SDKBehaviorBase=class SDKBehaviorBase extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._myObjectClasses=C33.New(C33.ArraySet),this._myInstances=C33.New(C33.ArraySet),this._sdkVersion=e.sdkVersion,this._scriptInterfaceClass=e.scriptInterfaceClass,this._iBehavior=null}Release(){this._myInstances.Release(),this._myObjectClasses.Release(),this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(e=!1){let t=this._scriptInterfaceClass;return t=e&&"function"!=typeof t&&2<=this.GetSdkVersion()?globalThis.ISDKBehaviorBase:t}_AddObjectClass(e){this._myObjectClasses.Add(e)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(e){this._myInstances.Add(e)}_RemoveInstance(e){this._myInstances.Delete(e)}GetInstances(){return this._myInstances.GetArray()}_InitScriptInterface(){var e=this.GetSdkVersion(),t=(C33.AddonManager._PushInitObject(this,e),this.GetScriptInterfaceClass(!0));if(t){if(this._iBehavior=new t,!(this._iBehavior instanceof IBehavior))throw new TypeError("behavior class must derive from IBehavior")}else this._iBehavior=new IBehavior;C33.AddonManager._PopInitObject(e)}GetIBehavior(){return this._iBehavior}}}{let C33=self.C3;C33.SDKBehaviorTypeBase=class SDKBehaviorTypeBase extends C33.DefendedBase{constructor(e){super(),this._runtime=e.GetRuntime(),this._behaviorType=e,this._objectClass=e.GetObjectClass(),this._behavior=e.GetBehavior(),this._behavior._AddObjectClass(this._objectClass)}Release(){this._runtime=null,this._behaviorType=null,this._objectClass=null,this._behavior=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}}}{let C33=self.C3;C33.SDKBehaviorInstanceBase=class SDKBehaviorInstanceBase extends C33.DefendedBase{constructor(e,t){super(),this._behInst=e,this._domComponentId=t,this._inst=e.GetObjectInstance(),this._runtime=e.GetRuntime(),this._behaviorType=e.GetBehaviorType(),this._sdkType=this._behaviorType.GetSdkType(),this._isTicking=!1,this._isTicking2=!1,this._isPostTicking=!1,this._disposables=null}Release(){this._StopTicking(),this._StopTicking2(),this._StopPostTicking(),this._disposables&&(this._disposables.Release(),this._disposables=null),this._behInst=null,this._inst=null,this._runtime=null,this._behaviorType=null,this._sdkType=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(e){return this._runtime.Trigger(e,this._inst,this._behaviorType)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,this._behaviorType)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}OnSpriteFrameChanged(e,t){}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){var r=this.GetPropertyValueByIndex(e);if("number"!=typeof r)throw new Error("expected number");this.SetPropertyValueByIndex(e,r+t)}}SetPropertyColorOffsetValueByIndex(e,t,r,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,r){var i;this._behInst.HasScriptInterface()&&(i=this.GetScriptInterface(),(e=C33.New(C33.Event,e,t)).behaviorInstance=i,e.instance=i.instance,r&&Object.assign(e,r),i.dispatchEvent(e))}}}{let ValidateInternalAPIToken2=function(e){if(e!==internalApiToken)throw new Error("invalid internal API token")},C33=(ValidateInternalAPIToken=ValidateInternalAPIToken2,self.C3),internalApiToken=(C33.Plugins={},C33.Behaviors={},C33._GetInternalAPIToken()),initObjectStack=[],initObjectStack2=[],initPropertiesStack=[],originalPushInitObject=null,originalPopInitObject=null,originalGetInitObject=null,originalGetInitObject2=null,pluginsByCtor=new Map,behaviorsByCtor=new Map;C33.AddonManager=class AddonManager extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._allPlugins=[],this._systemPlugin=null,this._allBehaviors=[],this._delayCreateBehaviors=new Map,this._solidBehavior=null,this._jumpthruBehavior=null,this._wrapperComponentIds=new Set(t)}CreatePlugin(e){var t=e[19],r=this._runtime.GetObjectReference(e[0]);if(!r)throw new Error("missing plugin");C33.AddCommonACEs(e,r);var i=2<=t?C33.SDKPluginBase:r,i=C33.New(i,{runtime:this._runtime,isSingleGlobal:e[1],isWorld:e[2],isRotatable:e[5],hasEffects:e[8],mustPredraw:e[9],supportsSceneGraph:e[13],supportsMesh:e[14],isHTMLElementType:e[17],is3d:e[18],sdkVersion:t,scriptInterfaceClass:2<=t?r:null});i.OnCreate(),this._allPlugins.push(i),pluginsByCtor.set(r,i)}CreateSystemPlugin(){this._systemPlugin=C33.New(C33.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0}),this._systemPlugin.OnCreate()}CreateBehavior(e){let t=e[1],r=this._runtime.GetObjectReference(e[0]);if(!r)throw new Error("missing behavior");this._delayCreateBehaviors.set(r,()=>{var e=2<=t?C33.SDKBehaviorBase:r,e=C33.New(e,{runtime:this._runtime,sdkVersion:t,scriptInterfaceClass:2<=t?r:null});e.OnCreate(),this._allBehaviors.push(e),behaviorsByCtor.set(r,e),!this._solidBehavior&&C33.Behaviors.solid&&e instanceof C33.Behaviors.solid?this._solidBehavior=e:!this._jumpthruBehavior&&C33.Behaviors.jumpthru&&e instanceof C33.Behaviors.jumpthru&&(this._jumpthruBehavior=e),e._InitScriptInterface()})}_DelayCreateBehavior(e){var t=this._delayCreateBehaviors.get(e);t&&(t(),this._delayCreateBehaviors.delete(e))}static _PushInitObject(e,t=1){if(C33.AddonManager._PushInitObject!==originalPushInitObject)throw new Error("invalid method");1===t&&initObjectStack.push(e),initObjectStack2.push(e)}static _PopInitObject(e=1){if(C33.AddonManager._PopInitObject!==originalPopInitObject)throw new Error("invalid method");1===e&&initObjectStack.pop(),initObjectStack2.pop()}static _GetInitObject(){if(C33.AddonManager._GetInitObject!==originalGetInitObject)throw new Error("invalid method");if(0===initObjectStack.length)throw new Error("no init object set");return initObjectStack.at(-1)}static _GetInitObject2(e){if(C33.AddonManager._GetInitObject2!==originalGetInitObject2)throw new Error("invalid method");if(ValidateInternalAPIToken2(e),0===initObjectStack2.length)throw new Error("no init object set");return initObjectStack2.at(-1)}static _PushInitProperties(e){initPropertiesStack.push(e)}static _PopInitProperties(){initPropertiesStack.pop()}static _GetInitProperties(){if(0===initPropertiesStack.length)throw new Error("no init properties set");return initPropertiesStack.at(-1)}_InitAddonScriptInterfaces(){for(var e of this._allPlugins)e._InitScriptInterface()}static GetPluginByConstructorFunction(e){return pluginsByCtor.get(e)||null}static GetBehaviorByConstructorFunction(e){return behaviorsByCtor.get(e)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}HasWrapperComponentId(e){return this._wrapperComponentIds.has(e)}},originalPushInitObject=C33.AddonManager._PushInitObject,originalPopInitObject=C33.AddonManager._PopInitObject,originalGetInitObject=C33.AddonManager._GetInitObject,originalGetInitObject2=C33.AddonManager._GetInitObject2}{let C33=self.C3,allImageInfos=new Set;C33.ImageInfo=class ImageInfo extends C33.DefendedBase{constructor(){super(),this._generation=0,this._url="",this._size=0,this._offsetX=0,this._offsetY=0,this._width=0,this._height=0,this._isRotated=!1,this._hasMetaData=!1,this._imageAsset=null,this._textureState="",this._rcTex=C33.New(C33.Rect),this._quadTex=C33.New(C33.Quad),this._blobUrl="",this._iImageInfo=new self.IImageInfo(this),allImageInfos.add(this)}Release(){this.ReleaseTexture(),this._imageAsset&&0===this._imageAsset.GetRefCount()&&this._imageAsset.Release(),this._imageAsset=null,allImageInfos.delete(this),this.ReleaseBlobURL()}static OnRendererContextLost(){for(var e of allImageInfos)e._textureState="",e._rcTex.set(0,0,0,0),e._quadTex.setFromRect(e._rcTex)}LoadData(e){this._url=e[0],this._size=e[1],this._offsetX=e[2],this._offsetY=e[3],this._width=e[4],this._height=e[5],this._isRotated=e[6],this._hasMetaData=!0}LoadDynamicAsset(e,t){if(this._imageAsset)throw new Error("already loaded asset");this._url=t;var r={};return C33.IsAbsoluteURL(t)&&(r.loadPolicy="remote"),this.LoadAsset(e,r),this._imageAsset.Load()}LoadDynamicBlobAsset(e,t){if(this._imageAsset)throw new Error("already loaded asset");this._url="",this._size=t.size,this._imageAsset=C33.New(C33.ImageAsset,e.GetAssetManager(),{blob:t,size:this._size,loadPolicy:"local"})}ReplaceWith(e){if(e===this)throw new Error("cannot replace with self");this._generation++,this.ReleaseTexture(),this._url=e._url,this._size=e._size,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._width=e._width,this._height=e._height,this._isRotated=e._isRotated,this._hasMetaData=e._hasMetaData,this._imageAsset=e._imageAsset,this._textureState=e._textureState,this._rcTex=e._rcTex,this._quadTex=e._quadTex,this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(e,t){if(this._imageAsset)throw new Error("already got asset");t=Object.assign({},t,{url:this.GetURL(),size:this.GetSize()}),this._imageAsset=e.LoadImage(t)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(e,t){if(!this._imageAsset)throw new Error("no asset");if(this._textureState)throw new Error("already loaded texture");var r=this._generation,e=(this._textureState="loading",await this._imageAsset.LoadStaticTexture(e,t));if(this._generation!==r)return null;if(!e)return this._textureState="",null;this._textureState="loaded",this._hasMetaData||(this._width=e.GetWidth(),this._height=e.GetHeight(),this._hasMetaData=!0);t=this._isRotated?this._height:this._width,r=this._isRotated?this._width:this._height;return this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+t,this._offsetY+r),this._rcTex.divide(e.GetWidth(),e.GetHeight()),this._quadTex.setFromRect(this._rcTex),this._isRotated&&this._quadTex.rotatePointsAnticlockwise(),e}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset&&"loaded"===this._textureState?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}GetImageAsset(){return this._imageAsset}async ExtractImageToCanvas(e){e=e||await this._imageAsset.LoadToDrawable();var t=C33.CreateCanvas(this._width,this._height),r=t.getContext("2d");return this._isRotated?(r.rotate(Math.PI/-2),r.translate(-this._height,0),r.drawImage(e,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)):r.drawImage(e,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height),t}async ExtractImageToBlobURL(e){return this._blobUrl||(e=await this.ExtractImageToCanvas(e),e=await C33.CanvasToBlob(e),this._blobUrl=URL.createObjectURL(e)),this._blobUrl}ReleaseBlobURL(){this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl="")}}}{let C33=self.C3;C33.AnimationInfo=class AnimationInfo extends C33.DefendedBase{constructor(e){super(),this._name=e[0],this._speed=e[1],this._isLooping=!!e[2],this._repeatCount=e[3],this._repeatTo=e[4],this._isPingPong=!!e[5],this._sid=e[6],this._frames=e[7].map(e=>C33.New(C33.AnimationFrameInfo,e)),this._iAnimation=new self.IAnimation(this)}static CreateDynamic(e,t){t=C33.New(C33.AnimationInfo,[t,0,!1,0,0,!1,Math.floor(1e15*Math.random()),[]]);return t._frames.push(C33.AnimationFrameInfo.CreateDynamic(e)),t}Release(){for(var e of this._frames)e.Release();C33.clearArray(this._frames)}LoadAllAssets(e){for(var t of this._frames)t.GetImageInfo().LoadAsset(e)}LoadAllTextures(t,r){return Promise.all(this._frames.map(e=>e.GetImageInfo().LoadStaticTexture(t,r)))}ReleaseAllTextures(){for(var e of this._frames)e.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(e){if((e=Math.floor(e))<0||e>=this._frames.length)throw new RangeError("invalid frame");return this._frames[e]}InsertFrameAt(e,t){(t=Math.floor(t))<0?this._frames.unshift(e):t>=this._frames.length?this._frames.push(e):this._frames.splice(t,0,e)}RemoveFrameAt(e){if((e=Math.floor(e))<0||e>=this._frames.length)throw new RangeError("invalid frame");this._frames[e].Release(),this._frames.splice(e,1)}GetFrameIndexByTag(r){for(let e=0,t=this._frames.length;e<t;++e)if(C33.equalsNoCase(this._frames[e].GetTag(),r))return e;return-1}FrameTagOrIndexToIndex(e){if("string"!=typeof e)return e;var t=this.GetFrameIndexByTag(e);if(-1===t)throw new Error("cannot find animation frame with tag "+e);return t}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}}}{let C33=self.C3,EMPTY_IMAGE_BLOB=(()=>{var r=atob("iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAANQTFRFAAAAp3o92gAAAAF0Uk5TAEDm2GYAAAATSURBVBgZYxgFo2AUjIJRQFcAAAV4AAHcRQIbAAAAAElFTkSuQmCC"),i=new Uint8Array(r.length);for(let e=0,t=r.length;e<t;++e)i[e]=r.charCodeAt(e);return new Blob([i],{type:"image/png"})})();C33.AnimationFrameInfo=class AnimationFrameInfo extends C33.DefendedBase{constructor(e){super(),this._imageInfo=C33.New(C33.ImageInfo),this._imageInfo.LoadData(e),this._duration=e[7],this._origin=C33.New(C33.Vector2,e[8],e[9]),this._imagePoints=e[10].map(e=>C33.New(C33.ImagePoint,this,e)),this._imagePointsByName=new Map;for(var t of this._imagePoints)this._imagePointsByName.set(t.GetName().toLowerCase(),t);this._collisionPoly=null;var r=e[11];6<=r.length&&(this._collisionPoly=C33.New(C33.CollisionPoly,r)),this._tag=e[12]||"",this._iAnimationFrame=new self.IAnimationFrame(this)}static CreateDynamic(e){var t=C33.New(C33.AnimationFrameInfo,["",0,0,0,100,100,!1,1,0,0,[],[],""]);return t._imageInfo.LoadDynamicBlobAsset(e,EMPTY_IMAGE_BLOB),t}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null),this._imageInfo.Release(),this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(e){return this._imagePointsByName.get(e.toLowerCase())||null}GetImagePointByIndex(e){return(e=Math.floor(e))<0||e>=this._imagePoints.length?null:this._imagePoints[e]}GetImagePointCount(){return this._imagePoints.length}GetTag(){return this._tag}GetIAnimationFrame(){return this._iAnimationFrame}}}{let C33=self.C3;C33.ImagePoint=class ImagePoint extends C33.DefendedBase{constructor(e,t){super(),this._afi=e,this._name=t[0],this._pos=C33.New(C33.Vector2,t[1],t[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}}}{let C33=self.C3,C3Debugger=self.C3Debugger,IObjectClass=self.IObjectClass,assert=self.assert;C33.ObjectClass=class ObjectClass extends C33.DefendedBase{constructor(t,e,r){super();var i=t.GetObjectReference(r[1]),[e,s]=(this._runtime=t,this._plugin=C33.AddonManager.GetPluginByConstructorFunction(i),this._sdkType=null,this._instSdkCtor=i.Instance,this._index=e,this._sid=r[11],this._name=r[0],this._jsPropName=this._runtime.GetJsPropName(r[14]),this._isGlobal=!!r[9],this._isFamily=!!r[2],this._isOnLoaderLayout=!!r[10],this._instVars=r[3].map(e=>({sid:e[0],type:e[1],name:e[2],jsPropName:t.GetJsPropName(e[3])})),this._behaviorsCount=r[4],this._effectsCount=r[5],this._isWorldType=this._plugin.IsWorldType(),this._dispatcher=C33.New(C33.Event.Dispatcher),this._effectList=null,t.GetCollisionEngine().GetCollisionCellSize());if(this._collisionGrid=C33.New(C33.SparseGrid,e,s),this._anyCollisionCellChanged=!0,this._familyMembers=null,this._familyMembersSet=null,this._familyIndex=-1,this._families=null,this._familiesSet=null,this._familyInstVarMap=null,this._familyBehaviorMap=null,this._familyEffectMap=null,this._isInContainer=!1,this._container=null,this._behaviorTypes=r[8].map(e=>C33.BehaviorType.Create(this,e)),this._behaviorTypesIncludingInherited=[],this._behaviorsByName=new Map,this._behaviorNameToIndex=new Map,this._usedBehaviorCtors=new Set,this._customActionMap=new Map,this._solStack=C33.New(C33.SolStack,this),this._defaultInstanceData=null,this._defaultLayerIndex=0,this._isContained=!1,this._container=null,this._imageInfo=null,this._animations=null,this._animationsByName=null,this._animationsBySid=null,this._textureRefCount=0,this._savedData=new Map,this._unsavedData=new Map,this._instances=[],this._worldInfosByLayer=new Map,this._iidsStale=!0,this._plugin.HasEffects()&&(this._effectList=C33.New(C33.EffectList,this,r[12])),r[6]&&(this._imageInfo=C33.New(C33.ImageInfo),this._imageInfo.LoadData(r[6])),r[7]){this._animations=r[7].map(e=>C33.New(C33.AnimationInfo,e)),this._animationsByName=new Map,this._animationsBySid=new Map;for(var a of this._animations)this._animationsByName.set(a.GetName().toLowerCase(),a),this._animationsBySid.set(a.GetSID(),a)}this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]);e=this._plugin.GetSdkVersion();if(e<2&&(this._sdkType=C33.New(i.Type,this,r[15]),!(this._sdkType instanceof C33.SDKTypeBase)))throw new Error("v1 sdk type must derive from SDKTypeBase");this._iObjectClass=null,this._instanceUserScriptClass=null,this._userScriptDispatcher=C33.New(C33.Event.Dispatcher),C33.AddonManager._PushInitObject(this,e);let n;if(n=2<=e?(n=i.Type)||globalThis.ISDKObjectTypeBase:this._sdkType.GetScriptInterfaceClass()){if(this._iObjectClass=new n(e<2?this:null),e<2&&!(this._iObjectClass instanceof IObjectClass))throw new TypeError("script interface class must derive from IObjectClass");if(2<=e&&!(this._iObjectClass instanceof globalThis.ISDKObjectTypeBase))throw new TypeError("script interface class must derive from ISDKObjectTypeBase")}else this._iObjectClass=new IObjectClass;C33.AddonManager._PopInitObject(e),r[13]&&(s=r[13])&&(i=s[0],e=s[1],s=s[2],this._sdkType.LoadTilemapData(i,e,s)),this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate(),this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),this._CreateSingleGlobalInstance(r)),this._loadInstancesJson=null}static Create(e,t,r){return C33.New(C33.ObjectClass,e,t,r)}Release(){if(this._dispatcher.Release(),this._dispatcher=null,this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null),this._animations){for(var e of this._animations)e.Release();C33.clearArray(this._animations),this._animationsByName.clear(),this._animationsBySid.clear()}this._loadInstancesJson=null,this._solStack.Release(),this._solStack=null,this._savedData.clear(),this._unsavedData.clear(),this._container=null,this._runtime=null}_LoadFamily(r){for(let e=1,t=r.length;e<t;++e){var i=this._runtime.GetObjectClassByIndex(r[e]);this._familyMembers.push(i),this._familyMembersSet.add(i),i._families.push(this),i._familiesSet.add(this)}}_SetContainer(e){this._isInContainer=!0,this._container=e}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){let e=0;if(!this._isFamily)for(var t of this._families)for(var r of t.GetBehaviorTypes()){var i=r.GetName().toLowerCase();this._behaviorsByName.set(i,r),this._behaviorNameToIndex.set(i,e),this._behaviorTypesIncludingInherited.push(r),++e}for(var s of this.GetBehaviorTypes()){var a=s.GetName().toLowerCase();this._behaviorsByName.set(a,s),this._behaviorNameToIndex.set(a,e),this._behaviorTypesIncludingInherited.push(s),++e}for(var n of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(n.GetBehavior().constructor);if(!this._isFamily&&this._families.length){var o,l=this._runtime.GetFamilyCount(),h=(C33.extendArray(this._familyInstVarMap,l,0),C33.extendArray(this._familyBehaviorMap,l,0),C33.extendArray(this._familyEffectMap,l,0),[]);let e=0,t=0,r=0;for(o of this._families){var u=o.GetFamilyIndex(),u=(this._familyInstVarMap[u]=e,e+=o.GetInstanceVariablesCount(),this._familyBehaviorMap[u]=t,t+=o.GetBehaviorTypesCount(),this._familyEffectMap[u]=r,r+=o.GetEffectTypesCount(),o.GetEffectList());if(u&&this._effectList)for(var c of u.GetAllEffectTypes())h.push(c.Clone(this._effectList))}this._effectList&&this._effectList.PrependEffectTypes(h)}}_CreateSingleGlobalInstance(e){var t=this._runtime._GetNewUID(),r=C33.New(C33.Instance,{runtime:this._runtime,objectType:this,uid:t});r._CreateSdkInstance(e[16],[]),this._runtime._MapInstanceByUID(t,r),this._instances.push(r)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}Dispatcher(){return this._dispatcher}OnCreate(){this._isFamily||(this._sdkType?this._sdkType.OnCreate():this._iObjectClass._onCreate())}HasLoadedTextures(){return 0<this._textureRefCount}async LoadTextures(e){this._isFamily||(this._textureRefCount++,1===this._textureRefCount&&(this._sdkType?await this._sdkType.LoadTextures(e):await this._iObjectClass._loadTextures(this._runtime.GetCanvasManager().GetIRenderer())))}ReleaseTextures(){if(!this._isFamily){if(this._textureRefCount--,this._textureRefCount<0)throw new Error("released textures too many times");0===this._textureRefCount&&(this._sdkType?this._sdkType.ReleaseTextures():this._iObjectClass._releaseTextures(this._runtime.GetCanvasManager().GetIRenderer()))}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw new Error("not applicable to family");this._sdkType?this._sdkType.OnDynamicTextureLoadComplete():this._iObjectClass._onDynamicTextureLoadComplete()}async PreloadTexturesWithInstances(e){this._isFamily||(this._sdkType?await this._sdkType.PreloadTexturesWithInstances(e):await this._iObjectClass._preloadTexturesWithInstances(this._runtime.GetCanvasManager().GetIRenderer()))}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(e){return e&&this._usedBehaviorCtors.has(e)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map(e=>e.sid)}GetInstanceVariableIndexBySID(t){return this._instVars.findIndex(e=>e.sid===t)}GetInstanceVariableIndexByName(t){return this._instVars.findIndex(e=>e.name===t)}_GetAllInstanceVariableNames(){return this._instVars.map(e=>e.name)}_GetAllInstanceVariableJsPropNames(){return this._instVars.map(e=>e.jsPropName)}GetInstanceVariableType(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].type}GetInstanceVariableName(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(e){return this._behaviorsByName.get(e.toLowerCase())||null}GetBehaviorIndexByName(e){e=this._behaviorNameToIndex.get(e.toLowerCase());return void 0===e?-1:e}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(e){this._defaultInstanceData=e}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(e){this._defaultLayerIndex=e}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(e){return this._familiesSet.has(e)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(e){return this._familyMembersSet.has(e)}GetFamilyBehaviorOffset(e){return this._familyBehaviorMap[e]}GetFamilyInstanceVariableOffset(e){return this._familyInstVarMap[e]}AddCustomAction(e){this._customActionMap.set(e.GetACEName().toLowerCase(),e)}HasOwnCustomActionByName(e){return!!this.GetOwnCustomActionByName(e)}GetOwnCustomActionByName(e){e=this._customActionMap.get(e.toLowerCase());return e&&e.IsEnabled()?e:null}GetAllAnimations(){return this._animations}GetAnimationByName(e){if(this._animations)return this._animationsByName.get(e.toLowerCase())||null;throw new Error("no animations")}GetAnimationBySID(e){if(this._animations)return this._animationsBySid.get(e)||null;throw new Error("no animations")}AddAnimation(e){if(this.GetAnimationByName(e))throw new Error(`animation name '${e}' already exists`);e=C33.AnimationInfo.CreateDynamic(this.GetRuntime(),e);return this._animations.push(e),this._animationsByName.set(e.GetName().toLowerCase(),e),this._animationsBySid.set(e.GetSID(),e),e}RemoveAnimation(e){var t=this.GetAnimationByName(e);if(!t)throw new Error(`animation name '${e}' does not exist`);if(1===this._animations.length)throw new Error("cannot remove last animation");e=this._animations.indexOf(t);this._animations.splice(e,1),this._animationsByName.delete(t.GetName().toLowerCase()),this._animationsBySid.delete(t.GetSID()),t.Release()}GetFirstAnimation(){if(this._animations)return this._animations[0];throw new Error("no animations")}GetFirstAnimationFrame(){return this.GetFirstAnimation().GetFrameAt(0)}GetDefaultInstanceSize(){var e;return this._animations?[(e=this.GetFirstAnimationFrame().GetImageInfo()).GetWidth(),e.GetHeight()]:this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(this._plugin.IsSingleGlobal())return this._instances[0];throw new Error("not a single-global plugin")}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances,yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(e){this._instances.push(e)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(this._iidsStale&&!this._isFamily){var t=this._instances;let e=0;for(var r,i=t.length;e<i;++e)t[e]._SetIID(e);for(r of this._runtime._GetInstancesPendingCreate())r.GetObjectClass()===this&&r._SetIID(e++);this._iidsStale=!1}}GetInstanceByIID(e){var t,r=this._instances;if(e<r.length)return r[e];e-=r.length;for(t of this._runtime._GetInstancesPendingCreate())if(t.GetObjectClass()===this){if(0===e)return t;--e}return null}GetFirstPicked(e){if(e&&e.IsInContainer()&&e.GetObjectClass()!==this)for(var t of e.siblings())if(t.GetObjectClass()===this)return t;e=this.GetCurrentSol().GetInstances();return e.length?e[0]:null}GetPairedInstance(e){var t=this.GetCurrentSol().GetInstances();return 0<t.length?t[e.GetIID()%t.length]:null}*allCorrespondingInstances(e,t){var r=this.GetCurrentSol().GetInstances(),i=r.length,s=t.GetCurrentSol(),a=t.GetCurrentSol().GetInstances(),n=a.length;let o=e.GetIID();!t.IsFamily()&&s.IsSelectAll()||(o=a.indexOf(e));t=Math.ceil(i/n),s=i%n;let l=0,h=0;h=0==s||o<s?(l=o*t,t):(l=s*t+(o-s)*(t-1),t-1);for(let e=l,t=l+h;e<t;++e)yield r[e]}FinishCondition(e){this._sdkType?.FinishCondition(e)}ApplySolToContainer(){if(this._isInContainer&&!this._isFamily){this._UpdateIIDs();var e,t=this.GetCurrentSol(),r=t._GetOwnInstances(),i=t.IsSelectAll(),s=this._runtime.GetCurrentEventStackFrame(),a=s&&s.GetCurrentEvent()&&s.GetCurrentEvent().IsOrBlock();for(e of this._container.objectTypes())if(e!==this){e._UpdateIIDs();var n=e.GetCurrentSol();if(n._SetSelectAll(i),!i){var o,l=n._GetOwnInstances();C33.clearArray(l);for(o of r)l.push(e.GetInstanceByIID(o.GetIID()));if(a){var h,u=t._GetOwnElseInstances(),c=n._GetOwnElseInstances();C33.clearArray(c);for(h of u)c.push(e.GetInstanceByIID(h.GetIID()))}}}}}_TruncateContainerSols(e,t){for(var r of this.GetContainer().objectTypes()){r=r.GetCurrentSol();e?C33.truncateArray(r._GetOwnElseInstances(),t):C33.truncateArray(r._GetOwnInstances(),t)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(e){this._anyCollisionCellChanged=!!e}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&this._isWorldType){for(var e of this._instances)e.GetWorldInfo()._UpdateCollisionCell();for(var t of this._runtime._GetInstancesPendingCreate())t.GetObjectClass()===this&&t.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}_OnWorldInstanceLayerChanged(t,e,r){var i;if(e&&(i=this._worldInfosByLayer.get(e))&&(i.delete(t),0===i.size)&&this._worldInfosByLayer.delete(e),r){let e=this._worldInfosByLayer.get(r);e||(e=new Set,this._worldInfosByLayer.set(r,e)),e.add(t)}}layersHasInstancesOn(){if(this.IsFamily()){var e,t=new Set;for(e of this._familyMembers)for(var r of e.layersHasInstancesOn())t.add(r);return t.values()}return this._worldInfosByLayer.keys()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.Persist)}_SaveToJson(){var e={instances:this._instances.map(e=>e.SaveToJson())};return this._savedData&&this._savedData.size&&(e.ex=C33.ToSuperJSON(this._savedData)),e}_LoadFromJson(e,r){this._savedData&&(this._savedData.clear(),this._savedData=null);var t=e.ex,i=(t&&(this._savedData=C33.FromSuperJSON(t)),this._instances),s=e.instances;for(let e=0,t=Math.min(i.length,s.length);e<t;++e)i[e].LoadFromJson(s[e]);for(let e=s.length,t=i.length;e<t;++e)this._runtime.DestroyInstance(i[e]);for(let t=i.length,e=s.length;t<e;++t){var a,n=s[t];let e=null;this.IsWorldType()&&!(e=this._runtime.GetMainRunningLayout().GetLayerBySID(n.w.l))||((a=this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,e,!1,0,0,!0)).LoadFromJson(n),r&&r.add(a))}this._loadInstancesJson=s,this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let e=0,t=this._instances;e<t;++e)this._instances[e]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(e){this._instanceUserScriptClass=e}DispatchUserScriptEvent(e){var t=this._runtime,t=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine();t&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger.AddScriptTime()}}}{let C33=self.C3;C33.Container=class Container extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._objectTypes=t;for(var r of this._objectTypes)r._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some(e=>e.IsWorldType())}}}{let C33=self.C3,C3Debugger=self.C3Debugger,IInstance=self.IInstance,originalAddonManager=C33.AddonManager,EMPTY_ARRAY=[],nextPuid=0,savedDataMaps=new WeakMap,unsavedDataMaps=new WeakMap,FLAG_DESTROYED=1,FLAG_TILEMAP=2,FLAG_MUST_PREDRAW=4,FLAG_SOLID_ENABLED=8,FLAG_JUMPTHRU_ENABLED=16,FLAG_MUST_MITIGATE_Z_FIGHTING=32,FLAG_IS_DRAWING_WITH_EFFECTS=64;C33.Instance=class Instance extends C33.DefendedBase{constructor(e){if(C33.AddonManager!==originalAddonManager)throw new Error("invalid addon manager");super(),this._runtime=e.runtime,this._objectType=e.objectType,this._worldInfo=null,this._sdkInst=null,this._iScriptInterface=null,this._iid=0,this._uid=e.uid,this._puid=nextPuid++,this._flags=0,this._tagsSet=null;var t,r=C33.splitStringAndNormalize(e.tags),r=(0<r.length&&(this._tagsSet=new Set(r)),this._instVarValues=EMPTY_ARRAY,this._behaviorInstances=EMPTY_ARRAY,this._objectType.GetBehaviorTypesIncludingInherited()),r=(0<r.length&&(this._behaviorInstances=r.map((e,t)=>C33.New(C33.BehaviorInstance,{runtime:this._runtime,behaviorType:e,instance:this,index:t}))),this._siblings=this._objectType.IsInContainer()?[]:null,this._timeScale=-1,this._dispatcher=null,this.GetPlugin());r.MustPreDraw()&&(this._flags|=FLAG_MUST_PREDRAW),r.IsWorldType()&&(this._worldInfo=C33.New(C33.WorldInfo,this,e.layer),e.worldData?this._worldInfo.Init(e.worldData):(this._worldInfo.InitNoData(),[r,t]=this._objectType.GetDefaultInstanceSize(),this._worldInfo.SetSize(r,t),this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters())),e.instVarData?this._LoadInstanceVariableData(e.instVarData):this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null),0<this._behaviorInstances.length){for(var e of this._behaviorInstances)e.Release();C33.clearArray(this._behaviorInstances)}this._sdkInst&&(this._sdkInst.Release(),this._sdkInst=null);var t=savedDataMaps.get(this),t=(t&&(t.clear(),savedDataMaps.delete(this)),unsavedDataMaps.get(this));t&&(t.clear(),unsavedDataMaps.delete(this)),this._siblings&&C33.clearArray(this._siblings),this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null),this._tagsSet&&this._tagsSet.clear(),this._tagsSet=null,this._runtime=null,this._objectType=null,0<this._instVarValues.length&&C33.clearArray(this._instVarValues),this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(e){0<e.length&&(this._instVarValues=[],C33.shallowAssignArray(this._instVarValues,e))}_LoadDefaultInstanceVariables(){var t=this._objectType.GetInstanceVariablesCount();if(0!==t){this._instVarValues=[];var r=[0,0,""];for(let e=0;e<t;++e)this._instVarValues.push(r[this._objectType.GetInstanceVariableType(e)])}}_CreateSdkInstance(e,r){if(this._sdkInst)throw new Error("already got sdk instance");for(let e=0,t=this._behaviorInstances.length;e<t;++e)this._behaviorInstances[e]._CreateSdkInstance(r?r[e]:null);if(this.GetPlugin().GetSdkVersion()<2){if(this._sdkInst=C33.New(this._objectType.GetInstanceSdkCtor(),this,e),!(this._sdkInst instanceof C33.SDKInstanceBase))throw new Error("sdk type must derive from SDKInstanceBase");!this.GetPlugin().IsWorldType()&&this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass()}else{var t=this.GetPlugin().GetScriptInterfaceClass();this._InitUserScriptInterface(t.Instance,e)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){var e=this._timeScale;return-1===e?this.GetRuntime().GetTimeScale():e}SetTimeScale(e){((e=+e)<0||!isFinite(e))&&(e=0),this._timeScale=e,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!0)}RestoreTimeScale(){this._timeScale=-1,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!1)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){return this._dispatcher||(this._dispatcher=C33.New(C33.Event.Dispatcher)),this._dispatcher}Draw(e){this._sdkInst?this._sdkInst.Draw(e):this._iScriptInterface._draw(this._runtime.GetCanvasManager().GetIRenderer())}OnCreate(e){this._sdkInst.OnCreate(e)}_SetHasTilemap(){this._flags|=FLAG_TILEMAP}HasTilemap(){return 0!=(this._flags&FLAG_TILEMAP)}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}IsDestroyed(){return 0!=(this._flags&FLAG_DESTROYED)}MustPreDraw(){return 0!=(this._flags&FLAG_MUST_PREDRAW)||this._sdkInst.MustPreDraw()}SetMustMitigateZFighting(){this._flags|=FLAG_MUST_MITIGATE_Z_FIGHTING}MustMitigateZFighting(){return 0!=(this._flags&FLAG_MUST_MITIGATE_Z_FIGHTING)}_IsSolidEnabled(){return 0!=(this._flags&FLAG_SOLID_ENABLED)}_SetSolidEnabled(e){e?this._flags|=FLAG_SOLID_ENABLED:this._flags&=~FLAG_SOLID_ENABLED}_IsJumpthruEnabled(){return 0!=(this._flags&FLAG_JUMPTHRU_ENABLED)}_SetJumpthruEnabled(e){e?this._flags|=FLAG_JUMPTHRU_ENABLED:this._flags&=~FLAG_JUMPTHRU_ENABLED}_IsDrawingWithEffects(){return 0!=(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)}_SetIsDrawingWithEffects(e){e?this._flags|=FLAG_IS_DRAWING_WITH_EFFECTS:this._flags&=~FLAG_IS_DRAWING_WITH_EFFECTS}SetFlag(e,t){e<<=16,t?this._flags|=e:this._flags&=~e}GetFlag(e){return 0!=(this._flags&e<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(e){return this._sdkInst.GetImagePoint(e)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(e){return e.IsFamily()?e.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===e}CollectInstancesToPick(i,e,t){var r=(e,t)=>{var t=t||e.GetObjectClass(),r=i.get(t);r?r.add(e):i.set(t,new Set([e]))};if(r(this,e),this.IsInContainer())for(var s of this.siblings())r(s);if(t)for(var a of this.allChildren())r(a)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw new Error("object does not support scene graph")}HasParent(){return null!==this.GetParent()}GetParent(){var e=this.GetWorldInfo();return(e=e&&e.GetParent())?e.GetInstance():null}GetTopParent(){var e=this.GetWorldInfo();return(e=e&&e.GetTopParent())?e.GetInstance():null}*parents(){var e=this.GetWorldInfo();if(e)for(var t of e.parents())yield t.GetInstance()}HasChild(e){if(e)for(var t of this.children())if(t===e)return!0;return!1}HasChildren(){var e=this.GetWorldInfo();return!!e&&e.HasChildren()}GetChildrenOfObjectClass(e){var t=this.GetWorldInfo();if(!t)return[];let r=e.GetName();return t.GetChildren().map(e=>e.GetInstance()).filter(e=>e.GetObjectClass().GetName()===r)}GetChildren(){var e=this.GetWorldInfo();return e?e.GetChildren().map(e=>e.GetInstance()):[]}*children(){var e=this.GetWorldInfo();if(e)for(var t of e.children())yield t.GetInstance()}*allChildren(){var e=this.GetWorldInfo();if(e)for(var t of e.allChildren())yield t.GetInstance()}GetChildCount(){var e=this.GetWorldInfo();return e?e.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){var e=this.GetWorldInfo();return e?e.GetAllChildCount():0}GetChildAt(e){var t=this.GetWorldInfo();return(t=t&&t.GetChildAt(e))?t.GetInstance():null}GetIndexInParent(){var e,t=this.GetWorldInfo();return t&&(e=t.GetParent())?e.GetChildIndex(t):NaN}HasChildWithUID(e){for(var t of this.GetWorldInfo().GetChildren())if(t.GetInstance().GetUID()===e)return!0;return!1}AddChild(e,t){this.VerifySupportsSceneGraph(),e.VerifySupportsSceneGraph(),this.GetWorldInfo().AddChild(e.GetWorldInfo(),t||{})}RemoveChild(e){var t=this.GetWorldInfo();t&&t.RemoveChild(e.GetWorldInfo())}GetDestroyWithParent(){var e=this.GetWorldInfo();return!!e&&e.GetDestroyWithParent()}SetupInitialSceneGraphConnections(){var e=this.GetWorldInfo();if(e){e=e.GetSceneGraphChildrenExportData();if(e)for(var t of e){var r=this._runtime.GetInstanceByUID(t[2]);r&&(t=t[3],this.AddChild(r,{transformX:!!(t>>0&1),transformY:!!(t>>1&1),transformWidth:!!(t>>2&1),transformHeight:!!(t>>3&1),transformAngle:!!(t>>4&1),destroyWithParent:!!(t>>5&1),transformZElevation:!!(t>>6&1),transformOpacity:!!(t>>7&1),transformVisibility:!!(t>>8&1)}))}}}SetupPersistedSceneGraphConnections(e,t){e=e.get(this);if(e)for(var r of e.sceneGraphJson.children){var i=t.get(r.index);i&&(r=r.flags,this.AddChild(i,{transformX:!!(r>>0&1),transformY:!!(r>>1&1),transformWidth:!!(r>>2&1),transformHeight:!!(r>>3&1),transformAngle:!!(r>>4&1),destroyWithParent:!!(r>>5&1),transformZElevation:!!(r>>6&1),transformOpacity:!!(r>>7&1),transformVisibility:!!(r>>8&1)}))}}GetTemplateName(){var e=this._runtime.GetTemplateManager();return e?e.GetInstanceTemplateName(this):""}IsInContainer(){return null!==this._siblings}_AddSibling(e){this._siblings.push(e)}GetSiblings(){return this._siblings}HasSibling(e){return!!this.GetSibling(e)}GetSibling(e){var t,r=this.siblings();if(null===r||0===r.length)return!1;for(t of r)if(t.GetObjectClass()===e)return t;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(var e of this.siblings())e.GetObjectClass().GetCurrentSol().SetSinglePicked(e)}_PushSiblingsToSolInstances(){for(var e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushInstance(e)}_SetSiblingsToSolInstancesIndex(e){for(var t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnInstances()[e]=t}_PushSiblingsToSolElseInstances(){for(var e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushElseInstance(e)}_SetSiblingsToSolElseInstancesIndex(e){for(var t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[e]=t}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(e){this._iid=e}GetIID(){return this._objectType._UpdateIIDs(),this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}_SetTagsSetFromJson(e){e?this.SetTagsSet(new Set(e)):this._tagsSet=null}SetTagsSet(e){if(0===e.size)this._tagsSet=null;else{this._tagsSet?this._tagsSet.clear():this._tagsSet=new Set;for(var t of e)this._tagsSet.add(t)}}GetTagsSet(){return this._tagsSet??new Set}GetTagsString(){return Array.from(this.GetTagsSet()).join(" ")}GetTagAt(e){e=Math.floor(e);for(var t of this.GetTagsSet()){if(0===e)return t;--e}return""}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(e){if(e)for(var t of this._behaviorInstances)if(t.GetBehavior()instanceof e)return t;return null}GetBehaviorSdkInstanceFromCtor(e){return(e=e&&this.GetBehaviorInstanceFromCtor(e))?e.GetSdkInstance():null}GetBehaviorIndexBySID(r){var i=this._behaviorInstances;for(let e=0,t=i.length;e<t;++e)if(i[e].GetBehaviorType().GetSID()===r)return e;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(e){var t=this._instVarValues;if((e|=0)<0||e>=t.length)throw new RangeError("invalid instance variable");return t[e]}_GetInstanceVariableValueUnchecked(e){return this._instVarValues[e]}_GetInstanceVariableTypedValue(e){var t=this._instVarValues[e];return 0===this._objectType.GetInstanceVariableType(e)?!!t:t}SetInstanceVariableValue(e,t){var r=this._instVarValues;if((e|=0)<0||e>=r.length)throw new RangeError("invalid instance variable");switch(this._objectType.GetInstanceVariableType(e)){case 0:r[e]=t?1:0;break;case 1:r[e]="number"==typeof t?t:parseFloat(t);break;case 2:r[e]="string"==typeof t?t:t.toString();break;default:throw new Error("unknown instance variable type")}}SetInstanceVariableOffset(e,t){if(0!==t){var r=this._instVarValues;if((e|=0)<0||e>=r.length)throw new RangeError("invalid instance variable");var i=r[e];if("number"!=typeof i)throw"boolean"==typeof i?new Error("can not set offset of boolean variable"):"string"==typeof i?new Error("can not set offset of string variable"):new Error("unknown instance variable type");r[e]+="number"==typeof t?t:parseFloat(t)}}GetSavedDataMap(){var e=savedDataMaps.get(this);return e||(e=new Map,savedDataMaps.set(this,e)),e}GetUnsavedDataMap(){var e=unsavedDataMaps.get(this);return e||(e=new Map,unsavedDataMaps.set(this,e)),e}_HasAnyCreateDestroyHandler(e){var t,r=this.GetObjectClass();if(r.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;for(t of r.GetFamilies())if(t.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;return!!this._runtime.UserScriptDispatcher().HasAnyHandlerFor(e)}_TriggerOnCreatedOnSelfAndRelated(){var e,t=new Set,r=(t.add(this),this.GetWorldInfo());if(r&&r.HasChildren())for(var i of this.allChildren())if(t.add(i),i.IsInContainer())for(var s of i.siblings())t.add(s);if(this.IsInContainer())for(var a of this.siblings())t.add(a);for(e of t.values())e._TriggerOnCreated()}_OnCreatedCommon(){this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass();for(var e of this._behaviorInstances)e.PostCreate()}_OnCreatedForLoadingSavegame(){this._OnCreatedCommon()}_TriggerOnCreated(){if(this._OnCreatedCommon(),this._HasAnyCreateDestroyHandler("instancecreate")){var e,t=this.GetObjectClass(),r=new C33.Event("instancecreate");r.instance=this.GetInterfaceClass(),t.DispatchUserScriptEvent(r);for(e of t.GetFamilies())e.DispatchUserScriptEvent(r);this._runtime.DispatchUserScriptEvent(r)}this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(e){if(this._iScriptInterface&&((r=new C33.Event("destroy")).isEndingLayout=e,this.DispatchUserScriptEvent(r)),this._HasAnyCreateDestroyHandler("instancedestroy")){var t,r=this.GetObjectClass(),i=new C33.Event("instancedestroy");i.instance=this.GetInterfaceClass(),i.isEndingLayout=e,r.DispatchUserScriptEvent(i);for(t of r.GetFamilies())t.DispatchUserScriptEvent(i);this._runtime.DispatchUserScriptEvent(i)}}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():this._iScriptInterface._getDebuggerProperties()}SaveToJson(e="full",t=null){var r={},i=("full"===e?r.uid=this.GetUID():r.c3=!0,this.GetTagsSet());if(0<i.size&&(r.tags=Array.from(i)),"visual-state"!==e){i=savedDataMaps.get(this);if(i&&i.size&&(r.ex=C33.ToSuperJSON(i)),-1!==this.GetTimeScale()&&(r.mts=this.GetTimeScale()),0<this._objectType.GetInstanceVariablesCount()){var s={},a=this._objectType.GetInstanceVariableSIDs();for(let e=0,t=this._instVarValues.length;e<t;++e)s[a[e].toString()]=this._instVarValues[e];r.ivs=s}if(this._behaviorInstances.length){var n,o={};for(n of this._behaviorInstances){var l=n.SaveToJson(e);l&&(o[n.GetBehaviorType().GetSID().toString()]=l)}r.behs=o}}this._worldInfo&&(r.w=this._worldInfo._SaveToJson(e,t));i=this._sdkInst?this._sdkInst.SaveToJson():this._iScriptInterface._saveToJson();return i&&(r.data=i),r}_OnBeforeLoad(e="full",t){this._worldInfo&&this._worldInfo._OnBeforeLoad(e)}_OnAfterLoad(e,t="full",r=null){this._worldInfo&&this._worldInfo._OnAfterLoad(e,t,r)}_OnAfterLoad2(e,t="full",r=null){this._worldInfo&&this._worldInfo._OnAfterLoad2(e,t,r)}_SetupSceneGraphConnectionsOnChangeOfLayout(){this.GetPlugin().IsWorldType()&&this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(t,e="full",r){if("full"===e)this._uid=t.uid;else if(!t.c3)return;if(this._SetTagsSetFromJson(t.tags),"visual-state"!==e){let e=savedDataMaps.get(this);e&&(e.clear(),savedDataMaps.delete(this));var i=t.ex,i=(i&&(e=C33.FromSuperJSON(i),savedDataMaps.set(this,e)),this._timeScale=t.hasOwnProperty("mts")?t.mts:-1,t.ivs);if(i)for(var[s,a]of Object.entries(i)){s=parseInt(s,10),s=this._objectType.GetInstanceVariableIndexBySID(s);if(!(s<0||s>=this._instVarValues.length)){let e=a;null===e&&(e=NaN),this._instVarValues[s]=e}}}if(this.GetPlugin().IsWorldType()&&(i=t.w)&&(h=i.l,this._worldInfo.GetLayer().GetSID()!==h&&((h=(n=this._worldInfo.GetLayer()).GetLayout().GetLayerBySID(h))?(this._worldInfo._SetLayer(h),n._RemoveInstance(this,!0),h._AddInstance(this,!0),h.SetZIndicesChanged(this),this._worldInfo.SetBboxChanged()):"full"===e&&this._runtime.DestroyInstance(this)),this._worldInfo._LoadFromJson(i,e)),"visual-state"!==e){var n=t.behs;if(n)for(var[o,l]of Object.entries(n)){o=parseInt(o,10),o=this.GetBehaviorIndexBySID(o);o<0||o>=this._behaviorInstances.length||this._behaviorInstances[o].LoadFromJson(l,e)}}var h=t.data;h&&(this._sdkInst?this._sdkInst.LoadFromJson(h,e):this._iScriptInterface._loadFromJson(h))}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(e,t){var r=this._worldInfo?e?self.ISDKWorldInstanceBase:self.IWorldInstance:e?self.ISDKInstanceBase:self.IInstance,e=e||this._sdkInst.GetScriptInterfaceClass(),i=this._objectType._GetUserScriptInstanceClass(),s=i||e||r,a=this.GetPlugin().GetSdkVersion();if(C33.AddonManager._PushInitObject(this,a),C33.AddonManager._PushInitProperties(t),this._iScriptInterface=new s,C33.AddonManager._PopInitProperties(),C33.AddonManager._PopInitObject(a),e&&!(this._iScriptInterface instanceof r))throw new TypeError(`script interface class '${e.name}' does not extend the right base class '${r.name}'`);if(i&&!(this._iScriptInterface instanceof(e||r)))throw new TypeError(`setInstanceClass(): class '${i.name}' does not extend the right base class - check it extends the right class, e.g. globalThis.InstanceType.MyObjectName`);return this._iScriptInterface}_GetInstVarsScriptDescriptor(e){if(0!==this._instVarValues.length){var r={},i=this._objectType._GetAllInstanceVariableJsPropNames();for(let e=0,t=i.length;e<t;++e)r[i[e]]={configurable:!1,enumerable:!0,get:C33.Instance.prototype._GetInstanceVariableTypedValue.bind(this,e),set:C33.Instance.prototype.SetInstanceVariableValue.bind(this,e)};var t=Object.create(Object.prototype,r);e.instVars={value:t,writable:!1}}}_GetBehaviorsScriptDescriptor(e){var t=this._behaviorInstances;if(0!==t.length){var r,i={};for(r of t)i[r.GetBehaviorType().GetJsPropName()]={value:r.GetScriptInterface(),writable:!1};t=Object.create(Object.prototype,i);e.behaviors={value:t,writable:!1}}}DispatchUserScriptEvent(e){var t,r;this.HasScriptInterface()&&(t=this.GetInterfaceClass(),e.instance=t,(r=(r=this._runtime).IsDebug()&&!r.GetEventSheetManager().IsInEventEngine())&&C3Debugger.StartMeasuringScriptTime(),t.dispatchEvent(e),r)&&C3Debugger.AddScriptTime()}}}{let C33=self.C3;C33.SceneGraphInfo=class SceneGraphInfo extends C33.DefendedBase{constructor(e){super(),this._owner=e,this._parent=null,this._children=[],this._startWidth=e.GetWidth(),this._startHeight=e.GetHeight(),this._startScaleX=1,this._startScaleY=1,this._parentStartAngle=0,this._ownOpacity=1,this._startOpacity=e.GetOpacity(),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._indexInParent=NaN}Release(){this._parent=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._indexInParent=NaN,C33.clearArray(this._children)}SetParent(e){this._ownOpacity=this._owner.GetOpacity(),this._startOpacity=this._ownOpacity,this._parent=e,this._parentStartAngle=e?e.GetAngle():0}GetParent(){return this._parent}HasChildren(){return 0<this._children.length}GetChildren(){return this._children}_MaybeSortChildren(){this.HasChildren()&&1!==this._children.length&&(this._tmpSceneGraphChildrenIndexes?this._children.sort((e,t)=>{e=this._tmpSceneGraphChildrenIndexes.get(e.GetInstance()),t=this._tmpSceneGraphChildrenIndexes.get(t.GetInstance());return C33.IsFiniteNumber(e)&&C33.IsFiniteNumber(t)?e-t:0}):this._children.sort((e,t)=>{e=e._GetSceneGraphInfo()._GetIndexInParent(),t=t._GetSceneGraphInfo()._GetIndexInParent();return C33.IsFiniteNumber(e)&&C33.IsFiniteNumber(t)?e-t:0}))}_GetIndexInParent(){return this._indexInParent}GetStartScaleX(){return this._startScaleX}SetStartScaleX(e){this._startScaleX=e}GetStartScaleY(){return this._startScaleY}SetStartScaleY(e){this._startScaleY=e}GetStartOpacity(){return this._startOpacity}GetOwnOpacity(){return this._ownOpacity}SetOwnOpacity(e){this._ownOpacity=e}_GetStartWidth(){return 0===this._startWidth?Number.EPSILON:this._startWidth}_GetStartHeight(){return 0===this._startHeight?Number.EPSILON:this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){var t=this._parent;let e=t.GetWidth();var r=t._GetSceneGraphInfo()._GetStartWidth();if(0===e&&(e=Number.EPSILON),r===Number.EPSILON&&e===Number.EPSILON)return 1;if(r===Number.EPSILON&&e!==Number.EPSILON){t=t.GetInstance().GetSdkInstance();if(t.IsOriginalSizeKnown())return 1+e/t.GetOriginalWidth()}return e/r}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){var t=this._parent;let e=t.GetHeight();var r=t._GetSceneGraphInfo()._GetStartHeight();if(0===e&&(e=Number.EPSILON),r===Number.EPSILON&&e===Number.EPSILON)return 1;if(r===Number.EPSILON&&e!==Number.EPSILON){t=t.GetInstance().GetSdkInstance();if(t.IsOriginalSizeKnown())return 1+e/t.GetOriginalHeight()}return e/r}return 1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJsonProperties(){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,sy:this._startScaleY,psa:this._parentStartAngle,oo:this._ownOpacity,so:this._startOpacity,pi:this._owner.GetInstance().GetIndexInParent()}}_SaveToJson(e,t=null){var r=this._SaveToJsonProperties();return t&&t.selfOnly?Object.assign(r,{p:null,c:[]}):Object.assign(r,{p:this._GetParentJson(e),c:this._GetChildrenJson(e)})}_GetFlagsString(e){let t="";return e.GetTransformWithParentX()&&(t+="x"),e.GetTransformWithParentY()&&(t+="y"),e.GetTransformWithParentWidth()&&(t+="w"),e.GetTransformWithParentHeight()&&(t+="h"),e.GetTransformWithParentAngle()&&(t+="a"),e.GetTransformWithParentZElevation()&&(t+="z"),e.GetDestroyWithParent()&&(t+="d"),e.GetTransformWithParentOpacity()&&(t+="o"),e.GetTransformWithParentVisibility()&&(t+="v"),t}_GetParentJson(e){return!this._parent||!this._parent.GetInstance()||this._parent.GetInstance().IsDestroyed()?null:this._GetInstanceJson(this._parent,this._owner,e)}_GetChildrenJson(t){return this._children.map(e=>this._GetInstanceJson(e,e,t)).filter(e=>e)}_GetInstanceJson(e,t,r){var i,e=e.GetInstance();return e&&e.IsDestroyed()?null:((i={}).uid=e.GetUID(),i.f=this._GetFlagsString(t),i.offsets=t._SaveSceneGraphPropertiesToJson(),i.data=C33.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(e),i.oci=e.GetObjectClass().GetIndex(),"state"===r?(i.inst=e.SaveToJson("full",{selfOnly:!0}),i.instIndex=NaN):(i.instIndex=e.GetObjectClass().GetInstances().indexOf(e),i.inst=null),i)}_LoadFromJson(e){this._startWidth=e.sw,this._startHeight=e.sh,this._startScaleX=e.sx,this._startScaleY=e.sy,this._parentStartAngle=e.psa,this._ownOpacity=e.oo,this._startOpacity=e.so,this._indexInParent=C33.IsFiniteNumber(e.pi)?e.pi:NaN}_SetTmpSceneGraphChildren(e,t){if(!e&&!t&&this._tmpSceneGraphChildren)for(var r of this._tmpSceneGraphChildren)r.IsDestroyed()||r.HasParent()||r.GetRuntime().DestroyInstance(r);this._tmpSceneGraphChildren=e,this._tmpSceneGraphChildrenIndexes=t}_OnAfterLoad(e,t){var r,i,s,a,n=this._owner,o=n.GetRuntime(),l=new Set,h=(e.p&&!this._parent&&(r=e.p.uid,r=o.GetInstanceByUID(r),t?.setFromJson,r?(i=r.GetWorldInfo(),r.HasChild(n.GetInstance())?this._parent=i:(r.HasChildWithUID(n.GetInstance().GetUID())?o.DestroyInstance(n.GetInstance()):r.AddChild(n.GetInstance(),this._GetFlagsObj(e.p.f)),l.has(n)||(n._LoadSceneGraphPropertiesFromJson(e.p.offsets),this._LoadInstancePropertiesFromJson(r,e.p,t)),l.add(n),r.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())):C33.IsFiniteNumber(e.p.oci)&&(i=o.GetObjectClassByIndex(e.p.oci),o.GetSystemPlugin(),r=o.CreateInstance(i,n.GetLayer(),0,0,!0),t?.setFromJson,r)&&(i=this._GetInstanceData(e.p,o),r.LoadFromJson(i),r.GetWorldInfo().GetLayer().SortAndAddInstancesByZIndex(r),r.AddChild(n.GetInstance(),this._GetFlagsObj(e.p.f)),r.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())),[]);for(s of e.c){var u=s.uid,u=o.GetInstanceByUID(u);u&&h.push(u)}let c=0;for(a of e.c){var _=a.uid,_=o.GetInstanceByUID(_);if(t?.setFromJson,_){if(this._tmpSceneGraphChildren){if(this._tmpSceneGraphChildren.includes(_)){var d=_;if(d.GetObjectClass()!==_.GetObjectClass()){c++;continue}if(d.IsDestroyed()){c++;continue}var p=e.c[c];if(!t?.setFromJson&&this._HasAllChildrenOfType(d,h,n)){this._UpdateInstance(c,p,n,l,t),c++;continue}if(d.HasParent()&&d.GetParent()!==n.GetInstance()){var m=this._CreateNewChildInstance(p,t);this._AddAndSetChildInstance(m,p,l,t),c++;continue}this._AddAndSetChildInstance(d.GetWorldInfo(),p,l,t,!0),c++;continue}if(this._tmpSceneGraphChildren[c]){m=this._tmpSceneGraphChildren[c];if(m.GetObjectClass()!==_.GetObjectClass()){c++;continue}if(m.IsDestroyed()){c++;continue}d=e.c[c];if(!t?.setFromJson&&this._HasAllChildrenOfType(m,h,n)){this._UpdateInstance(c,d,n,l,t),c++;continue}if(m.HasParent()&&m.GetParent()!==n.GetInstance()){p=this._CreateNewChildInstance(d,t);this._AddAndSetChildInstance(p,d,l,t),c++;continue}this._AddAndSetChildInstance(m.GetWorldInfo(),d,l,t,!0),c++;continue}}var g=_.GetObjectClass();if(this._GetInstancesOfObjectClassCount(h,g)===n.GetInstance().GetChildrenOfObjectClass(g).length){g=n.GetInstance().GetChildAt(c);g&&(f=g.GetWorldInfo())&&(l.has(f)||(f._LoadSceneGraphPropertiesFromJson(a.offsets),this._LoadInstancePropertiesFromJson(g,a,t)),l.add(f)),c++;continue}if(_.HasParent()&&_.GetParent()!==n.GetInstance()){g=this._CreateNewChildInstance(a,t);this._AddAndSetChildInstance(g,a,l,t),c++;continue}this._AddAndSetChildInstance(_.GetWorldInfo(),a,l,t)}else if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[c]){var f=this._tmpSceneGraphChildren[c],g=o.GetObjectClassByIndex(this._GetObjectClassIndex(a));if(f.GetObjectClass()!==g){c++;continue}if(f.IsDestroyed()){c++;continue}_=e.c[c];if(!t?.setFromJson&&this._HasAllChildrenOfType(f,h,n)){this._UpdateInstance(c,_,n,l,t),c++;continue}if(f.HasParent()&&f.GetParent()!==n.GetInstance()){var S=this._CreateNewChildInstance(_,t);this._AddAndSetChildInstance(S,_,l,t),c++;continue}this._AddAndSetChildInstance(f.GetWorldInfo(),_,l,t)}else{S=this._CreateNewChildInstance(a,t);this._AddAndSetChildInstance(S,a,l,t)}c++}}_HasAllChildrenOfType(e,t,r){e=e.GetObjectClass();return this._GetInstancesOfObjectClassCount(t,e)===r.GetInstance().GetChildrenOfObjectClass(e).length}_UpdateInstance(e,t,r,i,s){r=r.GetInstance().GetChildAt(e,t);r&&(e=r.GetWorldInfo())&&(i.has(e)||(e._LoadSceneGraphPropertiesFromJson(t.offsets),this._LoadInstancePropertiesFromJson(r,t,s)),i.add(e))}_GetFlagsObj(e){var t={};return t.transformX=e.includes("x"),t.transformY=e.includes("y"),t.transformWidth=e.includes("w"),t.transformHeight=e.includes("h"),t.transformAngle=e.includes("a"),t.transformZElevation=e.includes("z"),t.destroyWithParent=e.includes("d"),t.transformOpacity=e.includes("o"),t.transformVisibility=e.includes("v"),t}_GetObjectClassIndex(e){return C33.IsFiniteNumber(e.oci)?e.oci:e[1]}_CreateNewChildInstance(t,r){if(C33.IsFiniteNumber(t.oci)){var i,s=this._owner,a=s.GetRuntime();let e;if(e=t.data?a.CreateInstanceFromData(t.data,s.GetLayer(),!1,0,0,!1,!0):(i=a.GetObjectClassByIndex(t.oci),a.CreateInstance(i,s.GetLayer(),0,0,!0)),r?.setFromJson,e)return i=this._GetInstanceData(t,a),e.LoadFromJson(i),(s=e.GetWorldInfo()).GetLayer().SortAndAddInstancesByZIndex(e,!0),s}}_AddAndSetChildInstance(e,t,r,i,s=!0){this._owner.AddChild(e,this._GetFlagsObj(t.f))&&s&&(r.has(e)||(e._LoadSceneGraphPropertiesFromJson(t.offsets),this._LoadInstancePropertiesFromJson(e.GetInstance(),t,i)),r.add(e)),this._MaybeSortChildren()}_LoadInstancePropertiesFromJson(e,t,r){t=this._GetInstanceData(t,this._owner.GetRuntime());t&&((t=JSON.parse(JSON.stringify(t))).w=null,e.LoadFromJson(t))}_GetInstancesOfObjectClassCount(e,t){return e.filter(e=>e.GetObjectClass().GetName()===t.GetName()).length}_GetInstanceData(e,t){return C33.IsFiniteNumber(e.instIndex)?t.GetObjectClassByIndex(e.oci)._GetLoadInstancesJson()[e.instIndex]:C33.IsString(e.inst)?JSON.parse(e.inst):e.inst||void 0}static GetSceneGraphInstanceDataFromInstance(e){if(!(r=e.GetWorldInfo().GetLayer().GetInitialInstanceData(e.GetUID())))return null;var t,r=JSON.parse(JSON.stringify(r)),i=[];for(t of[...e.GetChildren()]){var s=t.GetWorldInfo();i.push([s.GetLayout().GetSID(),s.GetLayer().GetIndex(),t.GetUID(),C33.SceneGraphInfo._GetFlagsNumber(s),t.GetObjectClass().IsInContainer()?1:0,s.GetZIndex(),C33.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(t)])}return C33.IsArray(r[0][14])?r[0][14][1]=i:(r[0][14]=[],r[0][14][0]=C33.SceneGraphInfo._GetDefaultFlagsNumber(),r[0][14][1]=i,r[0][14][2]=e.GetWorldInfo().GetZIndex()),r}static _GetFlagsNumber(e){var t=0;return(t|=Number(e.GetTransformWithParentVisibility())<<8)|Number(e.GetTransformWithParentOpacity())<<7|Number(e.GetTransformWithParentZElevation())<<6|Number(e.GetDestroyWithParent())<<5|Number(e.GetTransformWithParentAngle())<<4|Number(e.GetTransformWithParentHeight())<<3|Number(e.GetTransformWithParentWidth())<<2|Number(e.GetTransformWithParentY())<<1|Number(e.GetTransformWithParentX())<<0}static _GetDefaultFlagsNumber(e){var t=0;t|=256;return 511}}}{let C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad),bboxChangeEvent=C33.New(C33.Event,"bboxchange",!1),tempColor=C33.New(C33.Color,0,0,0,0),tempCollisionPoly=C33.New(C33.CollisionPoly),DEFAULT_COLOR=C33.New(C33.Color,1,1,1,1),DEFAULT_RENDER_CELLS=C33.New(C33.Rect,0,0,-1,-1),DEFAULT_COLLISION_CELLS=C33.New(C33.Rect,0,0,-1,-1),VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]),EMPTY_ARRAY=[],enableUpdateRendererStateGroup=!0,FLAG_IS_VISIBLE=1,FLAG_BBOX_CHANGED=2,FLAG_ENABLE_BBOX_CHANGED_EVENT=4,FLAG_COLLISION_ENABLED=8,FLAG_COLLISION_CELL_CHANGED=16,FLAG_SOLID_FILTER_INCLUSIVE=32,FLAG_HAS_ANY_ACTIVE_EFFECT=64,FLAG_IS_ROTATABLE=128,FLAG_DESTROYED=256,FLAG_DESTROY_WITH_PARENT=512,FLAG_TRANSFORM_WITH_PARENT_X=1024,FLAG_TRANSFORM_WITH_PARENT_Y=2048,FLAG_TRANSFORM_WITH_PARENT_W=4096,FLAG_TRANSFORM_WITH_PARENT_H=8192,FLAG_TRANSFORM_WITH_PARENT_A=16384,FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=32768,FLAG_TRANSFORM_WITH_PARENT_OPACITY=1<<22,FLAG_TRANSFORM_WITH_PARENT_VISIBILITY=1<<23,MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION|FLAG_TRANSFORM_WITH_PARENT_OPACITY|FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,FLAG_MESH_CHANGED=65536,FLAG_PHYSICS_BODY_CHANGED=1<<17,FLAG_SIN_COS_ANGLE_CHANGED=1<<18,FLAG_USE_POINTS_SHADER_PROGRAM=1<<19,FLAG_DRAW_BACK_FACE_ONLY=1<<20,FLAG_DRAW_NON_BACK_FACES_ONLY=1<<21,FLAG_BLEND_MODE_BIT_OFFSET=26,FLAG_BLEND_MODE_MASK=31<<FLAG_BLEND_MODE_BIT_OFFSET,sceneGraphExportDataMap=new WeakMap,sceneGraphZIndexMap=new WeakMap;C33.WorldInfo=class WorldInfo extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=e.GetObjectClass(),this._runtime=e.GetRuntime(),this._layer=t,this._objectClass._OnWorldInstanceLayerChanged(this,null,t),this._zIndex=-1,this._htmlZIndex=-1,this._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED,this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=FLAG_IS_ROTATABLE),this._x=NaN,this._y=NaN,this._zElevation=NaN,this._w=NaN,this._h=NaN,this._depth=NaN,this._a=NaN,this._sinA=NaN,this._cosA=NaN,this._ox=NaN,this._oy=NaN,this._boundingBox=C33.New(C33.Rect),this._boundingQuad=C33.New(C33.Quad),this._collisionCells=DEFAULT_COLLISION_CELLS,this._renderCells=DEFAULT_RENDER_CELLS,this._sourceCollisionPoly=null,this._transformedPolyInfo=null,this._solidFilterTags=null,this._color=DEFAULT_COLOR,this._colorPremultiplied=DEFAULT_COLOR,this._stateGroup=null,this._instanceEffectList=null,this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=C33.New(C33.InstanceEffectList,this._inst,this)),this._sceneGraphInfo=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._tmpHierarchyPosition=-1,this._meshInfo=null}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}Release(){var e;if(this._objectClass._OnWorldInstanceLayerChanged(this,this._layer,null),this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null),this._sourceCollisionPoly=null,this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null),this._solidFilterTags&&(this._solidFilterTags.clear(),this._solidFilterTags=null),this.ReleaseMesh(),this._instanceEffectList&&this._instanceEffectList.Release(),this.HasParent()&&this.GetParent().RemoveChild(this),this.HasChildren())for(e of[...this.GetChildren()])this.RemoveChild(e);this._ReleaseSceneGraphInfo(),this._ReleaseTmpSceneGraphInfo(),sceneGraphExportDataMap.delete(this),sceneGraphZIndexMap.delete(this),this._inst=null,this._objectClass=null,this._runtime=null,this._layer=null}Init(e){if(enableUpdateRendererStateGroup=!1,this.SetXY(e[0],e[1]),this.SetZElevation(e[2]),this.SetSize(e[3],e[4]),this._depth=0,this.IsRotatable()?this.SetAngle(e[6]):this._a=0,tempColor.setFromJSON(e[7]),this._SetColor(tempColor),this.SetOriginX(e[8]),this.SetOriginY(e[9]),this.SetBlendMode(e[10]),this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(e[12]),e[14]&&sceneGraphExportDataMap.set(this,{childrenData:e[14][1],zIndexData:e[14][2]}),e[15]){var t=e[15],i=(this.CreateMesh(t[0],t[1]),this.GetSourceMesh()),s=t[2];for(let r=0,e=s.length;r<e;++r){var a=s[r];for(let e=0,t=a.length;e<t;++e){var n=a[e],o=i.GetMeshPointAt(e,r);o.SetX(n[0]),o.SetY(n[1]),o.SetZElevation(n[2]),o.SetU(n[3]),o.SetV(n[4])}}}var r,l,h;e[16]&&(t=e[16][0],l=!(r=!!(e=e[16][1])),h=this._runtime.GetTemplateManager(),r&&h&&h.MapInstanceToTemplateName(this.GetInstance(),e),l)&&h&&h.MapInstanceToTemplateName(this.GetInstance(),t),enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup()}InitNoData(){this._x=0,this._y=0,this._zElevation=0,this._w=0,this._h=0,this._depth=0,this._a=0,this._sinA=0,this._cosA=1,this._ox=0,this._oy=0,this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this._MaybeReflectAngleForMirrorFlip(this.GetParent()._GetAngleNoReflect()-this._sceneGraphInfo.GetParentStartAngle()):0}SetX(e){var t,r,i;e=+e,this.GetTransformWithParentX()?(t=this._sceneGraphInfo,r=e-this.GetX(),0==(i=-this._GetParentOffsetAngle())?this._x+=r/t.GetParentScaleX():(this._x+=Math.cos(i)*r/t.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(i)*r/t.GetParentScaleY()))):this._x=e}OffsetX(e,t=!1){e=+e,!t&&this.GetTransformWithParentX()?this.SetX(this.GetX()+e):this._x+=e}GetX(){if(this.GetTransformWithParentX()){let e=this._x;var t=this._sceneGraphInfo,r=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleX():(e=e*t.GetParentScaleX()*Math.cos(i),this.GetTransformWithParentY()&&(e-=this._y*t.GetParentScaleY()*Math.sin(i))),r.GetX()+e}return this._x}SetY(e){var t,r,i;e=+e,this.GetTransformWithParentY()?(t=this._sceneGraphInfo,r=e-this.GetY(),0==(i=-this._GetParentOffsetAngle())?this._y+=r/t.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(i)*r/t.GetParentScaleX()),this._y+=Math.cos(i)*r/t.GetParentScaleY())):this._y=e}OffsetY(e,t=!1){e=+e,!t&&this.GetTransformWithParentY()?this.SetY(this.GetY()+e):this._y+=e}GetY(){if(this.GetTransformWithParentY()){let e=this._y;var t=this._sceneGraphInfo,r=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleY():(e=e*t.GetParentScaleY()*Math.cos(i),this.GetTransformWithParentX()&&(e+=this._x*t.GetParentScaleX()*Math.sin(i))),r.GetY()+e}return this._y}SetXY(e,t){var r,i,s,a,n,o,l;e=+e,t=+t,this.GetTransformWithParentXOrY()?(r=this.GetTransformWithParentX(),i=this.GetTransformWithParentY(),s=this._sceneGraphInfo,a=e-this.GetX(),n=t-this.GetY(),0==(l=-this._GetParentOffsetAngle())?(r?this._x+=a/s.GetParentScaleX():this._x=e,i?this._y+=n/s.GetParentScaleY():this._y=t):(o=Math.sin(l),l=Math.cos(l),r?this._x+=i?(l*a-o*n)/s.GetParentScaleX():l*a/s.GetParentScaleX():this._x=e,i?this._y+=r?(o*a+l*n)/s.GetParentScaleY():l*n/s.GetParentScaleY():this._y=t)):(this._x=e,this._y=t)}GetXY(){return[this.GetX(),this.GetY()]}OffsetXY(e,t){e=+e,t=+t,this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+e,this.GetY()+t):(this._x+=e,this._y+=t)}EqualsXY(e,t){return this.GetX()===e&&this.GetY()===t}SetZElevation(e){e=+e,this.GetTransformWithParentZElevation()&&(e-=this.GetParent().GetZElevation()),this._zElevation!==e&&(this._zElevation=e,this._UpdateZElevation(),e=this.GetLayer(),0!==this._zElevation&&e._SetAnyInstanceZElevated(),e.SetZIndicesChanged(this))}_UpdateZElevation(){if(this._UpdateRendererStateGroup(),this.HasChildren()){var r=this.GetChildren();for(let e=0,t=r.length;e<t;e++){var i=r[e];i.GetTransformWithParentZElevation()&&i._UpdateZElevation()}}}OffsetZElevation(e){this.SetZElevation(this.GetZElevation()+e)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(e){var t;e=+e,this.GetTransformWithParentWidth()?0===(t=this.GetWidth())?this._w=Number.EPSILON:this._w*=e/t:this._w=e,this._MarkSinCosAngleChanged()}OffsetWidth(e,t){e=+e,!t&&this.GetTransformWithParentWidth()?this.SetWidth(this.GetWidth()+e):this._w+=e,this._MarkSinCosAngleChanged()}GetWidth(){var e,t;return this.GetTransformWithParentWidth()?(t=(e=this.GetParent()).GetWidth(),e._GetSceneGraphInfo()._GetStartWidth()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartWidth()+t)*this._w:t*this._w):this._w}SetHeight(e){var t;e=+e,this.GetTransformWithParentHeight()?0===(t=this.GetHeight())?this._h=Number.EPSILON:this._h*=e/t:this._h=e,this._MarkSinCosAngleChanged()}OffsetHeight(e,t){e=+e,!t&&this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+e):this._h+=e,this._MarkSinCosAngleChanged()}GetHeight(){var e,t;return this.GetTransformWithParentHeight()?(t=(e=this.GetParent()).GetHeight(),e._GetSceneGraphInfo()._GetStartHeight()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartHeight()+t)*this._h:t*this._h):this._h}SetSize(e,t){var r;e=+e,t=+t,this.GetTransformWithParentWidth()?0===(r=this.GetWidth())?this._w=Number.EPSILON:this._w*=e/r:this._w=e,this.GetTransformWithParentHeight()?0===(r=this.GetHeight())?this._h=Number.EPSILON:this._h*=t/r:this._h=t,this._MarkSinCosAngleChanged()}GetSize(){return[this.GetWidth(),this.GetHeight()]}GetDepth(){return this._depth}SetDepth(e){if(e<0)throw new RangeError("invalid depth");this._depth=e}GetSceneGraphScale(){var e;return this.HasParent()?(e=this._sceneGraphInfo,Math.min(e.GetParentScaleX(),e.GetParentScaleY())):1}IsRotatable(){return 0!=(this._flags&FLAG_IS_ROTATABLE)}SetAngle(e){e=+e,this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(e-=this.GetParent().GetAngle()),e=C33.clampAngle(e),this._a!==e)&&(this._a=e,this._MarkSinCosAngleChanged())}OffsetAngle(e){0!==(e=+e)&&this.IsRotatable()&&(this._a=C33.clampAngle(this._a+e),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){if(this._flags|=FLAG_SIN_COS_ANGLE_CHANGED,this.HasChildren()){var r=this.GetChildren();for(let e=0,t=r.length;e<t;e++)r[e]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()&&this.IsRotatable()?this._MaybeReflectAngleForMirrorFlip(C33.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a)):this._a}_GetAngleNoReflect(){return this.GetTransformWithParentAngle()&&this.IsRotatable()?C33.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a):this._a}_MaybeReflectAngleForMirrorFlip(e){return this.GetTransformWithParentWidth()&&this.GetTopParent().GetWidth()<0&&(e=C33.clampAngle(C33.angleReflect(e,this.GetTopParent().GetAngle()+Math.PI))),e=this.GetTransformWithParentHeight()&&this.GetTopParent().GetHeight()<0?C33.angleReflect(e,this.GetTopParent().GetAngle()):e}_NeedsReflectAngleForMirrorOrFlip(){var e=this.GetParent();return!!(this.GetTransformWithParentWidth()&&e.GetWidth()<0)||!!(this.GetTransformWithParentHeight()&&e.GetHeight()<0)}_NeedsReflectAngleForMirrorAndFlip(){var e=this.GetParent();return!!(this.GetTransformWithParentWidth()&&e.GetWidth()<0&&this.GetTransformWithParentHeight()&&e.GetHeight()<0)}_MaybeUpdateSinCosAngle(){var e,t=this._flags;0!=(t&FLAG_SIN_COS_ANGLE_CHANGED)&&(e=this.GetAngle(),this._sinA=Math.sin(e),this._cosA=Math.cos(e),this._flags=t&~FLAG_SIN_COS_ANGLE_CHANGED)}GetSinAngle(){return this._MaybeUpdateSinCosAngle(),this._sinA}GetCosAngle(){return this._MaybeUpdateSinCosAngle(),this._cosA}SetOriginX(e){this._ox=+e}OffsetOriginX(e){this._ox+=+e}GetOriginX(){return this._ox}SetOriginY(e){this._oy=+e}OffsetOriginY(e){this._oy+=+e}GetOriginY(){return this._oy}_SetColor(e){this._color.equals(e)||(this._color===DEFAULT_COLOR?(this._color=C33.New(C33.Color,e),this._colorPremultiplied=C33.New(C33.Color,e),this._colorPremultiplied.premultiply()):e.equalsRgba(1,1,1,1)?(this._color=DEFAULT_COLOR,this._colorPremultiplied=DEFAULT_COLOR):(this._color.set(e),this._colorPremultiplied.set(e),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(e){if(e=C33.clamp(+e,0,1),this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===e)return;this._GetSceneGraphInfo().SetOwnOpacity(e),e=this.GetOpacity()}else if(this._color.a===e)return;this._SetColorWithOpacity(e)}_SetOpacityOfChildren(){if(this.HasChildren()){var r=this.GetChildren();for(let e=0,t=r.length;e<t;e++){var i=r[e];i._SetColorWithOpacity(i.GetOpacity())}}}_SetColorWithOpacity(e){tempColor.copyRgb(this._color),tempColor.a=e,this._SetColor(tempColor),this._SetOpacityOfChildren()}OffsetOpacity(e){this.GetTransformWithParentOpacity()?this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+e):this.SetOpacity(this.GetOpacity()+e)}GetOpacity(){return this.GetTransformWithParentOpacity()?this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity():this._color.a}SetUnpremultipliedColor(e){this._color.equalsIgnoringAlpha(e)||(tempColor.copyRgb(e),tempColor.a=this.GetOpacity(),this._SetColor(tempColor))}SetUnpremultipliedColorRGB(e,t,r){tempColor.setRgb(e,t,r),this.SetUnpremultipliedColor(tempColor)}OffsetUnpremultipliedColorRGB(e,t,r){0===e&&0===t&&0===r||(tempColor.copyRgb(this._color),tempColor.r+=e,tempColor.g+=t,tempColor.b+=r,this.SetUnpremultipliedColor(tempColor))}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!=(this._flags&FLAG_DESTROY_WITH_PARENT)}SetDestroyWithParent(e){this._SetFlag(FLAG_DESTROY_WITH_PARENT,e)}GetTransformWithParentX(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)}SetTransformWithParentX(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,e)}GetTransformWithParentY(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)}GetTransformWithParentXOrY(){return 0!=(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))}SetTransformWithParentY(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,e)}GetTransformWithParentWidth(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)}SetTransformWithParentWidth(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,e)}GetTransformWithParentHeight(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)}SetTransformWithParentHeight(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,e)}GetTransformWithParentAngle(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)}SetTransformWithParentAngle(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,e)}GetTransformWithParentZElevation(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)}SetTransformWithParentZElevation(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,e)}GetTransformWithParentOpacity(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_OPACITY)}SetTransformWithParentOpacity(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_OPACITY,e)}GetTransformWithParentVisibility(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_VISIBILITY)}SetTransformWithParentVisibility(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,e)}_ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS}AddChild(e,t){var r,i,s,a,n,o,l;return e!==this&&!(e.HasParent()||this._HasChildRecursive(e)||this._HasAnyParent(e)||(l=e.GetX(),o=e.GetY(),r=e.GetWidth(),i=e.GetHeight(),s=e.GetAngle(),a=e.GetZElevation(),n=e.GetOpacity(),e._SetParent(this),e.SetTransformWithParentX(t.transformX),e.SetTransformWithParentY(t.transformY),e.SetTransformWithParentWidth(t.transformWidth),e.SetTransformWithParentHeight(t.transformHeight),e.SetTransformWithParentAngle(t.transformAngle),e.SetTransformWithParentZElevation(t.transformZElevation),e.SetTransformWithParentOpacity(t.transformOpacity),e.SetTransformWithParentVisibility(t.transformVisibility),e.SetDestroyWithParent(t.destroyWithParent),t.transformX&&(e._x=l-this.GetX(),t.transformWidth)&&0!=(l=this.GetWidth()/this._sceneGraphInfo._GetStartWidth())&&(e._x/=l),t.transformY&&(e._y=o-this.GetY(),t.transformHeight)&&0!=(l=this.GetHeight()/this._sceneGraphInfo._GetStartHeight())&&(e._y/=l),t.transformWidth&&(0===(o=this.GetWidth())||o===Number.EPSILON?(e._w=1,e._sceneGraphInfo.SetStartScaleX(1)):(e._w=r/this.GetWidth(),e._sceneGraphInfo.SetStartScaleX(e._w))),t.transformHeight&&(0===(l=this.GetHeight())||l===Number.EPSILON?(e._h=1,e._sceneGraphInfo.SetStartScaleY(1)):(e._h=i/this.GetHeight(),e._sceneGraphInfo.SetStartScaleY(e._h))),t.transformAngle&&(e._a=s-this.GetAngle()),t.transformZElevation&&(e._zElevation=a-this.GetZElevation()),t.transformOpacity&&e._sceneGraphInfo.SetOwnOpacity(n),t.transformVisibility&&e.SetVisible(this.IsVisible()),this._AddChildToSceneGraphInfo(e),this.SetBboxChanged(),this._SetOpacityOfChildren(),0))}RemoveChild(e){var t,r,i,s,a,n,o;e.GetParent()===this&&(t=e.GetX(),r=e.GetY(),i=e.GetWidth(),s=e.GetHeight(),a=e.GetAngle(),n=e.GetZElevation(),o=e.GetOpacity(),e._SetParent(null),e._ClearAllSceneGraphFlags(),e.SetXY(t,r),e.SetSize(i,s),e.SetAngle(a),e.SetZElevation(n),e.SetOpacity(o),this._RemoveChildFromSceneGraphInfo(e),this.SetBboxChanged())}GetTmpHierarchyPosition(){return this._tmpHierarchyPosition}_ResetAllSceneGraphState(){var e;this._BuildTmpSceneGraphData();for(e of[...this.children()])this.RemoveChild(e);var t=this.GetParent();t&&t.RemoveChild(this),this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphData(){if(this._SetTmpHierarchyPosition(),!this._tmpSceneGraphChildren){var t,r=[...this.children()];r.length&&(this._tmpSceneGraphChildren=[],this._tmpSceneGraphChildrenIndexes=new WeakMap);let e=0;for(t of r){var i=t.GetInstance();this._tmpSceneGraphChildren.push(i),this._tmpSceneGraphChildrenIndexes.set(i,e),e++}}r=this.GetParent();r&&r._BuildTmpSceneGraphData()}_SetTmpHierarchyPosition(){if(-1===this._tmpHierarchyPosition){var e,t,r=[...this.parents()];this._tmpHierarchyPosition=r.length;for(e of r)e._SetTmpHierarchyPosition();for(t of[...this.children()])t._SetTmpHierarchyPosition()}}_ReleaseTmpSceneGraphInfo(){this._tmpSceneGraphChildren&&(this._tmpSceneGraphChildren.length=0),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null;var e=this.GetParent();e&&e._ReleaseTmpSceneGraphInfo(),this._tmpHierarchyPosition=-1}HasParent(){return null!==this.GetParent()}GetParent(){var e=this._sceneGraphInfo;return null!==e?e.GetParent():null}GetTopParent(){let e=this;for(;e.HasParent();)e=e.GetParent();return e}*parents(){let e=this.GetParent();for(;e;)yield e,e=e.GetParent()}HasChild(e){return this.GetChildren().includes(e)}HasChildren(){var e=this._sceneGraphInfo;return null!==e&&e.HasChildren()}GetChildren(){var e=this._sceneGraphInfo;return null!==e?e.GetChildren():EMPTY_ARRAY}children(){return this.GetChildren()}*allChildren(){for(var e of this.children())yield e,yield*e.allChildren()}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(e){var t=this.GetChildren();return(e=Math.floor(+e))<0||e>=t.length?null:t[e]}GetChildIndex(t){if(t){var r=this.GetChildren();if(r)for(let e=0;e<r.length;e++)if(t===r[e])return e}return NaN}_CreateSceneGraphInfo(e){this._sceneGraphInfo||(this._sceneGraphInfo=C33.New(C33.SceneGraphInfo,this)),e&&this._sceneGraphInfo.SetParent(e)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(e){e?(e._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(e)):(this._sceneGraphInfo&&this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(e){var t;return!!this.HasParent()&&((t=this.GetParent())===e||t._HasAnyParent(e))}_HasChildRecursive(e){if(this.HasChild(e))return!0;for(var t of this.GetChildren())if(t._HasChildRecursive(e))return!0;return!1}_AddChildToSceneGraphInfo(e){this._sceneGraphInfo.GetChildren().push(e)}_RemoveChildFromSceneGraphInfo(e){var t=this._sceneGraphInfo.GetChildren(),r=t.indexOf(e);-1!==r&&t.splice(r,1),0!==t.length||this.HasParent()||this._ReleaseSceneGraphInfo(),e.HasChildren()||e._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){var e=sceneGraphExportDataMap.get(this);return e?e.childrenData:null}GetSceneGraphZIndexExportData(){var e=sceneGraphExportDataMap.get(this);return e?e.zIndexData:NaN}GetSceneGraphZIndex(){var e=sceneGraphZIndexMap.get(this);return C33.IsFiniteNumber(e)?e:NaN}SetSceneGraphZIndex(e){sceneGraphZIndexMap.set(this,e)}SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,!0),this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(enableUpdateRendererStateGroup){var t=this._runtime.GetRenderer();this._stateGroup&&t.ReleaseStateGroup(this._stateGroup);let e;e=0!=(this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)?t.GetPointsRenderingProgram()||"<point>":t.GetTextureFillShaderProgram()||"<default>",this._stateGroup=t.AcquireStateGroup(e,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===DEFAULT_COLOR}SetBlendMode(e){if((e|=0)<0||31<e)throw new RangeError("invalid blend mode");this.GetBlendMode()!==e&&(this._flags=this._flags&~FLAG_BLEND_MODE_MASK|e<<FLAG_BLEND_MODE_BIT_OFFSET,this._UpdateRendererStateGroup())}GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>FLAG_BLEND_MODE_BIT_OFFSET}_SetLayer(e,t){t=t&&this._layer!==e;t&&this._RemoveFromRenderCells(),this._objectClass._OnWorldInstanceLayerChanged(this,this._layer,e),this._layer=e,t&&this._UpdateRenderCell(),0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(e){this._zIndex=0|e}GetZIndex(){return this._layer._UpdateZIndices(),this._zIndex}_SetHTMLZIndex(e){this._htmlZIndex=0|e}GetHTMLZIndex(){return this._layer._UpdateHTMLZIndices(),this._htmlZIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(e,t){t?this._flags|=e:this._flags&=~e}IsVisible(){return 0!=(this._flags&FLAG_IS_VISIBLE)}SetVisible(e){if(this._SetFlag(FLAG_IS_VISIBLE,e),this.HasChildren())for(var t of this.GetChildren())t.GetTransformWithParentVisibility()&&t.SetVisible(e)}IsCollisionEnabled(){return 0!=(this._flags&FLAG_COLLISION_ENABLED)}SetCollisionEnabled(e){e=!!e,this.IsCollisionEnabled()!==e&&(this._SetFlag(FLAG_COLLISION_ENABLED,e),e?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(e,t){if(this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,e),this._solidFilterTags&&this._solidFilterTags.clear(),t.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(var r of t.split(" "))r&&this._solidFilterTags.add(r.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(e){var t=0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE),r=this._solidFilterTags;if(e&&r)for(var i of r)if(e.has(i))return t;return!t}SetBboxChanged(){if(this._flags|=FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED,this._objectClass._SetAnyCollisionCellChanged(!0),this._runtime.UpdateRender(),this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateRenderCell()),0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)&&this._inst.Dispatcher().dispatchEvent(bboxChangeEvent),null!==this._sceneGraphInfo){var r=this._sceneGraphInfo.GetChildren();for(let e=0,t=r.length;e<t;++e)r[e].SetBboxChanged()}}CalculateBbox(e,t,r){var i=this.GetX(),s=this.GetY(),a=this.GetWidth(),n=this.GetHeight(),o=this.GetAngle();e.setWH(i-this._ox*a,s-this._oy*n,a,n),r&&this.HasMesh()&&this._ExpandBboxForMesh(e),0===o?t.setFromRect(e):(e.offset(-i,-s),t.setFromRotatedRectPrecalc(e,this.GetSinAngle(),this.GetCosAngle()),t.offset(i,s),t.getBoundingBox(e)),e.normalize()}_UpdateBbox(){var e=this._flags;0!=(e&FLAG_BBOX_CHANGED)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=e&~FLAG_BBOX_CHANGED)}GetBoundingBox(){return this._UpdateBbox(),this._boundingBox}GetBoundingQuad(){return this._UpdateBbox(),this._boundingQuad}PixelRoundQuad(e){var t=this.GetX(),r=this.GetY(),t=Math.round(t)-t,r=Math.round(r)-r;return 0==t&&0==r?e:(tempQuad.copy(e),tempQuad.offset(t,r),tempQuad)}OverwriteBoundingBox(e){this._boundingBox.copy(e),this._boundingQuad.setFromRect(this._boundingBox),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateCollisionCell(),this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,e)}IsBboxChangeEventEnabled(){return 0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)}IsInViewport(e,t,r){return t&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||r?e.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){var e=this.GetLayer(),t=this.GetTotalZElevation();return!(t>=e.Get2DCameraZ())&&(e.GetViewportForZ(t,tempRect),tempRect.intersectsRect(this.GetBoundingBox()))}IsInViewport3D(e){var t=this.GetBoundingBox(),r=t.getLeft(),i=t.getRight(),s=t.getTop(),t=t.getBottom(),a=this.GetTotalZElevation(),n=a+this.GetDepth();return e.ContainsAABB(r,s,a,i,t,n)}IsInViewport2(){var e,t=this.GetLayer();return t.Has3DCamera()?this.IsInViewport3D(t._GetViewFrustum()):(e=t.GetLayout(),this.IsInViewport(t.GetViewport(),e.HasVanishingPointOutsideViewport(),e.IsOrthographicProjection()))}_SetDrawBackFaceOnly(e){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,e)}IsDrawBackFaceOnly(){return 0!=(this._flags&FLAG_DRAW_BACK_FACE_ONLY)}IsDrawNonBackFacesOnly(){return 0!=(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)}SetSourceCollisionPoly(e){this._sourceCollisionPoly=e,this._DiscardTransformedCollisionPoly(),this.HasMesh()&&(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(e,t,r){let i=0,s=1;return 0!==r&&(i=Math.sin(r),s=Math.cos(r)),this._GetCustomTransformedCollisionPolyPrecalc(e,t,r,i,s)}_GetCustomTransformedCollisionPolyPrecalc(t,r,e,i,s){let a=this._transformedPolyInfo;null===a&&(a={poly:C33.New(C33.CollisionPoly),width:NaN,height:NaN,angle:NaN},this._transformedPolyInfo=a);var n=a.poly;if(a.width!==t||a.height!==r||a.angle!==e){var o=this._sourceCollisionPoly;if(this.HasMesh()){var l=this.GetOriginX(),h=this.GetOriginY(),u=this.GetSourceMesh();let e=this._meshInfo.meshPoly;e||(o?(tempCollisionPoly.copy(o),tempCollisionPoly.offset(l,h)):tempCollisionPoly.setDefaultPoints(),e=u.InsertPolyMeshVertices(tempCollisionPoly),this._meshInfo.meshPoly=e),u.TransformCollisionPoly(e,n),n.offset(-l,-h),n.transformPrecalc(t,r,i,s)}else o?(n.copy(o),n.transformPrecalc(t,r,i,s)):n.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());a.width=t,a.height=r,a.angle=e}return n}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);var e=this._transformedPolyInfo;null!==e&&(e.width=NaN)}CreateMesh(e,t){if(e=Math.floor(e),t=Math.floor(t),!this.GetInstance().GetPlugin().SupportsMesh())throw new Error("object does not support mesh");this.ReleaseMesh(),this._meshInfo={sourceMesh:C33.New(C33.Gfx.Mesh,e,t),transformedMesh:C33.New(C33.Gfx.Mesh,e,t),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(this.HasMesh())return this._meshInfo.sourceMesh;throw new Error("no mesh")}GetTransformedMesh(){if(this.HasMesh())return this._meshInfo.transformedMesh;throw new Error("no mesh")}SetMeshChanged(e){this._SetFlag(FLAG_MESH_CHANGED,e)}IsMeshChanged(){return 0!=(this._flags&FLAG_MESH_CHANGED)}SetPhysicsBodyChanged(e){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,e)}IsPhysicsBodyChanged(){return 0!=(this._flags&FLAG_PHYSICS_BODY_CHANGED)}_ExpandBboxForMesh(e){var t=this._meshInfo.sourceMesh,r=Math.min(t.GetMinX(),0),i=Math.min(t.GetMinY(),0),s=Math.max(t.GetMaxX(),1),a=Math.max(t.GetMaxY(),1),n=e.width(),o=e.height();e.offsetLeft(r*n),e.offsetTop(i*o),e.offsetRight((s-1)*n),e.offsetBottom((a-1)*o),this._depth=t.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(e,t,r){e=Math.floor(e),t=Math.floor(t);var i=r.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(i))throw new Error("invalid mode");i="relative"===i;let s=r.x,a=r.y;var n=r.zElevation;let o="number"==typeof r.u?r.u:i?0:-1,l="number"==typeof r.v?r.v:i?0:-1;if(!this.HasMesh())return!1;var r=this.GetSourceMesh(),h=r.GetMeshPointAt(e,t);if(null===h)return!1;let u=!1;return"number"==typeof n&&h.GetZElevation()!==n&&(h.SetZElevation(n),u=!0),i&&(s+=e/(r.GetHSize()-1),a+=t/(r.GetVSize()-1)),o=-1!==o||i?(i&&(o+=e/(r.GetHSize()-1)),C33.clamp(o,0,1)):h.GetU(),l=-1!==l||i?(i&&(l+=t/(r.GetVSize()-1)),C33.clamp(l,0,1)):h.GetV(),h.GetX()===s&&h.GetY()===a&&h.GetU()===o&&h.GetV()===l?u:(h.SetX(s),h.SetY(a),h.SetU(o),h.SetV(l),this._DiscardTransformedCollisionPoly(),!0)}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(e,t){return!!this.GetBoundingBox().containsPoint(e,t)&&!!this.GetBoundingQuad().containsPoint(e,t)&&(this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(e,t):!this.HasOwnCollisionPoly()||this.GetTransformedCollisionPoly().containsPoint(e-this.GetX(),t-this.GetY()))}_IsCollisionCellChanged(){return 0!=(this._flags&FLAG_COLLISION_CELL_CHANGED)}_UpdateCollisionCell(){var e,t,r;this._IsCollisionCellChanged()&&this.IsCollisionEnabled()&&0==(this._flags&FLAG_DESTROYED)&&(r=this.GetBoundingBox(),e=this._objectClass._GetCollisionCellGrid(),t=this._collisionCells,tempRect.set(e.XToCell(r.getLeft()),e.YToCell(r.getTop()),e.XToCell(r.getRight()),e.YToCell(r.getBottom())),t.equals(tempRect)||(r=this._inst,t===DEFAULT_COLLISION_CELLS?(e.Update(r,null,tempRect),this._collisionCells=C33.New(C33.Rect,tempRect)):(e.Update(r,t,tempRect),t.copy(tempRect)),this._flags&=~FLAG_COLLISION_CELL_CHANGED))}_SetCollisionCellChanged(){this._flags|=FLAG_COLLISION_CELL_CHANGED}_RemoveFromCollisionCells(){var e=this._collisionCells;e!==DEFAULT_COLLISION_CELLS&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,e,null),this._collisionCells=DEFAULT_COLLISION_CELLS)}_UpdateRenderCell(){var e,t,r,i=this.GetLayer();i.UsesRenderCells()&&0==(this._flags&FLAG_DESTROYED)&&(e=i.GetRenderGrid(),r=this.GetBoundingBox(),t=this._renderCells,tempRect.set(e.XToCell(r.getLeft()),e.YToCell(r.getTop()),e.XToCell(r.getRight()),e.YToCell(r.getBottom())),t.equals(tempRect)||(r=this._inst,t===DEFAULT_RENDER_CELLS?(e.Update(r,null,tempRect),this._renderCells=C33.New(C33.Rect,tempRect)):(e.Update(r,t,tempRect),t.copy(tempRect)),i.SetRenderListStale()))}_RemoveFromRenderCells(){var e=this._renderCells;e!==DEFAULT_RENDER_CELLS&&(this.GetLayer().GetRenderGrid().Update(this._inst,e,null),this._renderCells=DEFAULT_RENDER_CELLS)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){var e=this._inst,t=this._layer,r=t._GetInstances();r.length&&r.at(-1)===e||(t._RemoveInstance(e,!1),t._AddInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){var e=this._inst,t=this._layer,r=t._GetInstances();r.length&&r[0]===e||(t._RemoveInstance(e,!1),t._PrependInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(e){var t=this._inst,r=this._layer;if(r.GetLayout()!==e.GetLayout())throw new Error("layer from different layout");e!==r&&(r._RemoveInstance(t,!0),this._SetLayer(e),e._AddInstance(t,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(e,t){var r=this._inst;let i=!1;var s=this._layer;if(e.GetUID()!==r.GetUID()){var a=e.GetWorldInfo();if(!a)throw new Error("expected world instance");a=a.GetLayer(),s=(s.GetIndex()!==a.GetIndex()&&(s._RemoveInstance(r,!0),this._SetLayer(a),a._AddInstance(r,!0),i=!0),a.MoveInstanceAdjacent(r,e,!!t));(i||s)&&this._runtime.UpdateRender()}}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,e)}HasAnyActiveEffect(){return 0!=(this._flags&FLAG_HAS_ANY_ACTIVE_EFFECT)}_SaveToJson(e,t=null){var r={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()},i=(0!==this.GetZElevation()&&(r.ze=this.GetZElevation()),0!==this.GetAngle()&&(r.a=this._GetAngleNoReflect()),this.HasDefaultColor()||(r.c=this._color.toJSON()),.5!==this.GetOriginX()&&(r.oX=this.GetOriginX()),.5!==this.GetOriginY()&&(r.oY=this.GetOriginY()),0!==this.GetBlendMode()&&(r.bm=this.GetBlendMode()),this.IsVisible()||(r.v=this.IsVisible()),this.IsCollisionEnabled()||(r.ce=this.IsCollisionEnabled()),this.IsBboxChangeEventEnabled()&&(r.be=this.IsBboxChangeEventEnabled()),this._instanceEffectList&&(r.fx=this._instanceEffectList._SaveToJson()),0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE));return i&&(r.sfi=i),this._solidFilterTags&&(r.sft=[...this._solidFilterTags].join(" ")),this._sceneGraphInfo&&"visual-state"!==e&&(r.sgi=this._sceneGraphInfo._SaveToJson(e,t),sceneGraphExportDataMap.has(this))&&(r.sgcd=sceneGraphExportDataMap.get(this).childrenData,r.sgzid=sceneGraphExportDataMap.get(this).zIndexData),this.HasMesh()&&(r.mesh=this.GetSourceMesh().SaveToJson()),r}_SaveSceneGraphPropertiesToJson(){return{x:this._x,y:this._y,z:this._zElevation,w:this._w,h:this._h,a:this._a,sgi:this._GetSceneGraphInfo()?this._GetSceneGraphInfo()._SaveToJsonProperties():null}}_LoadSceneGraphPropertiesFromJson(e){e&&(this._x=e.x,this._y=e.y,this._zElevation=e.z,this._w=e.w,this._h=e.h,this._a=e.a,e.sgi&&this._GetSceneGraphInfo()&&this._GetSceneGraphInfo()._LoadFromJson(e.sgi),this._MarkSinCosAngleChanged(),this.SetBboxChanged())}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo(),this._ResetAllSceneGraphState(),this._CreateSceneGraphInfo(null),this._sceneGraphInfo&&this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(e){"visual-state"!==e&&this._ResetAllSceneGraphState()}_OnAfterLoad(e,t="full",r=null){e.hasOwnProperty("sgi")&&"visual-state"!==t&&0==(this._flags&FLAG_DESTROYED)&&this._sceneGraphInfo._OnAfterLoad(e.sgi,r)}_OnAfterLoad2(e,t="full",r){e.hasOwnProperty("sgi")&&"visual-state"!==t&&0==(this._flags&FLAG_DESTROYED)&&(this._sceneGraphInfo._SetTmpSceneGraphChildren(null,null),this._ReleaseTmpSceneGraphInfo(),this.SetBboxChanged())}_LoadFromJson(e,t){if(enableUpdateRendererStateGroup=!1,this.SetX(e.x),this.SetY(e.y),this.SetWidth(e.w),this.SetHeight(e.h),this._SetZIndex(e.zi),this.SetZElevation(e.hasOwnProperty("ze")?e.ze:0),this.SetAngle(e.hasOwnProperty("a")?e.a:0),e.hasOwnProperty("c")?tempColor.setFromJSON(e.c):e.hasOwnProperty("o")?(tempColor.copyRgb(this._color),tempColor.a=e.o):tempColor.setRgba(1,1,1,1),this._SetColor(tempColor),this.SetOriginX(e.hasOwnProperty("oX")?e.oX:.5),this.SetOriginY(e.hasOwnProperty("oY")?e.oY:.5),this.SetBlendMode(e.hasOwnProperty("bm")?e.bm:0),this.SetVisible(!e.hasOwnProperty("v")||e.v),this.SetCollisionEnabled(!e.hasOwnProperty("ce")||e.ce),this.SetBboxChangeEventEnabled(!!e.hasOwnProperty("be")&&e.be),this.SetSolidCollisionFilter(!!e.hasOwnProperty("sfi")&&e.sfi,e.hasOwnProperty("sft")?e.sft:""),this._instanceEffectList&&e.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(e.fx),!e.hasOwnProperty("sgi")&&"visual-state"!==t&&this._tmpSceneGraphChildren)for(var r of this._tmpSceneGraphChildren)r.IsDestroyed()||this._runtime.DestroyInstance(r);var i,s;e.hasOwnProperty("sgi")&&"visual-state"!==t&&(this._CreateSceneGraphInfo(null),i=this._sceneGraphInfo,s=e.sgi,i._LoadFromJson(s),i._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes),e.sgcd)&&C33.IsFiniteNumber(e.sgzid)&&sceneGraphExportDataMap.set(this,{childrenData:e.sgcd,zIndexData:e.sgzid}),e.hasOwnProperty("mesh")?(s=e.mesh,this.CreateMesh(s.cols,s.rows),this.GetSourceMesh().LoadFromJson(s)):this.ReleaseMesh(),this.SetBboxChanged(),enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup(),"visual-state"!==t&&this._runtime.AddInstanceNeedingAfterLoad(this.GetInstance(),e)}}}{let C33=self.C3;C33.BehaviorType=class BehaviorType extends C33.DefendedBase{constructor(e,t){super();var r=e.GetRuntime(),i=r.GetObjectReference(t[1]),r=(r.GetAddonManager()._DelayCreateBehavior(i),this._runtime=r,this._objectClass=e,this._behavior=C33.AddonManager.GetBehaviorByConstructorFunction(i),this._sdkType=null,this._iBehaviorType=null,this._instSdkCtor=i.Instance,this._sid=t[2],this._name=t[0],this._jsPropName=this._runtime.GetJsPropName(t[3]),this._behavior.GetSdkVersion());if(r<2&&(this._sdkType=C33.New(i.Type,this),!(this._sdkType instanceof C33.SDKBehaviorTypeBase)))throw new Error("v1 sdk type must derive from SDKBehaviorBase");if(C33.AddonManager._PushInitObject(this,r),2<=r){e=i.Type??globalThis.ISDKBehaviorTypeBase;if(this._iBehaviorType=new e,!(this._iBehaviorType instanceof globalThis.ISDKBehaviorTypeBase))throw new Error("script interface class must derive from ISDKBehaviorTypeBase")}else this._iBehaviorType=new globalThis.IBehaviorType;C33.AddonManager._PopInitObject(r),this.OnCreate()}static Create(e,t){return C33.New(C33.BehaviorType,e,t)}Release(){this._runtime=null,this._behavior=null,this._sdkType&&(this._sdkType.Release(),this._sdkType=null),this._instSdkCtor=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType?this._sdkType.OnCreate():this._iBehaviorType&&this._iBehaviorType._onCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetIBehaviorType(){return this._iBehaviorType}GetJsPropName(){return this._jsPropName}}}{let C33=self.C3,IBehaviorInstance=self.IBehaviorInstance;C33.BehaviorInstance=class BehaviorInstance extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._behaviorType=e.behaviorType,this._behavior=this._behaviorType.GetBehavior(),this._inst=e.instance,this._index=e.index,this._sdkInst=null,this._iScriptInterface=null,this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null),this._behavior._RemoveInstance(this._inst),this._sdkInst&&(this._sdkInst.Release(),this._sdkInst=null),this._runtime=null,this._behaviorType=null,this._behavior=null,this._inst=null}_CreateSdkInstance(e){if(this._sdkInst)throw new Error("already got sdk instance");if(this.GetBehavior().GetSdkVersion()<2){if(this._sdkInst=C33.New(this._behaviorType.GetInstanceSdkCtor(),this,e),!(this._sdkInst instanceof C33.SDKBehaviorInstanceBase))throw new Error("v1 sdk type must derive from SDKBehaviorInstanceBase")}else{var t=this.GetBehavior().GetScriptInterfaceClass();this._InitScriptInterface(t.Instance,e)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst?this._sdkInst.PostCreate():this._iScriptInterface._postCreate()}OnSpriteFrameChanged(e,t){this._sdkInst&&this._sdkInst.OnSpriteFrameChanged(e,t)}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():this._iScriptInterface._getDebuggerProperties()}SaveToJson(e="full"){return this._sdkInst?this._sdkInst.SaveToJson(e):this._iScriptInterface._saveToJson(e)}LoadFromJson(e,t="full"){if(this._sdkInst)return this._sdkInst.LoadFromJson(e,t);this._iScriptInterface._loadFromJson(e,t)}static SortByTickSequence(e,t,r){var i=globalThis.ISDKBehaviorInstanceBase;let s,a;s=t instanceof i?e._UnwrapScriptInterface(t):t.GetBehaviorInstance(),a=r instanceof i?e._UnwrapScriptInterface(r):r.GetBehaviorInstance();var t=s.GetObjectInstance(),i=a.GetObjectInstance(),e=t.GetObjectClass().GetIndex(),r=i.GetObjectClass().GetIndex();return e!==r||(e=t.GetPUID())!==(r=i.GetPUID())?e-r:s._GetIndex()-a._GetIndex()}_InitScriptInterface(e,t){var r=IBehaviorInstance,e=e??this._sdkInst.GetScriptInterfaceClass(),i=e||r,s=this.GetBehavior().GetSdkVersion();if(C33.AddonManager._PushInitObject(this,s),C33.AddonManager._PushInitProperties(t),this._iScriptInterface=new i,C33.AddonManager._PopInitProperties(),C33.AddonManager._PopInitObject(s),!e||this._iScriptInterface instanceof r)return this._iScriptInterface;throw new TypeError(`script interface class '${e.name}' does not extend the right base class '${r.name}'`)}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}}}{let C33=self.C3;C33.EffectList=class EffectList extends C33.DefendedBase{constructor(e,t){super(),this._owner=e,this._allEffectTypes=[],this._activeEffectTypes=[],this._effectTypesByName=new Map,this._effectParams=[],this._effectParamBuffers=[],this._allInstanceEffectLists=new Set,this._preservesOpaqueness=!0;for(var r of t){var i=C33.New(C33.EffectType,this,r,this._allEffectTypes.length);this._allEffectTypes.push(i),this._effectTypesByName.set(i.GetName().toLowerCase(),i),3<=r.length&&this._effectParams.push(this._LoadSingleEffectParameters(i,r[2]))}this.GetRuntime()._AddEffectList(this)}Release(){this.GetRuntime()._RemoveEffectList(this);for(var e of this._effectParamBuffers)e.Release();C33.clearArray(this._effectParamBuffers),C33.clearArray(this._allEffectTypes),C33.clearArray(this._activeEffectTypes),this._effectTypesByName.clear(),C33.clearArray(this._effectParams),this._owner=null}_AddInstanceEffectList(e){this._allInstanceEffectLists.add(e)}_RemoveInstanceEffectList(e){this._allInstanceEffectLists.delete(e)}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._allEffectTypes.map(e=>{e=e.GetShaderProgram();return 0<e.GetCustomParametersByteSize()?C33.New(C33.Gfx.WebGPUEffectCustomParamsBuffer,e):null}),this._UpdateAllEffectParamBuffers());for(var t of this._allInstanceEffectLists)t._InitRenderer(e)}PrependEffectTypes(e){if(e.length){this._allEffectTypes=e.concat(this._allEffectTypes);for(var t of e)this._effectTypesByName.set(t.GetName().toLowerCase(),t);for(let e=0,t=this._allEffectTypes.length;e<t;++e)this._allEffectTypes[e]._SetIndex(e)}}_LoadSingleEffectParameters(e,t){e.SetActive(t[0]);var r=t.slice(1);for(let e=0,t=r.length;e<t;++e){var i,s=r[e];Array.isArray(s)&&((i=C33.New(C33.Color)).setFromJSON(s),r[e]=i)}return r}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){C33.clearArray(this._activeEffectTypes);let e=!0;for(var t of this._allEffectTypes)t.IsActive()&&(this._activeEffectTypes.push(t),t.GetShaderProgram().PreservesOpaqueness()||(e=!1));this._preservesOpaqueness=e}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return 0<this._allEffectTypes.length}GetEffectTypeByName(e){return this._effectTypesByName.get(e.toLowerCase())||null}GetEffectTypeByIndex(e){if((e=Math.floor(+e))<0||e>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[e]}IsEffectIndexActive(e){return this.GetEffectTypeByIndex(e).IsActive()}SetEffectIndexActive(e,t){this.GetEffectTypeByIndex(e).SetActive(t)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return 0<this._activeEffectTypes.length}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return(e<this._effectParamBuffers.length?this._effectParamBuffers:this._effectParams)[e]}GetEffectParameter(e,t){return e<0||e>=this._effectParams.length||(e=this._effectParams[e],t<0)||t>=e.length?null:e[t]}SetEffectParameter(e,t,r){if(e<0||e>=this._effectParams.length)return!1;var i=this._effectParams[e];if(t<0||t>=i.length)return!1;var s=i[t];if(s instanceof C33.Color){if(s.equalsIgnoringAlpha(r))return!1;s.copyRgb(r)}else{if(s===r)return!1;i[t]=r}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,r),!0}_UpdateAllEffectParamBuffers(){var r=this._effectParams,i=this._effectParamBuffers;for(let e=0,t=Math.min(r.length,i.length);e<t;++e){var s=i[e],a=r[e];for(let e=0,t=a.length;e<t;++e)s.SetParameterValue(e,a[e])}}static SaveFxParamToJson(e){return e&&e instanceof C33.Color?{t:"color",v:e.toJSON()}:e}static LoadFxParamFromJson(e){if(null===e)return NaN;if("object"!=typeof e)return e;var t;if("color"===e.t)return(t=C33.New(C33.Color)).setFromJSON(e.v),t;throw new Error("invalid effect parameter type")}static SaveFxParamsToJson(e){return e.map(C33.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(e){return e.map(C33.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map(e=>({name:e.GetName(),active:e.IsActive(),params:C33.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])}))}LoadFromJson(e){for(var t of e){var r=this.GetEffectTypeByName(t.name);r&&(r.SetActive(t.active),this._effectParams[r.GetIndex()]=C33.EffectList.LoadFxParamsFromJson(t.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{let C33=self.C3;C33.EffectType=class EffectType extends C33.DefendedBase{constructor(e,t,r){super(),this._effectList=e,this._id=t[0],this._name=t[1],this._index=r,this._shaderProgram=null,this._isActive=!0}Release(){this._effectList=null,this._shaderProgram=null}Clone(e){e=C33.New(C33.EffectType,e,[this._id,this._name],-1);return e._shaderProgram=this._shaderProgram,e._isActive=this._isActive,e}_InitRenderer(e){e=e.GetShaderProgramByName(this._id);if(!e)throw new Error("failed to find shader program '"+this._id+"'");this._shaderProgram=e}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(e){this._isActive=!!e}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){var r=[];for(let e=0,t=this._shaderProgram.GetParameterCount();e<t;++e){var i=this._shaderProgram.GetParameterType(e);if("float"===i||"percent"===i)r.push(0);else{if("color"!==i)throw new TypeError("unknown effect parameter type");r.push(C33.New(C33.Color,1,1,1,1))}}return r}}}{let C33=self.C3;C33.InstanceEffectList=class InstanceEffectList extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._wi=t,this._effectList=e.GetObjectClass().GetEffectList(),this._needsRebuildSteps=!0,this._wasDefaultColor=!0,this._was3D=!1,this._wasRotatedOrNegativeSize=!1,this._wasTexRotated=!1,this._wasMustPreDraw=!1,this._effectChain=C33.New(C33.Gfx.EffectChain,e.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(e,t)=>{var t=t.GetContentObject(),r=t.GetWorldInfo();e.SetColor(r.GetPremultipliedColor()),e.SetCurrentZ(r.GetTotalZElevation()),t.Draw(e),e.SetCurrentZ(0)},getSourceTextureInfo:e=>{var t=e.GetCurrentTexRect(),[e,r]=e.GetCurrentSurfaceSize();return{srcTexRect:t,srcWidth:e,srcHeight:r}},getShaderParameters:e=>this._GetEffectChainShaderParametersForIndex(e)}),this._activeEffectFlags=[],this._activeEffectTypes=[],this._preservesOpaqueness=!0,this._effectParams=[],this._effectParamBuffers=[],this._InitRenderer(e.GetRuntime().GetRenderer());for(let e=0,t=this._effectList.GetAllEffectTypes().length;e<t;++e)this._activeEffectFlags.push(!0);this.UpdateActiveEffects(),this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(var e of this._effectParamBuffers)e&&e.Release();C33.clearArray(this._effectParamBuffers),this._effectChain.Release(),this._effectChain=null,C33.clearArray(this._activeEffectFlags),C33.clearArray(this._activeEffectTypes),C33.clearArray(this._effectParams),this._inst=null,this._effectList=null}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._effectList.GetAllEffectTypes().map(e=>{e=e.GetShaderProgram();return 0<e.GetCustomParametersByteSize()?C33.New(C33.Gfx.WebGPUEffectCustomParamsBuffer,e):null}))}_LoadEffectParameters(e){let t=0;for(var r of e)this._effectParams.push(this._LoadSingleEffectParameters(t,r)),++t;this._UpdateAllEffectParamBuffers(),this.UpdateActiveEffects()}_LoadSingleEffectParameters(e,t){this._activeEffectFlags[e]=t[0];var r=t.slice(1);for(let e=0,t=r.length;e<t;++e){var i,s=r[e];Array.isArray(s)&&((i=C33.New(C33.Color)).setFromJSON(s),r[e]=i)}return r}LoadDefaultEffectParameters(){for(var e of this._effectList.GetAllEffectTypes())this._effectParams.push(e.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){C33.clearArray(this._activeEffectTypes);var r,e=this._wi,i=this._effectList.GetAllEffectTypes(),s=this._activeEffectTypes,a=this._activeEffectFlags;let n=!0;for(let e=0,t=i.length;e<t;++e)a[e]&&(r=i[e],s.push(r),r.GetShaderProgram().PreservesOpaqueness()||(n=!1));this._preservesOpaqueness=n,e._SetHasAnyActiveEffect(!!s.length),this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){var e=this._inst,t=this._wi,r=t.HasDefaultColor(),i=e.GetPlugin().Is3D(),t=0!==t.GetAngle()||0!==t.GetLayer().GetAngle()||t.GetWidth()<0||t.GetHeight()<0,s=e.IsCurrentTexRotated(),e=e.MustPreDraw();(this._needsRebuildSteps||r!==this._wasDefaultColor||i!==this._was3D||t!==this._wasRotatedOrNegativeSize||s!==this._wasTexRotated||e!==this._wasMustPreDraw||this._effectChain.NeedsRebuild())&&(this._effectChain.BuildSteps(this._activeEffectTypes.map(e=>e.GetShaderProgram()),{indexMap:this._activeEffectTypes.map(e=>e.GetIndex()),forcePreDraw:!r||e,is3D:i,isSourceTextureRotated:s,isRotatedOrNegativeSizeInstance:t}),this._needsRebuildSteps=!1,this._wasDefaultColor=r,this._was3D=i,this._wasRotatedOrNegativeSize=t,this._wasTexRotated=s,this._wasMustPreDraw=e)}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return(e<this._effectParamBuffers.length?this._effectParamBuffers:this._effectParams)[e]}GetEffectParameter(e,t){return e<0||e>=this._effectParams.length||(e=this._effectParams[e],t<0)||t>=e.length?null:e[t]}SetEffectParameter(e,t,r){if(e<0||e>=this._effectParams.length)return!1;var i=this._effectParams[e];if(t<0||t>=i.length)return!1;var s=i[t];if(s instanceof C33.Color){if(s.equalsIgnoringAlpha(r))return!1;s.copyRgb(r)}else{if(s===r)return!1;i[t]=r}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,r),!0}_UpdateAllEffectParamBuffers(){var r=this._effectParams,i=this._effectParamBuffers;for(let e=0,t=i.length;e<t;++e){var s=i[e],a=r[e];for(let e=0,t=a.length;e<t;++e)s.SetParameterValue(e,a[e])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(e=>e.GetShaderProgram().BlendsBackground())}IsEffectIndexActive(e){return this._activeEffectFlags[e]}SetEffectIndexActive(e,t){this._activeEffectFlags[e]=!!t}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map(e=>({name:e.GetName(),active:this._activeEffectFlags[e.GetIndex()],params:C33.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])}))}_LoadFromJson(e){for(var t of e){var r=this._effectList.GetEffectTypeByName(t.name);r&&(this._activeEffectFlags[r.GetIndex()]=t.active,this._effectParams[r.GetIndex()]=C33.EffectList.LoadFxParamsFromJson(t.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{let C33=self.C3,tempCandidates=[],tileCollRectCandidates=[],tempJumpthruRet=[],tempPolyA=C33.New(C33.CollisionPoly),tempPolyB=C33.New(C33.CollisionPoly),tempQuad=C33.New(C33.Quad),tempRect=C33.New(C33.Rect),tempRect2=C33.New(C33.Rect),tempPolyC=null,tempRect3=null,tempQuadB=null;C33.CollisionEngine=class CollisionEngine extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._collisionCellWidth=0,this._collisionCellHeight=0,this._registeredCollisions=[],this._collisionCheckCount=0,this._collisionCheckSec=0,this._polyCheckCount=0,this._polyCheckSec=0,this._iCollisionEngine=new self.ICollisionEngine(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetICollisionEngine(){return this._iCollisionEngine}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount,this._collisionCheckCount=0,this._polyCheckSec=this._polyCheckCount,this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(e,t){var r=e.GetWorldInfo(),i=t.GetWorldInfo();r&&i&&r.IsCollisionEnabled()&&i.IsCollisionEnabled()&&this._registeredCollisions.push([e,t])}AddRegisteredCollisionCandidates(t,r,i){for(var[s,a]of this._registeredCollisions){let e=null;if(t===s)e=a;else{if(t!==a)continue;e=s}!e.BelongsToObjectClass(r)||i.includes(e)||i.push(e)}}CheckRegisteredCollision(e,t){if(this._registeredCollisions.length)for(var[r,i]of this._registeredCollisions)if(e===r&&t===i||e===i&&t===r)return!0;return!1}ClearRegisteredCollisions(){C33.clearArray(this._registeredCollisions)}TestOverlap(e,t){if(!e||!t||e===t)return!1;e=e.GetWorldInfo(),t=t.GetWorldInfo();if(!e.IsCollisionEnabled()||!t.IsCollisionEnabled())return!1;this._collisionCheckCount++;var r=e.GetLayer(),i=t.GetLayer();return r.IsTransformCompatibleWith(i)?this._TestOverlap_SameLayers(e,t):this._TestOverlap_DifferentLayers(e,t)}_TestOverlap_SameLayers(e,t){var r,i;return!(!e.GetBoundingBox().intersectsRect(t.GetBoundingBox())||(this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(t.GetBoundingQuad()))||e.HasTilemap()&&t.HasTilemap())&&(e.HasTilemap()?this.TestTilemapOverlap(e,t):t.HasTilemap()?this.TestTilemapOverlap(t,e):!e.HasOwnCollisionPoly()&&!t.HasOwnCollisionPoly()||(r=e.GetTransformedCollisionPoly(),i=t.GetTransformedCollisionPoly(),r.intersectsPoly(i,t.GetX()-e.GetX(),t.GetY()-e.GetY())))}_TestOverlap_DifferentLayers(r,i){var e=r.HasTilemap(),t=i.HasTilemap();if(e&&!t)return this.TestTilemapOverlapDifferentLayers(r,i);if(t&&!e)return this.TestTilemapOverlapDifferentLayers(i,r);if(t||e)return!1;var s=r.GetLayer(),a=i.GetLayer(),n=(tempPolyA.copy(r.GetTransformedCollisionPoly()),tempPolyB.copy(i.GetTransformedCollisionPoly()),tempPolyA.pointsArr());for(let e=0,t=n.length;e<t;e+=2){var o=e+1,l=n[e],h=n[o],[l,h]=s.LayerToCanvasCss(l+r.GetX(),h+r.GetY());n[e]=l,n[o]=h}var u=tempPolyB.pointsArr();for(let e=0,t=u.length;e<t;e+=2){var c=e+1,_=u[e],d=u[c],[_,d]=a.LayerToCanvasCss(_+i.GetX(),d+i.GetY());u[e]=_,u[c]=d}return tempPolyA.setBboxChanged(),tempPolyB.setBboxChanged(),this._polyCheckCount++,tempPolyA.intersectsPoly(tempPolyB,0,0)}TestTilemapOverlapDifferentLayers(e,t){var r=e.GetLayer(),i=t.GetLayer(),s=(tempPolyC=tempPolyC||C33.New(C33.CollisionPoly),tempRect3=tempRect3||C33.New(C33.Rect),tempQuadB=tempQuadB||C33.New(C33.Quad),t.GetX()),a=t.GetY(),[i,n]=i.LayerToCanvasCss(s,a),[r,i]=r.CanvasCssToLayer(i,n),o=r-s,l=i-a;if(tempRect3.copy(t.GetBoundingBox()),tempRect3.offset(o,l),!e.GetBoundingBox().intersectsRect(tempRect3))return!1;if(tempQuadB.copy(t.GetBoundingQuad()),tempQuadB.offset(o,l),this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(tempQuadB))return!1;tempPolyC.copy(t.GetTransformedCollisionPoly());var h=tempPolyC.pointsArr();for(let e=0,t=h.length;e<t;e+=2){var u=e+1;h[e]+=o,h[u]+=l}return tempPolyC.setBboxChanged(),this.TestTilemapOverlap(e,t,r,i,tempPolyC,tempRect3,tempQuadB)}TestTilemapOverlap(e,r,t,i,s,a,n){var o=void 0!==a?a:r.GetBoundingBox(),l=e.GetX(),h=e.GetY(),a=e.GetInstance().GetSdkInstance(),u=void 0!==t?t:r.GetX(),c=void 0!==i?i:r.GetY(),_=r.HasOwnCollisionPoly(),d=void 0!==n?n:r.GetBoundingQuad(),p=tileCollRectCandidates;a.GetCollisionRectCandidates(o,p);for(let e=0,t=p.length;e<t;++e){var m=p[e],g=m.GetRect();if(this._collisionCheckCount++,o.intersectsRectOffset(g,l,h)&&(tempQuad.setFromRect(g),tempQuad.offset(l,h),tempQuad.intersectsQuad(d)))if(_){var f=void 0!==s?s:r.GetTransformedCollisionPoly();let e=u,t=c;void 0!==s&&(e=r.GetX(),t=r.GetY());var S=m.GetPoly();if(S){if(this._polyCheckCount++,S.intersectsPoly(f,e-(l+g.getLeft()),t-(h+g.getTop())))return C33.clearArray(p),!0}else if(tempPolyA.setFromQuad(tempQuad,0,0),tempPolyA.intersectsPoly(f,e,t))return C33.clearArray(p),!0}else{S=m.GetPoly();if(!S)return C33.clearArray(p),!0;if(tempPolyA.setFromQuad(d,0,0),S.intersectsPoly(tempPolyA,-(l+g.getLeft()),-(h+g.getTop())))return C33.clearArray(p),!0}}return C33.clearArray(p),!1}TestAndSelectCanvasPointOverlap(e,o,l){var h=e.GetCurrentSol(),t=this._runtime.GetCurrentEvent();if(!t)throw new Error("cannot call outside event");var u=t.IsOrBlock();let r=new Map;var c=e=>{let t=r.get(e);return void 0===t&&(t=e.IsSelfAndParentsInteractive(),r.set(e,t)),t};if(h.IsSelectAll()){l||(h._SetSelectAll(!1),C33.clearArray(h._GetOwnInstances())),u&&C33.clearArray(h._GetOwnElseInstances());for(var s of e.GetInstances()){let r=s.GetWorldInfo(),i=r.GetLayer(),e=!1;if(e=c(i)&&r.IsInViewport2()?o.some(([e,t])=>{var[e,t]=i.CanvasCssToLayer(e,t,r.GetTotalZElevation());return r.ContainsPoint(e,t)}):e){if(l)return!1;h._PushInstance(s)}else u&&h._PushElseInstance(s)}}else{let s,a=!1,n=(!u||t.IsFirstConditionOfType(this._runtime.GetCurrentCondition())||this._runtime.IsCurrentConditionFirst()&&!h._GetOwnElseInstances().length&&h._GetOwnInstances().length?s=h._GetOwnInstances():(s=h._GetOwnElseInstances(),a=!0),0);for(let t=0,e=s.length;t<e;++t){var _=s[t];let r=_.GetWorldInfo(),i=r.GetLayer(),e=!1;if(e=c(i)&&r.IsInViewport2()?o.some(([e,t])=>{var[e,t]=i.CanvasCssToLayer(e,t,r.GetTotalZElevation());return r.ContainsPoint(e,t)}):e){if(l)return!1;a?h._PushInstance(_):s[n++]=_}else a?s[n++]=_:u&&h._PushElseInstance(_)}l||(s.length=n)}return e.ApplySolToContainer(),r.clear(),!!l||h.HasAnyInstances()}_ObjectClassCanUseCollisionCells(e,t){if(e)for(var r of t.layersHasInstancesOn())if(!e.IsTransformCompatibleWith(r))return!1;return!0}GetCollisionCandidates(e,t,r,i){if(t.IsFamily())for(var s of t.GetFamilyMembers())this._ObjectClassCanUseCollisionCells(e,s)?(s._UpdateAllCollisionCells(),s._GetCollisionCellGrid().QueryRange(r,i)):C33.appendArray(i,s.GetInstances());else this._ObjectClassCanUseCollisionCells(e,t)?(t._UpdateAllCollisionCells(),t._GetCollisionCellGrid().QueryRange(r,i)):C33.appendArray(i,t.GetInstances())}GetObjectClassesCollisionCandidates(e,t,r,i){for(var s of t)this.GetCollisionCandidates(e,s,r,i)}GetSolidCollisionCandidates(e,t,r){var i=this._runtime.GetSolidBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,r)}GetJumpthruCollisionCandidates(e,t,r){var i=this._runtime.GetJumpthruBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,r)}IsSolidCollisionAllowed(e,t){return e._IsSolidEnabled()&&(!t||t.GetWorldInfo().IsSolidCollisionAllowed(e.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(e){var t,r=e.GetWorldInfo();this.GetSolidCollisionCandidates(r.GetLayer(),r.GetBoundingBox(),tempCandidates);for(t of tempCandidates)if(this.IsSolidCollisionAllowed(t,e)&&this.TestOverlap(e,t))return C33.clearArray(tempCandidates),t;return C33.clearArray(tempCandidates),null}TestRectOverlapSolid(e,t){this.GetSolidCollisionCandidates(null,e,tempCandidates);for(var r of tempCandidates)if(this.IsSolidCollisionAllowed(r,t)&&this.TestRectOverlap(e,r))return C33.clearArray(tempCandidates),r;return C33.clearArray(tempCandidates),null}TestOverlapJumpthru(e,t){let r=null;t&&(r=tempJumpthruRet,C33.clearArray(r));var i,s=e.GetWorldInfo();this.GetJumpthruCollisionCandidates(s.GetLayer(),s.GetBoundingBox(),tempCandidates);for(i of tempCandidates)if(i._IsJumpthruEnabled()&&this.TestOverlap(e,i)){if(!t)return C33.clearArray(tempCandidates),i;r.push(i)}return C33.clearArray(tempCandidates),r}PushOut(t,r,i,s,a){s=s||50;var n=t.GetWorldInfo(),o=n.GetX(),l=n.GetY();for(let e=0;e<s;++e)if(n.SetXY(o+r*e,l+i*e),n.SetBboxChanged(),!this.TestOverlap(t,a))return!0;return n.SetXY(o,l),n.SetBboxChanged(),!1}PushOutSolid(t,r,i,s,a,n){s=s||50;var o=t.GetWorldInfo(),l=o.GetX(),h=o.GetY();let u=null,c=null;for(let e=0;e<s;++e)if(o.SetXY(l+r*e,h+i*e),o.SetBboxChanged(),!this.TestOverlap(t,u))if(u=this.TestOverlapSolid(t))c=u;else if(a&&(u=n?this.TestOverlap(t,n)?n:null:this.TestOverlapJumpthru(t))&&(c=u),!u)return c&&this.PushInFractional(t,r,i,c,16,!0),!0;return o.SetXY(l,h),o.SetBboxChanged(),!1}PushOutSolidAxis(r,i,s,e){e=e||50;var a=r.GetWorldInfo(),n=a.GetX(),o=a.GetY();let l=null,h=null;for(let t=0;t<e;++t)for(let e=0;e<2;++e){var u=2*e-1;if(a.SetXY(n+i*t*u,o+s*t*u),a.SetBboxChanged(),!this.TestOverlap(r,l)){if(!(l=this.TestOverlapSolid(r)))return h&&this.PushInFractional(r,i*u,s*u,h,16,!0),!0;h=l}}return a.SetXY(n,o),a.SetBboxChanged(),!1}PushInFractional(e,t,r,i,s,a){let n=2,o=!1,l=!1;var h=e.GetWorldInfo();let u=h.GetX(),c=h.GetY();for(;n<=s;){var _=1/n;n*=2,h.OffsetXY(t*_*(o?1:-1),r*_*(o?1:-1)),h.SetBboxChanged(),this.TestOverlap(e,i)||a&&this.TestOverlapSolid(e)?(o=!0,l=!0):(o=!1,l=!1,u=h.GetX(),c=h.GetY())}l&&(h.SetXY(u,c),h.SetBboxChanged())}PushOutSolidNearest(r,e=100){let i=0;var s=r.GetWorldInfo(),a=s.GetX(),n=s.GetY();let o=0,l=this.TestOverlapSolid(r);if(!l)return!0;for(;i<=e;){let e=0,t=0;switch(o){case 0:e=0,t=-1,i++;break;case 1:e=1,t=-1;break;case 2:e=1,t=0;break;case 3:e=1,t=1;break;case 4:e=0,t=1;break;case 5:e=-1,t=1;break;case 6:e=-1,t=0;break;case 7:e=-1,t=-1}if(o=(o+1)%8,s.SetXY(Math.floor(a+e*i),Math.floor(n+t*i)),s.SetBboxChanged(),!this.TestOverlap(r,l)&&!(l=this.TestOverlapSolid(r)))return!0}return s.SetXY(a,n),s.SetBboxChanged(),!1}CalculateBounceAngle(e,t,r,i){var s=e.GetWorldInfo(),a=s.GetX(),n=s.GetY(),o=Math.max(10,C33.distanceTo(t,r,a,n)),l=C33.angleTo(t,r,a,n),h=i||this.TestOverlapSolid(e);if(!h)return C33.clampAngle(l+Math.PI);let u=h,c=0,_=0;var d=C33.toRadians(5);let p;for(p=1;p<36;++p){var m=l-p*d;if(s.SetXY(t+Math.cos(m)*o,r+Math.sin(m)*o),s.SetBboxChanged(),!this.TestOverlap(e,u)&&!(u=i?null:this.TestOverlapSolid(e))){c=m;break}}for(36===p&&(c=C33.clampAngle(l+Math.PI)),u=h,p=1;p<36;++p){var g=l+p*d;if(s.SetXY(t+Math.cos(g)*o,r+Math.sin(g)*o),s.SetBboxChanged(),!this.TestOverlap(e,u)&&!(u=i?null:this.TestOverlapSolid(e))){_=g;break}}if(36===p&&(_=C33.clampAngle(l+Math.PI)),s.SetXY(a,n),s.SetBboxChanged(),_===c)return _;h=C33.angleDiff(_,c)/2;let f;f=C33.angleClockwise(_,c)?C33.clampAngle(c+h+Math.PI):C33.clampAngle(_+h);var a=Math.cos(l),n=Math.sin(l),h=Math.cos(f),S=Math.sin(f),C=a*h+n*S,a=a-2*C*h,h=n-2*C*S;return C33.angleTo(0,0,a,h)}TestSegmentOverlap(e,t,r,i,s){var a;return!!s&&!!(a=s.GetWorldInfo()).IsCollisionEnabled()&&(this._collisionCheckCount++,tempRect.set(Math.min(e,r),Math.min(t,i),Math.max(e,r),Math.max(t,i)),!!a.GetBoundingBox().intersectsRect(tempRect))&&(s.HasTilemap()?this._TestSegmentOverlapTilemap(e,t,r,i,s,a):(this._polyCheckCount++,!!a.GetBoundingQuad().intersectsSegment(e,t,r,i)&&(!a.HasOwnCollisionPoly()||a.GetTransformedCollisionPoly().intersectsSegment(a.GetX(),a.GetY(),e,t,r,i))))}_TestSegmentOverlapTilemap(r,i,s,a,e,t){var n=t.GetX(),o=t.GetY(),t=e.GetSdkInstance(),l=tileCollRectCandidates;tempRect2.set(r,i,s,a),tempRect2.normalize(),t.GetCollisionRectCandidates(tempRect2,l);for(let e=0,t=l.length;e<t;++e){var h=l[e],u=h.GetRect();if(this._collisionCheckCount++,tempRect.intersectsRectOffset(u,n,o)&&(tempQuad.setFromRect(u),tempQuad.offset(n,o),tempQuad.intersectsSegment(r,i,s,a))){h=h.GetPoly();if(!h)return C33.clearArray(l),!0;if(this._polyCheckCount++,h.intersectsSegment(n+u.getLeft(),o+u.getTop(),r,i,s,a))return C33.clearArray(l),!0}}return C33.clearArray(l),!1}TestRectOverlap(e,t){var r;return!!t&&!!(r=t.GetWorldInfo()).IsCollisionEnabled()&&(this._collisionCheckCount++,!!r.GetBoundingBox().intersectsRect(e))&&(t.HasTilemap()?this._TestRectOverlapTilemap(e,t,r):(this._polyCheckCount++,tempQuad.setFromRect(e),!!r.GetBoundingQuad().intersectsQuad(tempQuad)&&(!r.HasOwnCollisionPoly()||((t=tempPolyA).setFromRect(e,r.GetX(),r.GetY()),e=r.GetTransformedCollisionPoly(),t.intersectsPoly(e,0,0)))))}_TestRectOverlapTilemap(r,e,t){var i=t.GetX(),s=t.GetY(),t=e.GetSdkInstance(),a=tileCollRectCandidates;t.GetCollisionRectCandidates(r,a);for(let e=0,t=a.length;e<t;++e){var n=a[e],o=n.GetRect();if(this._collisionCheckCount++,r.intersectsRectOffset(o,i,s)){n=n.GetPoly();if(!n)return C33.clearArray(a),!0;if(this._polyCheckCount++,tempPolyA.setFromRect(r,0,0),n.intersectsPoly(tempPolyA,-(i+o.getLeft()),-(s+o.getTop())))return C33.clearArray(a),!0}}return C33.clearArray(a),!1}TestRayIntersectsInstance(e,t){var r;e&&(r=e.GetWorldInfo()).IsCollisionEnabled()&&(this._collisionCheckCount++,r.GetBoundingBox().intersectsRect(t.rect))&&(e.HasTilemap()?this._TestRayIntersectsTilemap(e,r,t):(this._polyCheckCount++,r.HasOwnCollisionPoly()?t.TestInstancePoly(e,r.GetX(),r.GetY(),r.GetTransformedCollisionPoly()):t.TestInstanceQuad(e,r.GetBoundingQuad())))}_TestRayIntersectsTilemap(r,i,s){var a=i.GetX(),n=i.GetY(),o=tileCollRectCandidates;r.GetSdkInstance().GetCollisionRectCandidates(s.rect,o);for(let e=0,t=o.length;e<t;e++){var l=o[e],h=l.GetRect();this._collisionCheckCount++,s.rect.intersectsRectOffset(h,a,n)&&(l=l.GetPoly(),this._polyCheckCount++,l?s.TestInstancePoly(r,a+h.getLeft(),n+h.getTop(),l):s.TestInstanceRect(r,i.GetX(),i.GetY(),h))}C33.clearArray(o)}SetCollisionCellSize(e,t){if(e!==this._collisionCellWidth||t!==this._collisionCellHeight){var r;this._collisionCellWidth=e,this._collisionCellHeight=t;for(r of this._runtime.GetAllObjectClasses())if(r.IsWorldType()){for(var i of r.instancesIncludingPendingCreate())i.GetWorldInfo()._RemoveFromCollisionCells();r._GetCollisionCellGrid().SetCellSize(e,t),r._SetAnyCollisionCellChanged();for(var s of r.instancesIncludingPendingCreate()){s=s.GetWorldInfo();s._SetCollisionCellChanged(),s._UpdateCollisionCell()}}}}GetCollisionCellSize(){return[this._collisionCellWidth,this._collisionCellHeight]}_InitCollisionCellSize(e,t){this._collisionCellWidth=e,this._collisionCellHeight=t}}}{let C33=self.C3;C33.SparseGrid=class SparseGrid extends C33.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C33.New(C33.PairMap)}Release(){this._cells.Release(),this._cells=null}SetCellSize(e,t){if(!this._cells.IsEmpty())throw new Error("grid not empty");this._cellWidth=e,this._cellHeight=t}GetCell(e,t,r){var i=this._cells.Get(e,t);return i||(r?(i=C33.New(C33.GridCell,this,e,t),this._cells.Set(e,t,i),i):null)}XToCell(e){e=Math.floor(e/this._cellWidth);return isFinite(e)?e:0}YToCell(e){e=Math.floor(e/this._cellHeight);return isFinite(e)?e:0}Update(i,s,a){if(s)for(let r=s.getLeft(),e=s.getRight();r<=e;++r)for(let e=s.getTop(),t=s.getBottom();e<=t;++e){var n;a&&a.containsPoint(r,e)||(n=this.GetCell(r,e,!1))&&(n.Remove(i),n.IsEmpty())&&this._cells.Delete(r,e)}if(a)for(let r=a.getLeft(),e=a.getRight();r<=e;++r)for(let e=a.getTop(),t=a.getBottom();e<=t;++e)s&&s.containsPoint(r,e)||this.GetCell(r,e,!0).Insert(i)}QueryRange(e,t){let r=this.XToCell(e.getLeft());var i=this.YToCell(e.getTop()),s=this.XToCell(e.getRight()),a=this.YToCell(e.getBottom());if(isFinite(s)&&isFinite(a))for(;r<=s;++r)for(let e=i;e<=a;++e){var n=this.GetCell(r,e,!1);n&&n.Dump(t)}}}}{let C33=self.C3;C33.GridCell=class GridCell extends C33.DefendedBase{constructor(e,t,r){super(),this._grid=e,this._x=t,this._y=r,this._instances=C33.New(C33.ArraySet)}Release(){this._instances.Release(),this._instances=null,this._grid=null}IsEmpty(){return this._instances.IsEmpty()}Insert(e){this._instances.Add(e)}Remove(e){this._instances.Delete(e)}Dump(e){C33.appendArray(e,this._instances.GetArray())}}}{let C33=self.C3,PADDING=1e-6,NO_HIT=2;C33.Ray=class Ray{constructor(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.dx=0,this.dy=0,this.rect=new C33.Rect,this.hitFraction=NO_HIT,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0}DidCollide(){return this.hitFraction<1+PADDING}Reset(){this.hitFraction=NO_HIT}Set(e,t,r,i){return this.x1=e,this.y1=t,this.x2=r,this.y2=i,this.dx=r-e,this.dy=i-t,this.rect.set(e,t,r,i),this.rect.normalize(),this.hitFraction=NO_HIT,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0,this}Complete(){var e,t,r;!1!==this.DidCollide()&&(t=this.dx*this.hitFraction,e=this.dy*this.hitFraction,r=t/(t=Math.hypot(t,e)),e=e/t,this.distance=t-PADDING,this.hitX=this.x1+r*this.distance,this.hitY=this.y1+e*this.distance,this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2,this.normalX=Math.cos(this.hitNormal),this.normalY=Math.sin(this.hitNormal),t=r*this.normalX+e*this.normalY,this.reflectionX=r-2*this.normalX*t,this.reflectionY=e-2*this.normalY*t,0<t)&&(r=Math.PI,this.hitNormal=C33.clampAngle(this.hitNormal+r),this.normalX=-this.normalX,this.normalY=-this.normalY)}TestInstanceSegment(e,t,r,i,s){var a=C33.rayIntersect(this.x1,this.y1,this.x2,this.y2,t,r,i,s);0<=a&&a<this.hitFraction&&(this.hitFraction=a,this.hitUid=e.GetUID(),this.hitNormalDx=t-i,this.hitNormalDy=r-s)}TestInstanceRect(e,t,r,i){var s=t+i.getLeft(),t=t+i.getRight(),a=r+i.getTop(),r=r+i.getBottom();this.TestInstanceSegment(e,s,a,t,a),this.TestInstanceSegment(e,t,a,t,r),this.TestInstanceSegment(e,t,r,s,r),this.TestInstanceSegment(e,s,r,s,a)}TestInstanceQuad(e,t){var r=t.getTlx(),i=t.getTly(),s=t.getTrx(),a=t.getTry(),n=t.getBrx(),o=t.getBry(),l=t.getBlx(),t=t.getBly();this.TestInstanceSegment(e,r,i,s,a),this.TestInstanceSegment(e,s,a,n,o),this.TestInstanceSegment(e,n,o,l,t),this.TestInstanceSegment(e,l,t,r,i)}TestInstancePoly(r,i,s,e){var a=e.pointsArr();for(let e=0,t=a.length;e<t;e+=2){var n=(e+2)%t,o=a[e]+i,l=a[e+1]+s,h=a[n]+i,n=a[1+n]+s;this.TestInstanceSegment(r,o,l,h,n)}}}}{let C33=self.C3,VALID_FULLSCREEN_MODES=new Set(["off","crop","scale-inner","scale-outer","letterbox-scale","letterbox-integer-scale"]),VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]),glMatrix=self.glMatrix,mat42=glMatrix.mat4,vec32=glMatrix.vec3,tempProjection=mat42.create(),PERCENTTEXT_WIDTH=300,PERCENTTEXT_HEIGHT=200,PROGRESSBAR_WIDTH=120,PROGRESSBAR_HEIGHT=8,tempQuad=C33.New(C33.Quad),tempRect=C33.New(C33.Rect),SPLASH_MIN_DISPLAY_TIME=3e3,SPLASH_AFTER_FADEOUT_WAIT_TIME=200,SPLASH_FADE_DURATION=300;C33.CanvasManager=class CanvasManager extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._canvasLayers=[],this._isWebGPUEnabled=!1,this._webglRenderer=null,this._webgpuRenderer=null,this._iRenderer=null,this._gpuPreference="high-performance",this._isLimitedToWebGL1=!1,this._windowInnerWidth=0,this._windowInnerHeight=0,this._cssDisplayMode="",this._canvasCssWidth=0,this._canvasCssHeight=0,this._canvasDeviceWidth=0,this._canvasDeviceHeight=0,this._canvasCssOffsetX=0,this._canvasCssOffsetY=0,this._zAxisScale="normalized",this._initFieldOfView=0,this._zNear=1,this._zFar=1e4,this._enableMipmaps=!0,this._textureAnisotropy=0,this._drawWidth=0,this._drawHeight=0,this._fullscreenMode="letterbox-scale",this._documentFullscreenMode="letterbox-scale",this._deviceTransformOffX=0,this._deviceTransformOffY=0,this._defaultProjectionMatrix=mat42.create(),this._wantFullscreenScalingQuality="high",this._fullscreenScalingQuality=this._wantFullscreenScalingQuality,this._isDocumentFullscreen=!1,this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets=new Set,this._shaderData=self.C3_Shaders,this._effectChainManager=C33.New(C33.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:e=>this.ReleaseEffectCompositorRenderTarget(e),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()}),this._gpuTimeStartFrame=0,this._gpuTimeEndFrame=0,this._gpuLastUtilisation=NaN,this._gpuFrameTimingsBuffer=null,this._layersGpuProfile=new Map,this._gpuCurUtilisation=NaN,this._webgpuFrameTimings=new Map,this._snapshotFormat="",this._snapshotQuality=1,this._snapshotArea=C33.New(C33.Rect),this._snapshotUrl="",this._snapshotPromise=null,this._snapshotResolve=null,this._isPastingToDrawingCanvas=0,this._loaderStartTime=0,this._rafId=-1,this._loadingProgress=0,this._loadingprogress_handler=e=>this._loadingProgress=e.progress,this._percentText=null,this._splashTextures={logo:null,powered:null,website:null},this._splashFrameNumber=0,this._splashFadeInFinishTime=0,this._splashFadeOutStartTime=0,this._splashState="fade-in",this._splashDoneResolve=null,this._splashDonePromise=new Promise(e=>this._splashDoneResolve=e)}_SetGPUPowerPreference(e){this._gpuPreference=e}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}_SetZAxisScale(e){this._zAxisScale=e}GetZAxisScale(){return this._zAxisScale}_SetInitFieldOfView(e){this._initFieldOfView=e}_SetZDistances(e,t){this._zNear=e,this._zFar=t}_SetLimitedToWebGL1(e){this._isLimitedToWebGL1=!!e}async CreateCanvas(e){var t=e.canvas,t=(this._canvasLayers.push({canvas:t,ctx:null}),this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",e=>this._OnWindowResize(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",e=>this._OnFullscreenChange(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",e=>this._OnFullscreenError(e)),t.addEventListener("webglcontextlost",e=>this._OnWebGLContextLost(e)),t.addEventListener("webglcontextrestored",e=>this._OnWebGLContextRestored(e)),this._isDocumentFullscreen=!!e.isFullscreen,this._cssDisplayMode=e.cssDisplayMode,navigator.gpu&&this._isWebGPUEnabled);let r=!1;if(t)try{await this._InitWebGPUContext(!0)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}if(this.GetRenderer()||(r=!0),!this.GetRenderer()&&t)try{await this._InitWebGPUContext(!1)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}t=this.GetRenderer();if(!t)throw new Error("failed to acquire a renderer - check WebGL or WebGPU is supported");t.SetHasMajorPerformanceCaveat(r),this._webgpuRenderer&&(this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost(),this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored()),"normalized"===this._zAxisScale?t.SetZAxisScaleNormalized():(t.SetZAxisScaleRegular(),t.SetFovY(this._initFieldOfView)),this.SetSize(e.windowInnerWidth,e.windowInnerHeight,!0),await this._InitRenderer()}_MaybeLogRendererError(e,t){t&&"string"==typeof t.message&&t.message.startsWith("renderer-unavailable")||console.error(`Error creating ${e} renderer: `,t)}async _InitWebGPUContext(e){var t={nearZ:this._zNear,farZ:this._zFar},e={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:e,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling()};this._webgpuRenderer=C33.New(C33.Gfx.WebGPURenderer,t),await this._webgpuRenderer.Create(this._canvasLayers[0].canvas,e)}async _InitWebGLContext(e){e={alpha:!0,powerPreference:this._gpuPreference,enableGpuProfiling:"xbox-uwp-webview2"!==this._runtime.GetExportType(),depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:e,nearZ:this._zNear,farZ:this._zFar};this._isLimitedToWebGL1&&(e.maxWebGLVersion=1),this._webglRenderer=C33.New(C33.Gfx.WebGLRenderer,this._canvasLayers[0].canvas,e),await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){var e,t,r=[];for([e,t]of Object.entries(this._shaderData)){t.src=t.wgsl;var i=C33.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();r.push(this._webgpuRenderer.CreateShaderProgram(Object.assign({vertexSrc:i,name:e},t)))}await Promise.all(r)}}async _InitWebGL(){if(this._shaderData){var t,r,i=[];for([t,r]of Object.entries(this._shaderData)){let e;if(r.glslWebGL2&&2<=this._webglRenderer.GetWebGLVersionNumber())r.src=r.glslWebGL2,e=C33.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();else{if(!r.glsl)throw new Error(`shader '${t}' does not support WebGL 1`);r.src=r.glsl,e=C33.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}i.push(this._webglRenderer.CreateShaderProgram(Object.assign({vertexSrc:e,name:t},r)))}await Promise.all(i),this._webglRenderer.ResetLastProgram(),this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=C33.New(C33.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}async _InitRenderer(){this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL();var e,t=this.GetRenderer();t.SetMipmapsEnabled(this._enableMipmaps),t.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(e of this._runtime._GetAllEffectLists()){for(var r of e.GetAllEffectTypes())r._InitRenderer(t);e._InitRenderer(t),e.UpdateActiveEffects()}this._iRenderer=new self.IRenderer(this._runtime,t)}Release(){this._runtime=null,this._webglRenderer=null,this._canvasLayers.length=0}IsInWorker(){return this._runtime.IsInWorker()}_OnWindowResize(e){var t,r=this._runtime;r.IsExportToVideo()||(t=e.devicePixelRatio,this.IsInWorker()&&(self.devicePixelRatio=t),r._SetDevicePixelRatio(t),this._isDocumentFullscreen=!!e.isFullscreen,this._cssDisplayMode=e.cssDisplayMode,this.SetSize(e.innerWidth,e.innerHeight),r.UpdateRender(),(t=new C33.Event("window-resize")).data=e,r.Dispatcher().dispatchEventAndWaitAsyncSequential(t),(e=new C33.Event("resize")).cssWidth=this.GetCssWidth(),e.cssHeight=this.GetCssHeight(),e.deviceWidth=this.GetDeviceWidth(),e.deviceHeight=this.GetDeviceHeight(),r.DispatchUserScriptEvent(e),r.IsDebug()&&(r.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&r.Render())}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}SetSize(e,t,r=!1){if(e=Math.floor(e),t=Math.floor(t),e<=0||t<=0)throw new Error("invalid size");if(this._windowInnerWidth!==e||this._windowInnerHeight!==t||r){this._windowInnerWidth=e,this._windowInnerHeight=t;var i,r=this.GetCurrentFullscreenMode();"letterbox-scale"===r?this._CalculateLetterboxScale(e,t):"letterbox-integer-scale"===r?this._CalculateLetterboxIntegerScale(e,t):"off"===r?this._CalculateFixedSizeCanvas(e,t):this._CalculateFullsizeCanvas(e,t),this._UpdateFullscreenScalingQuality(r);for({canvas:i}of this._canvasLayers)i.width=this._canvasDeviceWidth,i.height=this._canvasDeviceHeight;this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight,displayScale:this.GetDisplayScale()});var s,a=this.GetRenderer();a.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,!0);for(s of this._availableAdditionalRenderTargets)a.DeleteRenderTarget(s);C33.clearArray(this._availableAdditionalRenderTargets),this.UpdateDefaultProjectionMatrix();e=this._runtime.GetLayoutManager();e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}}UpdateDefaultProjectionMatrix(){this.GetRenderer().CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight())}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(e,t){var r=this._runtime.GetDevicePixelRatio(),i=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight(),a=i/s;a<e/t?(this._canvasCssWidth=Math.round(t*a),this._canvasCssHeight=t,this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=0):(a=e/a,this._canvasCssWidth=e,this._canvasCssHeight=Math.round(a),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*r),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*r),this._runtime.SetViewportSize(i,s)}_CalculateLetterboxIntegerScale(e,t){var r=this._runtime.GetDevicePixelRatio(),i=(1!==r&&(e+=1,t+=1),this._runtime.GetOriginalViewportWidth()),s=this._runtime.GetOriginalViewportHeight(),a=i/s;let n;1<(n=a<e/t?t*a*r/i:e/a*r/s)?n=Math.floor(n):n<1&&(n=1/Math.ceil(1/n)),this._canvasDeviceWidth=Math.round(i*n),this._canvasDeviceHeight=Math.round(s*n),this._canvasCssWidth=this._canvasDeviceWidth/r,this._canvasCssHeight=this._canvasDeviceHeight/r,this._canvasCssOffsetX=Math.max(Math.floor((e-this._canvasCssWidth)/2),0),this._canvasCssOffsetY=Math.max(Math.floor((t-this._canvasCssHeight)/2),0),this._runtime.SetViewportSize(i,s)}_CalculateFullsizeCanvas(e,t){var r=this._runtime.GetDevicePixelRatio(),e=(this._canvasCssWidth=e,this._canvasCssHeight=t,this._canvasDeviceWidth=Math.round(this._canvasCssWidth*r),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*r),this._canvasCssOffsetX=0,this._canvasCssOffsetY=0,this.GetDisplayScale());this._runtime.SetViewportSize(this._canvasCssWidth/e,this._canvasCssHeight/e)}_CalculateFixedSizeCanvas(e,t){var r=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth(),this._canvasCssHeight=this._runtime.GetViewportHeight(),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*r),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*r),this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)):(this._canvasCssOffsetX=0,this._canvasCssOffsetY=0),this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(r){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let e,t;var i,s;t="off"===this.GetCurrentFullscreenMode()?(e=this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight()):(e=this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight()),this._canvasDeviceWidth<e||this._canvasDeviceHeight<t?(this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high"):(this._drawWidth=e,this._drawHeight=t,this._fullscreenScalingQuality="low","scale-inner"===r?(i=e/t,(s=this._windowInnerWidth/this._windowInnerHeight)<i?this._drawWidth=this._drawHeight*s:i<s&&(this._drawHeight=this._drawWidth/s)):"scale-outer"===r&&((i=e/t)<(s=this._windowInnerWidth/this._windowInnerHeight)?this._drawWidth=this._drawHeight*s:s<i&&(this._drawHeight=this._drawWidth/s)))}}GetRuntime(){return this._runtime}GetMainCanvas(){return this._canvasLayers[0].canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}GetCssDisplayMode(){return this._cssDisplayMode}SetFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw new Error("invalid fullscreen mode");this._fullscreenMode=e;e=this._runtime.GetLayoutManager();e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw new Error("invalid fullscreen mode");this._documentFullscreenMode=e;e=this._runtime.GetLayoutManager();e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():this.GetFullscreenMode()}SetFullscreenScalingQuality(e){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(e))throw new Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=e,this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(e){switch(e){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw new Error("invalid fullscreen mode")}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(e){this._textureAnisotropy=e}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){console.log("[Construct] WebGL context lost"),e.preventDefault(),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._webglRenderer.OnContextLost(),this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){console.log("[Construct] WebGPU device lost"),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored(),await this._InitRenderer(),await this._runtime._OnRendererContextRestored(),console.log("[Construct] WebGL context restored")}async _OnWebGPUDeviceRestored(){await this._InitRenderer(),await this._runtime._OnRendererContextRestored(),console.log("[Construct] WebGPU device restored")}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetIRenderer(){return this._iRenderer}GetRenderScale(){return"low"===this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){var e,t,r,i,s=this.GetCurrentFullscreenMode();return"off"===s||"crop"===s?1:(r=(e=this._runtime.GetOriginalViewportWidth())/(t=this._runtime.GetOriginalViewportHeight()),i=this._canvasDeviceWidth/this._canvasDeviceHeight,"scale-inner"!==s&&r<i||"scale-inner"===s&&i<r?this._canvasCssHeight/t:this._canvasCssWidth/e)}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(e,t){this._deviceTransformOffX=e,this._deviceTransformOffY=t}SetDeviceTransform(t,r,i,e=!0){r=r||this._drawWidth,i=i||this._drawHeight;var s=r/2+this._deviceTransformOffX,a=i/2+this._deviceTransformOffY;if(e){let e=this.GetDefaultProjectionMatrix();r===this._drawWidth&&i===this._drawHeight||(t.CalculatePerspectiveMatrix(tempProjection,r/i),e=tempProjection),t.SetProjectionMatrix(e)}e=t.CalculateLookAtModelView2(s,a,t.GetDefaultCameraZ(i),s,a,0,i);t.SetModelViewMatrix(e)}SetCssTransform(e,t=!0){var r=this.GetCssWidth(),i=this.GetCssHeight(),r=r/2,s=i/2,t=(t&&e.SetProjectionMatrix(this.GetDefaultProjectionMatrix()),e.CalculateLookAtModelView2(r,s,e.GetDefaultCameraZ(i),r,s,0,i));e.SetModelViewMatrix(t)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetHTMLLayerCount(){return this._canvasLayers.length}_CanUseImageBitmapRenderingContext(){return"undefined"!=typeof OffscreenCanvas&&this.GetMainCanvas()instanceof OffscreenCanvas&&("Chromium"!==C33.Platform.BrowserEngine||124<=C33.Platform.BrowserVersionNumber)}async SetHTMLLayerCount(t,r=!1){if(t<1)throw new Error("invalid HTML layer count");if(this._canvasLayers.length!==t){r={count:t,immediate:r,marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight};let e;if(e=this.IsInWorker()?await this._runtime.PostComponentMessageToDOMAsync("canvas","set-html-layer-count",r):self.c3_runtimeInterface._OnSetHTMLLayerCount(r),t<this._canvasLayers.length)this._canvasLayers.length=t;else for(var i of e.addedCanvases){i.width=this._canvasDeviceWidth,i.height=this._canvasDeviceHeight;var s=this._CanUseImageBitmapRenderingContext()?"bitmaprenderer":"2d",a=i.getContext(s);if(!a)throw new Error(`failed to acquire '${s}' canvas context`);this._canvasLayers.push({canvas:i,ctx:a})}this._runtime.UpdateRender()}}BlitMainCanvasToHTMLLayerCanvas(e){var t;e>=this._canvasLayers.length||(t=this.GetMainCanvas(),e=this._canvasLayers[e].ctx,this._CanUseImageBitmapRenderingContext()?e.transferFromImageBitmap(t.transferToImageBitmap()):(e.globalCompositeOperation="copy",e.drawImage(t,0,0)))}GetAdditionalRenderTarget(t){t.depth=this._runtime.Uses3DFeatures();var e=this._availableAdditionalRenderTargets,r=e.findIndex(e=>e.IsCompatibleWithOptions(t));let i;return-1!==r?(i=e[r],e.splice(r,1)):i=this.GetRenderer().CreateRenderTarget(t),this._usedAdditionalRenderTargets.add(i),i}ReleaseAdditionalRenderTarget(e){if(!this._usedAdditionalRenderTargets.has(e))throw new Error("render target not in use");this._usedAdditionalRenderTargets.delete(e),this._availableAdditionalRenderTargets.push(e)}GetEffectCompositorRenderTarget(){var e={sampling:this._runtime.GetSampling()};return"low"===this.GetCurrentFullscreenScalingQuality()&&(e.width=this.GetDrawWidth(),e.height=this.GetDrawHeight()),this.GetAdditionalRenderTarget(e)}ReleaseEffectCompositorRenderTarget(e){this.ReleaseAdditionalRenderTarget(e)}*activeLayersGpuProfiles(){for(var e of this._runtime.GetLayoutManager().runningLayouts())for(var t of e.GetLayers()){t=this._layersGpuProfile.get(t);t&&(yield t)}}GetLayerTimingsBuffer(e){if(!this.GetRenderer().SupportsGPUProfiling())return null;let t=this._layersGpuProfile.get(e);return t||(t={layer:e,name:e.GetName(),timingsBuffer:C33.New(C33.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastTotalUtilisation:0,lastSelfUtilisation:0},this._layersGpuProfile.set(e,t)),t.timingsBuffer}_Update1sFrameRange(){var e=this.GetRenderer();if(e.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=e.GetFrameNumber(),this._gpuCurUtilisation=NaN;for(var t of this.activeLayersGpuProfiles())t.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL(),this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(var e of this.activeLayersGpuProfiles())if(e.curUtilisation=e.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(e.curUtilisation))return;if(this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1),this._runtime.IsDebug()){let r=new Map;for(var t of this.activeLayersGpuProfiles())t.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),t.lastTotalUtilisation=Math.min(t.curUtilisation,1),r.set(t.layer,t.lastTotalUtilisation);for(var i of this.activeLayersGpuProfiles()){var s=i.layer,s=(r.get(s)||0)-s.GetSubLayers().reduce((e,t)=>e+(r.get(t)||0),0);i.lastSelfUtilisation=C33.clamp(s,0,1)}var a=this._runtime.GetMainRunningLayout(),a=this._gpuLastUtilisation-a._GetRootLayers().reduce((e,t)=>e+(r.get(t)||0),0);self.C3Debugger.UpdateGPUProfile(C33.clamp(a,0,1),this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0!==this._gpuTimeEndFrame){for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){var r=this._webgpuFrameTimings.get(e);if(r&&!r.HasResult())return}var e=this._runtime.GetMainRunningLayout(),s=C33.MakeFilledArray(e.GetLayerCount()+1,0);let t=0;for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){var a=this._webgpuFrameTimings.get(e);if(a){var n=a.GetResult();let r=BigInt(0),i=BigInt(0);var o=BigInt(0);for(let e=0,t=Math.min(s.length,n.length/2);e<t;++e){var l=n[2*e],h=n[2*e+1],h=(l!==o&&(r===o||l<r)&&(r=l),h>i&&(i=h),h-l),l=Number(h)/1e9;s[e]+=l}a=i-r,a=Number(a)/1e9;t+=a}}if(this._gpuLastUtilisation=C33.clamp(t,0,1),this._runtime.IsDebug()){var u=e.GetLayers();let r=new Map;for(let e=0,t=Math.min(u.length,s.length-1);e<t;++e){var c=s[e+1];r.set(u[e],c)}var _,d,p=[];let i=new Map;for([_,d]of r){var m=[..._.selfAndAllSubLayers()].reduce((e,t)=>e+(r.get(t)||0),0);i.set(_,m),p.push({name:_.GetName(),lastSelfUtilisation:C33.clamp(d,0,1),lastTotalUtilisation:C33.clamp(m,0,1)})}e=this._gpuLastUtilisation-e._GetRootLayers().reduce((e,t)=>e+(i.get(t)||0),0);self.C3Debugger.UpdateGPUProfile(C33.clamp(e,0,1),this._gpuLastUtilisation,p)}for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e)this._webgpuFrameTimings.delete(e);this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}_AddWebGPUFrameTiming(e){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),e)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(e,t,r,i,s,a){return this._snapshotFormat=e,this._snapshotQuality=t,this._snapshotArea.setWH(r,i,s,a),this._snapshotPromise||(this._snapshotPromise=new Promise(e=>{this._snapshotResolve=e})),this._snapshotPromise}_MaybeTakeSnapshot(){if(this._snapshotFormat){let e=this.GetMainCanvas();var i=this._snapshotArea,s=C33.clamp(Math.floor(i.getLeft()),0,e.width),a=C33.clamp(Math.floor(i.getTop()),0,e.height);let t=i.width(),r=(t=0===t?e.width-s:C33.clamp(Math.floor(t),0,e.width-s),i.height());r=0===r?e.height-a:C33.clamp(Math.floor(r),0,e.height-a),(0!==s||0!==a||t!==e.width||r!==e.height)&&0<t&&0<r&&((i=C33.CreateCanvas(t,r)).getContext("2d").drawImage(e,s,a,t,r,0,0,t,r),e=i),C33.CanvasToBlob(e,this._snapshotFormat,this._snapshotQuality).then(e=>{this._snapshotUrl&&URL.revokeObjectURL(this._snapshotUrl),this._snapshotUrl=URL.createObjectURL(e),this._snapshotPromise=null,this._snapshotResolve(this._snapshotUrl)}),this._snapshotFormat="",this._snapshotQuality=1}}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(e){e?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return 0<this._isPastingToDrawingCanvas}InitLoadingScreen(e){let t=this.GetRenderer();var r;2===e?(this._percentText=C33.New(C33.Gfx.RendererText,this.GetRenderer()),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),this._percentText.SetSize(PERCENTTEXT_WIDTH,PERCENTTEXT_HEIGHT)):0===e?(r=this._runtime.GetLoadingLogoAsset())&&r.LoadStaticTexture(t).catch(e=>console.warn("[C3 runtime] Failed to create texture for loading logo: ",e)):4===e&&(this._LoadSvgSplashImage("splash-images/splash-logo.svg").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.logo=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-poweredby-512.png").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.powered=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-website-512.png").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.website=e}).catch(e=>console.warn("Failed to load splash image: ",e)))}async _LoadSvgSplashImage(e){e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString();e=await C33.FetchBlob(e),e=await this._runtime.RasterSvgImage(e,2048,2048);return this.GetRenderer().CreateStaticTextureAsync(e,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(e){e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString();e=await C33.FetchBlob(e);return this.GetRenderer().CreateStaticTextureAsync(e,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now(),this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen()),3!==this._runtime.GetLoaderStyle()&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){var e=this.GetRenderer(),t=(this._loadingProgress=1,this._runtime.GetLoaderStyle());4===t&&await this._splashDonePromise,this._splashDoneResolve=null,this._splashDonePromise=null,-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1),this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler),this._loadingprogress_handler=null,this._percentText&&(this._percentText.Release(),this._percentText=null),this._runtime.ReleaseLoadingLogoAsset(),e.Start(),this._splashTextures.logo&&(e.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null),this._splashTextures.powered&&(e.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null),this._splashTextures.website&&(e.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null),e.ClearRgba(0,0,0,0),e.Finish(),this._splashState="done",this._gpuTimeStartFrame=e.GetFrameNumber(),3===t&&this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(-1!==this._rafId){var e=this.GetRenderer(),t=(e.Start(),this._rafId=-1,this._runtime.GetAssetManager().HasHadErrorLoading()),r=this._runtime.GetLoaderStyle();if(3!==r&&(this.SetCssTransform(e),e.ClearRgba(0,0,0,0),e.ResetColor(),e.SetTextureFillMode(),e.SetTexture(null)),0===r)this._DrawProgressBarAndLogoLoadingScreen(t);else if(1===r)this._DrawProgressBarLoadingScreen(t,PROGRESSBAR_WIDTH,0);else if(2===r)this._DrawPercentTextLoadingScreen(t);else if(3===r)C33.noop();else{if(4!==r)throw new Error("invalid loader style");this._DrawSplashLoadingScreen(t)}e.Finish(),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen())}}_DrawPercentTextLoadingScreen(e){e?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6),this._percentText.SetText(Math.round(100*this._loadingProgress)+"%");var e=this._canvasCssWidth/2,t=this._canvasCssHeight/2,r=PERCENTTEXT_WIDTH/2,i=PERCENTTEXT_HEIGHT/2,e=(tempQuad.setRect(e-r,t-i,e+r,t+i),this.GetRenderer());e.SetTexture(this._percentText.GetTexture()),e.Quad3(tempQuad,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(e,t,r){var i=this.GetRenderer(),s=PROGRESSBAR_HEIGHT,e=(i.SetColorFillMode(),e?i.SetColorRgba(1,0,0,1):i.SetColorRgba(.118,.565,1,1),this._canvasCssWidth/2),a=this._canvasCssHeight/2,n=t/2,o=s/2;tempRect.setWH(e-n,a-o+r,Math.floor(t*this._loadingProgress),s),i.Rect(tempRect),tempRect.setWH(e-n,a-o+r,t,s),tempRect.offset(-.5,-.5),tempRect.inflate(.5,.5),i.SetColorRgba(0,0,0,1),i.LineRect2(tempRect),tempRect.inflate(1,1),i.SetColorRgba(1,1,1,1),i.LineRect2(tempRect)}_DrawProgressBarAndLogoLoadingScreen(e){var t,r,i,s,a,n=this.GetRenderer(),o=this._runtime.GetLoadingLogoAsset();(o=o&&o.GetTexture())?(t=o.GetWidth(),a=o.GetHeight(),r=this._canvasCssWidth/2,i=this._canvasCssHeight/2,s=t/2,a=a/2,tempQuad.setRect(r-s,i-a,r+s,i+a),n.SetTexture(o),n.Quad(tempQuad),this._DrawProgressBarLoadingScreen(e,t,16+a)):this._DrawProgressBarLoadingScreen(e,PROGRESSBAR_WIDTH,0)}_DrawSplashLoadingScreen(e){var t=this.GetRenderer(),r=this._splashTextures.logo,i=this._splashTextures.powered,s=this._splashTextures.website,a=Date.now(),n=(0===this._splashFrameNumber&&(this._loaderStartTime=a),this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova()),o=n?0:SPLASH_AFTER_FADEOUT_WAIT_TIME,l=n?0:SPLASH_MIN_DISPLAY_TIME;let h=1;"fade-in"===this._splashState?h=Math.min((a-this._loaderStartTime)/SPLASH_FADE_DURATION,1):"fade-out"===this._splashState&&(h=Math.max(1-(a-this._splashFadeOutStartTime)/SPLASH_FADE_DURATION,0)),t.SetColorFillMode(),t.SetColorRgba(.231*h,.251*h,.271*h,h),tempRect.set(0,0,this._canvasCssWidth,this._canvasCssHeight),t.Rect(tempRect);var u=Math.ceil(this._canvasCssWidth),c=Math.ceil(this._canvasCssHeight);let _,d;256<this._canvasCssHeight?(t.SetColorRgba(.302*h,.334*h,.365*h,h),_=u,d=Math.max(.005*c,2),tempRect.setWH(0,.8*c-d/2,_,d),t.Rect(tempRect),e?t.SetColorRgba(h,0,0,h):t.SetColorRgba(.161*h,.953*h,.816*h,h),_=u*this._loadingProgress,tempRect.setWH(.5*u-_/2,.8*c-d/2,_,d),t.Rect(tempRect),t.SetColorRgba(h,h,h,h),t.SetTextureFillMode(),i&&(_=1.5*C33.clamp(.22*c,105,.6*u),d=_/8,tempRect.setWH(.5*u-_/2,.2*c-d/2,_,d),t.SetTexture(i),t.Rect(tempRect)),r&&(_=Math.min(.395*c,.95*u),d=_,tempRect.setWH(.5*u-_/2,.485*c-d/2,_,d),t.SetTexture(r),t.Rect(tempRect)),s&&(_=1.5*C33.clamp(.22*c,105,.6*u),d=_/8,tempRect.setWH(.5*u-_/2,.868*c-d/2,_,d),t.SetTexture(s),t.Rect(tempRect))):(t.SetColorRgba(.302*h,.334*h,.365*h,h),_=u,d=Math.max(.005*c,2),tempRect.setWH(0,.85*c-d/2,_,d),t.Rect(tempRect),e?t.SetColorRgba(h,0,0,h):t.SetColorRgba(.161*h,.953*h,.816*h,h),_=u*this._loadingProgress,tempRect.setWH(.5*u-_/2,.85*c-d/2,_,d),t.Rect(tempRect),t.SetColorRgba(h,h,h,h),t.SetTextureFillMode(),r&&(_=.55*c,d=_,tempRect.setWH(.5*u-_/2,.45*c-d/2,_,d),t.SetTexture(r),t.Rect(tempRect))),this._splashFrameNumber++,"fade-in"===this._splashState&&a-this._loaderStartTime>=SPLASH_FADE_DURATION&&2<=this._splashFrameNumber&&(this._splashState="wait",this._splashFadeInFinishTime=a),"wait"===this._splashState&&a-this._splashFadeInFinishTime>=l&&1<=this._loadingProgress&&(this._splashState="fade-out",this._splashFadeOutStartTime=a),("fade-out"===this._splashState&&a-this._splashFadeOutStartTime>=SPLASH_FADE_DURATION+o||n&&1<=this._loadingProgress&&a-this._loaderStartTime<500)&&this._splashDoneResolve()}}}{let C33=self.C3,C3Debugger=self.C3Debugger,assert=self.assert,DEFAULT_RUNTIME_OPTS={messagePort:null,runtimeBaseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,exportType:""},ife=!0;C33.Runtime=class C3Runtime extends C33.DefendedBase{constructor(e){e=Object.assign({},DEFAULT_RUNTIME_OPTS,e),super(),this._messagePort=e.messagePort,this._runtimeBaseUrl=e.runtimeBaseUrl,this._previewUrl=e.previewUrl,this._isHeadless=!!e.headless,this._hasDom=!!e.hasDom,this._isInWorker=!!e.isInWorker,ife=e.ife,this._useAudio=!!e.useAudio,this._exportType=e.exportType,this._isiOSCordova=!!e.isiOSCordova,this._isiOSWebView=!!e.isiOSWebView,this._isWindowsWebView2=!!e.isWindowsWebView2,this._isAnyWebView2Wrapper=!!e.isAnyWebView2Wrapper,this._isFBInstantAvailable=!!e.isFBInstantAvailable,this._isDebug=!("preview"!==this._exportType||!e.isDebug),this._breakpointsEnabled=this._isDebug,this._isDebugging=this._isDebug,this._debuggingDisabled=0,this._additionalLoadPromises=[],this._additionalCreatePromises=[],this._isUsingCreatePromises=!1,this._projectName="",this._projectVersion="",this._projectUniqueId="",this._appId="",this._originalViewportWidth=0,this._originalViewportHeight=0,this._devicePixelRatio=self.devicePixelRatio,this._parallaxXorigin=0,this._parallaxYorigin=0,this._viewportWidth=0,this._viewportHeight=0,this._loaderStyle=0,this._usesLoaderLayout=!1,this._isLoading=!0,this._usesAnyBackgroundBlending=!1,this._usesAnyCrossSampling=!1,this._usesAnyDepthSampling=!1,this._loadingLogoAsset=null,this._assetManager=C33.New(C33.AssetManager,this,e),this._layoutManager=C33.New(C33.LayoutManager,this),this._eventSheetManager=C33.New(C33.EventSheetManager,this),this._addonManager=C33.New(C33.AddonManager,this,e.wrapperComponentIds),this._collisionEngine=C33.New(C33.CollisionEngine,this),this._timelineManager=C33.New(C33.TimelineManager,this),this._transitionManager=C33.New(C33.TransitionManager,this),this._templateManager=C33.New(C33.TemplateManager,this),this._flowchartManager=C33.New(C33.FlowchartManager,this),this._textIconManager=C33.New(C33.TextIconManager,{getIconSetMeta:e=>this._GetTextIconSetMeta(e),getIconSetContent:e=>this._GetTextIconSetContent(e)}),this._iconChangeHandlers=new Map,this._allObjectClasses=[],this._objectClassesByName=new Map,this._objectClassesBySid=new Map,this._familyCount=0,this._allContainers=[],this._allEffectLists=new Set,this._currentLayoutStack=[],this._instancesPendingCreate=[],this._instancesPendingDestroy=new Map,this._hasPendingInstances=!1,this._isFlushingPendingInstances=!1,this._objectCount=0,this._nextUid=0,this._instancesByUid=new Map,this._instancesPendingRelease=new Set,this._instancesPendingReleaseAffectedObjectClasses=new Set,this._objectReferenceTable=[],this._jsPropNameTable=[],this._canvasManager=null,this._uses3dFeatures=!1,this._framerateMode="vsync",this._sampling="trilinear",this._isPixelRoundingEnabled=!1,this._needRender=!0,this._pauseOnBlur=!1,this._isPausedOnBlur=!1,this._exportToVideo=null,this._tickCallbacks={normal:e=>{this._rafId=-1,this._ruafId=-1,this.Tick(e)},tickOnly:e=>{this._ruafId=-1,this.Tick(e,!1,"skip-render")},renderOnly:()=>{this._rafId=-1,this.Render()}},this._rafId=-1,this._ruafId=-1,this._tickCount=0,this._tickCountNoSave=0,this._hasStarted=!1,this._isInTick=!1,this._hasStartedTicking=!1,this._isLayoutFirstTick=!0,this._isAutoSuspendEnabled=!0,this._isPageVisibilitySuspended=!1,this._suspendCount=0,this._scheduleTriggersThrottle=new C33.PromiseThrottle(1),this._randomNumberCallback=()=>Math.random(),this._startTime=0,this._lastTickTime=0,this._dtRaw=0,this._dt1=0,this._dt=0,this._timeScale=1,this._maxDt=1/30,this._minDt=0,this._gameTime=C33.New(C33.KahanSum),this._gameTimeRaw=C33.New(C33.KahanSum),this._wallTime=C33.New(C33.KahanSum),this._instanceTimes=new Map,this._fpsFrameCount=-1,this._fpsLastTime=0,this._fps=0,this._tpsTickCount=-1,this._tps=0,this._mainThreadTimeCounter=0,this._mainThreadTime=0,this._isLoadingState=!1,this._saveToSlotName="",this._loadFromSlotName="",this._loadFromJson=null,this._lastSaveJson="",this._projectStorage=null,this._savegamesStorage=null,this._dispatcher=C33.New(C33.Event.Dispatcher),this._domEventHandlers=new Map,this._pendingResponsePromises=new Map,this._nextDomResponseId=0,this._didRequestDeviceOrientationEvent=!1,this._didRequestDeviceMotionEvent=!1,this._isReadyToHandleEvents=!1,this._waitingToHandleEvents=[],this._eventObjects={pretick:C33.New(C33.Event,"pretick",!1),tick:C33.New(C33.Event,"tick",!1),tick2:C33.New(C33.Event,"tick2",!1),instancedestroy:C33.New(C33.Event,"instancedestroy",!1),beforelayoutchange:C33.New(C33.Event,"beforelayoutchange",!1),layoutchange:C33.New(C33.Event,"layoutchange",!1)},this._eventObjects.instancedestroy.instance=null,this._userScriptDispatcher=C33.New(C33.Event.Dispatcher),this._userScriptEventObjects=null;var t=(e,t)=>C33.BehaviorInstance.SortByTickSequence(this,e,t);this._behInstsToTick=C33.New(C33.RedBlackSet,t),this._behInstsToPostTick=C33.New(C33.RedBlackSet,t),this._behInstsToTick2=C33.New(C33.RedBlackSet,t),this._jobScheduler=C33.New(C33.JobSchedulerRuntime,this,e.jobScheduler),e.canvas&&(this._canvasManager=C33.New(C33.CanvasManager,this)),this._messagePort.onmessage=e=>this._OnMessageFromDOM(e.data),this.AddDOMComponentMessageHandler("runtime","visibilitychange",e=>this._OnVisibilityChange(e)),this.AddDOMComponentMessageHandler("runtime","wrapper-extension-message",e=>this._OnWrapperExtensionMessage(e)),this.AddDOMComponentMessageHandler("runtime","opus-decode",e=>this._WasmDecodeWebMOpus(e.arrayBuffer)),this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",()=>this._GetRemotePreviewStatusInfo()),this.AddDOMComponentMessageHandler("runtime","js-invoke-function",e=>this._InvokeFunctionFromJS(e)),this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript),this.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",e=>this._OnOfflineAudioRenderCompleted(e)),this._dispatcher.addEventListener("window-blur",e=>this._OnWindowBlur(e)),this._dispatcher.addEventListener("window-focus",()=>this._OnWindowFocus()),this._timelineManager.AddRuntimeListeners(),this._templateManager.AddRuntimeListeners(),this._iRuntime=null,this._interfaceMap=new WeakMap,this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null,timelineController:null,platformInfo:null},this._instancesNeedingAfterLoadMap=new WeakMap,this._instancesNeedingAfterLoadArray=[]}static Create(e){return C33.New(C33.Runtime,e)}Release(){C33.clearArray(this._allObjectClasses),this._objectClassesByName.clear(),this._objectClassesBySid.clear(),this._layoutManager.Release(),this._layoutManager=null,this._eventSheetManager.Release(),this._eventSheetManager=null,this._addonManager.Release(),this._addonManager=null,this._assetManager.Release(),this._assetManager=null,this._collisionEngine.Release(),this._collisionEngine=null,this._timelineManager.Release(),this._timelineManager=null,this._transitionManager.Release(),this._transitionManager=null,this._templateManager.Release(),this._templateManager=null,this._flowchartManager.Release(),this._flowchartManager=null,this._textIconManager.Release(),this._textIconManager=null,this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null),this._dispatcher.Release(),this._dispatcher=null,this._tickEvent=null}["_OnMessageFromDOM"](e){var t=e.type;if("event"===t)this._OnEventFromDOM(e);else{if("result"!==t)throw new Error(`unknown message '${t}'`);this._OnResultFromDOM(e)}}_OnEventFromDOM(e){if(this._isReadyToHandleEvents){let t=e.component,r=e.handler;var s=e.data,a=e.dispatchOpts,n=!(!a||!a.dispatchRuntimeEvent),a=!(!a||!a.dispatchUserScriptEvent);let i=e.responseId;if("runtime"===t)if(n&&((u=new C33.Event(r)).data=s,this._dispatcher.dispatchEventAndWaitAsyncSequential(u)),a){var o,l,h=new C33.Event(r,!0);for([o,l]of Object.entries(s))h[o]=l;this.DispatchUserScriptEvent(h)}var u=this._domEventHandlers.get(t);if(u){u=u.get(r);if(u){let e=null;try{e=u(s)}catch(e){return console.error(`Exception in '${t}' handler '${r}':`,e),void(null!==i&&this._PostResultToDOM(i,!1,""+e))}null!==i&&(e&&e.then?e.then(e=>this._PostResultToDOM(i,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${r}':`,e),this._PostResultToDOM(i,!1,""+e)}):this._PostResultToDOM(i,!0,e))}else n||a||console.warn(`[Runtime] No DOM handler '${r}' for component '${t}'`)}else n||a||console.warn(`[Runtime] No DOM event handlers for component '${t}'`)}else this._waitingToHandleEvents.push(e)}_PostResultToDOM(e,t,r){this._messagePort.postMessage({type:"result",responseId:e,isOk:t,result:r})}_OnResultFromDOM(e){var t=e.responseId,r=e.isOk,e=e.result,i=this._pendingResponsePromises.get(t);r?i.resolve(e):i.reject(e),this._pendingResponsePromises.delete(t)}AddDOMComponentMessageHandler(e,t,r){let i=this._domEventHandlers.get(e);if(i||(i=new Map,this._domEventHandlers.set(e,i)),i.has(t))throw new Error(`[Runtime] Component '${e}' already has handler '${t}'`);i.set(t,r)}PostComponentMessageToDOM(e,t,r,i){this._messagePort.postMessage({type:"event",component:e,handler:t,data:r,responseId:null},i)}PostComponentMessageToDOMAsync(e,t,r,i){let s=this._nextDomResponseId++;var a=new Promise((e,t)=>{this._pendingResponsePromises.set(s,{resolve:e,reject:t})});return this._messagePort.postMessage({type:"event",component:e,handler:t,data:r,responseId:s},i),a}SendWrapperExtensionMessage(e,t,r,i=-1){this.PostComponentMessageToDOM("runtime","send-wrapper-extension-message",{componentId:e,messageId:t,params:r,asyncId:i})}SendWrapperExtensionMessageAsync(e,t,r){let i=this._nextDomResponseId++;var s=new Promise((e,t)=>{this._pendingResponsePromises.set(i,{resolve:e,reject:t})});return this.SendWrapperExtensionMessage(e,t,r,i),s}_OnWrapperExtensionMessage(e){var t;-1!==e.asyncId?(t=e.asyncId,this._pendingResponsePromises.get(t).resolve(e.params),this._pendingResponsePromises.delete(t)):this._OnEventFromDOM({component:"wrapper-extension:"+e.componentId,handler:e.messageId,data:e.params,responseId:null})}AddWrapperExtensionMessageHandler(e,t,r){this.AddDOMComponentMessageHandler("wrapper-extension:"+e,t,r)}HasWrapperComponentId(e){return this._addonManager.HasWrapperComponentId(e)}PostToDebugger(e){if(!this.IsDebug())throw new Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",e)}async Init(e){C33.CommonACES_SetRuntime(this),this.IsDebug()?await C3Debugger.Init(this):self.C3Debugger&&self.C3Debugger.InitPreview(this);var t,r,[i]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);await this._LoadDataJson(i),await this._InitialiseCanvas(e),this.IsPreview()||console.info("%cMade with Construct, the game and animation creation tool. Visit: https://www.construct.net","font-weight: bold"),this.GetWebGLRenderer()?(i=this.GetWebGLRenderer(),console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGL ${i.GetWebGLVersionNumber()} [${i.GetUnmaskedRenderer()}]`)):this.GetWebGPURenderer()&&console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGPU [${this.GetWebGPURenderer().GetAdapterInfoString()}]`),this.GetRenderer().HasMajorPerformanceCaveat()&&console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance."),this._isReadyToHandleEvents=!0;for(t of this._waitingToHandleEvents)this._OnEventFromDOM(t);C33.clearArray(this._waitingToHandleEvents),this._canvasManager&&this._canvasManager.StartLoadingScreen();for(r of e.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(r));if(await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]),C33.clearArray(this._additionalLoadPromises),!this._assetManager.HasHadErrorLoading())return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new C33.Event("beforeruntimestart")),await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this;this._canvasManager&&this._canvasManager.HideCordovaSplashScreen()}async _RunOnStartupFunction(e){try{await e(this._iRuntime)}catch(e){console.error("[C3 runtime] Error in runOnStartup function: ",e)}}async _LoadDataJson(e){var e=e.project,t=(this._projectName=e[0],this._projectVersion=e[16],this._projectUniqueId=e[31],this._appId=e[38],e[39]||"loading-logo.png"),r=(this._isPixelRoundingEnabled=!!e[9],this._originalViewportWidth=this._viewportWidth=e[10],this._originalViewportHeight=this._viewportHeight=e[11],this._collisionEngine._InitCollisionCellSize(this._originalViewportWidth,this._originalViewportHeight),this._parallaxXorigin=this._originalViewportWidth/2,this._parallaxYorigin=this._originalViewportHeight/2,this._framerateMode=e[37],this._uses3dFeatures=!!e[40],this._sampling=e[14],this._usesAnyBackgroundBlending=e[15],this._usesAnyCrossSampling=e[42],this._usesAnyDepthSampling=e[17],this._usesLoaderLayout=!!e[18],this._loaderStyle=e[19],this._nextUid=e[21],this._pauseOnBlur=e[22],this._assetManager);if(r._SetFileStructure(e[45]),r._SetAudioFiles(e[7],e[25]),r._SetMediaSubfolder(e[8]),r._SetFontsSubfolder(e[32]),r._SetIconsSubfolder(e[28]),r._SetWebFonts(e[29]),0===this._loaderStyle){let e="";(e="flat"===r.GetFileStructure()?r.GetIconsSubfolder()+t:t)&&(this._loadingLogoAsset=r.LoadImage({url:e}))}this._canvasManager&&(this._canvasManager.SetFullscreenMode(C33.CanvasManager._FullscreenModeNumberToString(e[12])),this._canvasManager.SetFullscreenScalingQuality(e[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==e[24]),this._canvasManager._SetGPUPowerPreference(e[34]),this._canvasManager._SetTextureAnisotropy(e[41]),this._canvasManager._SetWebGPUEnabled(e[13]),this._canvasManager._SetZAxisScale(e[30]),this._canvasManager._SetZDistances(e[46],e[47]),this._canvasManager._SetInitFieldOfView(e[26]),this._canvasManager._SetLimitedToWebGL1(e[48]));var i,s,a,n,o,l,h,t=e[43],r=(t&&await this._LoadExportToVideoData(t),this._InitScriptInterfaces(),this._addonManager.CreateSystemPlugin(),this._objectReferenceTable=self.C3_GetObjectRefTable(),e[2]);for(i of r[1])this._addonManager.CreateBehavior(i);for(s of r[0])this._addonManager.CreatePlugin(s);this._objectReferenceTable=self.C3_GetObjectRefTable(),this._LoadJsPropNameTable(),this._addonManager._InitAddonScriptInterfaces();for(a of e[3]){var u=C33.ObjectClass.Create(this,this._allObjectClasses.length,a);this._allObjectClasses.push(u),this._objectClassesByName.set(u.GetName().toLowerCase(),u),this._objectClassesBySid.set(u.GetSID(),u)}for(n of e[4])this._allObjectClasses[n[0]]._LoadFamily(n);for(o of e[27]){var c=o.map(e=>this._allObjectClasses[e]);this._allContainers.push(C33.New(C33.Container,this,c))}this._InitObjectsScriptInterface();for(l of this._allObjectClasses)l._OnAfterCreate();for(h of e[5])this._layoutManager.Create(h);var _,d,p,m,g,t=e[1];t&&(r=this._layoutManager.GetLayoutByName(t))&&this._layoutManager.SetFirstLayout(r);for(_ of e[35])this._transitionManager.Create(_);for(d of e[33])this._timelineManager.Create(d);for(p of e[44])this._templateManager.Create(p);this._templateManager.HasTemplates()||(this._templateManager.Release(),this._templateManager=null);for(m of e[49])this._flowchartManager.Create(m);this._flowchartManager.HasFlowcharts()||(this._flowchartManager.Release(),this._flowchartManager=null);for(g of e[6])this._eventSheetManager.Create(g);this._eventSheetManager._PostInit(),this._InitGlobalVariableScriptInterface(),C33.clearArray(this._objectReferenceTable),this.FlushPendingInstances();let f="any";t=e[20];1===t?f="portrait":2===t&&(f="landscape"),this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:f})}async _LoadExportToVideoData(e){var t=e.format;"image-sequence"===t?this._exportToVideo=new self.C3ExportToImageSequence(this,e):"image-sequence-gif"===t?this._exportToVideo=new self.C3ExportToGIF(this,e):"webm"===t?this._exportToVideo=new self.C3ExportToWebMVideo(this,e):"mp4"===t&&(this._exportToVideo=new self.C3ExportToMP4Video(this,e)),this._framerateMode="unlimited-frame",this._canvasManager.SetFullscreenMode("off"),this._devicePixelRatio=1,self.devicePixelRatio=1,await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{message:this._exportToVideo.GetExportingMessageForPercent(0),duration:this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return null!==this._exportToVideo}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){var e=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetMainCanvas(),e)}_ExportToVideoAddKeyframe(){this._exportToVideo&&this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(e){this._additionalLoadPromises.push(e)}SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e}AddCreatePromise(e){this._isUsingCreatePromises&&this._additionalCreatePromises.push(e)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(e){this._allEffectLists.add(e)}_RemoveEffectList(e){this._allEffectLists.delete(e)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(e){this._canvasManager&&(await this._canvasManager.CreateCanvas(e),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){var t=this._assetManager;if(!t.IsAudioFormatSupported("audio/webm; codecs=opus")){let e=null;var r=t.GetScriptSubfolder(),i=r+"opus.wasm.js",r=r+"opus.wasm.wasm";try{e=this.IsiOSCordova()&&t.IsFileProtocol()?await t.CordovaFetchLocalFileAsArrayBuffer(r):await t.FetchArrayBuffer(r)}catch(e){return void console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",e)}this.AddJobWorkerBuffer(e,"opus-decoder-wasm"),await this.AddJobWorkerScripts([i])}}async _WasmDecodeWebMOpus(e){return await this.AddJob("OpusDecode",{arrayBuffer:e},[e])}async Start(){this._hasStarted=!0,this._startTime=Date.now();let t=null,e=new Promise(e=>t=e);if(this._usesLoaderLayout){for(var r of this._allObjectClasses)r.IsFamily()||r.IsOnLoaderLayout()||!r.IsWorldType()||r.OnCreate();(async()=>{await this._assetManager.WaitForAllToLoad(),await e,this._isLoading=!1,this._OnLoadFinished()})()}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished(),this.IsDebug()&&C3Debugger.RuntimeInit(ife);for(var i of this._layoutManager.GetAllLayouts())i._CreateGlobalNonWorlds();this.IsExportToVideo()&&await this._InitExportToVideo();var s=this._layoutManager.GetFirstLayout(),s=(await s._Load(null,this.GetRenderer()),await s._StartRunning(!0),this._fpsLastTime=performance.now(),t(),this._usesLoaderLayout||this._OnLoadFinished(),await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking"));s.isSuspended&&!this.IsExportToVideo()?(this._suspendCount++,this._isPageVisibilitySuspended=!0):this.Tick()}_OnLoadFinished(){this.Trigger(C33.Plugins.System.Cnds.OnLoadFinished,null,null),this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(e){e=Math.floor(e);var t=this._objectReferenceTable;if(e<0||e>=t.length)throw new Error("invalid object reference");return t[e]}_LoadJsPropNameTable(){for(var e of self.C3_JsPropNameTable){e=C33.first(Object.keys(e));this._jsPropNameTable.push(e)}}GetJsPropName(e){e=Math.floor(e);var t=this._jsPropNameTable;if(e<0||e>=t.length)throw new Error("invalid prop reference");return t[e]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetAddonManager(){return this._addonManager}GetSystemPlugin(){return this._addonManager.GetSystemPlugin()}GetObjectClassByIndex(e){if((e=Math.floor(e))<0||e>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[e]}GetObjectClassByName(e){return this._objectClassesByName.get(e.toLowerCase())||null}GetObjectClassBySID(e){return this._objectClassesBySid.get(e)||null}GetSingleGlobalObjectClassByCtor(e){e=C33.AddonManager.GetPluginByConstructorFunction(e);return e?e.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(var e of this._allObjectClasses)e.IsFamily()||(yield*e.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();var t=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();t&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.runtime=this.GetIRuntime(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(e,t){this._originalViewportWidth===e&&this._originalViewportHeight===t||(this._originalViewportWidth=e,this._originalViewportHeight=t,(e=this.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(e,t){this._viewportWidth===e&&this._viewportHeight===t||(this._viewportWidth=e,this._viewportHeight=t,(e=this.GetLayoutManager()).SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}_SetDevicePixelRatio(e){this.IsExportToVideo()||(this._devicePixelRatio=e)}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(e){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(e):null}ReleaseAdditionalRenderTarget(e){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(e)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}_SetFramerateMode(e){this._framerateMode!==e&&(this._framerateMode=e,-1!==this._rafId||-1!==this._ruafId)&&(this._CancelAnimationFrame(),this._RequestAnimationFrame())}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.ReleaseTexture(),this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetFlowchartManager(){return this._flowchartManager}GetAssetManager(){return this._assetManager}LoadImage(e){return this._assetManager.LoadImage(e)}CreateInstance(e,t,r,i,s,a){if(a&&this._templateManager){if(e instanceof C33.ObjectClass&&e.IsFamily())return o=e.GetFamilyMembers(),n=Math.floor(this.Random()*o.length),this.CreateInstance(o[n],t,r,i,s,a);var n,o=this._templateManager.GetTemplateData(e,a);if(o)return n=this.CreateInstanceFromData(o,t,!1,r,i,!1,s,void 0,s),this._templateManager.MapInstanceToTemplateName(n,a),n}return this.CreateInstanceFromData(e,t,!1,r,i,!1,s,void 0,s)}CreateInstanceFromData(e,t,r,i,s,a,n,o,l){let h=null,u=null;e instanceof C33.ObjectClass?((u=e).IsFamily()&&(c=u.GetFamilyMembers(),p=Math.floor(this.Random()*c.length),u=c[p]),h=u.GetDefaultInstanceData()):(h=e,u=this.GetObjectClassByIndex(h[1]));var c=u.GetPlugin().IsWorldType();if(this._isLoading&&c&&!u.IsOnLoaderLayout())return null;var _=t;c||(t=null);let d;d=r&&!a&&h&&!this._instancesByUid.has(h[2])?h[2]:this._nextUid++;var p=h?h[0]:null,m=C33.New(C33.Instance,{runtime:this,objectType:u,layer:t,worldData:p,instVarData:h?h[3]:null,uid:d,tags:h?h[6]:null});this._instancesByUid.set(d,m);let g=null,f=(c&&(g=m.GetWorldInfo(),void 0!==i&&void 0!==s&&(g.SetX(i),g.SetY(s)),u._SetAnyCollisionCellChanged(!0)),t&&(l||t._AddInstance(m,!0),t.GetLayout().MaybeLoadTexturesFor(u)),this._objectCount++,!0);if(o&&(e=o.GetObjectClass()).IsInContainer()&&u.IsInContainer()&&u.GetContainer()===e.GetContainer()&&(f=!1),u.IsInContainer()&&!r&&!a&&f){var S,C,y,G=new Set;for(S of u.GetContainer().objectTypes())S!==u&&((C=this._MaybeGetChildInstanceForObjectTypeData(S,g,G))?(C=this.CreateInstanceFromData(C,_,!1,g?g.GetX():i,g?g.GetY():s,!0,!1,void 0,l),m._AddSibling(C)):(C=this.CreateInstanceFromData(S,_,!1,g?g.GetX():i,g?g.GetY():s,!0,!1,void 0,l),m._AddSibling(C)));for(y of m.siblings()){y._AddSibling(m);for(var I of m.siblings())y!==I&&y._AddSibling(I)}}if(c&&!r&&n&&this._CreateChildInstancesFromData(m,p,g,t,i,s,l),u.IsInContainer()&&!r&&!a&&n)for(var T of m.siblings()){var v,A,b=T.GetWorldInfo();b&&(v=T.GetPlugin(),A=T.GetObjectClass().GetDefaultInstanceData()[0],v.IsWorldType()?this._CreateChildInstancesFromData(T,A,b,t,b.GetX(),b.GetY(),l):this._CreateChildInstancesFromData(T,A,b,t,void 0,void 0,l))}!a&&n&&(void 0===i&&(i=p[0]),void 0===s&&(s=p[1]),o=g.GetTopParent(),e=i-g.GetX()+o.GetX(),r=s-g.GetY()+o.GetY(),o.SetXY(e,r)),u._SetIIDsStale();a=h?C33.cloneArray(h[5]):null,n=h?h[4].map(e=>C33.cloneArray(e)):null,o=c&&p&&p[13];return o&&m._SetHasTilemap(),m._CreateSdkInstance(a,n),o&&(e=p[13],m.GetSdkInstance().LoadTilemapData(e[2],e[0],e[1])),this._instancesPendingCreate.push(m),this._hasPendingInstances=!0,this.IsDebug()&&C3Debugger.InstanceCreated(m),m}_GetInstanceData(e){var t=e[0],r=e[1],i=e[2],e=e[6];return e||this._layoutManager.GetLayoutBySID(t).GetLayer(r).GetInitialInstanceData(i)}_MaybeGetChildInstanceForObjectTypeData(e,t,r){var i;for(i of t?.GetSceneGraphChildrenExportData()??[]){var s=this._GetInstanceData(i),a=!!i[4],n=this.GetObjectClassByIndex(s[1]);if(!r.has(s)&&(e===n&&a))return r.add(s),s}}_CreateChildInstancesFromData(t,e,r,i,s,a,n){var o=r.GetSceneGraphZIndexExportData(),r=r.GetSceneGraphChildrenExportData();if(t.GetWorldInfo().SetSceneGraphZIndex(o),r){void 0===s&&(s=e[0]),void 0===a&&(a=e[1]);var l,h=new Set,u=e[0],c=e[1];for(l of r){var _=l[0],d=l[1],p=l[2],m=l[3],g=!!l[4],f=l[5],S=l[6];let e;e=S||this._layoutManager.GetLayoutBySID(_).GetLayer(d).GetInitialInstanceData(p);var S=this.GetObjectClassByIndex(e[1]),_=t.HasSibling(S),d=h.has(S);_&&!d&&g?((p=t.GetSibling(S)).GetWorldInfo().Init(e[0]),_=s+e[0][0]-u,d=a+e[0][1]-c,p.GetWorldInfo().SetXY(_,d),p.GetWorldInfo().SetSceneGraphZIndex(f),t.AddChild(p,{transformX:!!(m>>0&1),transformY:!!(m>>1&1),transformWidth:!!(m>>2&1),transformHeight:!!(m>>3&1),transformAngle:!!(m>>4&1),destroyWithParent:!!(m>>5&1),transformZElevation:!!(m>>6&1),transformOpacity:!!(m>>7&1),transformVisibility:!!(m>>8&1)}),h.add(S)):(g=s+e[0][0]-u,_=a+e[0][1]-c,(d=this.CreateInstanceFromData(e,i,!1,g,_,!1,!0,t,n)).GetWorldInfo().SetSceneGraphZIndex(f),t.AddChild(d,{transformX:!!(m>>0&1),transformY:!!(m>>1&1),transformWidth:!!(m>>2&1),transformHeight:!!(m>>3&1),transformAngle:!!(m>>4&1),destroyWithParent:!!(m>>5&1),transformZElevation:!!(m>>6&1),transformOpacity:!!(m>>7&1),transformVisibility:!!(m>>8&1)}))}}}DestroyInstance(t){if(!this._instancesPendingRelease.has(t)){var r,i=t.GetObjectClass();let e=this._instancesPendingDestroy.get(i);if(e){if(e.has(t))return;e.add(t)}else(e=new Set).add(t),this._instancesPendingDestroy.set(i,e);if(this.IsDebug()&&C3Debugger.InstanceDestroyed(t),t._MarkDestroyed(),this._hasPendingInstances=!0,t.IsInContainer())for(var s of t.siblings())this.DestroyInstance(s);for(r of t.children())r.GetDestroyWithParent()&&this.DestroyInstance(r);this._layoutManager.IsEndingLayout()||this._isLoadingState||((i=this.GetEventSheetManager()).BlockFlushingInstances(!0),t._TriggerOnDestroyed(),i.BlockFlushingInstances(!1)),t._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._isFlushingPendingInstances=!1,this._hasPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(var e of this._instancesPendingCreate){var t,r=e.GetObjectClass();r._AddInstance(e);for(t of r.GetFamilies())t._AddInstance(e),t._SetIIDsStale()}C33.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(var[e,t]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(e,t),t.clear();this._instancesPendingDestroy.clear(),this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(e,t){for(var r of t){var i=this._eventObjects.instancedestroy,i=(i.instance=r,this._dispatcher.dispatchEvent(i),this._instancesByUid.delete(r.GetUID()),this._instanceTimes.delete(r),r.GetWorldInfo());i&&(i._RemoveFromCollisionCells(),i._RemoveFromRenderCells(),i._MarkDestroyed()),this._instancesPendingRelease.add(r),this._objectCount--}C33.arrayRemoveAllInSet(e.GetInstances(),t),e._SetIIDsStale(),this._instancesPendingReleaseAffectedObjectClasses.add(e);for(var s of e.GetFamilies())C33.arrayRemoveAllInSet(s.GetInstances(),t),s._SetIIDsStale(),this._instancesPendingReleaseAffectedObjectClasses.add(s);var a;if(e.GetPlugin().IsWorldType())for(a of new Set([...t].map(e=>e.GetWorldInfo().GetLayer())))a._RemoveAllInstancesInSet(t)}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(e){for(var t of this._GetInstancesPendingCreate())e.IsFamily()?t.GetObjectClass().BelongsToFamily(e)&&(yield t):t.GetObjectClass()===e&&(yield t)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(e,t){this._instancesByUid.set(e,t)}_SetAutoSuspendEnabled(e){this._isAutoSuspendEnabled!==(e=!!e)&&(this._isAutoSuspendEnabled=!!e,this._isAutoSuspendEnabled)&&this._isPageVisibilitySuspended&&(this.SetSuspended(!1),this._isPageVisibilitySuspended=!1)}_IsAutoSuspendEnabled(){return this._isAutoSuspendEnabled}_OnRendererContextLost(){this._dispatcher.dispatchEvent(C33.New(C33.Event,"renderercontextlost")),this.SetSuspended(!0);for(var e of this._allObjectClasses)!e.IsFamily()&&e.HasLoadedTextures()&&e.ReleaseTextures();var t=this.GetMainRunningLayout();t&&t._OnRendererContextLost(),C33.ImageInfo.OnRendererContextLost(),C33.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer()),this._dispatcher.dispatchEvent(C33.New(C33.Event,"renderercontextrestored")),this.SetSuspended(!1),this.UpdateRender()}_OnVisibilityChange(e){!this._isAutoSuspendEnabled||(e=e.hidden,this.SetSuspended(e),this._isPageVisibilitySuspended=e)||this.UpdateRender()}_OnWindowBlur(e){!this.IsPreview()||!this._pauseOnBlur||C33.Platform.IsMobile||e.data.parentHasFocus||(this.SetSuspended(!0),this._isPausedOnBlur=!0)}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){var e=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=C33.RequestUnlimitedAnimationFrame(e.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.renderOnly))):-1===this._ruafId&&(this._ruafId=C33.RequestUnlimitedAnimationFrame(e.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1),-1!==this._ruafId&&(C33.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return 0<this._suspendCount}SetSuspended(e){var t;this.IsExportToVideo()||(t=this.IsSuspended(),this._suspendCount+=e?1:-1,this._suspendCount<0&&(this._suspendCount=0),e=this.IsSuspended(),!t&&e?(console.log("[Construct] Suspending"),this._CancelAnimationFrame(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"suspend")),this.Trigger(C33.Plugins.System.Cnds.OnSuspend,null,null)):t&&!e&&(console.log("[Construct] Resuming"),t=performance.now(),this._lastTickTime=t,this._fpsLastTime=t,this._fpsFrameCount=0,this._fps=0,this._tpsTickCount=0,this._tps=0,this._mainThreadTime=0,this._mainThreadTimeCounter=0,this._dispatcher.dispatchEvent(C33.New(C33.Event,"resume")),this.Trigger(C33.Plugins.System.Cnds.OnResume,null,null),this.HitBreakpoint()||this.Tick(t)))}_AddBehInstToTick(e){this._behInstsToTick.Add(e)}_AddBehInstToPostTick(e){this._behInstsToPostTick.Add(e)}_AddBehInstToTick2(e){this._behInstsToTick2.Add(e)}_RemoveBehInstToTick(e){this._behInstsToTick.Remove(e)}_RemoveBehInstToPostTick(e){this._behInstsToPostTick.Remove(e)}_RemoveBehInstToTick2(e){this._behInstsToTick2.Remove(e)}_BehaviorTick(){var e,t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(e of this._behInstsToTick)e instanceof t?e._tick():e.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){var e,t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(e of this._behInstsToPostTick)e instanceof t?e._postTick():e.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){var e,t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(e of this._behInstsToTick2)e instanceof t?e._tick2():e.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){var t,r=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(t of this._behInstsToTick){let e;e=t instanceof r?t._tick():t.Tick(),C33.IsIterator(e)&&(yield*e)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){var t,r=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(t of this._behInstsToPostTick){let e;e=t instanceof r?t._postTick():t.PostTick(),C33.IsIterator(e)&&(yield*e)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){var t,r=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(t of this._behInstsToTick2){let e;e=t instanceof r?t._tick2():t.Tick2(),C33.IsIterator(e)&&(yield*e)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(t,r,i){this._hasStartedTicking=!0;var s="background-wake"===i,i="background-wake"!==i&&"skip-render"!==i,a=this.GetLayoutManager(),n=this.GetCanvasManager();if(this._hasStarted&&(!this.IsSuspended()||r||s)){var r=performance.now(),t=(this._isInTick=!0,this._MeasureDt(t||0),this._tpsTickCount++,this._ReleasePendingInstances(),this.Step_BeforePreTick()),t=(this.IsDebugging()&&await t,this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick)),t=(t instanceof Promise&&await t,this.Step_AfterPreTick()),t=(this.IsDebugging()&&await t,this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad(),a.IsPendingChangeMainLayout()&&await this._MaybeChangeLayout(),this.Step_RunEventsEtc()),t=(this.IsDebugging()&&await t,a.GetMainRunningLayout()),a=t._GetPendingSetHTMLLayerCount();let e=!1;-1!==a&&(t._ResetPendingHTMLLayerCount(),n.GetHTMLLayerCount()!==a)&&(t=this.GetCanvasManager().SetHTMLLayerCount(a),this.IsInWorker())&&(e=!0,await t),i&&this.Render(),e&&this.PostComponentMessageToDOM("canvas","cleanup-html-layers"),this.IsExportToVideo()&&(await this._ExportToVideoAddFrame(),this.GetGameTime()>=this.GetExportVideoDuration())?this._ExportToVideoFinish():(this.IsSuspended()||s||this._RequestAnimationFrame(),this._tickCount++,this._tickCountNoSave++,this._isInTick=!1,this._mainThreadTimeCounter+=performance.now()-r)}}async Step_BeforePreTick(){var e=this._eventSheetManager,t=this.IsDebug();this.FlushPendingInstances(),e.BlockFlushingInstances(!0),this.PushCurrentLayout(this.GetMainRunningLayout()),t&&C3Debugger.StartMeasuringTime(),this.IsDebugging()?await e.DebugRunScheduledWaits():e.RunScheduledWaits(),t&&C3Debugger.AddEventsTime(),this.PopCurrentLayout(),e.BlockFlushingInstances(!1),this.FlushPendingInstances(),e.BlockFlushingInstances(!0)}async Step_AfterPreTick(){var e=this.IsDebug(),t=this.IsDebugging(),r=this._dispatcher,i=this._eventObjects,s=this._userScriptEventObjects;e&&C3Debugger.StartMeasuringTime(),t?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick(),t?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick(),e&&C3Debugger.AddBehaviorTickTime(),e&&C3Debugger.StartMeasuringTime(),t?await this.DebugFireGeneratorEventAndBreak(i.tick):r.dispatchEvent(i.tick),e&&C3Debugger.AddPluginTickTime(),this._eventSheetManager.BlockFlushingInstances(!1),this.DispatchUserScriptEvent(s.tick)}async Step_RunEventsEtc(){var e=this._eventSheetManager,t=this._dispatcher,r=this._eventObjects,i=this.IsDebug(),s=this.IsDebugging();i&&C3Debugger.StartMeasuringTime(),s?await e.DebugRunEvents(this._layoutManager):e.RunEvents(this._layoutManager),i&&C3Debugger.AddEventsTime(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleasePendingInstances(),this._isLayoutFirstTick=!1,e.BlockFlushingInstances(!0),i&&C3Debugger.StartMeasuringTime(),s?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2(),i&&C3Debugger.AddBehaviorTickTime(),i&&C3Debugger.StartMeasuringTime(),s?await this.DebugFireGeneratorEventAndBreak(r.tick2):t.dispatchEvent(r.tick2),i&&C3Debugger.AddPluginTickTime(),e.BlockFlushingInstances(!1),s&&await e.RunQueuedDebugTriggersAsync()}_ReleasePendingInstances(){if(0!==this._instancesPendingRelease.size){var e,t,r=this._dispatcher;r.SetDelayRemoveEventsEnabled(!0);for(e of this._instancesPendingReleaseAffectedObjectClasses)e.GetSolStack().RemoveInstances(this._instancesPendingRelease);this._instancesPendingReleaseAffectedObjectClasses.clear(),this._eventSheetManager._OnInstancesReleased(this._instancesPendingRelease);for(t of this._instancesPendingRelease)t.Release();this._instancesPendingRelease.clear(),r.SetDelayRemoveEventsEnabled(!1)}}async _MaybeChangeLayout(){var e=this.GetLayoutManager();let t=0;for(;e.IsPendingChangeMainLayout()&&t++<10;)await this._DoChangeLayout(e.GetPendingChangeMainLayout())}_MeasureDt(e){let t=0;var r,i,s;this.IsExportToVideo()?(t=1/this.GetExportVideoFramerate(),this._dtRaw=t,this._dt1=t):0!==this._lastTickTime&&(r=Math.max(e-this._lastTickTime,0),.5<(t=r/1e3)&&(t=0),this._dtRaw=t,this._dt1=C33.clamp(t,this._minDt,this._maxDt)),this._lastTickTime=e,this._dt=this._dt1*this._timeScale,this._gameTime.Add(this._dt),this._gameTimeRaw.Add(t*this._timeScale),this._wallTime.Add(this._dt1);for([i,s]of this._instanceTimes)s.Add(this._dt1*i.GetTimeScale());this._canvasManager&&this._canvasManager._UpdateTick(),1e3<=e-this._fpsLastTime&&(this._fpsLastTime+=1e3,1e3<=e-this._fpsLastTime&&(this._fpsLastTime=e),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._tps=this._tpsTickCount,this._tpsTickCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1e3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),this._collisionEngine._Update1sStats(),this.IsDebug())&&C3Debugger.Update1sPerfStats()}_SetTrackingInstanceTime(e,t){t?this._instanceTimes.has(e)||((t=C33.New(C33.KahanSum)).Copy(this._gameTime),this._instanceTimes.set(e,t)):this._instanceTimes.delete(e)}_GetInstanceGameTime(e){e=this._instanceTimes.get(e);return e?e.Get():this.GetGameTime()}async _DoChangeLayout(e){var t=this._dispatcher,r=this.GetLayoutManager().GetMainRunningLayout();await r._StopRunning(),r._Unload(e,this.GetRenderer()),r===e&&this._eventSheetManager.ClearAllScheduledWaits(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleasePendingInstances(),t.dispatchEvent(this._eventObjects.beforelayoutchange),C33.Asyncify.SetHighThroughputMode(!0),await e._Load(r,this.GetRenderer()),C33.Asyncify.SetHighThroughputMode(!1),await e._StartRunning(!1),t.dispatchEvent(this._eventObjects.layoutchange),this.UpdateRender(),this._isLayoutFirstTick=!0,this.FlushPendingInstances(),this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){var r=this._canvasManager;if(r&&!r.IsRendererContextLost()){var i=this.GetRenderer(),s=i.SupportsGPUProfiling(),a=s&&i.IsWebGL(),s=s&&i.IsWebGPU();if(a&&i.CheckForQueryResults(),this._needRender||this.IsExportToVideo()){var n=this._layoutManager.GetMainRunningLayout(),o=(this._fpsFrameCount++,i.Start(),this.IsDebug());o&&C3Debugger.StartMeasuringTime(),this._needRender=!1;let e=null,t=(a&&(e=r.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),i.StartQuery(e)),null);s&&(t=i.StartFrameTiming(2*(1+n.GetLayerCount())),i.StartMeasuringRenderPassTime(0,1)),this.Uses3DFeatures()&&"low"===r.GetCurrentFullscreenScalingQuality()?i.SetFixedSizeDepthBuffer(r.GetDrawWidth(),r.GetDrawHeight()):i.SetAutoSizeDepthBuffer(),this._Render(this.GetRenderer(),n),e&&i.EndQuery(e),s&&(i.StopMeasuringRenderPassTime(),this._canvasManager._AddWebGPUFrameTiming(t)),i.Finish(),o&&(C3Debugger.AddDrawCallsTime(),C3Debugger.UpdateInspectHighlight()),r&&r._MaybeTakeSnapshot()}else i.IncrementFrameNumber()}}_NeedsHTMLLayerCompositing(e){return"low"===this.GetCanvasManager().GetCurrentFullscreenScalingQuality()||e.IsWebGL()&&(this.UsesAnyBackgroundBlending()||this.Uses3DFeatures())}_Render(t,r){t.SetTextureFillMode(),t.SetAlphaBlend(),t.SetColorRgba(1,1,1,1),t.SetRenderTarget(null),t.SetTexture(null),t.SetDepthEnabled(this.Uses3DFeatures()),this._NeedsHTMLLayerCompositing(t)&&r._MaybeStartDrawToOwnTexture(t);var i=r.GetHTMLLayerCount();for(let e=1;e<i;++e)r.DrawForHTMLLayerIndex(t,e),t.IsWebGPU()&&t.Restart();this._NeedsHTMLLayerCompositing(t)||r._MaybeStartDrawToOwnTexture(t),r.DrawMain(t)}Trigger(e,t,r){if(!this._hasStarted)return!1;var i=!this._isInTick&&!this._eventSheetManager.IsInTrigger();let s=0;i&&(s=performance.now());var a=this.IsDebug(),e=(a&&this.SetDebuggingEnabled(!1),this._eventSheetManager._Trigger(this._layoutManager,e,t,r));return i&&(t=performance.now()-s,this._mainThreadTimeCounter+=t,a)&&C3Debugger.AddTriggersTime(t),a&&this.SetDebuggingEnabled(!0),e}DebugTrigger(e,t,r){if(!this.IsDebugging())return this.Trigger(e,t,r);if(this.HitBreakpoint())throw new Error("called DebugTrigger() while stopped on breakpoint");if(this._isInTick||this._eventSheetManager.IsInTrigger())return this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,r);throw new Error("called DebugTrigger() outside of event code - use TriggerAsync() instead")}async TriggerAsync(e,t,r){if(!this.IsDebugging())return this.Trigger(e,t,r);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(e,t,r);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(e,t,r);var i=performance.now(),s=this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,r);let a=s.next();for(;!a.done;)await this.DebugBreak(a.value),a=s.next();return this.IsSuspended()||this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame()),this._mainThreadTimeCounter+=performance.now()-i,a.value}FastTrigger(e,t,r){var i=this.IsDebug(),e=(i&&this.SetDebuggingEnabled(!1),this._eventSheetManager._FastTrigger(this._layoutManager,e,t,r));return i&&this.SetDebuggingEnabled(!0),e}DebugFastTrigger(e,t,r){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,e,t,r)}ScheduleTriggers(e){return this._scheduleTriggersThrottle.Add(e)}PushCurrentLayout(e){this._currentLayoutStack.push(e)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw new Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(e){return e&&-1!==e.GetTimeScale()?this._dt1*e.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetDtRaw(){return this._dtRaw}GetTimeScale(){return this._timeScale}SetTimeScale(e){(isNaN(e)||e<0)&&(e=0),this._timeScale=e}SetMinDt(e){this._minDt=Math.max(e,0)}GetMinDt(){return this._minDt}SetMaxDt(e){this._maxDt=Math.max(e,0)}GetMaxDt(){return this._maxDt}GetFramesPerSecond(){return this._fps}GetTicksPerSecond(){return this._tps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(e){if(this._isLoadingState)throw new Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(e)||null}_RefreshUidMap(){this._instancesByUid.clear();for(var e of this._allObjectClasses)if(!e.IsFamily())for(var t of e.GetInstances())this._instancesByUid.set(t.GetUID(),t)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===C33.Platform.OS&&("cordova"===this._exportType||"playable-ad-single-file"===this._exportType||"playable-ad-zip"===this._exportType||"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}IsWindowsWebView2(){return this._isWindowsWebView2}IsAnyWebView2Wrapper(){return this._isAnyWebView2Wrapper}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._addonManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._addonManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(e){return this.GetRenderer().GetDefaultCameraZ(e||this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){this._isPixelRoundingEnabled!==(e=!!e)&&(this._isPixelRoundingEnabled=e,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}GetTextIconSet(e){this._iconChangeHandlers.has(e)||(this._iconChangeHandlers.set(e,t=()=>this.DeleteTextIconSet(e)),e.Dispatcher().addEventListener("animationframeimagechange",t));var t=this._textIconManager.GetIconSet(e);return t.HasLoaded()||t.LoadContent().then(()=>this.UpdateRender()),t}DeleteTextIconSet(e){this._textIconManager.DeleteIconSet(e)}_GetTextIconSetMeta(e){var t,r=[];for(t of e.GetAnimations())for(var i of t.GetFrames()){var s=i.GetImageInfo();r.push({source:i,width:s.GetWidth(),height:s.GetHeight(),tag:i.GetTag()})}return{icons:r}}async _GetTextIconSetContent(e){var t,i=C33.New(C33.PromiseThrottle),r=[];let s=new Map;for(t of e.GetAnimations())for(var a of t.GetFrames()){let t=a.GetImageInfo().GetImageAsset();s.has(t)||(s.set(t,null),r.push(i.Add(async()=>{var e=await t.LoadToDrawable();s.set(t,e)})))}await Promise.all(r);var n,o=[];for(n of e.GetAnimations())for(let r of n.GetFrames())o.push(i.Add(async()=>{var e=r.GetImageInfo(),t=s.get(e.GetImageAsset()),e=await e.ExtractImageToCanvas(t);return{drawable:await createImageBitmap(e)}}));var l,e=await Promise.all(o);for(l of s.values())l instanceof ImageBitmap&&l.close&&l.close();return{icons:e}}SaveToSlot(e){this._saveToSlotName=e}LoadFromSlot(e){this._loadFromSlotName=e}LoadFromJsonString(e){this._loadFromJson=e}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!(!this._saveToSlotName&&!this._loadFromSlotName&&null===this._loadFromJson)}async _HandleSaveOrLoad(){if(this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad()),this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug())&&C3Debugger.StepIfPausedInDebugger(),null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to load state from JSON string: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._saveToSlotName="",this._loadFromSlotName="",this._loadFromJson=null}_GetProjectStorage(){return this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._projectStorage}_GetSavegamesStorage(){return this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._savegamesStorage}async _DoSaveToSlot(e){var t=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(e,t),console.log("[Construct] Saved state to storage ("+t.length+" chars)"),this._lastSaveJson=t,await this.TriggerAsync(C33.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to save state to storage: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(e){try{var t=await this._GetSavegamesStorage().getItem(e);if(!t)throw new Error("empty slot");console.log("[Construct] Loaded state from storage ("+t.length+" chars)"),await this._DoLoadFromJsonString(t),this._lastSaveJson=t,await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to load state from storage: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){var e,t,r={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(e of this._allObjectClasses)e.IsFamily()||e.HasNoSaveBehavior()||(r.types[e.GetSID().toString()]=e._SaveToJson());for(t of this._layoutManager.GetAllLayouts())r.layouts[t.GetSID().toString()]=t._SaveToJson();var i=this._CreateUserScriptEvent("save");return i.saveData=null,await this.DispatchUserScriptEventAsyncWait(i),r.user_script_data=i.saveData,JSON.stringify(r)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(e){var t,r=this.GetLayoutManager(),e=JSON.parse(e);if(e.c2save)throw new Error("C2 saves are incompatible with C3 runtime");if(!e.c3save)throw new Error("not valid C3 save data");if(1<e.version)throw new Error("C3 save data from future version");this.ClearIntancesNeedingAfterLoad(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"beforeload"));for(t of this.allInstances())t.GetObjectClass().HasNoSaveBehavior()||t._OnBeforeLoad();var i,s,a=e.rt,n=(this._gameTime.Set(a.time),a.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(a.timeRaw),this._wallTime.Set(a.walltime),this._timeScale=a.timescale,this._tickCount=a.tickcount,this._startTime=Date.now()-a.start_time_offset,a.running_layout);let o=!(this._isLoadingState=!0);if(n!==this.GetMainRunningLayout().GetSID()){n=r.GetLayoutBySID(n);if(!n)return;await this._DoChangeLayout(n),o=!0}for([i,s]of Object.entries(e.layouts)){var l=parseInt(i,10),l=r.GetLayoutBySID(l);l&&l._LoadFromJson(s)}var h,u,c,_,d,p,m,g=new Set;for([h,u]of Object.entries(e.types)){var f=parseInt(h,10),f=this.GetObjectClassBySID(f);!f||f.IsFamily()||f.HasNoSaveBehavior()||f._LoadFromJson(u,g)}for(c of this._layoutManager.GetAllLayouts())for(var S of c.allLayers())S._LoadFromJsonAfterInstances();if(this.FlushPendingInstances(),this._RefreshUidMap(),this._isLoadingState=!1,o){for(var C of this.allInstances())C.SetupInitialSceneGraphConnections();for(var[y,G]of Object.entries(e.types)){y=parseInt(y,10),y=this.GetObjectClassBySID(y);!y||y.IsFamily()||y.HasNoSaveBehavior()||y._SetupSceneGraphConnectionsOnChangeOfLayout(G)}}this._nextUid=a.next_uid,this._eventSheetManager._LoadFromJson(e.events);for(_ of this._allObjectClasses)if(!_.IsFamily()&&_.IsInContainer())for(var I of _.GetInstances()){var T,v=I.GetIID();for(T of _.GetContainer().objectTypes())if(T!==_){var A=T.GetInstances();if(v<0||v>=A.length)throw new Error("missing sibling instance");I._AddSibling(A[v])}}this._timelineManager._LoadFromJson(e.timelines),r.SetAllLayerProjectionChanged(),r.SetAllLayerMVChanged();for(d of g)d._OnCreatedForLoadingSavegame();this.DoAfterLoad(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"afterload")),this.DispatchUserScriptEvent(this._CreateUserScriptEvent("afterload"));for([p,m]of Object.entries(e.types)){var b=parseInt(p,10),b=this.GetObjectClassBySID(b);b&&b._ClearLoadInstancesJson()}n=this._CreateUserScriptEvent("load");n.saveData=e.user_script_data,await this.DispatchUserScriptEventAsyncWait(n),this.UpdateRender()}SortOnTmpHierarchyPosition(e,t){return e.GetWorldInfo().GetTmpHierarchyPosition()-t.GetWorldInfo().GetTmpHierarchyPosition()}AddInstanceNeedingAfterLoad(e,t){!e.GetWorldInfo()||this._instancesNeedingAfterLoadMap.has(e)||(this._instancesNeedingAfterLoadMap.set(e,t),this._instancesNeedingAfterLoadArray.push(e))}ClearIntancesNeedingAfterLoad(){this._instancesNeedingAfterLoadMap=new WeakMap,C33.clearArray(this._instancesNeedingAfterLoadArray)}DoAfterLoad(e="full",t=null){this._instancesNeedingAfterLoadArray.sort(this.SortOnTmpHierarchyPosition);for(var r of this._instancesNeedingAfterLoadArray)r._OnAfterLoad(this._instancesNeedingAfterLoadMap.get(r),e,t);for(var i of this._instancesNeedingAfterLoadArray)i._OnAfterLoad2(this._instancesNeedingAfterLoadMap.get(i),e,t);this.ClearIntancesNeedingAfterLoad()}async AddJobWorkerScripts(e){e=await Promise.all(e.map(async e=>{var t;return this.IsCordova()&&this._assetManager.IsFileProtocol()||"playable-ad-single-file"===this.GetExportType()?(t=await this._assetManager.FetchBlob(e),URL.createObjectURL(t)):new URL(e,location.href).toString()}));this._jobScheduler.ImportScriptsToJobWorkers(e)}AddJobWorkerBlob(e,t){this._jobScheduler.SendBlobToJobWorkers(e,t)}AddJobWorkerBuffer(e,t){this._jobScheduler.SendBufferToJobWorkers(e,t)}AddJob(e,t,r,i){return this._jobScheduler.AddJob(e,t,r,null,null,i)}BroadcastJob(e,t,r,i){return this._jobScheduler.BroadcastJob(e,t,r,i)}GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers()}InvokeDownload(e,t){this.PostComponentMessageToDOM("runtime","invoke-download",{url:e,filename:t})}async RasterSvgImage(e,t,r,i,s,a){return i=i||t,s=s||r,this.IsInWorker()?(await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:e,imageWidth:t,imageHeight:r,surfaceWidth:i,surfaceHeight:s,imageBitmapOpts:a})).imageBitmap:(e=await self.C3_RasterSvgImageBlob(e,t,r,i,s),a?self.createImageBitmap(e,a):e)}async GetSvgImageSize(e){return this.IsInWorker()?this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:e}):self.C3_GetSvgImageSize(e)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(e){this._randomNumberCallback=e}_GetRemotePreviewStatusInfo(){var e=this.GetRenderer();return{fps:this.GetFramesPerSecond(),tps:this.GetTicksPerSecond(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:e.IsWebGL()?e.GetUnmaskedRenderer():e.GetAdapterInfoString()}}HitBreakpoint(){return!!this.IsDebug()&&C3Debugger.HitBreakpoint()}DebugBreak(e){return this.IsDebugging()?C3Debugger.DebugBreak(e):Promise.resolve()}DebugBreakNext(){return!!this.IsDebugging()&&C3Debugger.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e,this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(e){e?this._debuggingDisabled--:this._debuggingDisabled++,this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&C3Debugger.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&C3Debugger.IsGPUProfiling()}async DebugIterateAndBreak(e){if(e)for(var t of e)await this.DebugBreak(t)}DebugFireGeneratorEventAndBreak(e){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(e))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e.name,e.params)}_GetHTMLLayerWrapElement(e){if(this.IsInWorker())throw new Error("not supported in worker mode");return self.c3_runtimeInterface._GetHTMLWrapElement(e)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(e){e=C33.New(C33.Event,e,!1);return e.runtime=this._iRuntime,e}_InitScriptInterfaces(){this._iRuntime=new self.IRuntime(this),this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitObjectsScriptInterface(){var e,t={};for(e of this._allObjectClasses)t[e.GetJsPropName()]={value:e.GetIObjectClass(),enumerable:!0,writable:!1};this._iRuntime._InitObjects(t)}_InitGlobalVariableScriptInterface(){var e,t={};for(e of this.GetEventSheetManager().GetAllGlobalVariables())t[e.GetJsPropName()]=e._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(t)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(e,t){this._interfaceMap.set(e,t)}_UnwrapScriptInterface(e){return this._interfaceMap.get(e)}_UnwrapIObjectClass(e){if(!(e instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");e=this._UnwrapScriptInterface(e);if(e&&e instanceof C33.ObjectClass)return e;throw new Error("invalid IObjectClass")}_UnwrapIInstance(e){if(!(e instanceof self.IInstance))throw new TypeError("expected IInstance");e=this._UnwrapScriptInterface(e);if(e&&e instanceof C33.Instance)return e;throw new Error("invalid IInstance")}_UnwrapIWorldInstance(e){if(!(e instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");e=this._UnwrapScriptInterface(e);if(e&&e instanceof C33.Instance)return e;throw new Error("invalid IInstance")}},self.C3_CreateRuntime=C33.Runtime.Create,self.C3_InitRuntime=(e,t)=>e.Init(t)}{let C33=self.C3;C33.JobSchedulerRuntime=class JobSchedulerRuntime extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._jobPromises=new Map,this._nextJobId=0,this._inputPort=t.inputPort,t.outputPort.onmessage=e=>this._OnJobWorkerMessage(e),this._maxNumWorkers=t.maxNumWorkers,this._jobWorkerCount=1,this._isCreatingWorker=!1,this._hadErrorCreatingWorker=!1}async Init(){}GetMaxNumWorkers(){return this._maxNumWorkers}ImportScriptsToJobWorkers(e){this._inputPort.postMessage({type:"_import_scripts",scripts:e})}SendBlobToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_blob",blob:e,id:t})}SendBufferToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_buffer",buffer:e,id:t},[e])}AddJob(e,t,r,i,s,a){if(r=r||[],"number"==typeof a&&(a=Math.floor(a))<=0)throw new Error("invalid maxWorkerNum");let n=this._nextJobId++;e={type:e,isBroadcast:!1,maxWorkerNum:a,jobId:n,params:t,transferables:r},t=new Promise((e,t)=>{this._jobPromises.set(n,{resolve:e,progress:i,reject:t,cancelled:!1,maxWorkerNum:a})});return s&&s.SetAction(()=>this._CancelJob(n)),this._inputPort.postMessage(e,r),this._MaybeCreateExtraWorker(),t}BroadcastJob(e,t,r,i){if(r=r||[],"number"==typeof i&&(i=Math.floor(i))<=0)throw new Error("invalid maxWorkerNum");var s=this._nextJobId++;this._inputPort.postMessage({type:e,isBroadcast:!0,maxWorkerNum:i,jobId:s,params:t,transferables:r},r)}_CancelJob(e){var t=this._jobPromises.get(e);t&&(t.cancelled=!0,t.resolve=null,t.progress=null,t.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:e}))}_OnJobWorkerMessage(e){var t=e.data,r=t.type,i=t.jobId;switch(r){case"result":this._OnJobResult(i,t.result);break;case"progress":this._OnJobProgress(i,t.progress);break;case"error":this._OnJobError(i,t.error);break;case"ready":this._OnJobWorkerReady();break;default:throw new Error(`unknown message from worker '${r}'`)}}_OnJobResult(e,t){var r=this._jobPromises.get(e);if(!r)throw new Error("invalid job ID");r.cancelled||r.resolve(t),this._jobPromises.delete(e)}_OnJobProgress(e,t){e=this._jobPromises.get(e);if(!e)throw new Error("invalid job ID");!e.cancelled&&e.progress&&e.progress(t)}_OnJobError(e,t){var r=this._jobPromises.get(e);if(!r)throw new Error("invalid job ID");r.cancelled||r.reject(t),this._jobPromises.delete(e)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}_GetWorkerCountNeededForPendingJobs(){let e=0;var t;for(t of[...this._jobPromises.values()].sort((e,t)=>(e.maxWorkerNum||1/0)-(t.maxWorkerNum||1/0))){var r=t.maxWorkerNum||1/0;e<r&&e++}return e}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount))try{this._isCreatingWorker=!0,(await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker")).outputPort.onmessage=e=>this._OnJobWorkerMessage(e)}catch(e){this._hadErrorCreatingWorker=!0,this._isCreatingWorker=!1,console.error(`[Construct] Failed to create job worker; stopping creating any more (created ${this._jobWorkerCount} so far)`,e)}}}}self.C3_Shaders={};{let ForEachOrdered_SortInstances2=function(e,t){var e=e[1],t=t[1];return"number"==typeof e&&"number"==typeof t?e-t:(e=""+e)<(t=""+t)?-1:t<e?1:0},C33=(ForEachOrdered_SortInstances=ForEachOrdered_SortInstances2,self.C3),cacheRegex=null,lastRegex="",lastFlags="",regexMatches=[],lastMatchesStr="",lastMatchesRegex="",lastMatchesFlags="",forEachStack=C33.New(C33.ArrayStack);C33.Plugins.System=class SystemPlugin extends C33.SDKPluginBase{constructor(e){super(e),this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack(),this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._imagesLoadingTotal=0,this._imagesLoadingComplete=0,this._functionMaps=new Map}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(e){this._runtime.Trigger(e,null,null)}GetRegex(e,t){return cacheRegex&&e===lastRegex&&t===lastFlags||(cacheRegex=new RegExp(e,t),lastRegex=e,lastFlags=t),cacheRegex.lastIndex=0,cacheRegex}GetRegexMatches(e,t,r){var i;return e===lastMatchesStr&&t===lastMatchesRegex&&r===lastMatchesFlags||(i=this.GetRegex(t,r),regexMatches=e.match(i),lastMatchesStr=e,lastMatchesRegex=t,lastMatchesFlags=r),regexMatches}async _LoadTexturesForObjectClasses(e,t){if(t.length){this._imagesLoadingTotal+=t.length;var r,i=[];for(r of t)i.push(e.MaybeLoadTexturesFor(r));await C33.PromiseAllWithProgress(i,()=>{this._imagesLoadingComplete++}),this._imagesLoadingComplete++,this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._imagesLoadingComplete=0,this._imagesLoadingTotal=0,this._runtime.Trigger(C33.Plugins.System.Cnds.OnImageLoadingComplete,null,null))}}_UnloadTexturesForObjectClasses(e,t){for(var r of t)0===r.GetInstanceCount()&&e.MaybeUnloadTexturesFor(r)}_GetForEachStack(){return forEachStack}_Repeat(t){var r=this._runtime.GetEventSheetManager(),e=r.GetEventStack(),i=e.GetCurrentStackFrame(),s=i.GetCurrentEvent(),a=s.GetSolModifiers(),n=i.IsSolModifierAfterCnds(),o=e.Push(s),l=r.GetLoopStack(),h=l.Push();if(h.SetEnd(t),n)for(let e=0;e<t&&!h.IsStopped();++e)r.PushCopySol(a),h.SetIndex(e),s.Retrigger(i,o),r.PopSol(a);else for(let e=0;e<t&&!h.IsStopped();++e)h.SetIndex(e),s.Retrigger(i,o);return e.Pop(),l.Pop(),!1}*_DebugRepeat(t){var r=this._runtime.GetEventSheetManager(),e=r.GetEventStack(),i=e.GetCurrentStackFrame(),s=i.GetCurrentEvent(),a=s.GetSolModifiers(),n=i.IsSolModifierAfterCnds(),o=e.Push(s),l=r.GetLoopStack(),h=l.Push();if(h.SetEnd(t),n)for(let e=0;e<t&&!h.IsStopped();++e)r.PushCopySol(a),h.SetIndex(e),yield*s.DebugRetrigger(i,o),r.PopSol(a);else for(let e=0;e<t&&!h.IsStopped();++e)h.SetIndex(e),yield*s.DebugRetrigger(i,o);return e.Pop(),l.Pop(),!1}_While(){var t=this._runtime.GetEventSheetManager(),e=t.GetEventStack(),r=e.GetCurrentStackFrame(),i=r.GetCurrentEvent(),s=i.GetSolModifiers(),a=r.IsSolModifierAfterCnds(),n=e.Push(i),o=t.GetLoopStack(),l=o.Push();if(a)for(let e=0;!l.IsStopped();++e)t.PushCopySol(s),l.SetIndex(e),i.Retrigger(r,n)||l.Stop(),t.PopSol(s);else for(let e=0;!l.IsStopped();++e)l.SetIndex(e),i.Retrigger(r,n)||l.Stop();return e.Pop(),o.Pop(),!1}*_DebugWhile(){var t=this._runtime.GetEventSheetManager(),e=t.GetEventStack(),r=e.GetCurrentStackFrame(),i=r.GetCurrentEvent(),s=i.GetSolModifiers(),a=r.IsSolModifierAfterCnds(),n=e.Push(i),o=t.GetLoopStack(),l=o.Push();if(a)for(let e=0;!l.IsStopped();++e)t.PushCopySol(s),l.SetIndex(e),(yield*i.DebugRetrigger(r,n))||l.Stop(),t.PopSol(s);else for(let e=0;!l.IsStopped();++e)l.SetIndex(e),(yield*i.DebugRetrigger(r,n))||l.Stop();return e.Pop(),o.Pop(),!1}_For(e,t,r){var i=this._runtime.GetEventSheetManager(),s=i.GetEventStack(),a=s.GetCurrentStackFrame(),n=a.GetCurrentEvent(),o=n.GetSolModifiers(),l=a.IsSolModifierAfterCnds(),h=s.Push(n),u=i.GetLoopStack(),c=u.Push();if(c.SetName(e),c.SetEnd(r),r<t)if(l)for(let e=t;e>=r&&!c.IsStopped();--e)i.PushCopySol(o),c.SetIndex(e),n.Retrigger(a,h),i.PopSol(o);else for(let e=t;e>=r&&!c.IsStopped();--e)c.SetIndex(e),n.Retrigger(a,h);else if(l)for(let e=t;e<=r&&!c.IsStopped();++e)i.PushCopySol(o),c.SetIndex(e),n.Retrigger(a,h),i.PopSol(o);else for(let e=t;e<=r&&!c.IsStopped();++e)c.SetIndex(e),n.Retrigger(a,h);return s.Pop(),u.Pop(),!1}*_DebugFor(e,t,r){var i=this._runtime.GetEventSheetManager(),s=i.GetEventStack(),a=s.GetCurrentStackFrame(),n=a.GetCurrentEvent(),o=n.GetSolModifiers(),l=a.IsSolModifierAfterCnds(),h=s.Push(n),u=i.GetLoopStack(),c=u.Push();if(c.SetName(e),c.SetEnd(r),r<t)if(l)for(let e=t;e>=r&&!c.IsStopped();--e)i.PushCopySol(o),c.SetIndex(e),yield*n.DebugRetrigger(a,h),i.PopSol(o);else for(let e=t;e>=r&&!c.IsStopped();--e)c.SetIndex(e),yield*n.DebugRetrigger(a,h);else if(l)for(let e=t;e<=r&&!c.IsStopped();++e)i.PushCopySol(o),c.SetIndex(e),yield*n.DebugRetrigger(a,h),i.PopSol(o);else for(let e=t;e<=r&&!c.IsStopped();++e)c.SetIndex(e),yield*n.DebugRetrigger(a,h);return s.Pop(),u.Pop(),!1}_ForEach(r){var e=r.GetCurrentSol(),t=e.GetInstances();if(0!==t.length){var i=this._runtime.GetEventSheetManager(),s=i.GetEventStack(),a=s.GetCurrentStackFrame(),n=a.GetCurrentEvent(),o=n.GetSolModifiers(),l=a.IsSolModifierAfterCnds(),h=s.Push(n),u=i.GetLoopStack(),c=u.Push(),_=r.IsInContainer(),d=forEachStack.Push();if(C33.shallowAssignArray(d,t),c.SetEnd(d.length),l)for(let e=0,t=d.length;e<t&&!c.IsStopped();++e){i.PushCopySol(o);var p=d[e];r.GetCurrentSol().SetSinglePicked(p),_&&p.SetSiblingsSinglePicked(),c.SetIndex(e),n.Retrigger(a,h),i.PopSol(o)}else{e._SetSelectAll(!1);var m=e._GetOwnInstances();C33.clearArray(m),m.push(null);for(let e=0,t=d.length;e<t&&!c.IsStopped();++e){var g=d[e];m[0]=g,_&&g.SetSiblingsSinglePicked(),c.SetIndex(e),n.Retrigger(a,h)}}s.Pop(),u.Pop(),C33.clearArray(d),forEachStack.Pop()}return!1}*_DebugForEach(r){var e=r.GetCurrentSol(),t=e.GetInstances();if(0!==t.length){var i=this._runtime.GetEventSheetManager(),s=i.GetEventStack(),a=s.GetCurrentStackFrame(),n=a.GetCurrentEvent(),o=n.GetSolModifiers(),l=a.IsSolModifierAfterCnds(),h=s.Push(n),u=i.GetLoopStack(),c=u.Push(),_=r.IsInContainer(),d=forEachStack.Push();if(C33.shallowAssignArray(d,t),c.SetEnd(d.length),l)for(let e=0,t=d.length;e<t&&!c.IsStopped();++e){i.PushCopySol(o);var p=d[e];r.GetCurrentSol().SetSinglePicked(p),_&&p.SetSiblingsSinglePicked(),c.SetIndex(e),yield*n.DebugRetrigger(a,h),i.PopSol(o)}else{e._SetSelectAll(!1);var m=e._GetOwnInstances();C33.clearArray(m),m.push(null);for(let e=0,t=d.length;e<t&&!c.IsStopped();++e){var g=d[e];m[0]=g,_&&g.SetSiblingsSinglePicked(),c.SetIndex(e),yield*n.DebugRetrigger(a,h)}}s.Pop(),u.Pop(),C33.clearArray(d),forEachStack.Pop()}return!1}_ForEachOrdered(r,e){var t=r.GetCurrentSol(),i=t.GetInstances();if(0!==i.length){var s=this._runtime.GetEventSheetManager(),a=s.GetEventStack(),n=s.GetCurrentCondition(),o=a.GetCurrentStackFrame(),l=o.GetCurrentEvent(),h=l.GetSolModifiers(),u=o.IsSolModifierAfterCnds(),c=a.Push(l),_=s.GetLoopStack(),d=_.Push(),p=r.IsInContainer(),m=forEachStack.Push();C33.clearArray(m),d.SetEnd(i.length);for(let e=0,t=i.length;e<t;++e)m.push([i[e],n.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances2),1===e&&m.reverse(),u)for(let e=0,t=m.length;e<t&&!d.IsStopped();++e){s.PushCopySol(h);var g=m[e][0];r.GetCurrentSol().SetSinglePicked(g),p&&g.SetSiblingsSinglePicked(),d.SetIndex(e),l.Retrigger(o,c),s.PopSol(h)}else{t._SetSelectAll(!1);var f=t._GetOwnInstances();C33.clearArray(f),f.push(null);for(let e=0,t=m.length;e<t&&!d.IsStopped();++e){var S=m[e][0];f[0]=S,p&&S.SetSiblingsSinglePicked(),d.SetIndex(e),l.Retrigger(o,c)}}a.Pop(),_.Pop(),C33.clearArray(m),forEachStack.Pop()}return!1}*_DebugForEachOrdered(r,e){var t=r.GetCurrentSol(),i=t.GetInstances();if(0!==i.length){var s=this._runtime.GetEventSheetManager(),a=s.GetEventStack(),n=s.GetCurrentCondition(),o=a.GetCurrentStackFrame(),l=o.GetCurrentEvent(),h=l.GetSolModifiers(),u=o.IsSolModifierAfterCnds(),c=a.Push(l),_=s.GetLoopStack(),d=_.Push(),p=r.IsInContainer(),m=forEachStack.Push();C33.clearArray(m),d.SetEnd(i.length);for(let e=0,t=i.length;e<t;++e)m.push([i[e],n.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances2),1===e&&m.reverse(),u)for(let e=0,t=m.length;e<t&&!d.IsStopped();++e){s.PushCopySol(h);var g=m[e][0];r.GetCurrentSol().SetSinglePicked(g),p&&g.SetSiblingsSinglePicked(),d.SetIndex(e),yield*l.DebugRetrigger(o,c),s.PopSol(h)}else{t._SetSelectAll(!1);var f=t._GetOwnInstances();C33.clearArray(f),f.push(null);for(let e=0,t=m.length;e<t&&!d.IsStopped();++e){var S=m[e][0];f[0]=S,p&&S.SetSiblingsSinglePicked(),d.SetIndex(e),yield*l.DebugRetrigger(o,c)}}a.Pop(),_.Pop(),C33.clearArray(m),forEachStack.Pop()}return!1}_GetFunctionMap(e,t){var r=this._functionMaps.get(e);if(!r){if(!t)return null;r={defaultFunc:null,strMap:new Map},this._functionMaps.set(e,r)}return r}_DoCallMappedFunction(e,t,r,i,s){t.GetEventBlock().RunAsMappedFunctionCall(r,t.IsCopyPicked()),i&&e.PopSol(s)}*_DebugDoCallMappedFunction(e,t,r,i,s){yield*t.GetEventBlock().DebugRunAsMappedFunctionCall(r,t.IsCopyPicked()),i&&e.PopSol(s)}}}{let C33=self.C3;C33.Plugins.System.Type=class SystemType extends C33.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}OnCreate(){}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}}}{let C33=self.C3;C33.Plugins.System.Instance=class SystemInstance extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._runtime=this._inst.GetRuntime()}Release(){this._inst=null,this._objectClass=null,this._sdkType=null,this._runtime=null}}}{let C33=self.C3,tmpPickArray=[];C33.Plugins.System.Cnds={EveryTick(){return!0},OnLayoutStart(){return!0},OnLayoutEnd(){return!0},OnSuspend(){return!0},OnResume(){return!0},IsSuspended(){return this._runtime.IsSuspended()},Else(){var e=this._runtime.GetCurrentEventStackFrame();return!e.GetElseBranchRan()&&!e.GetLastEventTrue()},TriggerOnce(){var e=this._runtime.GetCurrentCondition().GetSavedDataMap();let t=e.get("TriggerOnce_lastTick");void 0===t&&(t=-1,e.set("TriggerOnce_lastTick",-1));var r=this._runtime.GetTickCount();return e.set("TriggerOnce_lastTick",r),this._runtime.IsLayoutFirstTick()||t!==r-1},Every(e){var t=this._runtime.GetCurrentCondition().GetSavedDataMap(),r=t.get("Every_lastTime")||0,i=this._runtime.GetGameTime(),s=(t.has("Every_seconds")||t.set("Every_seconds",e),t.get("Every_seconds"));return r+s<=i?(t.set("Every_lastTime",r+s),i>=t.get("Every_lastTime")+.04&&t.set("Every_lastTime",i),t.set("Every_seconds",e),!0):(i<r-.1&&t.set("Every_lastTime",i),!1)},IsGroupActive(e){e=this._runtime.GetEventSheetManager().GetEventGroupByName(e);return e&&e.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile(){return C33.Platform.IsMobile},OnLoadFinished(){return!0},OnCanvasSnapshot(){return!0},EffectsSupported(){return!0},OnSaveComplete(){return!0},OnSaveFailed(){return!0},OnLoadComplete(){return!0},OnLoadFailed(){return!0},ObjectUIDExists(e){return!!this._runtime.GetInstanceByUID(e)},IsOnPlatform(e){switch(e){case 0:return"browser"===C33.Platform.Context;case 1:return"iOS"===C33.Platform.OS;case 2:return"Android"===C33.Platform.OS;case 8:return"cordova"===C33.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===C33.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(e,t,r){return this.GetRegex(t,r).test(e)},Compare(e,t,r){return C33.compare(e,t,r)},CompareBetween(e,t,r){return t<=e&&e<=r},CompareVar(e,t,r){return C33.compare(e.GetValue(),t,r)},CompareBoolVar(e){return!!e.GetValue()},CompareTime(e,t){var r,i=this._runtime.GetGameTime();return 0===e?!(r=this._runtime.GetCurrentCondition().GetSavedDataMap()).get("CompareTime_executed")&&t<=i&&(r.set("CompareTime_executed",!0),!0):C33.compare(i,e,t)},IsNaN(e){return isNaN(e)},AngleWithin(e,t,r){return C33.angleDiff(C33.toRadians(e),C33.toRadians(r))<=C33.toRadians(t)},IsClockwiseFrom(e,t){return C33.angleClockwise(C33.toRadians(e),C33.toRadians(t))},IsBetweenAngles(e,t,r){e=C33.toRadians(e),t=C33.toRadians(t),r=C33.toRadians(r);return!C33.angleClockwise(r,t)?!(!C33.angleClockwise(e,t)&&C33.angleClockwise(e,r)):C33.angleClockwise(e,t)&&!C33.angleClockwise(e,r)},IsValueType(e,t){return"number"==typeof e?0===t:1===t},EvaluateExpression(e){return!!e},OnSignal(e){return e.toLowerCase()===this._runtime.GetEventSheetManager().GetCurrentSignalTag()},PickByComparison(e,r,i,s){if(!e)return!1;var t=this._GetForEachStack(),a=t.Push(),n=e.GetCurrentSol(),o=(C33.shallowAssignArray(a,n.GetInstances()),n.IsSelectAll()&&C33.clearArray(n._GetOwnElseInstances()),this._runtime.GetCurrentCondition());let l=0;for(let e=0,t=a.length;e<t;++e){var h=a[e];a[l]=h,r=o.ReevaluateParameter(1,e),s=o.ReevaluateParameter(3,e),C33.compare(r,i,s)?++l:n._PushElseInstance(h)}C33.truncateArray(a,l),n.SetArrayPicked(a);var u=!!a.length;return C33.clearArray(a),t.Pop(),e.ApplySolToContainer(),u},PickByEvaluate(e,t){if(!e)return!1;var r=this._GetForEachStack(),i=r.Push(),s=e.GetCurrentSol(),a=(C33.shallowAssignArray(i,s.GetInstances()),s.IsSelectAll()&&C33.clearArray(s._GetOwnElseInstances()),this._runtime.GetCurrentCondition());let n=0;for(let e=0,t=i.length;e<t;++e){var o=i[e];i[n]=o,a.ReevaluateParameter(1,e)?++n:s._PushElseInstance(o)}C33.truncateArray(i,n),s.SetArrayPicked(i);var l=!!i.length;return C33.clearArray(i),r.Pop(),e.ApplySolToContainer(),l},PickByHighestLowestValue(e,r,i){if(!e)return!1;var t=e.GetCurrentSol(),s=t.GetInstances();if(0===s.length)return!1;var a=this._runtime.GetCurrentCondition();let n=null,o=0;for(let e=0,t=s.length;e<t;++e){var l=s[e];i=a.ReevaluateParameter(2,e),(null===n||0===r&&i<o||1===r&&i>o)&&(o=i,n=l)}return t.PickOne(n),e.ApplySolToContainer(),!0},PickNth(e,t){var r,i;return!(!e||(i=(r=e.GetCurrentSol()).GetInstances(),(t=Math.floor(t))>=i.length)||(i=i[t],r.PickOne(i),e.ApplySolToContainer(),0))},PickRandom(e){var t,r,i;return!(!e||(i=(t=e.GetCurrentSol()).GetInstances(),(r=Math.floor(this._runtime.Random()*i.length))>=i.length)||(i=i[r],t.PickOne(i),e.ApplySolToContainer(),0))},PickAll(e){return!!e&&!!e.GetInstanceCount()&&(e.GetCurrentSol()._SetSelectAll(!0),e.ApplySolToContainer(),!0)},PickOverlappingPoint(e,r,i){if(!e)return!1;var s=e.GetCurrentSol(),t=s.GetInstances(),a=this._runtime.GetCurrentEvent().IsOrBlock(),n=this._runtime.GetCurrentCondition().IsInverted();s.IsSelectAll()?(C33.shallowAssignArray(tmpPickArray,t),s.ClearArrays(),s._SetSelectAll(!1)):a?(C33.shallowAssignArray(tmpPickArray,s._GetOwnElseInstances()),C33.clearArray(s._GetOwnElseInstances())):(C33.shallowAssignArray(tmpPickArray,s._GetOwnInstances()),C33.clearArray(s._GetOwnInstances()));for(let e=0,t=tmpPickArray.length;e<t;++e){var o=tmpPickArray[e];C33.xor(o.GetWorldInfo().ContainsPoint(r,i),n)?s._PushInstance(o):s._PushElseInstance(o)}return e.ApplySolToContainer(),C33.xor(!!s._GetOwnInstances().length,n)},PickLastCreated(t){if(!t)return!1;var r=t.IsFamily();let i=null;var e,s=this._runtime._GetInstancesPendingCreate();for(let e=s.length-1;0<=e;--e){var a=s[e];if(r){if(a.GetObjectClass().BelongsToFamily(t)){i=a;break}}else if(a.GetObjectClass()===t){i=a;break}}return i||(e=t.GetInstances()).length&&(i=e.at(-1)),!!i&&(t.GetCurrentSol().PickOne(i),t.ApplySolToContainer(),!0)},Repeat(e){return this._runtime.IsDebugging()?this._DebugRepeat(e):this._Repeat(e)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(e,t,r){return this._runtime.IsDebugging()?this._DebugFor(e,t,r):this._For(e,t,r)},ForEach(e){return this._runtime.IsDebugging()?this._DebugForEach(e):this._ForEach(e)},ForEachOrdered(e,t,r){return this._runtime.IsDebugging()?this._DebugForEachOrdered(e,r):this._ForEachOrdered(e,r)},LayerVisible(e){return!!e&&e.IsVisible()},LayerInteractive(e){return!!e&&e.IsSelfAndParentsInteractive()},LayerIsHTML(e){return!!e&&e.IsHTMLElementsLayer()},LayerEmpty(e){return!!e&&!e.GetInstanceCount()},LayerCmpOpacity(e,t,r){return!!e&&C33.compare(100*e.GetOpacity(),t,r)},LayerNameExists(e){var t=this._runtime.GetMainRunningLayout();return!!t&&t.HasLayerByName(e)},OnImageLoadingComplete(){return!0},IsLoadingImages(){return 0<this._imagesLoadingTotal},TemplateExists(e,t){var r=this._runtime.GetTemplateManager();return!!r&&!!t&&!!r.GetTemplateData(e,t)}}}{let SortZOrderList2=function(e,t){var r=e[0]-t[0];return 0!=r?r:e[1]-t[1]},SortInstancesByValue2=function(e,t){return e[1]-t[1]},C33=(SortZOrderList=SortZOrderList2,SortInstancesByValue=SortInstancesByValue2,self.C3),tempZOrderList=[],tempInstValues=[],tempRect=C33.New(C33.Rect),tempColor=C33.New(C33.Color),EMPTY_ITERABLE=[];C33.Plugins.System.Acts={SetVar(e,t){e.SetValue(t)},AddVar(e,t){e.IsNumber()&&"number"!=typeof t&&(t=parseFloat(t)),e.SetValue(e.GetValue()+t)},SubVar(e,t){e.IsNumber()&&e.SetValue(e.GetValue()-t)},SetBoolVar(e,t){e.SetValue(!!t)},ToggleBoolVar(e){e.SetValue(!e.GetValue())},ResetEventVar(e){e.SetValue(e.GetInitialValue())},ResetGlobals(e){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue(e)},CreateObject(e,t,r,i,s,a){if(e&&t){r=this._runtime.CreateInstance(e,t,r,i,s,a);if(r){s&&t.SortAndAddInstancesByZIndex(r);var n,o,i=this._runtime.GetEventSheetManager(),a=(i.BlockFlushingInstances(!0),r._TriggerOnCreatedOnSelfAndRelated(),i.BlockFlushingInstances(!1),new Map);r.CollectInstancesToPick(a,e,s);for([n,o]of a)n.GetCurrentSol().SetSetPicked(o)}}},CreateObjectByName(e,t,r,i,s,a){e&&t&&(e=this._runtime.GetObjectClassByName(e))&&C33.Plugins.System.Acts.CreateObject.call(this,e,t,r,i,s,a)},RecreateInitialObjects(i,s,a,n,o,l,e,h,u,c,_){if(i){var d=this._runtime.GetCurrentLayout();let t=d;if(l){var l=this._runtime.GetLayoutManager().GetLayoutByName(l);if(!l)return;t=l}let r=null;if(!("number"!=typeof e||0<=e)||(r=t.GetLayer(e))){let e=null;("number"!=typeof h||0<=h)&&!(e=d.GetLayer(h))||(tempRect.set(s,a,n,o),l=t.RecreateInitialObjects(i,tempRect,r,e,u,c,_),i.GetCurrentSol().SetArrayPicked(l),i.ApplySolToContainer())}}},StopLoop(){var e=this._loopStack;e.IsInLoop()&&e.GetCurrent().Stop()},SetGroupActive(e,t){e=this._runtime.GetEventSheetManager().GetEventGroupByName(e);e&&(0===t?e.SetGroupActive(!1):1===t?e.SetGroupActive(!0):e.SetGroupActive(!e.IsGroupActive()))},SetTimescale(e){this._runtime.SetTimeScale(e)},SetObjectTimescale(e,t){var r;if(t<0&&(t=0),e)for(r of e.GetCurrentSol().GetInstances())r.SetTimeScale(t)},RestoreObjectTimescale(e){var t;if(e)for(t of e.GetCurrentSol().GetInstances())t.RestoreTimeScale()},Wait(e){if(!(e<0))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(e),!0},WaitForSignal(e){return this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(e),!0},WaitForPreviousActions(){var e=this._runtime.GetEventSheetManager();return e.AddScheduledWait().InitPromise(e.GetPromiseForAllAsyncActions()),!0},Signal(e){this._runtime.GetEventSheetManager().Signal(e)},async SnapshotCanvas(e,t,r,i,s,a){var n=this._runtime.GetCanvasManager();n&&(this.UpdateRender(),await n.SnapshotCanvas(0===e?"image/png":"image/jpeg",t/100,r,i,s,a),await this._runtime.TriggerAsync(C33.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(e,t){var r;e<=0||t<=0||(this._runtime.SetViewportSize(e,t),this._runtime.GetCurrentLayout().BoundScrolling(),(r=this._runtime.GetCanvasManager())&&("off"!==r.GetCurrentFullscreenMode()&&this._runtime.SetOriginalViewportSize(e,t),r.SetSize(r.GetLastWidth(),r.GetLastHeight(),!0),this._runtime.UpdateRender()))},SetFullscreenQuality(e){var t=this._runtime.GetCanvasManager();t&&"off"!==t.GetCurrentFullscreenMode()&&(t.SetFullscreenScalingQuality(0!==e?"high":"low"),t.SetSize(t.GetLastWidth(),t.GetLastHeight(),!0))},SaveState(e){this._runtime.SaveToSlot(e)},LoadState(e){this._runtime.LoadFromSlot(e)},LoadStateJSON(e){this._runtime.LoadFromJsonString(e)},SetHalfFramerateMode(e){},ResetPersisted(){for(var e of this._runtime.GetLayoutManager().GetAllLayouts())e.ResetPersistData()},SetPixelRounding(e){this._runtime.SetPixelRoundingEnabled(0!==e)},SetFramerateMinMax(e,t){this._runtime.SetMaxDt(1/e),this._runtime.SetMinDt(1/t)},SetDeltaTimeMinMax(e,t){this._runtime.SetMinDt(e),this._runtime.SetMaxDt(t)},SetFramerateMode(e){this._runtime._SetFramerateMode(["vsync","unlimited-tick","unlimited-frame"][e])},SortZOrderByInstVar(e,r){if(e){var i=e.GetCurrentSol().GetInstances(),s=tempZOrderList,a=tempInstValues,n=this._runtime.GetCurrentLayout(),o=e.IsFamily(),l=e.GetFamilyIndex();for(let e=0,t=i.length;e<t;++e){var h=i[e],u=h.GetWorldInfo();if(u){let e;e=o?h.GetInstanceVariableValue(r+h.GetObjectClass().GetFamilyInstanceVariableOffset(l)):h.GetInstanceVariableValue(r),s.push([u.GetLayer().GetIndex(),u.GetZIndex()]),a.push([h,e])}}if(s.length){s.sort(SortZOrderList2),a.sort(SortInstancesByValue2);let r=!1;for(let e=0,t=s.length;e<t;++e){var c=a[e][0],_=n.GetLayerByIndex(s[e][0]),d=s[e][1],p=_._GetInstances();p[d]!==c&&((p[d]=c).GetWorldInfo()._SetLayer(_,!0),_.SetZIndicesChanged(c),r=!0)}r&&this._runtime.UpdateRender(),C33.clearArray(tempZOrderList),C33.clearArray(tempInstValues)}}},SetCollisionCellSize(e,t){e=Math.floor(e),t=Math.floor(t),e<=0||t<=0||!Number.isFinite(e)||!Number.isFinite(t)||this._runtime.GetCollisionEngine().SetCollisionCellSize(e,t)},GoToLayout(e){var t;this._runtime.IsLoading()||(t=this._runtime.GetLayoutManager()).IsPendingChangeMainLayout()||t.ChangeMainLayout(e)},GoToLayoutByName(e){var t;this._runtime.IsLoading()||(t=this._runtime.GetLayoutManager()).IsPendingChangeMainLayout()||(e=t.GetLayoutByName(e))&&t.ChangeMainLayout(e)},NextPrevLayout(e){var t,r,i;this._runtime.IsLoading()||(t=this._runtime.GetLayoutManager()).IsPendingChangeMainLayout()||(r=(i=t.GetAllLayouts()).indexOf(t.GetMainRunningLayout()),e&&0===r)||!e&&r===i.length-1||(i=i[r+(e?-1:1)],t.ChangeMainLayout(i))},RestartLayout(){var e;this._runtime.IsLoading()||(e=this._runtime.GetLayoutManager()).IsPendingChangeMainLayout()||(e.ChangeMainLayout(e.GetMainRunningLayout()),this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())},SetLayerVisible(e,t){e&&e.SetVisible(t)},SetLayerInteractive(e,t){e&&e.SetInteractive(t)},SetLayerHTML(e,t){e&&e.SetIsHTMLElementsLayer(t)},SetLayerOpacity(e,t){e&&e.SetOpacity(t/100)},SetLayerScale(e,t){e&&e.SetOwnScale(t)},SetLayerScaleRate(e,t){e&&e.SetScaleRate(t)},SetLayerAngle(e,t){e&&e.SetAngle(C33.toRadians(+t))},SetLayerScroll(e,t,r){e&&(e.SetOwnScrollPositionEnabled(!0),e.SetScrollX(t),e.SetScrollY(r))},RestoreLayerScroll(e){e&&e.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(e,t,r){e&&e.SetParallax(t/100,r/100)},SetLayerZElevation(e,t){e&&e.SetZElevation(+t)},SetLayerBackground(e,t){e&&(tempColor.setFromRgbValue(t),tempColor.clamp(),(t=e.GetBackgroundColor()).equalsIgnoringAlpha(tempColor)||(t.copyRgb(tempColor),this.UpdateRender()))},SetLayerTransparent(e,t){e&&e.SetTransparent(t)},SetLayerBlendMode(e,t){e&&e.SetBlendMode(t)},SetLayerEffectEnabled(e,t,r){e&&(r=e.GetEffectList().GetEffectTypeByName(r))&&(t=1===t,r.IsActive()!==t)&&(r.SetActive(t),e.UpdateActiveEffects(),this._runtime.UpdateRender())},SetLayerEffectParam(e,t,r,i){var s;e&&(t=(e=e.GetEffectList()).GetEffectTypeByName(t))&&(r=Math.floor(r),s=t.GetShaderProgram().GetParameterType(r))&&("color"===s?(tempColor.setFromRgbValue(i),i=tempColor):"percent"===s&&(i/=100),e.SetEffectParameter(t.GetIndex(),r,i))&&t.IsActive()&&this._runtime.UpdateRender()},SetLayerForceOwnTexture(e,t){e&&e.SetForceOwnTexture(t)},SetLayoutScale(e){this._runtime.GetCurrentLayout().SetScale(+e)},SetLayoutAngle(e){this._runtime.GetCurrentLayout().SetAngle(C33.toRadians(+e))},SetLayoutEffectEnabled(e,t){var r=this._runtime.GetCurrentLayout(),t=r.GetEffectList().GetEffectTypeByName(t);t&&(e=1===e,t.IsActive()!==e)&&(t.SetActive(e),r.UpdateActiveEffects(),this._runtime.UpdateRender())},SetLayoutEffectParam(e,t,r){var i,s=this._runtime.GetCurrentLayout().GetEffectList(),e=s.GetEffectTypeByName(e);e&&(t=Math.floor(t),i=e.GetShaderProgram().GetParameterType(t))&&("color"===i?(tempColor.setFromRgbValue(r),r=tempColor):"percent"===i&&(r/=100),s.SetEffectParameter(e.GetIndex(),t,r))&&e.IsActive()&&this._runtime.UpdateRender()},SetLayoutVanishingPoint(e,t){this._runtime.GetCurrentLayout().SetVanishingPointXY(e/100,t/100)},SetLayoutProjection(e){var t=this._runtime.GetCurrentLayout();0===e?t.SetPerspectiveProjection():t.SetOrthographicProjection()},ScrollX(e){this._runtime.GetCurrentLayout().SetScrollX(e)},ScrollY(e){this._runtime.GetCurrentLayout().SetScrollY(e)},Scroll(e,t){var r=this._runtime.GetCurrentLayout();r.SetScrollX(e),r.SetScrollY(t)},ScrollToObject(e){var t;e&&(e=e.GetFirstPicked())&&(e=e.GetWorldInfo())&&((t=this._runtime.GetCurrentLayout()).SetScrollX(e.GetX()),t.SetScrollY(e.GetY()))},AddLayer(e,t,r){var i=this._runtime.GetCurrentLayout();try{i.AddLayer(e,t,r)}catch(e){console.warn("[Construct] Cannot add layer: ",e)}},MoveLayer(e,t,r){if(e){var i=this._runtime.GetCurrentLayout();try{i.MoveLayer(e,t,r)}catch(e){console.warn("[Construct] Cannot move layer: ",e)}}},RemoveLayer(e){e&&this._runtime.GetCurrentLayout().RemoveLayer(e)},RemoveAllDynamicLayers(){this._runtime.GetCurrentLayout().RemoveAllDynamicLayers()},async LoadObjectTextures(e){var t=this._runtime.GetMainRunningLayout();t&&e&&!this._runtime.IsLoading()&&(e=e.IsFamily()?e.GetFamilyMembers():[e],await this._LoadTexturesForObjectClasses(t,e))},async LoadObjectTexturesByName(e){await C33.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadObjectTextures(e){var t=this._runtime.GetMainRunningLayout();t&&e&&(e=e.IsFamily()?e.GetFamilyMembers():[e],this._UnloadTexturesForObjectClasses(t,e))},UnloadObjectTexturesByName(e){C33.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadUnusedTextures(){var e,t=this._runtime.GetMainRunningLayout();t&&(e=t._GetTextureLoadedObjectTypes(),this._UnloadTexturesForObjectClasses(t,e))},async LoadLayoutTextures(e){var t=this._runtime.GetMainRunningLayout();e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},async LoadLayoutTexturesByName(e){var t=this._runtime.GetMainRunningLayout(),e=this._runtime.GetLayoutManager().GetLayoutByName(e);e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},SetFunctionReturnValue(e){var t=this._eventStack.GetCurrentExpFuncStackFrame();if(t)switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:t.SetFunctionReturnValue(e)}},MapFunction(e,t,r){var i=this._GetFunctionMap(e.toLowerCase(),!0),s=i.strMap,a=t.toLowerCase(),i=(s.has(a)&&console.warn(`[Construct] Function map '${e}' string '${t}' already in map; overwriting entry`),C33.first(s.values())||i.defaultFunc);if(i&&0!==i.GetReturnType()!=(0!==r.GetReturnType()))return void console.error(`[Construct] Function map '${e}' string '${t}' function return type not compatible with other functions in the map; entry ignored`);s.set(a,r)},MapFunctionDefault(e,t){var r=this._GetFunctionMap(e.toLowerCase(),!0),i=(r.defaultFunc&&console.warn(`[Construct] Function map '${e}' already has a default; overwriting entry`),C33.first(r.strMap.values())||r.defaultFunc);if(i&&0!==i.GetReturnType()!=(0!==t.GetReturnType()))return void console.error(`[Construct] Function map '${e}' default: function return type not compatible with other functions in the map; entry ignored`);r.defaultFunc=t},CallMappedFunction(e,t,r){var i=this._runtime,s=i.IsDebugging()?EMPTY_ITERABLE:null,a=(r=Math.floor(r),this._GetFunctionMap(e.toLowerCase(),!1));if(!a)return console.warn(`[Construct] Call mapped function: map name '${e}' not found; call ignored`),s;let n=a.strMap.get(t.toLowerCase());if(!n){if(!a.defaultFunc)return console.warn(`[Construct] Call mapped function: no function associated with map '${e}' string '${t}'; call ignored (consider setting a default)`),s;n=a.defaultFunc,r=0}if(!n.IsEnabled())return s;if(0!==n.GetReturnType())return console.warn(`[Construct] Call mapped function: map '${e}' string '${t}' has a return type so cannot be called`),s;var a=i.GetEventSheetManager(),e=a.GetCurrentEvent(),t=e.GetSolModifiersIncludingParents(),s=0<t.length,o=(s&&(n.IsCopyPicked()?a.PushCopySol(t):a.PushCleanSol(t)),[]),e=a.FindFirstFunctionBlockParent(e);if(e){var l=e.GetFunctionParameters();for(let e=r,t=l.length;e<t;++e)o.push(l[e].GetValue())}var h=n.GetFunctionParameters();for(let e=o.length,t=h.length;e<t;++e)o.push(h[e].GetInitialValue());return i.IsDebugging()?this._DebugDoCallMappedFunction(a,n,o,s,t):this._DoCallMappedFunction(a,n,o,s,t)}}}{let C33=self.C3;C33.Plugins.System.Exps={int:function(e){return"string"==typeof e&&(e=parseInt(e,10),isNaN(e))&&(e=0),Math.floor(e)},float:function(e){return e="string"==typeof e&&(e=parseFloat(e),isNaN(e))?0:e},str(e){return e.toString()},len(e){return"string"==typeof e?e.length:0},random(e,t){return void 0===t?this._runtime.Random()*e:this._runtime.Random()*(t-e)+e},choose(...e){return e[Math.floor(this._runtime.Random()*e.length)]},chooseindex(e,...t){return"number"!=typeof e&&(e=0),t[e=C33.clamp(Math.floor(e),0,t.length-1)]},pi(){return Math.PI},infinity(){return 1/0},sqrt(e){return Math.sqrt(e)},abs(e){return Math.abs(e)},round(e){return Math.round(e)},roundtodp(e,t){t=Math.max(Math.floor(t),0);t=Math.pow(10,t);return Math.round((e+Number.EPSILON)*t)/t},floor(e){return Math.floor(e)},ceil(e){return Math.ceil(e)},sign(e){return Math.sign(e)},sin(e){return Math.sin(C33.toRadians(e))},cos(e){return Math.cos(C33.toRadians(e))},tan(e){return Math.tan(C33.toRadians(e))},asin(e){return C33.toDegrees(Math.asin(e))},acos(e){return C33.toDegrees(Math.acos(e))},atan(e){return C33.toDegrees(Math.atan(e))},exp(e){return Math.exp(e)},ln(e){return Math.log(e)},log10(e){return Math.log10(e)},max(...r){let i=r[0];"number"!=typeof i&&(i=0);for(let e=1,t=r.length;e<t;++e){var s=r[e];"number"==typeof s&&i<s&&(i=s)}return i},min(...r){let i=r[0];"number"!=typeof i&&(i=0);for(let e=1,t=r.length;e<t;++e){var s=r[e];"number"==typeof s&&i>s&&(i=s)}return i},clamp(e,t,r){return C33.clamp(e,t,r)},distance(e,t,r,i){return C33.distanceTo(e,t,r,i)},angle(e,t,r,i){return C33.toDegrees(C33.angleTo(e,t,r,i))},lerp(e,t,r){return C33.lerp(e,t,r)},unlerp(e,t,r){return C33.unlerp(e,t,r)},qarp(e,t,r,i){return C33.qarp(e,t,r,i)},cubic(e,t,r,i,s){return C33.cubic(e,t,r,i,s)},cosp(e,t,r){return C33.cosp(e,t,r)},anglediff(e,t){return C33.toDegrees(C33.angleDiff(C33.toRadians(e),C33.toRadians(t)))},anglelerp(e,t,r){return C33.toDegrees(C33.angleLerp(C33.toRadians(e),C33.toRadians(t),r))},anglerotate(e,t,r){return C33.toDegrees(C33.angleRotate(C33.toRadians(e),C33.toRadians(t),C33.toRadians(r)))},setbit(e,t,r){return(e|=0)&~(1<<(t|=0))|(r=0!==r?1:0)<<t},togglebit(e,t){return(e|=0)^1<<(t|=0)},getbit(e,t){return(e|=0)&1<<(t|=0)?1:0},newline(){return"\n"},uppercase(e){return"string"==typeof e?e.toUpperCase():""},lowercase(e){return"string"==typeof e?e.toLowerCase():""},left(e,t){return"string"==typeof e?e.substr(0,t):""},mid(e,t,r){return"string"!=typeof e?"":r<0?e.substr(t):e.substr(t,r)},right(e,t){return"string"==typeof e?e.substr(Math.max(e.length-t,0)):""},trim(e){return"string"==typeof e?e.trim():""},tokenat(e,t,r){return"string"!=typeof e||"string"!=typeof r||(e=e.split(r),(t=Math.floor(t))<0)||t>=e.length?"":e[t]},tokencount(e,t){return"string"==typeof e&&"string"==typeof t&&e.length?e.split(t).length:0},find(e,t){return"string"==typeof e&&"string"==typeof t?e.search(new RegExp(C33.EscapeRegex(t),"i")):-1},findcase(e,t){return"string"==typeof e&&"string"==typeof t?e.search(new RegExp(C33.EscapeRegex(t),"")):-1},replace(e,t,r){return"string"==typeof e&&"string"==typeof t&&"string"==typeof r?e.replace(new RegExp(C33.EscapeRegex(t),"gi"),r):"string"==typeof e?e:""},stringsub(e,...r){let i=e;for(let e=0,t=r.length;e<t;++e)i=i.replaceAll(`{${e}}`,r[e].toString());return i},regexsearch(e,t,r){t=this.GetRegex(t,r);return e?e.search(t):-1},regexreplace(e,t,r,i){t=this.GetRegex(t,r);return e?e.replace(t,i):""},regexmatchcount(e,t,r){e=this.GetRegexMatches(e.toString(),t,r);return e?e.length:0},regexmatchat(e,t,r,i){i=Math.floor(i);e=this.GetRegexMatches(e.toString(),t,r);return!e||i<0||i>=e.length?"":e[i]},zeropad(e,t){var r=e<0?"-":"",t=t-(e=e<0?-e:e).toString().length;return(r+="0".repeat(Math.max(t,0)))+e.toString()},urlencode(e){return encodeURIComponent(e)},urldecode(e){return decodeURIComponent(e)},dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1e3},unixtime(){return Date.now()},time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFramesPerSecond()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return C33.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointX()},vanishingpointy(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointY()},viewportleft(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().getLeft():0},viewporttop(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().getTop():0},viewportright(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().getRight():0},viewportbottom(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().getBottom():0},viewportwidth(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().width():0},viewportheight(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetViewport3D().height():0},viewportmidx(e){var e=this._runtime.GetCurrentLayout().GetLayer(e);return e?((e=e.GetViewport3D()).getLeft()+e.getRight())/2:0},viewportmidy(e){var e=this._runtime.GetCurrentLayout().GetLayer(e);return e?((e=e.GetViewport3D()).getTop()+e.getBottom())/2:0},canvastolayerx(e,t,r){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.CanvasCssToLayer(t,r)[0]:0},canvastolayery(e,t,r){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.CanvasCssToLayer(t,r)[1]:0},layertocanvasx(e,t,r){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.LayerToCanvasCss(t,r)[0]:0},layertocanvasy(e,t,r){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.LayerToCanvasCss(t,r)[1]:0},layertolayerx(e,t,r,i){var s=this._runtime.GetCurrentLayout(),e=s.GetLayer(e),s=s.GetLayer(t);return e&&s&&e!==s?([t,e]=e.LayerToCanvasCss(r,i),s.CanvasCssToLayer(t,e)[0]):r},layertolayery(e,t,r,i){var s=this._runtime.GetCurrentLayout(),e=s.GetLayer(e),s=s.GetLayer(t);return e&&s&&e!==s?([t,e]=e.LayerToCanvasCss(r,i),s.CanvasCssToLayer(t,e)[1]):i},layerscale(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetOwnScale():0},layerangle(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?C33.toDegrees(e.GetOwnAngle()):0},layeropacity(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?100*e.GetOpacity():0},layerscalerate(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetScaleRate():0},layerscrollx(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetScrollX():0},layerscrolly(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetScrollY():0},layerparallaxx(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?100*e.GetParallaxX():0},layerparallaxy(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?100*e.GetParallaxY():0},layerzelevation(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetZElevation():0},layerindex(e){e=this._runtime.GetCurrentLayout().GetLayer(e);return e?e.GetIndex():-1},canvassnapshot(){var e=this._runtime.GetCanvasManager();return e?e.GetCanvasSnapshotUrl():""},loopindex(e){var t=this._loopStack;return t.IsInLoop()?e?(e=t.FindByName(e))?e.GetIndex():0:t.GetCurrent().GetIndex():0},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(e,t,...r){var i=this._GetFunctionMap(e.toLowerCase(),!1);if(!i)return console.warn(`[Construct] Call mapped function: map name '${e}' not found; returning 0`),0;let s=i.strMap.get(t.toLowerCase());if(!s){if(!i.defaultFunc)return console.warn(`[Construct] Call mapped function: no function associated with map '${e}' string '${t}'; returning 0 (consider setting a default)`),0;s=i.defaultFunc}var i=s.GetReturnType(),a=s.GetDefaultReturnValue();if(0===i)return console.warn(`[Construct] Call mapped function: map '${e}' string '${t}' has no return type so cannot be called from an expression; returning 0`),0;if(!s.IsEnabled())return a;var e=this._runtime.GetEventSheetManager(),t=e.GetCurrentEvent().GetSolModifiersIncludingParents(),n=0<t.length,o=(n&&(s.IsCopyPicked()?e.PushCopySol(t):e.PushCleanSol(t)),s.GetFunctionParameters());for(let e=r.length,t=o.length;e<t;++e)r.push(o[e].GetInitialValue());var l=s.GetEventBlock(),l=l.RunAsExpressionFunctionCall(l.GetSolModifiersIncludingParents(),s.IsCopyPicked(),i,a,...r);return n&&e.PopSol(t),l},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?this._runtime.GetWebGPURenderer().GetAdapterInfoString():this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){var e=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*e/1048576)/100},rgb(e,t,r){return C33.PackRGB(e,t,r)},rgbex(e,t,r){return C33.PackRGBEx(e/100,t/100,r/100)},rgba(e,t,r,i){return C33.PackRGBAEx(e/100,t/100,r/100,i/100)},rgbex255(e,t,r){return C33.PackRGBEx(e/255,t/255,r/255)},rgba255(e,t,r,i){return C33.PackRGBAEx(e/255,t/255,r/255,i/255)},projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}}}{let C33=self.C3;C33.Plugins.Sprite=class SpritePlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3,C3X=self.C3X,spawnPickStack=[],map=(C33.Plugins.Sprite.Type=class SpriteType extends C33.SDKTypeBase{constructor(e){super(e),this._animations=e.GetAnimations()}Release(){C33.clearArray(this._animations),super.Release()}OnCreate(){for(var e of this._animations)e.LoadAllAssets(this._runtime)}LoadTextures(t){let r={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(e=>e.LoadAllTextures(t,r)))}ReleaseTextures(){for(var e of this._animations)e.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(var e of this._objectClass.instancesIncludingPendingCreate())e.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(e){C33.Plugins.Sprite.FinishCollisionCondition(this,e)}BeforeRunAction(e){spawnPickStack.push({objectClass:null,createHierarchy:!1,instances:[]})}_SpawnPickInstance(e,t,r){var i=spawnPickStack.at(-1);i.objectClass=e,i.createHierarchy=r,i.instances.push(t)}AfterRunAction(e){var t=spawnPickStack.pop(),r=t.objectClass,i=t.createHierarchy;if(r){var s,a,n,o=new Map;for(s of t.instances)s.CollectInstancesToPick(o,r,i);for([a,n]of o)a.GetCurrentSol().SetSetPicked(n)}}_AddAnimation(e){var e=this.GetObjectClass().AddAnimation(e),t=this.GetRuntime();return e.GetFrameAt(0).GetImageInfo().LoadStaticTexture(t.GetRenderer(),{sampling:t.GetSampling()}).then(()=>this._UpdateAllCurrentTexture()),e}_RemoveAnimation(e){for(var t of this._objectClass.instancesIncludingPendingCreate())t.GetSdkInstance()._OnAnimationRemoved(e);this.GetObjectClass().RemoveAnimation(e)}_AddAnimationFrame(e,t){var r=this._objectClass.GetAnimationByName(e);if(!r)throw new Error(`cannot find animation name '${e}'`);let i=r.FrameTagOrIndexToIndex(t);i<0&&(i+=r.GetFrameCount()+1);var s,e=C33.AnimationFrameInfo.CreateDynamic(this.GetRuntime()),t=(r.InsertFrameAt(e,i),this.GetRuntime());e.GetImageInfo().LoadStaticTexture(t.GetRenderer(),{sampling:t.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());for(s of this._objectClass.instancesIncludingPendingCreate())s.GetSdkInstance()._OnAnimationFramesChanged();return e}_RemoveAnimationFrame(e,t){var r,i=this._objectClass.GetAnimationByName(e);if(!i)throw new Error(`cannot find animation name '${e}'`);if(1===i.GetFrameCount())throw new Error(`cannot remove last frame from animation '${e}'`);let s=i.FrameTagOrIndexToIndex(t);s<0&&(s+=i.GetFrameCount()),i.RemoveFrameAt(s);for(r of this._objectClass.instancesIncludingPendingCreate())r.GetSdkInstance()._OnAnimationFramesChanged()}GetScriptInterfaceClass(){return self.ISpriteObjectType}},new WeakMap);self.ISpriteObjectType=class ISpriteObjectType extends self.IObjectClass{constructor(e){super(e),map.set(this,e.GetSdkType())}getAnimation(e){C3X.RequireString(e);e=map.get(this).GetObjectClass().GetAnimationByName(e);return e?e.GetIAnimation():null}getAllAnimations(){return map.get(this).GetObjectClass().GetAllAnimations().map(e=>e.GetIAnimation())}addAnimation(e){return C3X.RequireString(e),map.get(this)._AddAnimation(e).GetIAnimation()}removeAnimation(e){C3X.RequireString(e),map.get(this)._RemoveAnimation(e)}addAnimationFrame(e,t){if(C3X.RequireString(e),"number"!=typeof t&&"string"!=typeof t)throw new TypeError("invalid insert location");return map.get(this)._AddAnimationFrame(e,t).GetIAnimationFrame()}removeAnimationFrame(e,t){if(C3X.RequireString(e),"number"!=typeof t&&"string"!=typeof t)throw new TypeError("invalid insert location");map.get(this)._RemoveAnimationFrame(e,t)}}}{let C33=self.C3,C3X=self.C3X,INITIALLY_VISIBLE=0,INITIAL_ANIMATION=1,INITIAL_FRAME=2,ENABLE_COLLISIONS=3,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad),tempVec2=C33.New(C33.Vector2),FLAG_PLAYING_FORWARDS=1,FLAG_ANIMATION_PLAYING=2,FLAG_ANIMATION_TRIGGER=4,map=(C33.Plugins.Sprite.Instance=class SpriteInstance extends C33.SDKWorldInstanceBase{constructor(e,t){super(e);let r=!0,i="",s=0,a=!0;t&&(r=!!t[INITIALLY_VISIBLE],i=t[INITIAL_ANIMATION],s=t[INITIAL_FRAME],a=t[ENABLE_COLLISIONS]),this._currentAnimation=this._objectClass.GetAnimationByName(i)||this._objectClass.GetAnimations()[0],this._currentFrameIndex=C33.clamp(s,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);t=this._currentAnimationFrame.GetImageInfo(),this._currentTexture=t.GetTexture(),this._currentRcTex=t.GetTexRect(),this._currentQuadTex=t.GetTexQuad(),this.HandleRendererContextLoss(),e.SetFlag(FLAG_ANIMATION_PLAYING,!0),e.SetFlag(FLAG_PLAYING_FORWARDS,0<=this._currentAnimation.GetSpeed()),this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed()),this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo(),this._animationTimer=C33.New(C33.KahanSum),this._frameStartTime=0,this._animationRepeats=0,this._animTriggerName="",this._changeAnimFrameIndex=-1,this._changeAnimationName="",this._changeAnimationFrom=0,t=this.GetWorldInfo();this._bquadRef=t.GetBoundingQuad(),t.SetVisible(r),t.SetCollisionEnabled(a),t.SetOriginX(this._currentAnimationFrame.GetOriginX()),t.SetOriginY(this._currentAnimationFrame.GetOriginY()),t.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly()),t.SetBboxChanged(),1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._currentAnimation=null,this._currentAnimationFrame=null,this._currentTexture=null,this._animationTimer=null,super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(e){var t=this._currentTexture;null!==t&&(e.SetTexture(t),(t=this.GetWorldInfo()).HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e))}_DrawStandard(e,t){let r=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&(r=e.PixelRoundQuad(r)),t.Quad4(r,this._currentQuadTex)}_DrawMesh(t,e){var r=t.GetTransformedMesh();if(t.IsMeshChanged()){t.CalculateBbox(tempRect,tempQuad,!1);let e=tempQuad;this._runtime.IsPixelRoundingEnabled()&&(e=t.PixelRoundQuad(e)),r.CalculateTransformedMesh(t.GetSourceMesh(),e,this._currentQuadTex),t.SetMeshChanged(!1)}r.Draw(e)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(FLAG_ANIMATION_PLAYING)}SetAnimationPlaying(e){this._inst.SetFlag(FLAG_ANIMATION_PLAYING,e)}IsPlayingForwards(){return this._inst.GetFlag(FLAG_PLAYING_FORWARDS)}SetPlayingForwards(e){this._inst.SetFlag(FLAG_PLAYING_FORWARDS,e)}IsInAnimationTrigger(){return this._inst.GetFlag(FLAG_ANIMATION_TRIGGER)}SetInAnimationTrigger(e){this._inst.SetFlag(FLAG_ANIMATION_TRIGGER,e)}Tick(){this._changeAnimationName&&this._DoChangeAnimation(),0<=this._changeAnimFrameIndex&&this._DoChangeAnimFrame();var e,t,r,i,s,a,n,o,l,h=this._currentAnimationSpeed;this.IsAnimationPlaying()&&0!==h?(e=this._runtime.GetDt(this._inst),this._animationTimer.Add(e),e=this.GetAnimationTime(),l=(t=this._currentAnimationFrame).GetDuration()/h,e<this._frameStartTime+l||(r=this._currentAnimation,i=this._currentAnimationRepeatTo,s=r.GetFrameCount(),a=r.GetRepeatCount(),n=r.IsLooping(),o=r.IsPingPong(),this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--,this._frameStartTime+=l,this._currentFrameIndex>=s&&(o?(this.SetPlayingForwards(!1),this._currentFrameIndex=s-2):!n&&(this._animationRepeats++,this._animationRepeats>=a)?this._FinishAnimation(!1):this._currentFrameIndex=i),this._currentFrameIndex<0&&(o?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),n||(this._animationRepeats++,this._animationRepeats>=a&&this._FinishAnimation(!0))):!n&&(this._animationRepeats++,this._animationRepeats>=a)?this._FinishAnimation(!0):this._currentFrameIndex=i),this._currentFrameIndex=C33.clamp(this._currentFrameIndex,0,s-1),l=r.GetFrameAt(this._currentFrameIndex),e>this._frameStartTime+l.GetDuration()/h&&(this._frameStartTime=e),this._OnFrameChanged(t,l))):this._StopTicking()}_FinishAnimation(e){this._currentFrameIndex=e?0:this._currentAnimation.GetFrameCount()-1,this.SetAnimationPlaying(!1),this._animTriggerName=this._currentAnimation.GetName(),this.SetInAnimationTrigger(!0),this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName}),this.Trigger(C33.Plugins.Sprite.Cnds.OnAnyAnimFinished),this.Trigger(C33.Plugins.Sprite.Cnds.OnAnimFinished),this.SetInAnimationTrigger(!1),this._animationRepeats=0}_OnFrameChanged(r,i,e){if(r!==i){var t=this.GetWorldInfo(),s=r.GetImageInfo(),a=i.GetImageInfo(),n=s.GetWidth(),s=s.GetHeight(),o=a.GetWidth(),l=a.GetHeight(),h=(e&&e.onFrameChange?e.onFrameChange(t,n,s,o,l):(n!==o&&t.SetWidth(t.GetWidth()*(o/n)),s!==l&&t.SetHeight(t.GetHeight()*(l/s))),t.SetOriginX(i.GetOriginX()),t.SetOriginY(i.GetOriginY()),t.SetSourceCollisionPoly(i.GetCollisionPoly()),t.SetBboxChanged(),this._currentAnimationFrame=i,this._currentTexture=a.GetTexture(),this._currentRcTex=a.GetTexRect(),this._currentQuadTex=a.GetTexQuad(),this.GetInstance().GetBehaviorInstances());for(let e=0,t=h.length;e<t;++e)h[e].OnSpriteFrameChanged(r,i);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex}),this.Trigger(C33.Plugins.Sprite.Cnds.OnFrameChanged),this._runtime.UpdateRender()}}_StartAnim(e){this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),1===e&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame()),this._StartTicking()}_SetAnim(e,t,r){this._changeAnimationName=e,this._changeAnimationFrom=t,this._StartTicking(),!r&&this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){return this._changeAnimationName||this._currentAnimation.GetName()}_OnAnimationRemoved(e){C33.equalsNoCase(e,this._GetCurrentAnimationName())&&this._SetAnim(this._objectClass.GetFirstAnimation().GetName(),1,!0)}_SetAnimFrame(e){if("string"==typeof e)if(String(Number(e))===e)e=Number(e);else{var t=this._objectClass.GetAnimationByName(this._GetCurrentAnimationName());if(!t)return;if(-1===(e=t.GetFrameIndexByTag(e)))return}isFinite(e)&&(this._changeAnimFrameIndex=e,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_OnAnimationFramesChanged(){var e,t;this._changeAnimationName||-1!==this._changeAnimFrameIndex||((e=this._currentAnimationFrame)!==(t=this._currentAnimation.GetFrameAt(C33.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1)))&&this._OnFrameChanged(e,t),1<this._currentAnimation.GetFrameCount()&&0<this._currentAnimationSpeed&&this._StartTicking())}_GetAnimFrame(){return this._currentFrameIndex}_GetAnimFrameTag(){return this._currentAnimationFrame.GetTag()}_SetAnimSpeed(e){this._currentAnimationSpeed=Math.abs(e),this.SetPlayingForwards(0<=e),0<this._currentAnimationSpeed&&this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(e){"string"==typeof e&&-1===(e=this._currentAnimation.GetFrameIndexByTag(e))||(e=C33.clamp(Math.floor(e),0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationRepeatTo=e)}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(e){var t=this._currentAnimationFrame,r=this._objectClass.GetAnimationByName(this._changeAnimationName);this._changeAnimationName="",!r||r===this._currentAnimation&&this.IsAnimationPlaying()||(this._currentAnimation=r,this.SetPlayingForwards(0<=r.GetSpeed()),this._currentAnimationSpeed=Math.abs(r.GetSpeed()),this._currentAnimationRepeatTo=r.GetRepeatTo(),this._currentFrameIndex=C33.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),r=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(t,r,e))}_DoChangeAnimFrame(e){var t=this._currentAnimationFrame,r=this._currentFrameIndex;this._currentFrameIndex=C33.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1),this._changeAnimFrameIndex=-1,!e&&r===this._currentFrameIndex||(e=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(t,e),this._frameStartTime=this.GetAnimationTime())}_UpdateCurrentTexture(){var e=this._currentAnimationFrame.GetImageInfo();this._currentTexture=e.GetTexture(),this._currentRcTex=e.GetTexRect(),this._currentQuadTex=e.GetTexQuad(),this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(e){var t,r,i=this._currentAnimationFrame,s=this.GetWorldInfo();let a=null;if("string"==typeof e)a=i.GetImagePointByName(e);else{if("number"!=typeof e)throw new TypeError("expected string or number");a=i.GetImagePointByIndex(e-1)}let n=s.GetTotalZElevation();return a?(tempVec2.copy(a.GetVec2()),s.HasMesh()&&([e,t,r]=s.GetSourceMesh().TransformPoint(tempVec2.getX(),tempVec2.getY()),tempVec2.set(e,t),n+=r),tempVec2.offset(-i.GetOriginX(),-i.GetOriginY()),tempVec2.scale(s.GetWidth(),s.GetHeight()),tempVec2.rotate(s.GetAngle()),tempVec2.offset(s.GetX(),s.GetY()),[tempVec2.getX(),tempVec2.getY(),n]):[s.GetX(),s.GetY(),n]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(e){e=Math.floor(e);var t=this.GetWorldInfo(),r=t.GetTransformedCollisionPoly(),i=r.pointCount();return(e=e===i?0:e)<0||i<=e?[0,0]:[(i=r.pointsArr())[2*e+0]+t.GetX(),i[2*e+1]+t.GetY()]}GetDebuggerProperties(){let t=C33.Plugins.Sprite.Acts;var e="plugins.sprite.debugger.animation-properties";return[{title:e+".title",properties:[{name:e+".current-animation",value:this._currentAnimation.GetName(),onedit:e=>this.CallAction(t.SetAnim,e,0)},{name:e+".current-frame",value:this._currentFrameIndex,onedit:e=>this.CallAction(t.SetAnimFrame,e)},{name:e+".is-playing",value:this.IsAnimationPlaying(),onedit:e=>e?this.CallAction(t.StartAnim,0):this.CallAction(t.StopAnim)},{name:e+".speed",value:this._currentAnimationSpeed,onedit:e=>this.CallAction(t.SetAnimSpeed,e)},{name:e+".repeats",value:this._animationRepeats,onedit:e=>this._animationRepeats=e}]}]}SaveToJson(){var e={a:this._currentAnimation.GetSID()},t=(0!==this._frameStartTime&&(e.fs=this._frameStartTime),this.GetAnimationTime()),t=(0!==t&&(e.at=t),0!==this._currentFrameIndex&&(e.f=this._currentFrameIndex),0!==this._currentAnimationSpeed&&(e.cas=this._currentAnimationSpeed),1!==this._animationRepeats&&(e.ar=this._animationRepeats),0!==this._currentAnimationRepeatTo&&(e.rt=this._currentAnimationRepeatTo),this.IsAnimationPlaying()||(e.ap=this.IsAnimationPlaying()),this.IsPlayingForwards()||(e.af=this.IsPlayingForwards()),this.GetWorldInfo());return t.IsCollisionEnabled()&&(e.ce=t.IsCollisionEnabled()),e}LoadFromJson(e){var t=this.GetObjectClass().GetAnimationBySID(e.a),t=(t&&(this._currentAnimation=t),this._frameStartTime=e.hasOwnProperty("fs")?e.fs:0,this._animationTimer.Set(e.hasOwnProperty("at")?e.at:0),e.hasOwnProperty("f")?e.f:0),t=(this._currentFrameIndex=C33.clamp(t,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationSpeed=e.hasOwnProperty("cas")?e.cas:0,this._animationRepeats=e.hasOwnProperty("ar")?e.ar:1,e.hasOwnProperty("rt")?e.rt:0),t=(this._currentAnimationRepeatTo=C33.clamp(t,0,this._currentAnimation.GetFrameCount()-1),this.SetAnimationPlaying(!e.hasOwnProperty("ap")||!!e.ap),this.SetPlayingForwards(!e.hasOwnProperty("af")||!!e.af),this._currentAnimation.GetFrameAt(this._currentFrameIndex)),r=(this._currentAnimationFrame=t,this._UpdateCurrentTexture(),this.GetWorldInfo());r.SetOriginX(t.GetOriginX()),r.SetOriginY(t.GetOriginY()),r.SetSourceCollisionPoly(t.GetCollisionPoly()),r.SetCollisionEnabled(!!e.ce),this.IsAnimationPlaying()&&this._StartTicking()}GetPropertyValueByIndex(e){var t=this.GetWorldInfo();switch(e){case ENABLE_COLLISIONS:return t.IsCollisionEnabled();case INITIAL_FRAME:return C33.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case INITIAL_ANIMATION:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(e,t,r){var i=this.GetWorldInfo();switch(e){case ENABLE_COLLISIONS:i.SetCollisionEnabled(!!t);break;case INITIAL_FRAME:this.SetAnimationPlaying(!1);var s=this._currentAnimation.GetFrameCount()-1,a=t=C33.clamp(t,0,s),n=this._currentAnimation.GetFrameAt(this._currentFrameIndex),o=this._currentAnimation.GetFrameAt(a);this._OnFrameChanged(n,o,r),this._currentFrameIndex=C33.clamp(a,0,s);break;case INITIAL_ANIMATION:this._changeAnimationName=t,this._DoChangeAnimation(r),1<this._currentAnimation.GetFrameCount()&&0<this._currentAnimation.GetSpeed()?this._StartTicking():this._StopTicking()}}GetScriptInterfaceClass(){return self.ISpriteInstance}},new WeakMap),ANIM_FROM_MODES=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class ISpriteInstance extends self.IWorldInstance{constructor(){super(),map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return map.get(this).GetImagePointCount()}getImagePointX(e){return this.getImagePoint(e)[0]}getImagePointY(e){return this.getImagePoint(e)[1]}getImagePointZ(e){return this.getImagePoint(e)[2]}getImagePoint(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return map.get(this).GetImagePoint(e)}getPolyPointCount(){return map.get(this).GetCollisionPolyPointCount()}getPolyPointX(e){return C3X.RequireFiniteNumber(e),map.get(this).GetCollisionPolyPoint(e)[0]}getPolyPointY(e){return C3X.RequireFiniteNumber(e),map.get(this).GetCollisionPolyPoint(e)[1]}getPolyPoint(e){return C3X.RequireFiniteNumber(e),map.get(this).GetCollisionPolyPoint(e)}stopAnimation(){map.get(this).SetAnimationPlaying(!1)}startAnimation(e="current-frame"){C3X.RequireString(e);e=ANIM_FROM_MODES.get(e);if(void 0===e)throw new Error("invalid mode");map.get(this)._StartAnim(e)}setAnimation(e,t="beginning"){C3X.RequireString(e),C3X.RequireString(t);t=ANIM_FROM_MODES.get(t);if(void 0===t)throw new Error("invalid mode");var r=map.get(this);if(!r.GetObjectClass().GetAnimationByName(e))throw new Error(`animation name "${e}" does not exist`);r._SetAnim(e,t)}getAnimation(e){C3X.RequireString(e);e=map.get(this).GetObjectClass().GetAnimationByName(e);return e?e.GetIAnimation():null}get animation(){return map.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return map.get(this)._GetCurrentAnimationName()}set animationFrame(e){C3X.RequireFiniteNumber(e),map.get(this)._SetAnimFrame(e)}get animationFrame(){return map.get(this)._GetAnimFrame()}set animationFrameTag(e){C3X.RequireString(e),map.get(this)._SetAnimFrame(e)}get animationFrameTag(){return map.get(this)._GetAnimFrameTag()}set animationSpeed(e){C3X.RequireFiniteNumber(e),map.get(this)._SetAnimSpeed(e)}get animationSpeed(){return map.get(this)._GetAnimSpeed()}set animationRepeatToFrame(e){C3X.RequireFiniteNumber(e),map.get(this)._SetAnimRepeatToFrame(e)}get animationRepeatToFrame(){return map.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return map.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){var e=map.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}async replaceCurrentAnimationFrame(e){C3X.RequireInstanceOf(e,Blob);var t=map.get(this),r=t.GetRuntime(),i=t.GetCurrentImageInfo(),s=C33.New(C33.ImageInfo);s.LoadDynamicBlobAsset(r,e),await s.LoadStaticTexture(r.GetRenderer(),{sampling:r.GetSampling()}),t.WasReleased()?s.Release():(i.ReplaceWith(s),(e=t.GetSdkType())._UpdateAllCurrentTexture(),e.GetObjectClass().Dispatcher().dispatchEvent(new C33.Event("animationframeimagechange")),r.UpdateRender())}setSolidCollisionFilter(e,t){C3X.RequireString(t),map.get(this).GetWorldInfo().SetSolidCollisionFilter(!!e,t)}}}{let C33=self.C3;C33.Plugins.Sprite.Cnds={IsAnimPlaying(e){return C33.equalsNoCase(this._GetCurrentAnimationName(),e)},CompareFrame(e,t){return C33.compare(this._currentFrameIndex,e,t)},CompareFrameTag(e,t){var r;return"string"==typeof t&&(r=this._currentAnimationFrame.GetTag(),C33.compare(r.toLowerCase(),e,t.toLowerCase()))},CompareAnimSpeed(e,t){return C33.compare(this._GetAnimSpeed(),e,t)},OnAnimFinished(e){return C33.equalsNoCase(this._animTriggerName,e)},OnAnyAnimFinished(){return!0},OnFrameChanged(){return!0},IsMirrored(){return this.GetWorldInfo().GetWidth()<0},IsFlipped(){return this.GetWorldInfo().GetHeight()<0},OnURLLoaded(){return!0},OnURLFailed(){return!0},IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}}}{let C33=self.C3;C33.Plugins.Sprite.Acts={Spawn(e,t,r,i,s){var a;e&&t&&([r,a]=this.GetImagePoint(r),r=this._runtime.CreateInstance(e,t,r,a,i,s))&&(i&&t.SortAndAddInstancesByZIndex(r),e.GetPlugin().IsRotatable()&&((a=r.GetWorldInfo()).SetAngle(this.GetWorldInfo().GetAngle()),a.SetBboxChanged()),(s=this._runtime.GetEventSheetManager()).BlockFlushingInstances(!0),r._TriggerOnCreatedOnSelfAndRelated(),s.BlockFlushingInstances(!1),e!==this._runtime.GetCurrentAction().GetObjectClass())&&this._sdkType._SpawnPickInstance(e,r,i)},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(e){this._StartAnim(e)},SetAnim(e,t){this._SetAnim(e,t)},SetAnimFrame(e){this._SetAnimFrame(e)},SetAnimSpeed(e){this._SetAnimSpeed(e)},SetAnimRepeatToFrame(e){this._SetAnimRepeatToFrame(e)},AddRemoveAnimation(t,e){try{0===t?this.GetSdkType()._AddAnimation(e):this.GetSdkType()._RemoveAnimation(e)}catch(e){console.error(`[Construct] Error ${0===t?"adding":"removing"} animation: `,e)}},AddRemoveAnimationFrame(t,e,r){try{0===t?this.GetSdkType()._AddAnimationFrame(e,r):this.GetSdkType()._RemoveAnimationFrame(e,r)}catch(e){console.error(`[Construct] Error ${0===t?"adding":"removing"} animation frame: `,e)}},SetMirrored(e){var t=this.GetWorldInfo(),r=t.GetWidth(),e=Math.abs(r)*(0===e?-1:1);r!==e&&(t.SetWidth(e),t.SetBboxChanged())},SetFlipped(e){var t=this.GetWorldInfo(),r=t.GetHeight(),e=Math.abs(r)*(0===e?-1:1);r!==e&&(t.SetHeight(e),t.SetBboxChanged())},SetScale(e){var t=this._currentAnimationFrame.GetImageInfo(),r=this.GetWorldInfo(),i=r.GetWidth()<0?-1:1,s=r.GetHeight()<0?-1:1,i=t.GetWidth()*e*i,t=t.GetHeight()*e*s;r.GetWidth()===i&&r.GetHeight()===t||(r.SetSize(i,t),r.SetBboxChanged())},async LoadURL(e,t,r){var i=this._currentAnimationFrame.GetImageInfo(),s=this.GetWorldInfo(),a=this._runtime,n=this._sdkType;if(i.GetURL()===e)0===t&&(s.SetSize(i.GetWidth(),i.GetHeight()),s.SetBboxChanged()),this.Trigger(C33.Plugins.Sprite.Cnds.OnURLLoaded);else{var o=C33.New(C33.ImageInfo);try{if(await o.LoadDynamicAsset(a,e),!o.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return void o.Release();await o.LoadStaticTexture(a.GetRenderer(),{sampling:a.GetSampling()})}catch(e){return console.error("Load image from URL failed: ",e),void(this.WasReleased()||this.Trigger(C33.Plugins.Sprite.Cnds.OnURLFailed))}this.WasReleased()?o.Release():(i.ReplaceWith(o),n._UpdateAllCurrentTexture(),n.GetObjectClass().Dispatcher().dispatchEvent(new C33.Event("animationframeimagechange")),a.UpdateRender(),0===t&&(s.SetSize(i.GetWidth(),i.GetHeight()),s.SetBboxChanged()),await this.TriggerAsync(C33.Plugins.Sprite.Cnds.OnURLLoaded))}},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},SetSolidCollisionFilter(e,t){this.GetWorldInfo().SetSolidCollisionFilter(0===e,t)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{let C33=self.C3;C33.Plugins.Sprite.Exps={AnimationFrame(){return this._GetAnimFrame()},AnimationFrameTag(){return this._GetAnimFrameTag()},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(e){return this.GetImagePoint(e)[0]},ImagePointY(e){return this.GetImagePoint(e)[1]},ImagePointZ(e){return this.GetImagePoint(e)[2]},ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(e){return this.GetCollisionPolyPoint(e)[0]},PolyPointYAt(e){return this.GetCollisionPolyPoint(e)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}}}{let C33=self.C3;C33.Plugins.Text=class TextPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Text.Type=class TextType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}LoadTextures(e){}ReleaseTextures(){}}}{let C33=self.C3,C3X=self.C3X,TEMP_COLOR_ARRAY=[0,0,0],TEXT=0,ENABLE_BBCODE=1,FONT=2,SIZE=3,LINE_HEIGHT=4,BOLD=5,ITALIC=6,COLOR=7,HORIZONTAL_ALIGNMENT=8,VERTICAL_ALIGNMENT=9,WRAPPING=10,TEXT_DIRECTION=11,ICON_SET=12,INITIALLY_VISIBLE=13,ORIGIN=14,READ_ALOUD=15,HORIZONTAL_ALIGNMENTS=["left","center","right"],VERTICAL_ALIGNMENTS=["top","center","bottom"],TEXT_DIRECTIONS=["ltr","rtl"],WORD_WRAP_MODES=["word","cjk","character"],tempRect=new C33.Rect,tempQuad=new C33.Quad,tempColor=new C33.Color,tempVec2=C33.New(C33.Vector2),BBCODE_TAG_TO_HTML=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["iconoffsety",null]]),map=(C33.Plugins.Text.Instance=class TextInstance extends C33.SDKWorldInstanceBase{constructor(e,t){super(e),this._text="",this._enableBBcode=!0,this._faceName="Arial",this._ptSize=12,this._lineHeightOffset=0,this._isBold=!1,this._isItalic=!1,this._color=C33.New(C33.Color),this._horizontalAlign=0,this._verticalAlign=0,this._wrapMode="word",this._textDirection=0,this._resolutionMode="auto",this._fixedScaleFactor=1,this._iconObjectClass=null,this._htmlString="",this._isHtmlStringUpToDate=!1,this._readAloud=!1,this._screenReaderText=null,this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,this._rendererText=C33.New(C33.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5}),this._rendererText.ontextureupdate=()=>this._runtime.UpdateRender(),this._animationframeimagechange_handler=()=>this._OnIconObjectClassImageChanged(),this._pendingUpdateIconSet=!1,t&&(this._text=t[TEXT],this._enableBBcode=!!t[ENABLE_BBCODE],this._faceName=t[FONT],this._ptSize=t[SIZE],this._lineHeightOffset=t[LINE_HEIGHT],this._isBold=!!t[BOLD],this._isItalic=!!t[ITALIC],this._horizontalAlign=t[HORIZONTAL_ALIGNMENT],this._verticalAlign=t[VERTICAL_ALIGNMENT],this._wrapMode=WORD_WRAP_MODES[t[WRAPPING]],this._textDirection=t[TEXT_DIRECTION],this._SetIconObjectClass(this._runtime.GetObjectClassBySID(t[ICON_SET])),e=t[COLOR],this._color.setRgb(e[0],e[1],e[2]),this.GetWorldInfo().SetVisible(t[INITIALLY_VISIBLE]),this._readAloud=!!t[READ_ALOUD]),this._UpdateTextSettings(),this._UpdateScreenReaderText()}Release(){this._SetIconObjectClass(null),this._CancelTypewriter(),this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null),this._rendererText.Release(),this._rendererText=null,super.Release()}_UpdateTextSettings(){var e=this._rendererText;e.SetText(this._text),e.SetBBCodeEnabled(this._enableBBcode),this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass?this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)):this._rendererText.SetIconSet(null),e.SetIconSmoothing("nearest"!==this._runtime.GetSampling()),e.SetFontName(this._faceName),e.SetLineHeight(this._lineHeightOffset),e.SetBold(this._isBold),e.SetItalic(this._isItalic),e.SetColor(this._color),e.SetHorizontalAlignment(HORIZONTAL_ALIGNMENTS[this._horizontalAlign]),e.SetVerticalAlignment(VERTICAL_ALIGNMENTS[this._verticalAlign]),e.SetWordWrapMode(this._wrapMode),e.SetTextDirection(TEXT_DIRECTIONS[this._textDirection])}_UpdateTextSize(){var e=this.GetWorldInfo(),t=(this._rendererText.SetFontSize(this._ptSize),this._rendererText.SetFontSizeScale(e.GetSceneGraphScale()),e.GetLayer());let r;"auto"===this._resolutionMode?r=t.GetResolutionScaleFactorToZ(e.GetTotalZElevation()):"fixed"===this._resolutionMode&&(r=this._fixedScaleFactor),e.HasMesh()&&r!==this._rendererText.GetZoom()&&e.SetMeshChanged(!0),this._rendererText.SetSize(e.GetWidth(),e.GetHeight(),r)}_SetIconObjectClass(e){e&&(e.IsFamily()||e.GetPlugin().constructor!==C33.Plugins.Sprite)||e!==this._iconObjectClass&&(this._iconObjectClass&&this._iconObjectClass.Dispatcher().removeEventListener("animationframeimagechange",this._animationframeimagechange_handler),this._iconObjectClass=e,this._iconObjectClass&&this._iconObjectClass.Dispatcher().addEventListener("animationframeimagechange",this._animationframeimagechange_handler),this._UpdateTextSettings(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}_OnIconObjectClassImageChanged(){this._runtime.DeleteTextIconSet(this._iconObjectClass),this._runtime.UpdateRender(),this._pendingUpdateIconSet=!0}_UpdateScreenReaderText(){if(this._readAloud){let e=this._text;this._enableBBcode&&(e=C33.BBString.StripAnyTags(e)),this._screenReaderText?this._screenReaderText.SetText(e):this._screenReaderText=C33.New(C33.ScreenReaderText,this._runtime,e)}else this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null)}Draw(e){var t,r,i,s,a,n,o,l=this.GetWorldInfo(),h=(this._UpdateTextSize(),this._pendingUpdateIconSet&&(this._pendingUpdateIconSet=!1,this._rendererText.IsBBCodeEnabled())&&this._iconObjectClass&&this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)),this._rendererText.GetTexture());h&&(t=l.GetLayer(),0===l.GetAngle()&&0===t.GetAngle()&&0===l.GetTotalZElevation()&&!l.HasMesh()&&t.RendersIn2DMode()?(r=l.GetBoundingQuad(),[n,o]=t.LayerToDrawSurface(r.getTlx(),r.getTly()),[r,i]=t.LayerToDrawSurface(r.getBrx(),r.getBry()),s=n-Math.round(n),a=o-Math.round(o),[n,o]=(tempRect.set(n,o,r,i),tempRect.offset(-s,-a),tempQuad.setFromRect(tempRect),e.GetRenderTargetSize(e.GetRenderTarget())),this._runtime.GetCanvasManager().SetDeviceTransform(e,n,o),e.SetTexture(h),e.Quad3(tempQuad,this._rendererText.GetTexRect()),t._SetTransform(e)):(e.SetTexture(h),l.HasMesh()?this._DrawMesh(l,e):this._DrawStandard(l,e)))}_DrawStandard(e,t){let r=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(r=this._PixelRoundQuad(r)),t.Quad3(r,this._rendererText.GetTexRect())}_DrawMesh(t,e){var r=t.GetTransformedMesh();if(t.IsMeshChanged()){t.CalculateBbox(tempRect,tempQuad,!1);let e=tempQuad;this._runtime.IsPixelRoundingEnabled()&&(e=this._PixelRoundQuad(e)),r.CalculateTransformedMesh(t.GetSourceMesh(),e,this._rendererText.GetTexRect()),t.SetMeshChanged(!1)}r.Draw(e)}_PixelRoundQuad(e){var t=e.getTlx()-Math.round(e.getTlx()),r=e.getTly()-Math.round(e.getTly());return 0==t&&0==r?e:(tempQuad.copy(e),tempQuad.offset(-t,-r),tempQuad)}GetCurrentSurfaceSize(){var e=this._rendererText.GetTexture();return e?[e.GetWidth(),e.GetHeight()]:[100,100]}GetCurrentTexRect(){return this._rendererText.GetTexRect()}IsCurrentTexRotated(){return!1}SaveToJson(){var e={t:this._text,c:this._color.toJSON(),fn:this._faceName,ps:this._ptSize};return this._enableBBcode&&(e.bbc=this._enableBBcode),0!==this._horizontalAlign&&(e.ha=this._horizontalAlign),0!==this._verticalAlign&&(e.va=this._verticalAlign),"word"!==this._wrapMode&&(e.wr=this._wrapMode),0!==this._lineHeightOffset&&(e.lho=this._lineHeightOffset),this._isBold&&(e.b=this._isBold),this._isItalic&&(e.i=this._isItalic),-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),this._iconObjectClass&&(e.ioc=this._iconObjectClass.GetSID()),"fixed"===this._resolutionMode&&(e.fs=this._fixedScaleFactor),e}LoadFromJson(e){var t;this._CancelTypewriter(),this._text=e.t,this._color.setFromJSON(e.c),this._faceName=e.fn,this._ptSize=e.ps,this._enableBBcode=!!e.hasOwnProperty("bbc")&&e.bbc,this._horizontalAlign=e.hasOwnProperty("ha")?e.ha:0,this._verticalAlign=e.hasOwnProperty("va")?e.va:0,e.hasOwnProperty("wr")?(t=e.wr,this._wrapMode="boolean"==typeof t?t?"word":"character":t):this._wrapMode="word",this._lineHeightOffset=e.hasOwnProperty("lho")?e.lho:0,this._isBold=!!e.hasOwnProperty("b")&&e.b,this._isItalic=!!e.hasOwnProperty("i")&&e.i,e.hasOwnProperty("tw")&&(t=e.tw,this._typewriterStartTime=t.st,this._typewriterEndTime=t.en,this._typewriterLength=t.l),e.hasOwnProperty("ioc")?(t=this.GetRuntime().GetObjectClassBySID(e.ioc))&&this._SetIconObjectClass(t):this._SetIconObjectClass(null),e.hasOwnProperty("fs")?(this._resolutionMode="fixed",this._fixedScaleFactor=e.fs):this._resolutionMode="auto",this._UpdateTextSettings(),this._UpdateScreenReaderText(),this._isHtmlStringUpToDate=!1,-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case TEXT:return this.GetText();case ENABLE_BBCODE:return this._enableBBcode;case FONT:return this._GetFontFace();case SIZE:return this._GetFontSize();case LINE_HEIGHT:return this._GetLineHeight();case BOLD:return this._IsBold();case ITALIC:return this._IsItalic();case COLOR:return TEMP_COLOR_ARRAY[0]=this._color.getR(),TEMP_COLOR_ARRAY[1]=this._color.getG(),TEMP_COLOR_ARRAY[2]=this._color.getB(),TEMP_COLOR_ARRAY;case HORIZONTAL_ALIGNMENT:return this._GetHAlign();case VERTICAL_ALIGNMENT:return this._GetVAlign();case WRAPPING:return this._GetWrapMode();case READ_ALOUD:return this._IsReadAloud()}}SetPropertyValueByIndex(e,t){switch(e){case TEXT:this._SetText(t);break;case ENABLE_BBCODE:this._enableBBcode!==!!t&&(this._enableBBcode=!!t,this._UpdateTextSettings());break;case FONT:this._SetFontFace(t);break;case SIZE:this._SetFontSize(t);break;case LINE_HEIGHT:this._SetLineHeight(t);break;case BOLD:this._SetBold(t);break;case ITALIC:this._SetItalic(t);break;case COLOR:var r=this._color,i=t;r.getR()===i[0]&&r.getG()===i[1]&&r.getB()===i[2]||(this._color.setRgb(i[0],i[1],i[2]),this._UpdateTextSettings());break;case HORIZONTAL_ALIGNMENT:this._SetHAlign(t);break;case VERTICAL_ALIGNMENT:this._SetVAlign(t);break;case WRAPPING:this._SetWrapMode(t)}}SetPropertyColorOffsetValueByIndex(e,t,r,i){0===t&&0===r&&0===i||e===COLOR&&(this._color.addRgb(t,r,i),this._UpdateTextSettings())}_SetText(e){this._text!==e&&(this._text=e,this._rendererText.SetText(e),this._UpdateScreenReaderText(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(e,t){this._UpdateTextSize(),this._SetText(e),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+t/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=this._rendererText.GetLengthInGraphemes(),this._rendererText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,this._rendererText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(C33.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetFontFace(e){this._faceName!==e&&(this._faceName=e,this._rendererText.SetFontName(e),this._runtime.UpdateRender())}_GetFontFace(){return this._faceName}_SetBold(e){this._isBold!==(e=!!e)&&(this._isBold=e,this._rendererText.SetBold(e),this._runtime.UpdateRender())}_IsBold(){return this._isBold}_SetItalic(e){this._isItalic!==(e=!!e)&&(this._isItalic=e,this._rendererText.SetItalic(e),this._runtime.UpdateRender())}_IsItalic(){return this._isItalic}_SetFontSize(e){this._ptSize!==e&&(this._ptSize=e,this._runtime.UpdateRender())}_GetFontSize(){return this._ptSize}_SetFontColor(e){this._color.equalsIgnoringAlpha(e)||(this._color.copyRgb(e),this._rendererText.SetColor(this._color),this._runtime.UpdateRender())}_GetFontColor(){return this._color}_SetLineHeight(e){this._lineHeightOffset!==e&&(this._lineHeightOffset=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapModeByIndex(e){this._SetWrapMode(WORD_WRAP_MODES[e])}_SetWrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetWrapMode(){return this._wrapMode}_SetTextDirection(e){this._textDirection!==e&&(this._textDirection=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetTextDirection(){return this._textDirection}_SetReadAloud(e){this._readAloud=!!e,this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_SetResolutionMode(e){this._resolutionMode!==e&&(this._resolutionMode=e,this._runtime.UpdateRender())}_GetResolutionMode(){return this._resolutionMode}_SetFixedScaleFactor(e){this._fixedScaleFactor!==e&&(this._fixedScaleFactor=e,"fixed"===this._resolutionMode)&&this._runtime.UpdateRender()}_GetFixedScaleFactor(){return this._fixedScaleFactor}_GetTextWidth(){return this._UpdateTextSize(),this._rendererText.GetTextWidth()}_GetTextHeight(){return this._UpdateTextSize(),this._rendererText.GetTextHeight()}_GetTagAtPosition(e,t){this._UpdateTextSize();var r=this.GetWorldInfo(),e=(tempVec2.set(e-r.GetX(),t-r.GetY()),tempVec2.rotate(-r.GetAngle()),tempVec2.offset(r.GetWidth()*r.GetOriginX(),r.GetHeight()*r.GetOriginY()),tempVec2.divide(r.GetWidth(),r.GetHeight()),tempVec2.scale(this._rendererText.GetWidth(),this._rendererText.GetHeight()),this._rendererText.HitTestFragment(tempVec2.getX(),tempVec2.getY()));if(e){t=e.GetStyleTag("tag");if(t)return t.param}return""}_HasTagAtPosition(e,t,r){t=this._GetTagAtPosition(t,r);return t&&C33.equalsNoCase(e,t)}_GetTagPosition(e,t){this._UpdateTextSize(),t=Math.floor(t);var r,i,s,a,e=this._rendererText.FindFragmentWithTag(e,t);return e?(t=this.GetWorldInfo(),r=this._rendererText.GetDrawScale(),i=e.GetPosX(),s=e.GetPosY()-(e.GetHeight()-e.GetFontBoundingBoxDescent())*r,a=e.GetWidth()*r/this._rendererText.GetWidth()*t.GetWidth(),e=e.GetHeight()*r/this._rendererText.GetHeight()*t.GetHeight(),tempVec2.set(i,s),tempVec2.divide(this._rendererText.GetWidth(),this._rendererText.GetHeight()),tempVec2.scale(t.GetWidth(),t.GetHeight()),tempVec2.offset(-t.GetWidth()*t.GetOriginX(),-t.GetHeight()*t.GetOriginY()),tempVec2.rotate(t.GetAngle()),tempVec2.offset(t.GetX(),t.GetY()),{x:tempVec2.getX(),y:tempVec2.getY(),width:a,height:e}):null}_GetTagCount(e){return this._UpdateTextSize(),this._rendererText.CountFragmentsWithTag(e)}_GetHTMLCloseTag(e){let t=BBCODE_TAG_TO_HTML.get(e);return null===t?"":`</${(t=t||"span")||"span"}>`}_GetHTMLOpenTag(e,t){let r=BBCODE_TAG_TO_HTML.get(e);if(null===r)return"";switch(r=r||"span",e){case"color":return`<${r} style="color: ${t}">`;case"font":return`<${r} style="font-family: '${t}'">`;case"opacity":return`<${r} style="opacity: ${t}%">`;case"size":return`<${r} style="font-size: ${t}pt">`;case"background":return`<${r} style="background-color: ${t}">`;case"hide":return`<${r} style="visibility: hidden">`;case"class":return`<${r} class="${t}">`;case"tag":return`<${r} data-tag="${t}">`;default:return`<${r}>`}}async _UpdateHTMLString(){if(!this._isHtmlStringUpToDate){var e=new C33.BBString(this._text,{noEscape:!0}).toFragmentList();let a=new Map,t='<span class="c3-text"';var r=[],n=(r.push(`font-family: '${this._GetFontFace()}';`),this._IsBold()&&r.push("font-weight: bold;"),this._IsItalic()&&r.push("font-style: italic;"),"character"===this._GetWrapMode()&&r.push("word-break: break-all;"),t+=` style="${r.join(" ")}">`,this._iconObjectClass?this.GetRuntime().GetTextIconSet(this._iconObjectClass):null);if(this._iconObjectClass){var i,o=C33.New(C33.PromiseThrottle),l=[];let s=new Map;for(i of e)if(i.IsIcon()){var h=i.GetTextIcon(n);if(h){let t=h.GetSource().GetImageInfo().GetImageAsset();if(s.has(t))continue;s.set(t,null),l.push(o.Add(async()=>{var e=await t.LoadToDrawable();s.set(t,e)}))}}await Promise.all(l);var u,c,_=[];for(u of e)if(u.IsIcon()){let i=u.GetTextIcon(n);if(i){let t=i.GetSource(),r=t.GetImageInfo().GetImageAsset();_.push(o.Add(async()=>{var e=await t.GetImageInfo().ExtractImageToBlobURL(s.get(r));a.set(i,e)}))}}await Promise.all(_);for(c of s.values())c instanceof ImageBitmap&&c.close&&c.close()}var s,d=new Map;for(s of e){var p,m,g,f=s.GetStyleMap(),S=[...d.keys()];S.reverse();for(p of S)f.has(p)&&f.get(p)===d.get(p)||(d.delete(p),t+=this._GetHTMLCloseTag(p));for([m,g]of f)d.has(m)||(d.set(m,g),t+=this._GetHTMLOpenTag(m,g));if(s.IsText()&&(t+=C33.ReplaceAll(C33.EscapeHTML(s.GetCharacterArray().join("")),"\n","<br>")),s.IsIcon()&&n){S=s.GetTextIcon(n);if(S){var C=a.get(S);if(C){var y=[];let e="0.2em";var G=f.get("iconoffsety");G&&(G=G.trim(),e=G.endsWith("%")?parseFloat(G)/100+"em":G+"px"),y.push("top: "+e),"nearest"===this._runtime.GetSampling()&&y.push("image-rendering: pixelated"),t+=`<img class="c3-text-icon" data-icon="${s.GetIconParameter()}" width="${S.GetWidth()}" height="${S.GetHeight()}" style="${y.join(";")}" src="${C}">`}}}}var I,r=[...d.keys()];r.reverse();for(I of r)t+=this._GetHTMLCloseTag(I);t+="</span>",this._htmlString=t,this._isHtmlStringUpToDate=!0}return this._htmlString}Tick(){var e=this._runtime.GetWallTime();e>=this._typewriterEndTime?(this._CancelTypewriter(),this.Trigger(C33.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender()):(e=C33.relerp(this._typewriterStartTime,this._typewriterEndTime,e,0,this._typewriterLength),(e=Math.floor(e))!==this._rendererText.GetDrawMaxCharacterCount()&&(this._rendererText.SetDrawMaxCharacterCount(e),this._runtime.UpdateRender()))}GetDebuggerProperties(){var e="plugins.text";return[{title:e+".name",properties:[{name:e+".properties.text.name",value:this.GetText(),onedit:e=>this._SetText(e)},{name:e+".properties.font.name",value:this._GetFontFace(),onedit:e=>this._SetFontFace(e)},{name:e+".properties.size.name",value:this._GetFontSize(),onedit:e=>this._SetFontSize(e)},{name:e+".properties.line-height.name",value:this._GetLineHeight(),onedit:e=>this._SetLineHeight(e)},{name:e+".properties.bold.name",value:this._IsBold(),onedit:e=>this._SetBold(e)},{name:e+".properties.italic.name",value:this._IsItalic(),onedit:e=>this._SetItalic(e)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}},new WeakMap),SCRIPT_HORIZONTAL_ALIGNMENTS=new Map([["left",0],["center",1],["right",2]]),SCRIPT_VERTICAL_ALIGNMENTS=new Map([["top",0],["center",1],["bottom",2]]),SCRIPT_TEXT_DIRECTIONS=["ltr","rtl"],VALID_RESOLUTION_MODES=new Set(["auto","fixed"]);self.ITextInstance=class ITextInstance extends self.IWorldInstance{constructor(){super(),map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return map.get(this).GetText()}set text(e){C3X.RequireString(e);var t=map.get(this);t._CancelTypewriter(),t._SetText(e)}typewriterText(e,t){C3X.RequireString(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._CancelTypewriter(),r._StartTypewriter(e,t)}typewriterFinish(){map.get(this)._FinishTypewriter()}set fontFace(e){C3X.RequireString(e),map.get(this)._SetFontFace(e)}get fontFace(){return map.get(this)._GetFontFace()}set isBold(e){map.get(this)._SetBold(e)}get isBold(){return map.get(this)._IsBold()}set isItalic(e){map.get(this)._SetItalic(e)}get isItalic(){return map.get(this)._IsItalic()}set sizePt(e){C3X.RequireFiniteNumber(e),map.get(this)._SetFontSize(e)}get sizePt(){return map.get(this)._GetFontSize()}set fontColor(e){if(C3X.RequireArray(e),e.length<3)throw new Error("expected 3 elements");tempColor.setRgb(e[0],e[1],e[2]),map.get(this)._SetFontColor(tempColor)}get fontColor(){var e=map.get(this)._GetFontColor();return[e.getR(),e.getG(),e.getB()]}set lineHeight(e){C3X.RequireFiniteNumber(e),map.get(this)._SetLineHeight(e)}get lineHeight(){return map.get(this)._GetLineHeight()}set horizontalAlign(e){C3X.RequireString(e);e=SCRIPT_HORIZONTAL_ALIGNMENTS.get(e);if(void 0===e)throw new Error("invalid mode");map.get(this)._SetHAlign(e)}get horizontalAlign(){return HORIZONTAL_ALIGNMENTS[map.get(this)._GetHAlign()]}set verticalAlign(e){C3X.RequireString(e);e=SCRIPT_VERTICAL_ALIGNMENTS.get(e);if(void 0===e)throw new Error("invalid mode");map.get(this)._SetVAlign(e)}get verticalAlign(){return VERTICAL_ALIGNMENTS[map.get(this)._GetVAlign()]}set wordWrapMode(e){if(!WORD_WRAP_MODES.includes(e))throw new Error("invalid mode");map.get(this)._SetWrapMode(e)}get wordWrapMode(){return map.get(this)._GetWrapMode()}set textDirection(e){C3X.RequireString(e);e=SCRIPT_TEXT_DIRECTIONS.indexOf(e);if(-1===e)throw new Error("invalid text direction");map.get(this)._SetTextDirection(e)}get textDirection(){return SCRIPT_TEXT_DIRECTIONS[map.get(this)._GetTextDirection()]}set readAloud(e){map.get(this)._SetReadAloud(!!e)}get readAloud(){return map.get(this)._IsReadAloud()}setFixedResolutionMode(e){C3X.RequireFiniteNumber(e);var t=map.get(this);t._SetResolutionMode("fixed"),t._SetFixedScaleFactor(e)}setAutoResolutionMode(){map.get(this)._SetResolutionMode("auto")}get textWidth(){return map.get(this)._GetTextWidth()}get textHeight(){return map.get(this)._GetTextHeight()}getTextSize(){var e=map.get(this);return[e._GetTextWidth(),e._GetTextHeight()]}hasTagAtPosition(e,t,r){return C3X.RequireString(e),C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(r),map.get(this)._HasTagAtPosition(e,t,r)}getTagAtPosition(e,t){return C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),map.get(this)._GetTagAtPosition(e,t)}getTagPositionAndSize(e,t=0){return C3X.RequireString(e),C3X.RequireFiniteNumber(t),map.get(this)._GetTagPosition(e,t)}getTagCount(e){return C3X.RequireString(e),map.get(this)._GetTagCount(e)}changeIconSet(e){var t=map.get(this),e=t.GetRuntime()._UnwrapIObjectClass(e);t._SetIconObjectClass(e)}getAsHtmlString(){return map.get(this)._UpdateHTMLString()}}}{let C33=self.C3;C33.Plugins.Text.Cnds={CompareText(e,t){return t?this._text===e:C33.equalsNoCase(this._text,e)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished(){return!0},HasTagAtPosition(e,t,r){return this._HasTagAtPosition(e,t,r)}}}{let C33=self.C3,tempColor=C33.New(C33.Color);C33.Plugins.Text.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),(e=(e="number"==typeof e&&e<1e9?Math.round(1e10*e)/1e10:e).toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},SetFontFace(e,t){let r=!1,i=!1;switch(t){case 1:r=!0;break;case 2:i=!0;break;case 3:r=!0,i=!0}e===this._faceName&&r===this._isBold&&i===this._isItalic||(this._SetFontFace(e),this._SetBold(r),this._SetItalic(i))},SetFontSize(e){this._SetFontSize(e)},SetFontColor(e){tempColor.setFromRgbValue(e),tempColor.clamp(),this._SetFontColor(tempColor)},SetWebFont(e,t){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect")},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},SetLineHeight(e){this._SetLineHeight(e)},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapModeByIndex(e)},SetTextDirection(e){this._SetTextDirection(e)},ChangeIconSet(e){this._SetIconObjectClass(e)},UpdateHTML(){return this._UpdateHTMLString()},SetReadAloud(e){this._SetReadAloud(e)},SetResolutionMode(e,t){this._SetResolutionMode(["auto","fixed"][e]),this._SetFixedScaleFactor(t)}}}{let C33=self.C3;C33.Plugins.Text.Exps={Text(){return this._text},PlainText(){return this._enableBBcode?C33.BBString.StripAnyTags(this._text):this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset},TagAtPosition(e,t){return this._GetTagAtPosition(e,t)},TagCount(e){return this._GetTagCount(e)},TagX(e,t){e=this._GetTagPosition(e,t);return e?e.x:0},TagY(e,t){e=this._GetTagPosition(e,t);return e?e.y:0},TagWidth(e,t){e=this._GetTagPosition(e,t);return e?e.width:0},TagHeight(e,t){e=this._GetTagPosition(e,t);return e?e.height:0},AsHTML(){return this._htmlString}}}{let C33=self.C3;C33.Plugins.Browser=class BrowserPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Browser.Type=class BrowserType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,DOM_COMPONENT_ID="browser";C33.Plugins.Browser.Instance=class BrowserInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._initLocationStr="",this._isOnline=!1,this._referrer="",this._docTitle="",this._isCookieEnabled=!1,this._screenWidth=0,this._screenHeight=0,this._windowOuterWidth=0,this._windowOuterHeight=0,this._isConstructArcade=!1,this._cssStyleMap=new Map,this._isInstallAvailable=!1,this._installResult="",this._isWarnOnCloseEnabled=!1,this.AddDOMMessageHandlers([["online-state",e=>this._OnOnlineStateChanged(e)],["backbutton",()=>this._OnBackButton()],["sw-message",e=>this._OnSWMessage(e)],["hashchange",e=>this._OnHashChange(e)],["install-available",()=>this._OnInstallAvailable()],["app-installed",e=>this._OnAppInstalled(e)]]);e=this.GetRuntime().Dispatcher();this._disposables=new C33.CompositeDisposable(C33.Disposable.From(e,"afterfirstlayoutstart",()=>this._OnAfterFirstLayoutStart()),C33.Disposable.From(e,"window-resize",()=>this._OnWindowResize()),C33.Disposable.From(e,"suspend",()=>this._OnSuspend()),C33.Disposable.From(e,"resume",()=>this._OnResume())),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state",{exportType:this._runtime.GetExportType()}).then(e=>{this._initLocationStr=e.location,this._isOnline=e.isOnline,this._referrer=e.referrer,this._docTitle=e.title,this._isCookieEnabled=e.isCookieEnabled,this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._isConstructArcade=e.isConstructArcade}))}Release(){super.Release()}_OnAfterFirstLayoutStart(){this.PostToDOM("ready-for-sw-messages")}async _OnOnlineStateChanged(e){e=!!e.isOnline;this._isOnline!==e&&(this._isOnline=e,this._isOnline?await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnOnline):await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnOffline))}async _OnWindowResize(){await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnResize)}_OnSuspend(){this.Trigger(C33.Plugins.Browser.Cnds.OnPageHidden)}_OnResume(){this.Trigger(C33.Plugins.Browser.Cnds.OnPageVisible)}async _OnBackButton(){await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnBackButton)}_OnSWMessage(e){e=e.type;"downloading-update"===e?this.Trigger(C33.Plugins.Browser.Cnds.OnUpdateFound):"update-ready"===e||"update-pending"===e?this.Trigger(C33.Plugins.Browser.Cnds.OnUpdateReady):"offline-ready"===e&&this.Trigger(C33.Plugins.Browser.Cnds.OnOfflineReady)}_OnHashChange(e){this._initLocationStr=e.location,this.Trigger(C33.Plugins.Browser.Cnds.OnHashChange)}_OnInstallAvailable(){this._isInstallAvailable=!0,this.Trigger(C33.Plugins.Browser.Cnds.OnInstallAvailable)}_OnAppInstalled(e){this._isInstallAvailable=!1,this.Trigger(C33.Plugins.Browser.Cnds.OnAppInstalled)}_IsWarnOnCloseEnabled(){return this._isWarnOnCloseEnabled}_SetWarnOnCloseEnabled(e){this._isWarnOnCloseEnabled!==(e=!!e)&&(this._isWarnOnCloseEnabled=e,this.PostToDOM("set-warn-on-close",{enabled:e}))}GetDebuggerProperties(){var e="plugins.browser.debugger";return[{title:"plugins.browser.name",properties:[{name:e+".user-agent",value:navigator.userAgent},{name:e+".is-online",value:this._isOnline},{name:e+".is-fullscreen",value:this._runtime.GetCanvasManager().IsDocumentFullscreen()}]}]}}}{let C33=self.C3;C33.Plugins.Browser.Cnds={IsOnline(){return this._isOnline},OnOnline(){return!0},OnOffline(){return!0},OnResize(){return!0},CookiesEnabled(){return this._isCookieEnabled},IsFullscreen(){return this._runtime.GetCanvasManager().IsDocumentFullscreen()},OnBackButton(){return!0},IsPortraitLandscape(e){return(this._runtime.GetCanvasManager().GetLastWidth()<=this._runtime.GetCanvasManager().GetLastHeight()?0:1)===e},OnUpdateFound(){return!0},OnUpdateReady(){return!0},OnOfflineReady(){return!0},OnHashChange(){return!0},OnInstallAvailable(){return!0},IsInstallAvailable(){return this._isInstallAvailable},OnInstallResult(e){switch(e){case 0:return"accepted"===this._installResult;case 1:return"dismissed"===this._installResult;case 2:return"error"===this._installResult;case 3:return!0;default:return!1}},OnAppInstalled(){return!0},CompareDisplayMode(e){var t=this._runtime.GetCanvasManager().GetCssDisplayMode();switch(e){case 0:return"browser"===t;case 1:return"minimal-ui"===t;case 2:return"standalone"===t;case 3:return"fullscreen"===t;default:return!1}},IsWarnOnCloseEnabled(){return this._IsWarnOnCloseEnabled()},PageVisible(){return!this._runtime.IsSuspended()},OnPageHidden(){return!0},OnPageVisible(){return!0},HasJava(){return!1},IsDownloadingUpdate(){return!1},OnMenuButton(){return!1},OnSearchButton(){return!1},IsMetered(){return!1},IsCharging(){return!0},SupportsFullscreen(){return!0}}}{let C3=self.C3,ORIENTATIONS=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];C3.Plugins.Browser.Acts={Alert(e){this.PostToDOM("alert",{message:e.toString()})},Close(){this._isConstructArcade||(this._runtime.IsDebug()?self.C3Debugger.CloseWindow():this.PostToDOM("close"))},Focus(){this.PostToDOM("set-focus",{isFocus:!0})},Blur(){this.PostToDOM("set-focus",{isFocus:!1})},GoBack(){this._isConstructArcade||this.PostToDOM("navigate",{type:"back"})},GoForward(){this._isConstructArcade||this.PostToDOM("navigate",{type:"forward"})},GoHome(){},Reload(){this._isConstructArcade||(this._runtime.IsDebug()?this._runtime.PostToDebugger({type:"reload"}):this.PostToDOM("navigate",{type:"reload"}))},GoToURL(e,t){this._PostToDOMMaybeSync("navigate",{type:"url",url:e,target:t,exportType:this._runtime.GetExportType()})},GoToURLWindow(e,t){this._PostToDOMMaybeSync("navigate",{type:"new-window",url:e,tag:t,exportType:this._runtime.GetExportType()})},RequestFullScreen(e,t){2<=e&&(e+=1),1===(e=6===e?2:e)&&(e=0);e=C3.CanvasManager._FullscreenModeNumberToString(e);this._runtime.GetCanvasManager().SetDocumentFullscreenMode(e),this._PostToDOMMaybeSync("request-fullscreen",{navUI:t})},CancelFullScreen(){this._PostToDOMMaybeSync("exit-fullscreen")},Vibrate(e){var r=e.split(",");for(let e=0,t=r.length;e<t;++e)r[e]=parseInt(r[e],10);this._PostToDOMMaybeSync("vibrate",{pattern:r})},async InvokeDownload(e,t){e&&t&&(e=await this._runtime.GetAssetManager().GetProjectFileUrl(e),this._runtime.InvokeDownload(e,t))},InvokeDownloadString(e,t,r){r&&(t=`data:${t},`+encodeURIComponent(e),this._runtime.InvokeDownload(t,r))},ConsoleLog(e,t){t=t.toString(),0===e?console.log(t):1===e?console.warn(t):2===e&&console.error(t)},ConsoleGroup(e){console.group(e)},ConsoleGroupEnd(){console.groupEnd()},ExecJs(jsStr){try{eval(jsStr)}catch(err){console.error("Error executing JavaScript: ",err)}},LockOrientation(e){(e=Math.floor(e))<0||e>=ORIENTATIONS.length||(e=ORIENTATIONS[e],this._PostToDOMMaybeSync("lock-orientation",{orientation:e}))},UnlockOrientation(){this._PostToDOMMaybeSync("unlock-orientation")},LoadStyleSheet(e){this._runtime.GetAssetManager().LoadStyleSheet(e)},async SetDocumentCSSStyle(e,t,r,i){await this.PostToDOMAsync("set-document-css-style",{prop:C3.CSSToCamelCase(e),value:t,selector:r,"is-all":0!==i})},async GetDocumentCSSStyle(e,t,r){e=await this.PostToDOMAsync("get-document-css-style",{prop:e,selector:t});e.isOk&&this._cssStyleMap.set(r.toLowerCase(),e.result.trim())},SetHash(e){this.PostToDOM("set-hash",{hash:e})},SetWindowSize(e,t){this.PostToDOM("set-window-size",{windowWidth:e,windowHeight:t})},SetWindowPosition(e,t){this.PostToDOM("set-window-position",{windowX:e,windowY:t})},async RequestInstall(){var e=await this.PostToDOMAsync("request-install");this._installResult=e.result,this.Trigger(C3.Plugins.Browser.Cnds.OnInstallResult)},SetWarnOnClose(e){this._SetWarnOnCloseEnabled(e)}}}{let C3=self.C3;C3.Plugins.Browser.Exps={URL(){return this._runtime.IsInWorker()?this._initLocationStr:location.toString()},Protocol(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).protocol},Domain(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).hostname},Port(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).port},PathName(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).pathname},Hash(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).hash},QueryString(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).search},QueryParam(e){var t=(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).search,e=RegExp("[?&]"+e+"=([^&]*)").exec(t);return e?decodeURIComponent(e[1].replace(/\+/g," ")):""},Referrer(){return this._referrer},Title(){return this._docTitle},Language(){return navigator.language},Platform(){return navigator.platform},UserAgent(){return navigator.userAgent},ExecJS(jsStr){let result=0;try{result=eval(jsStr)}catch(err){console.error("Error executing JavaScript: ",err)}return"number"==typeof result||"string"==typeof result?result:"boolean"==typeof result&&result?1:0},CSSStyleValue(e){return this._cssStyleMap.get(e)||""},Name(){return navigator.appName},Version(){return navigator.appVersion},Product(){return navigator.product},Vendor(){return navigator.vendor},BatteryLevel(){return 1},BatteryTimeLeft(){return 1/0},Bandwidth(){var e=navigator.connection;return e&&(e.downlink||e.downlinkMax||e.bandwidth)||1/0},ConnectionType(){var e=navigator.connection;return e&&e.type||"unknown"},DevicePixelRatio(){return self.devicePixelRatio},ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterWidth},DisplayMode(){return this._runtime.GetCanvasManager().GetCssDisplayMode()},InstallResult(){return this._installResult}}}{let C33=self.C3;C33.Plugins.Arr=class ArrayPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Arr.Type=class ArrayType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let ResizeArray2=function(t,r,i){if(r<t.length)C33.truncateArray(t,r);else if(r>t.length)if("function"==typeof i)for(let e=t.length;e<r;++e)t.push(i());else for(let e=t.length;e<r;++e)t.push(i)},C33=(ResizeArray=ResizeArray2,self.C3),C3X=self.C3X,IInstance=self.IInstance,map=(C33.Plugins.Arr.Instance=class ArrayInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._cx=10,this._cy=1,this._cz=1,this._arr=null,this._forX=[],this._forY=[],this._forZ=[],this._forDepth=-1,t&&(this._cx=t[0],this._cy=t[1],this._cz=t[2]),this._arr=C33.MakeFilledArray(this._cx,()=>C33.MakeFilledArray(this._cy,()=>C33.MakeFilledArray(this._cz,0)))}Release(){this._arr=null,super.Release()}At(e,t,r){return e=Math.floor(e),t=Math.floor(t),r=Math.floor(r),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=r&&r<this._cz?this._arr[e][t][r]:0}Set(e,t,r,i){e=Math.floor(e),t=Math.floor(t),r=Math.floor(r),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=r&&r<this._cz&&(this._arr[e][t][r]=i)}SetSize(e,r,i){if(e=Math.floor(e),r=Math.floor(r),i=Math.floor(i),r<0&&(r=0),i<0&&(i=0),this._cx!==(e=e<0?0:e)||this._cy!==r||this._cz!==i){this._cx=e,this._cy=r,this._cz=i;var s=this._arr;ResizeArray2(s,e,()=>C33.MakeFilledArray(r,()=>C33.MakeFilledArray(i,0)));for(let t=0;t<e;++t){ResizeArray2(s[t],r,()=>C33.MakeFilledArray(i,0));for(let e=0;e<r;++e)ResizeArray2(s[t][e],i,0)}}}GetWidth(){return this._cx}GetHeight(){return this._cy}GetDepth(){return this._cz}_ShuffleHelper(e,t,r,i,s){for(;0<t;){var a,n,o,l,h=Math.floor(this._runtime.Random()*t);--t,0===e?(n=this.At(t,i,s),a=this.At(h,i,s),this.Set(t,i,s,a),this.Set(h,i,s,n)):1===e?(a=this.At(r,t,s),n=this.At(r,h,s),this.Set(r,t,s,n),this.Set(r,h,s,a)):2===e&&(o=this.At(r,i,t),l=this.At(r,i,h),this.Set(r,i,t,l),this.Set(r,i,h,o))}}GetDebuggerProperties(){var e="plugins.arr.debugger",t="plugins.arr.properties",t=[{title:e+".array-properties.title",properties:[{name:t+".width.name",value:this._cx,onedit:e=>this.SetSize(e,this._cy,this._cz)},{name:t+".height.name",value:this._cy,onedit:e=>this.SetSize(this._cx,e,this._cz)},{name:t+".depth.name",value:this._cz,onedit:e=>this.SetSize(this._cx,this._cy,e)},{name:t+".elements.name",value:this._cx*this._cy*this._cz}]}],r=[];if(1===this._cy&&1===this._cz)for(let t=0;t<this._cx;++t)r.push({name:"$"+t,value:this._arr[t][0][0],onedit:e=>this._arr[t][0][0]=e});else for(let e=0;e<this._cx;++e)r.push({name:"$"+e,value:this._arr[e].toString()});return r.length&&t.push({title:e+".array-data.title",properties:r}),t}GetAsJsonString(){return JSON.stringify({c2array:!0,size:[this._cx,this._cy,this._cz],data:this._arr})}SaveToJson(){return{size:[this._cx,this._cy,this._cz],data:this._arr}}LoadFromJson(e){var t=e.size;this._cx=t[0],this._cy=t[1],this._cz=t[2],this._arr=e.data}_GetForX(){return 0<=this._forDepth&&this._forDepth<this._forX.length?this._forX[this._forDepth]:0}_GetForY(){return 0<=this._forDepth&&this._forDepth<this._forY.length?this._forY[this._forDepth]:0}_GetForZ(){return 0<=this._forDepth&&this._forDepth<this._forZ.length?this._forZ[this._forDepth]:0}GetScriptInterfaceClass(){return self.IArrayInstance}},new WeakMap);self.IArrayInstance=class IArrayInstance extends IInstance{constructor(){super(),map.set(this,IInstance._GetInitInst().GetSdkInstance())}get width(){return map.get(this).GetWidth()}get height(){return map.get(this).GetHeight()}get depth(){return map.get(this).GetDepth()}setSize(e,t=1,r=1){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(r),map.get(this).SetSize(e,t,r)}getAt(e,t=0,r=0){return C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(r),map.get(this).At(e,t,r)}setAt(e,t,r=0,i=0){if(C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(r),C3X.RequireFiniteNumber(i),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid type");map.get(this).Set(t,r,i,e)}}}{let DoForEachTrigger2=function(e,t,r,i,s,a){e.PushCopySol(r),a.GetObjectClass().GetCurrentSol().PickOne(a.GetInstance()),t.Retrigger(i,s),e.PopSol(r)},C33=(DoForEachTrigger=DoForEachTrigger2,self.C3);C33.Plugins.Arr.Cnds={CompareX(e,t,r){return C33.compare(this.At(e,0,0),t,r)},CompareXY(e,t,r,i){return C33.compare(this.At(e,t,0),r,i)},CompareXYZ(e,t,r,i,s){return C33.compare(this.At(e,t,r),i,s)},ArrForEach(e){var t=this._runtime,i=t.GetEventSheetManager(),s=t.GetCurrentEvent(),a=s.GetSolModifiers(),r=t.GetEventStack(),n=r.GetCurrentStackFrame(),o=r.Push(s),l=++this._forDepth,h=this._forX,u=this._forY,c=this._forZ,_=this._cx,d=this._cy,p=this._cz;if(l===this._forX.length?(h.push(0),u.push(0),c.push(0)):(h[l]=0,u[l]=0,c[l]=0),t.SetDebuggingEnabled(!1),0===e)for(let r=0;r<_;++r)for(let t=0;t<d;++t)for(let e=0;e<p;++e)h[l]=r,u[l]=t,c[l]=e,DoForEachTrigger2(i,s,a,n,o,this);else if(1===e)for(let t=0;t<_;++t)for(let e=0;e<d;++e)h[l]=t,u[l]=e,DoForEachTrigger2(i,s,a,n,o,this);else for(let e=0;e<_;++e)h[l]=e,DoForEachTrigger2(i,s,a,n,o,this);return t.SetDebuggingEnabled(!0),this._forDepth--,r.Pop(),!1},CompareCurrent(e,t){return C33.compare(this.At(this._GetForX(),this._GetForY(),this._GetForZ()),e,t)},Contains(i){var e=this._cx,s=this._cy,a=this._cz,n=this._arr;for(let r=0;r<e;++r)for(let t=0;t<s;++t)for(let e=0;e<a;++e)if(n[r][t][e]===i)return!0;return!1},IsEmpty(){return 0===this._cx||0===this._cy||0===this._cz},CompareSize(e,t,r){let i=0;switch(e){case 0:i=this._cx;break;case 1:i=this._cy;break;case 2:i=this._cz}return C33.compare(i,t,r)}}}{let CompareValues2=function(e,t){return"number"==typeof e&&"number"==typeof t?e-t:(e=e.toString())<(t=t.toString())?-1:t<e?1:0},C33=(CompareValues=CompareValues2,self.C3);C33.Plugins.Arr.Acts={Clear(i){var e=this._cx,s=this._cy,a=this._cz,n=this._arr;for(let r=0;r<e;++r)for(let t=0;t<s;++t)for(let e=0;e<a;++e)n[r][t][e]=i},SetSize(e,t,r){this.SetSize(e,t,r)},SetX(e,t){this.Set(e,0,0,t)},SetXY(e,t,r){this.Set(e,t,0,r)},SetXYZ(e,t,r,i){this.Set(e,t,r,i)},Push(r,i,e){var s=this._cx,a=this._cy;let t=this._cz;var n=this._arr;if(0===e){var o=C33.MakeFilledArray(a,()=>C33.MakeFilledArray(t,i));0===r?n.push(o):n.unshift(o),this._cx++}else if(1===e){for(let e=0;e<s;++e){var l=C33.MakeFilledArray(t,i);0===r?n[e].push(l):n[e].unshift(l)}this._cy++}else{for(let t=0;t<s;++t)for(let e=0;e<a;++e)0===r?n[t][e].push(i):n[t][e].unshift(i);this._cz++}},Pop(r,e){var i=this._cx,s=this._cy,t=this._cz,a=this._arr;if(0===e)0!==i&&(0===r?a.pop():a.shift(),this._cx--);else if(1===e){if(0!==s){for(let e=0;e<i;++e)0===r?a[e].pop():a[e].shift();this._cy--}}else if(0!==t){for(let t=0;t<i;++t)for(let e=0;e<s;++e)0===r?a[t][e].pop():a[t][e].shift();this._cz--}},Reverse(e){var r=this._cx,i=this._cy,t=this._cz,s=this._arr;if(0!==r&&0!==i&&0!==t)if(0===e)s.reverse();else if(1===e)for(let e=0;e<r;++e)s[e].reverse();else for(let t=0;t<r;++t)for(let e=0;e<i;++e)s[t][e].reverse()},Sort(e){var r=this._cx,i=this._cy,t=this._cz,s=this._arr;if(0!==r&&0!==i&&0!==t)if(0===e)s.sort((e,t)=>CompareValues2(e[0][0],t[0][0]));else if(1===e)for(let e=0;e<r;++e)s[e].sort((e,t)=>CompareValues2(e[0],t[0]));else for(let t=0;t<r;++t)for(let e=0;e<i;++e)s[t][e].sort(CompareValues2)},Shuffle(r){var i=this._cx,s=this._cy,a=this._cz;if(0!==i&&0!==s&&0!==a)if(0===r)for(let t=0;t<s;++t)for(let e=0;e<a;++e)this._ShuffleHelper(r,i,0,t,e);else if(1===r)for(let t=0;t<i;++t)for(let e=0;e<a;++e)this._ShuffleHelper(r,s,t,0,e);else for(let t=0;t<i;++t)for(let e=0;e<s;++e)this._ShuffleHelper(r,a,t,e,0)},Delete(r,e){if(!((r=Math.floor(r))<0)){var i=this._cx,s=this._cy,t=this._cz,a=this._arr;if(0===e)i<=r||(a.splice(r,1),this._cx--);else if(1===e){if(!(s<=r)){for(let e=0;e<i;++e)a[e].splice(r,1);this._cy--}}else if(!(t<=r)){for(let t=0;t<i;++t)for(let e=0;e<s;++e)a[t][e].splice(r,1);this._cz--}}},Insert(r,i,e){if(!((i=Math.floor(i))<0)){var s=this._cx,a=this._cy;let t=this._cz;var n=this._arr;if(0===e)s<i||(n.splice(i,0,C33.MakeFilledArray(a,()=>C33.MakeFilledArray(t,r))),this._cx++);else if(1===e){if(!(a<i)){for(let e=0;e<s;++e)n[e].splice(i,0,C33.MakeFilledArray(t,r));this._cy++}}else if(!(i>t)){for(let t=0;t<s;++t)for(let e=0;e<a;++e)n[t][e].splice(i,0,r);this._cz++}}},SplitString(e,t,r){var i=e.split(t);this.SetSize(i.length,1,1);for(let t=0,e=i.length;t<e;++t){let e=i[t];0===r?String(Number(e))===e&&(e=Number(e)):2===r&&(e=Number(e)),this.Set(t,0,0,e)}},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct] Failed to parse JSON: ",e)}t.c2array&&(e=t.size,this._cx=e[0],this._cy=e[1],this._cz=e[2],this._arr=t.data)},JSONDownload(e){var t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}{let C33=self.C3;C33.Plugins.Arr.Exps={At(e,t,r){return this.At(e,t||0,r||0)},Width(){return this._cx},Height(){return this._cy},Depth(){return this._cz},CurX(){return this._GetForX()},CurY(){return this._GetForY()},CurZ(){return this._GetForZ()},CurValue(){return this.At(this._GetForX(),this._GetForY(),this._GetForZ())},Front(){return this.At(0,0,0)},Back(){return this.At(this._cx-1,0,0)},IndexOf(r){var i=this._arr;for(let e=0,t=this._cx;e<t;++e)if(i[e][0][0]===r)return e;return-1},LastIndexOf(t){var r=this._arr;for(let e=this._cx-1;0<=e;--e)if(r[e][0][0]===t)return e;return-1},JoinString(e){var t=[];for(let e=0;e<this._cx;++e)t.push(this.At(e,0,0));return t.join(e)},AsJSON(){return this.GetAsJsonString()}}}{let C33=self.C3;C33.Plugins.Keyboard=class KeyboardPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetKeyboardSdkInstance2=function(){return keyboardObjectType.GetSingleGlobalInstance().GetSdkInstance()},C33=(GetKeyboardSdkInstance=GetKeyboardSdkInstance2,self.C3),C3X=self.C3X,keyboardObjectType=(C33.Plugins.Keyboard.Type=class KeyboardType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IKeyboardObjectType}},null);self.IKeyboardObjectType=class IKeyboardObjectType extends self.IObjectClass{constructor(e){super(e),(keyboardObjectType=e).GetRuntime()._GetCommonScriptInterfaces().keyboard=this}isKeyDown(e){var t=GetKeyboardSdkInstance2();if("string"==typeof e)return t.IsKeyDown(e);if("number"==typeof e)return t.IsKeyCodeDown(e);throw new TypeError("expected string or number")}}}{let C33=self.C3;C33.Plugins.Keyboard.Instance=class KeyboardInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._keysDownByString=new Set,this._keysDownByWhich=new Set,this._triggerWhich=0,this._triggerString="",this._triggerTypedKey="";e=this.GetRuntime().Dispatcher();this._disposables=new C33.CompositeDisposable(C33.Disposable.From(e,"keydown",e=>this._OnKeyDown(e.data)),C33.Disposable.From(e,"keyup",e=>this._OnKeyUp(e.data)),C33.Disposable.From(e,"window-blur",()=>this._OnWindowOrKeyboardBlur()),C33.Disposable.From(e,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur()))}Release(){super.Release()}_OnKeyDown(e){var t=e.which,r=e.code||t.toString(),e=e.key;this._keysDownByString.has(r)||(this._keysDownByString.add(r),this._keysDownByWhich.add(t),this._triggerString=r,this._triggerWhich=t,this._triggerTypedKey=e,this.Trigger(C33.Plugins.Keyboard.Cnds.OnAnyKey),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKey),this.Trigger(C33.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKeyCode))}_OnKeyUp(e){var t=e.which,r=e.code||t.toString(),e=e.key;this._keysDownByString.delete(r),this._keysDownByWhich.delete(t),this._triggerString=r,this._triggerWhich=t,this._triggerTypedKey=e,this.Trigger(C33.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(C33.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKeyCodeReleased)}_OnWindowOrKeyboardBlur(){for(var e of this._keysDownByWhich)this._keysDownByWhich.delete(e),this._triggerWhich=e,this.Trigger(C33.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(C33.Plugins.Keyboard.Cnds.OnKeyCodeReleased);this._keysDownByString.clear()}IsKeyDown(e){return this._keysDownByString.has(e)}IsKeyCodeDown(e){return this._keysDownByWhich.has(e)}SaveToJson(){return{tk:this._triggerWhich,tkk:this._triggerTypedKey}}LoadFromJson(e){this._triggerWhich=e.tk,e.hasOwnProperty("tkk")&&(this._triggerTypedKey=e.tkk)}GetDebuggerProperties(){var e="plugins.keyboard";return[{title:e+".name",properties:[{name:e+".debugger.last-key-code",value:this._triggerWhich},{name:e+".debugger.last-key-string",value:C33.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:e+".debugger.last-typed-key",value:this._triggerTypedKey}]}]}}}{let C33=self.C3,LEFTRIGHT_KEY_STRINGS=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"];C33.Plugins.Keyboard.Cnds={IsKeyDown(e){return this._keysDownByWhich.has(e)},OnKey(e){return this._triggerWhich===e},OnAnyKey(){return!0},OnAnyKeyReleased(){return!0},OnKeyReleased(e){return this._triggerWhich===e},IsKeyCodeDown(e){return e=Math.floor(e),this._keysDownByWhich.has(e)},OnKeyCode(e){return this._triggerWhich===e},OnKeyCodeReleased(e){return this._triggerWhich===e},OnLeftRightKeyPressed(e){e=LEFTRIGHT_KEY_STRINGS[e];return this._triggerString===e},OnLeftRightKeyReleased(e){e=LEFTRIGHT_KEY_STRINGS[e];return this._triggerString===e},IsLeftRightKeyDown(e){e=LEFTRIGHT_KEY_STRINGS[e];return this._keysDownByString.has(e)}}}{let C33=self.C3;C33.Plugins.Keyboard.Acts={}}{let StringFromCharCode2=function(e){switch(e=Math.floor(e)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"←";case 38:return"↑";case 39:return"→";case 40:return"↓";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}},C33=(StringFromCharCode=StringFromCharCode2,self.C3);C33.Plugins.Keyboard.Exps={LastKeyCode(){return this._triggerWhich},StringFromKeyCode(e){return StringFromCharCode2(e)},TypedKey(){return this._triggerTypedKey}}}{let C33=self.C3;C33.Plugins.Touch=class TouchPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetTouchSdkInstance2=function(){return touchObjectType.GetSingleGlobalInstance().GetSdkInstance()},C33=(GetTouchSdkInstance=GetTouchSdkInstance2,self.C3),C3X=self.C3X,touchObjectType=(C33.Plugins.Touch.Type=class TouchType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}},null);self.ITouchObjectType=class ITouchObjectType extends self.IObjectClass{constructor(e){super(e),(touchObjectType=e).GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(e){C3X.RequireString(e);var t=GetTouchSdkInstance2();if("orientation"===e)return t._RequestPermission(0);if("motion"===e)return t._RequestPermission(1);throw new Error("invalid type")}}}{let C33=self.C3,DOM_COMPONENT_ID="touch";C33.Plugins.Touch.Instance=class TouchInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._touches=new Map,this._useMouseInput=!1,this._isMouseDown=!1,this._orientCompassHeading=0,this._orientAlpha=0,this._orientBeta=0,this._orientGamma=0,this._accX=0,this._accY=0,this._accZ=0,this._accWithGX=0,this._accWithGY=0,this._accWithGZ=0,this._triggerIndex=0,this._triggerId=0,this._triggerPermission=0,this._curTouchX=0,this._curTouchY=0,this._getTouchIndex=0,this._triggerType=0,this._permissionPromises=[],t&&(this._useMouseInput=t[0]),this.AddDOMMessageHandler("permission-result",e=>this._OnPermissionResult(e));e=this.GetRuntime().Dispatcher();this._disposables=new C33.CompositeDisposable(C33.Disposable.From(e,"pointerdown",e=>this._OnPointerDown(e.data)),C33.Disposable.From(e,"pointermove",e=>this._OnPointerMove(e.data)),C33.Disposable.From(e,"pointerup",e=>this._OnPointerUp(e.data,!1)),C33.Disposable.From(e,"pointercancel",e=>this._OnPointerUp(e.data,!0)),C33.Disposable.From(e,"deviceorientation",e=>this._OnDeviceOrientation(e.data)),C33.Disposable.From(e,"deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e.data)),C33.Disposable.From(e,"devicemotion",e=>this._OnDeviceMotion(e.data)),C33.Disposable.From(e,"tick2",e=>this._OnTick2()))}Release(){this._touches.clear(),super.Release()}_OnPointerDown(e){if("mouse"===e.pointerType){if(!this._useMouseInput)return;this._isMouseDown=!0}var t,r,i,s,a=e.pointerId;this._touches.has(a)||(t=e.pageX-this._runtime.GetCanvasClientX(),e=e.pageY-this._runtime.GetCanvasClientY(),r=performance.now(),i=this._touches.size,this._triggerIndex=i,this._triggerId=a,(s=C33.New(C33.Plugins.Touch.TouchInfo)).Init(r,t,e,a,i),this._touches.set(a,s),this.Trigger(C33.Plugins.Touch.Cnds.OnNthTouchStart),this.Trigger(C33.Plugins.Touch.Cnds.OnTouchStart),this._curTouchX=t,this._curTouchY=e,this._triggerType=0,this.Trigger(C33.Plugins.Touch.Cnds.OnTouchObject))}_OnPointerMove(e){var t,r,i,s;"mouse"===e.pointerType&&!this._isMouseDown||!(t=this._touches.get(e.pointerId))||(r=performance.now())-t.GetTime()<2||(i=e.pageX-this._runtime.GetCanvasClientX(),s=e.pageY-this._runtime.GetCanvasClientY(),t.Update(r,i,s,e.width,e.height,e.pressure))}_OnPointerUp(e,t){if("mouse"===e.pointerType){if(!this._isMouseDown)return;this._isMouseDown=!1}var r,i=performance.now(),s=e.pointerId,a=this._touches.get(s);a&&(this._triggerIndex=a.GetStartIndex(),this._triggerId=a.GetId(),t||(r=e.pageX-this._runtime.GetCanvasClientX(),e=e.pageY-this._runtime.GetCanvasClientY(),this._curTouchX=r,this._curTouchY=e,this._triggerType=1,this.Trigger(C33.Plugins.Touch.Cnds.OnTouchObject)),this.Trigger(C33.Plugins.Touch.Cnds.OnNthTouchEnd),this.Trigger(C33.Plugins.Touch.Cnds.OnTouchEnd),t||("single-tap"===(r=a.ShouldTriggerTap(i))?(this.Trigger(C33.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=a.GetX(),this._curTouchY=a.GetY(),this.Trigger(C33.Plugins.Touch.Cnds.OnTapGestureObject)):"double-tap"===r&&(this.Trigger(C33.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=a.GetX(),this._curTouchY=a.GetY(),this.Trigger(C33.Plugins.Touch.Cnds.OnDoubleTapGestureObject))),a.Release(),this._touches.delete(s))}_RequestPermission(r){return this._PostToDOMMaybeSync("request-permission",{type:r}),new Promise((e,t)=>{this._permissionPromises.push({type:r,resolve:e,reject:t})})}_OnPermissionResult(e){var t,r=e.result;let i=e.type;this._triggerPermission=i;for(t of this._permissionPromises.filter(e=>e.type===i))t.resolve(r?"granted":"denied");this._permissionPromises=this._permissionPromises.filter(e=>e.type!==i),r?(this.Trigger(C33.Plugins.Touch.Cnds.OnPermissionGranted),0===i?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(C33.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){"number"==typeof e.webkitCompassHeading?this._orientCompassHeading=e.webkitCompassHeading:e.absolute&&(this._orientCompassHeading=e.alpha),this._orientAlpha=e.alpha,this._orientBeta=e.beta,this._orientGamma=e.gamma}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e.alpha}_OnDeviceMotion(e){var t=e.acceleration,t=(t&&(this._accX=t.x,this._accY=t.y,this._accZ=t.z),e.accelerationIncludingGravity);t&&(this._accWithGX=t.x,this._accWithGY=t.y,this._accWithGZ=t.z)}_OnTick2(){var e,t=performance.now();let r=0;for(e of this._touches.values())e.GetTime()<=t-50&&e._SetLastTime(t),e.ShouldTriggerHold(t)&&(this._triggerIndex=e.GetStartIndex(),this._triggerId=e.GetId(),this._getTouchIndex=r,this.Trigger(C33.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=e.GetX(),this._curTouchY=e.GetY(),this.Trigger(C33.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++r}_GetTouchByIndex(e){e=Math.floor(e);for(var t of this._touches.values()){if(0===e)return t;--e}return null}_IsClientPosOnCanvas(e,t){return 0<=e&&0<=t&&e<this._runtime.GetCanvasCssWidth()&&t<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",properties:[...this._touches.values()].map(e=>({name:"$"+e.GetId(),value:e.GetX()+", "+e.GetY()}))}]}}}{let C33=self.C3,tempArr=[];C33.Plugins.Touch.Cnds={OnTouchStart(){return!0},OnTouchEnd(){return!0},IsInTouch(){return 0<this._touches.size},OnTouchObject(e,t){return!!e&&t===this._triggerType&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},IsTouchingObject(e){var t,r;return!!e&&(t=this._runtime.GetCurrentCondition().IsInverted(),r=[...this._touches.values()].filter(e=>this._IsClientPosOnCanvas(e.GetX(),e.GetY())).map(e=>[e.GetX(),e.GetY()]),C33.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,r,t),t))},CompareTouchSpeed(e,t,r){e=this._GetTouchByIndex(e);return!!e&&C33.compare(e.GetSpeed(),t,r)},OrientationSupported(){return!0},MotionSupported(){return!0},CompareOrientation(e,t,r){this._runtime.RequestDeviceOrientationEvent();let i=0;return i=0===e?this._orientAlpha:1===e?this._orientBeta:this._orientGamma,C33.compare(i,t,r)},CompareAcceleration(e,t,r){this._runtime.RequestDeviceMotionEvent();let i=0;return i=0===e?this._accWithGX:1===e?this._accWithGY:2===e?this._accWithGZ:3===e?this._accX:4===e?this._accY:this._accZ,C33.compare(i,t,r)},OnNthTouchStart(e){return(e=Math.floor(e))===this._triggerIndex},OnNthTouchEnd(e){return(e=Math.floor(e))===this._triggerIndex},HasNthTouch(e){return e=Math.floor(e),this._touches.size>=e+1},OnHoldGesture(){return!0},OnTapGesture(){return!0},OnDoubleTapGesture(){return!0},OnHoldGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnTapGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnDoubleTapGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnPermissionGranted(e){return this._triggerPermission===e},OnPermissionDenied(e){return this._triggerPermission===e}}}{let C33=self.C3;C33.Plugins.Touch.Acts={RequestPermission(e){this._RequestPermission(e)}}}{let C33=self.C3;C33.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(e){var t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!0):0},Y(e){var t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!1):0},XAt(e,t){e=this._GetTouchByIndex(e);return e?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YAt(e,t){e=this._GetTouchByIndex(e);return e?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},XForID(e,t){e=this._touches.get(e);return e?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YForID(e,t){e=this._touches.get(e);return e?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},AbsoluteX(){var e=this._GetTouchByIndex(0);return e?e.GetX():0},AbsoluteY(){var e=this._GetTouchByIndex(0);return e?e.GetY():0},AbsoluteXAt(e){e=this._GetTouchByIndex(e);return e?e.GetX():0},AbsoluteYAt(e){e=this._GetTouchByIndex(e);return e?e.GetY():0},AbsoluteXForID(e){e=this._touches.get(e);return e?e.GetX():0},AbsoluteYForID(e){e=this._touches.get(e);return e?e.GetY():0},SpeedAt(e){e=this._GetTouchByIndex(e);return e?e.GetSpeed():0},SpeedForID(e){e=this._touches.get(e);return e?e.GetSpeed():0},AngleAt(e){e=this._GetTouchByIndex(e);return e?C33.toDegrees(e.GetAngle()):0},AngleForID(e){e=this._touches.get(e);return e?C33.toDegrees(e.GetAngle()):0},CompassHeading(){return this._runtime.RequestDeviceOrientationEvent(),this._orientCompassHeading},Alpha(){return this._runtime.RequestDeviceOrientationEvent(),this._orientAlpha},Beta(){return this._runtime.RequestDeviceOrientationEvent(),this._orientBeta},Gamma(){return this._runtime.RequestDeviceOrientationEvent(),this._orientGamma},AccelerationXWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGX},AccelerationYWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGY},AccelerationZWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGZ},AccelerationX(){return this._runtime.RequestDeviceMotionEvent(),this._accX},AccelerationY(){return this._runtime.RequestDeviceMotionEvent(),this._accY},AccelerationZ(){return this._runtime.RequestDeviceMotionEvent(),this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(e){e=this._touches.get(e);return e?e.GetWidth():0},HeightForID(e){e=this._touches.get(e);return e?e.GetHeight():0},PressureForID(e){e=this._touches.get(e);return e?e.GetPressure():0}}}{let C33=self.C3,GESTURE_HOLD_THRESHOLD=15,GESTURE_HOLD_TIMEOUT=500,GESTURE_TAP_TIMEOUT=333,GESTURE_DOUBLETAP_THRESHOLD=25,lastTapX=-1e3,lastTapY=-1e3,lastTapTime=-1e4;C33.Plugins.Touch.TouchInfo=class TouchInfo extends C33.DefendedBase{constructor(){super(),this._pointerId=0,this._startIndex=0,this._startTime=0,this._time=0,this._lastTime=0,this._startX=0,this._startY=0,this._x=0,this._y=0,this._lastX=0,this._lastY=0,this._width=0,this._height=0,this._pressure=0,this._hasTriggeredHold=!1,this._isTooFarForHold=!1}Release(){}Init(e,t,r,i,s){this._pointerId=i,this._startIndex=s,this._time=e,this._lastTime=e,this._startTime=e,this._startX=t,this._startY=r,this._x=t,this._y=r,this._lastX=t,this._lastY=r}Update(e,t,r,i,s,a){this._lastTime=this._time,this._time=e,this._lastX=this._x,this._lastY=this._y,this._x=t,this._y=r,this._width=i,this._height=s,this._pressure=a,!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)>=GESTURE_HOLD_THRESHOLD&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(e){this._lastTime=e}GetX(){return this._x}GetY(){return this._y}GetSpeed(){var e=C33.distanceTo(this._x,this._y,this._lastX,this._lastY),t=(this._time-this._lastTime)/1e3;return 0<t?e/t:0}GetAngle(){return C33.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(e){return!this._hasTriggeredHold&&e-this._startTime>=GESTURE_HOLD_TIMEOUT&&!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD&&(this._hasTriggeredHold=!0)}ShouldTriggerTap(e){return!this._hasTriggeredHold&&e-this._startTime<=GESTURE_TAP_TIMEOUT&&!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD?e-lastTapTime<=2*GESTURE_TAP_TIMEOUT&&C33.distanceTo(lastTapX,lastTapY,this._x,this._y)<GESTURE_DOUBLETAP_THRESHOLD?(lastTapX=-1e3,lastTapY=-1e3,lastTapTime=-1e4,"double-tap"):(lastTapX=this._x,lastTapY=this._y,lastTapTime=e,"single-tap"):""}GetPositionForLayer(e,t,r){return void 0===t?e.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(this._x,this._y)[r?0:1]:(e=e.GetLayer(t))?e.CanvasCssToLayer(this._x,this._y)[r?0:1]:0}}}{let C33=self.C3;C33.Plugins.LocalStorage=class LocalStoragePlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.LocalStorage.Type=class LocalStorageType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,DOM_COMPONENT_ID="localstorage";C33.Plugins.LocalStorage.Instance=class LocalStorageInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._currentKey="",this._lastValue="",this._keyNamesList=[],this._errorMessage="",this._isPersistent=!1,this._pendingGets=0,this._pendingSets=0,this._storage=this._runtime._GetProjectStorage(),this._debugCache=new Map,this._isLoadingDebugCache=!1,this._runtime.AddLoadPromise(this._Init())}async _Init(){var e=await Promise.race([this.PostToDOMAsync("init"),C33.Wait(3e3)]);e&&(this._isPersistent=e.isPersistent)}Release(){super.Release()}async _TriggerStorageError(e){this._errorMessage=this._GetErrorString(e),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnError)}_GetErrorString(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.name?e.name:"string"==typeof e.data?e.data:"unknown error":"unknown error"}GetDebuggerProperties(){return this._isLoadingDebugCache||this._DebugCacheStorage(),[{title:"plugins.localstorage.name",properties:[...this._debugCache.entries()].map(t=>({name:"$"+t[0],value:t[1],onedit:e=>this._storage.setItem(t[0],e)}))}]}async _DebugCacheStorage(){this._isLoadingDebugCache=!0;try{var r=await this._storage.keys(),i=(r.sort((e,t)=>{e=e.toLowerCase(),t=t.toLowerCase();return e<t?-1:t<e?1:0}),await Promise.all(r.map(e=>this._storage.getItem(e))));this._debugCache.clear();for(let e=0,t=r.length;e<t;++e)this._debugCache.set(r[e],i[e])}catch(e){console.warn("[C3 debugger] Error displaying local storage: ",e)}finally{this._isLoadingDebugCache=!1}}}}{let C33=self.C3;C33.Plugins.LocalStorage.Cnds={OnItemSet(e){return this._currentKey===e},OnAnyItemSet(){return!0},OnItemGet(e){return this._currentKey===e},OnAnyItemGet(){return!0},OnItemRemoved(e){return this._currentKey===e},OnAnyItemRemoved(){return!0},OnCleared(){return!0},OnAllKeyNamesLoaded(){return!0},OnError(){return!0},OnItemExists(e){return this._currentKey===e},OnItemMissing(e){return this._currentKey===e},CompareKey(e,t){return C33.compare(this._currentKey,e,t)},CompareValue(e,t){return C33.compare(this._lastValue,e,t)},IsProcessingSets(){return 0<this._pendingSets},IsProcessingGets(){return 0<this._pendingGets},OnAllSetsComplete(){return!0},OnAllGetsComplete(){return!0},IsPersistent(){return this._isPersistent}}}{let IsExpressionType2=function(e){return"string"==typeof e||"number"==typeof e},C33=(IsExpressionType=IsExpressionType2,self.C3);C33.Plugins.LocalStorage.Acts={async SetItem(t,r){this._pendingSets++;try{let e=await this._storage.setItem(t,r);await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue=e,await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}},async SetBinaryItem(e,t){if(t){t=t.GetFirstPicked(this._inst);if(t){t=t.GetSdkInstance();if(t){t=t.GetArrayBufferReadOnly();this._pendingSets++;try{await this._storage.setItem(e,t),await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}}}}},async GetItem(t){this._pendingGets++;try{let e=await this._storage.getItem(t);await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue=IsExpressionType2(e)?e:"",await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}},async GetBinaryItem(r,e){if(e){e=e.GetFirstPicked(this._inst);if(e){let t=e.GetSdkInstance();this._pendingGets++;try{let e=await this._storage.getItem(r);e=e instanceof ArrayBuffer?e:new ArrayBuffer(0),await this.ScheduleTriggers(async()=>{this._lastValue="",this._currentKey=r,t.SetArrayBufferTransfer(e),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}}}},async CheckItemExists(t){try{let e=await this._storage.getItem(t);await this.ScheduleTriggers(async()=>{this._currentKey=t,null==e?(this._lastValue="",await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemMissing)):(this._lastValue=IsExpressionType2(e)?e:"",await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemExists))})}catch(e){await this._TriggerStorageError(e)}},async RemoveItem(e){try{await this._storage.removeItem(e),await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAnyItemRemoved),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnItemRemoved)})}catch(e){await this._TriggerStorageError(e)}},async ClearStorage(){try{await this._storage.clear(),await this.ScheduleTriggers(async()=>{this._currentKey="",this._lastValue="",C33.clearArray(this._keyNamesList),await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnCleared)})}catch(e){await this._TriggerStorageError(e)}},async GetAllKeyNames(){try{let e=await this._storage.keys();await this.ScheduleTriggers(async()=>{this._keyNamesList=e,await this.TriggerAsync(C33.Plugins.LocalStorage.Cnds.OnAllKeyNamesLoaded)})}catch(e){await this._TriggerStorageError(e)}},async RequestPersistent(){var e=await this.PostToDOMAsync("request-persistent");e.isOk&&(this._isPersistent=e.isPersistent)}}}{let C33=self.C3;C33.Plugins.LocalStorage.Exps={ItemValue(){return this._lastValue},Key(){return this._currentKey},KeyCount(){return this._keyNamesList.length},KeyAt(e){return(e=Math.floor(e))<0||e>=this._keyNamesList.length?"":this._keyNamesList[e]},ErrorMessage(){return this._errorMessage}}}{let C33=self.C3;C33.Plugins.Dictionary=class DictionaryPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Dictionary.Type=class DictionaryType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,C3X=self.C3X,IInstance=self.IInstance,map=(C33.Plugins.Dictionary.Instance=class DictionaryInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._data=new Map,this._curKey=""}Release(){this._data.clear(),super.Release()}GetAsJsonString(){return JSON.stringify({c2dictionary:!0,data:C33.MapToObject(this._data)})}GetDataMap(){return this._data}SaveToJson(){return C33.MapToObject(this._data)}LoadFromJson(e){C33.ObjectToMap(e,this._data)}GetDebuggerProperties(){var e="plugins.dictionary";return[{title:e+".name",properties:[{name:e+".debugger.key-count",value:this._data.size},...[...this._data].map(t=>({name:"$"+t[0],value:t[1],onedit:e=>this._data.set(t[0],e)}))]}]}GetScriptInterfaceClass(){return self.IDictionaryInstance}},new WeakMap);self.IDictionaryInstance=class IDictionaryInstance extends IInstance{constructor(){super(),map.set(this,IInstance._GetInitInst().GetSdkInstance())}getDataMap(){return map.get(this).GetDataMap()}}}{let C33=self.C3;C33.Plugins.Dictionary.Cnds={CompareValue(e,t,r){e=this._data.get(e);return void 0!==e&&C33.compare(e,t,r)},ForEachKey(){var e,t=this._runtime,r=t.GetEventSheetManager(),i=t.GetCurrentEvent(),s=i.GetSolModifiers(),a=t.GetEventStack(),n=a.GetCurrentStackFrame(),o=a.Push(i);t.SetDebuggingEnabled(!1);for(e of this._data.keys())this._curKey=e,r.PushCopySol(s),this.GetObjectClass().GetCurrentSol().PickOne(this.GetInstance()),i.Retrigger(n,o),r.PopSol(s);return t.SetDebuggingEnabled(!0),this._curKey="",a.Pop(),!1},CompareCurrentValue(e,t){var r=this._data.get(this._curKey);return void 0!==r&&C33.compare(r,e,t)},HasKey(e){return this._data.has(e)},IsEmpty(){return 0===this._data.size}}}{let C33=self.C3;C33.Plugins.Dictionary.Acts={AddKey(e,t){this._data.set(e,t)},SetKey(e,t){this._data.has(e)&&this._data.set(e,t)},DeleteKey(e){this._data.delete(e)},Clear(){this._data.clear()},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct] Error parsing JSON: ",e)}t.c2dictionary&&C33.ObjectToMap(t.data,this._data)},JSONDownload(e){var t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}{let C33=self.C3;C33.Plugins.Dictionary.Exps={Get(e){e=this._data.get(e);return void 0===e?0:e},GetDefault(e,t){e=this._data.get(e);return void 0===e?t:e},KeyCount(){return this._data.size},CurrentKey(){return this._curKey},CurrentValue(){return this._data.get(this._curKey)??0},AsJSON(){return this.GetAsJsonString()}}}{let C33=self.C3,actionPromises=[];C33.Plugins.Audio=class AudioPlugin extends C33.SDKPluginBase{constructor(e){super(e)}_AddActionPromise(e){actionPromises.push(e)}static async WaitForAllActionPromises(){await Promise.all(actionPromises),C33.clearArray(actionPromises)}Release(){super.Release()}}}{let GetAudioSdkInstance2=function(){return audioObjectType.GetSingleGlobalInstance().GetSdkInstance()},GetAudioDOMInterface2=function(){if(self.C3Audio_DOMInterface)return self.C3Audio_DOMInterface;throw new Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode")},C33=(GetAudioSdkInstance=GetAudioSdkInstance2,GetAudioDOMInterface=GetAudioDOMInterface2,self.C3),C3X=self.C3X,audioObjectType=(C33.Plugins.Audio.Type=class AudioType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IAudioObjectType}},null);self.IAudioObjectType=class IAudioObjectType extends self.IObjectClass{constructor(e){super(e),audioObjectType=e}get audioContext(){return GetAudioDOMInterface2().GetAudioContextExtern()}get destinationNode(){return GetAudioDOMInterface2().GetDestinationNodeExtern()}get isSilent(){return GetAudioSdkInstance2()._IsSilent()}set isSilent(e){GetAudioSdkInstance2()._SetSilent(e)}get masterVolume(){return GetAudioSdkInstance2()._GetMasterVolume()}set masterVolume(e){C3X.RequireFiniteNumber(e),GetAudioSdkInstance2()._SetMasterVolume(e)}stopAll(){GetAudioSdkInstance2()._StopAll()}}}{let C33=self.C3,DOM_COMPONENT_ID="audio",LATENCY_HINTS=["interactive","balanced","playback"];C33.Plugins.Audio.Instance=class AudioInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._nextPlayTime=0,this._triggerTags=[],this._enableMultiTags=!0,this._timeScaleMode=0,this._saveLoadMode=0,this._playInBackground=!1,this._panningModel=1,this._distanceModel=1,this._listenerPos=[this._runtime.GetViewportWidth()/2,this._runtime.GetViewportHeight()/2,600],this._listenerForwardVec=[0,0,-1],this._listenerUpVec=[0,1,0],this._referenceDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._listenerInst=null,this._loadListenerUid=-1,this._masterVolume=1,this._isSilent=!1,this._sampleRate=0,this._audioContextState="suspended",this._outputLatency=0,this._effectCount=new Map,this._preloadTotal=0,this._preloadCount=0,this._bufferMetadata=new Map,this._remoteUrls=new Map;let r="interactive";t&&(this._timeScaleMode=t[0],this._saveLoadMode=t[1],this._playInBackground=t[2],r=LATENCY_HINTS[t[3]],this._enableMultiTags=t[4],this._panningModel=t[5],this._distanceModel=t[6],this._listenerPos[2]=t[7],this._referenceDistance=t[8],this._maxDistance=t[9],this._rolloffFactor=t[10]),this._lastAIState=[],this._lastFxState=[],this._lastAnalysersData=[],this.AddDOMMessageHandlers([["state",e=>this._OnUpdateState(e)],["audiocontext-state",e=>this._OnAudioContextStateChanged(e)],["fxstate",e=>this._OnUpdateFxState(e)],["trigger",e=>this._OnTrigger(e)],["buffer-metadata",e=>this._OnBufferMetadata(e)]]);var e=this.GetRuntime().Dispatcher(),t=(this._disposables=new C33.CompositeDisposable(C33.Disposable.From(e,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),C33.Disposable.From(e,"afterload",()=>this._OnAfterLoad()),C33.Disposable.From(e,"suspend",()=>this._OnSuspend()),C33.Disposable.From(e,"resume",()=>this._OnResume())),"Safari"===C33.Platform.Browser),e=this._runtime.IsiOSWebView(),i=this._runtime.GetAssetManager().IsFileProtocol(),s="playable-ad-single-file"===this._runtime.GetExportType(),t=t||e||i||s;this._runtime.AddLoadPromise(this.PostToDOMAsync("create-audio-context",{preloadList:this._runtime.GetAssetManager().GetAudioToPreload().map(e=>({originalUrl:e.originalUrl,url:e.url,type:e.type,fileSize:e.fileSize})),timeScaleMode:this._timeScaleMode,latencyHint:r,panningModel:this._panningModel,distanceModel:this._distanceModel,refDistance:this._referenceDistance,maxDistance:this._maxDistance,rolloffFactor:this._rolloffFactor,listenerPos:this._listenerPos,usePlayMusicAsSoundWorkaround:t}).then(e=>{this._sampleRate=e.sampleRate,this._audioContextState=e.audioContextState,this._outputLatency=e.outputLatency})),this._StartTicking()}Release(){this._listenerInst=null,super.Release()}_SplitTags(e){return this._enableMultiTags?e.split(" ").filter(e=>!!e):e?[e]:[]}_MatchTagLists(t,e){for(var r of e){let e=!1;for(var i of t)if(C33.equalsNoCase(i,r)){e=!0;break}if(!e)return!1}return!0}_MatchTagListToStr(e,t){return this._MatchTagLists(e,this._SplitTags(t))}_AddActionPromise(e){this.GetPlugin()._AddActionPromise(e)}_OnInstanceDestroyed(e){this._listenerInst===e&&(this._listenerInst=null)}DbToLinearNoCap(e){return Math.pow(10,e/20)}DbToLinear(e){e=this.DbToLinearNoCap(e);return isFinite(e)?Math.max(Math.min(e,1),0):0}LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}LinearToDb(e){return this.LinearToDbNoCap(Math.max(Math.min(e,1),0))}_OnSuspend(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!0})}_OnResume(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!1})}_OnUpdateState(e){let t=e.tickCount;this._outputLatency=e.outputLatency;var r=this._lastAIState.filter(e=>e.hasOwnProperty("placeholder")&&(e.placeholder>t||-1===e.placeholder));this._lastAIState=e.audioInstances,this._lastAnalysersData=e.analysers,0<r.length&&C33.appendArray(this._lastAIState,r)}_OnBufferMetadata(e){this._bufferMetadata.set(e.originalUrl,{duration:e.duration})}_OnAudioContextStateChanged(e){this._audioContextState=e.audioContextState}GetAudioContextState(){return this._runtime.IsExportToVideo()?"running":this._audioContextState}_OnUpdateFxState(e){this._lastFxState=e.fxstate}_GetFirstAudioStateByTags(e){var t,r=this._SplitTags(e);for(t of this._lastAIState)if(this._MatchTagLists(t.tags,r))return t;return null}_IsTagPlaying(e){let t=this._SplitTags(e);return this._lastAIState.some(e=>this._MatchTagLists(e.tags,t)&&e.isPlaying)}_MaybeMarkAsPlaying(e,t,r,i,s){var a;return this._IsTagPlaying(t)?null:(a=this._bufferMetadata.get(e),t={tags:this._SplitTags(t),duration:a?a.duration:0,volume:s,isPlaying:!0,playbackTime:0,playbackRate:1,uid:-1,bufferOriginalUrl:e,bufferUrl:"",bufferType:"",isMusic:r,isLooping:i,isMuted:!1,resumePosition:0,pan:null,placeholder:-1},this._lastAIState.push(t),t)}_MaybeMarkAsStopped(e){var t,r=this._SplitTags(e);for(t of this._lastAIState)this._MatchTagLists(t.tags,r)&&(t.isPlaying=!1)}async _OnTrigger(e){var t=e.type,r=(this._triggerTags=e.tags,e.aiid);if("ended"===t){for(var i of this._lastAIState)if(i.aiid===r){i.isPlaying=!1;break}await this.TriggerAsync(C33.Plugins.Audio.Cnds.OnEnded)}else"fade-ended"===t&&await this.TriggerAsync(C33.Plugins.Audio.Cnds.OnFadeEnded)}_MatchTriggerTag(e){return this._MatchTagListToStr(this._triggerTags,e)}Tick(){var e,t={timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),instPans:this.GetInstancePans(),tickCount:this._runtime.GetTickCountNoSave()};this._listenerInst&&(e=this._listenerInst.GetWorldInfo(),this._listenerPos[0]=e.GetX(),this._listenerPos[1]=e.GetY(),t.listenerPos=this._listenerPos,t.listenerOrientation=[...this._listenerForwardVec,...this._listenerUpVec]),this.PostToDOM("tick",t)}rotatePtAround(e,t,r,i,s){var a,n;return 0!==r&&(n=(e-=i)*(a=Math.sin(r)),e=e*(r=Math.cos(r))-(t-=s)*a,t=t*r+n,e+=i,t+=s),[e,t]}GetInstancePans(){return this._lastAIState.filter(e=>-1!==e.uid).map(e=>this._runtime.GetInstanceByUID(e.uid)).filter(e=>e).map(e=>{var t=e.GetWorldInfo(),r=t.GetLayer().GetAngle(),[i,s]=this.rotatePtAround(t.GetX(),t.GetY(),-r,this._listenerPos[0],this._listenerPos[1]);return{uid:e.GetUID(),x:i,y:s,z:t.GetTotalZElevation(),angle:t.GetAngle()-r}})}GetAnalyserData(e,t){for(var r of this._lastAnalysersData)if(r.index===t&&C33.equalsNoCase(r.tag,e))return r;return null}_IncrementEffectCount(e){for(var t of this._SplitTags(e)){t=t.toLowerCase();this._effectCount.set(t,(this._effectCount.get(t)||0)+1)}}_IsSilent(){return this._isSilent}_SetSilent(e){this._isSilent!==(e=!!e)&&(this._isSilent=e,this.PostToDOM("set-silent",{isSilent:e}))}_GetMasterVolume(){return this._masterVolume}_SetMasterVolume(e){this._masterVolume!==e&&(this._masterVolume=e,this.PostToDOM("set-master-volume",{vol:e}))}_StopAll(){this.PostToDOM("stop-all");for(var e of this._lastAIState)e.isPlaying=!1}_ShouldSave(e){return!e.hasOwnProperty("placeholder")&&3!==this._saveLoadMode&&!(e.isMusic&&1===this._saveLoadMode||!e.isMusic&&2===this._saveLoadMode)}SaveToJson(){return{isSilent:this._isSilent,masterVolume:this._masterVolume,listenerZ:this._listenerPos[2],listenerForwardVec:this._listenerForwardVec,listenerUpVec:this._listenerUpVec,listenerUid:this._listenerInst?this._listenerInst.GetUID():-1,remoteUrls:[...this._remoteUrls.entries()],playing:this._lastAIState.filter(e=>this._ShouldSave(e)),effects:this._lastFxState,analysers:this._lastAnalysersData}}LoadFromJson(e){if(this._isSilent=e.isSilent,this._masterVolume=e.masterVolume,this._listenerPos[2]=e.listenerZ,this._listenerInst=null,this._loadListenerUid=e.listenerUid,e.hasOwnProperty("listenerForwardVec")?this._listenerForwardVec=e.listenerForwardVec:this._listenerForwardVec=[0,0,-1],e.hasOwnProperty("listenerUpVec")?this._listenerUpVec=e.listenerUpVec:this._listenerUpVec=[0,1,0],this._remoteUrls.clear(),e.remoteUrls)for(var[t,r]of e.remoteUrls)this._remoteUrls.set(t,r);this._lastAIState=e.playing;for(var i of this._lastAIState)i.hasOwnProperty("tag")&&!i.hasOwnProperty("tags")&&(i.tags=[i.tag].filter(e=>!!e));this._lastFxState=e.effects,this._lastAnalysersData=e.analysers}_OnAfterLoad(){var e,t,r,i;-1!==this._loadListenerUid&&(this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid),this._loadListenerUid=-1,this._listenerInst)&&(e=this._listenerInst.GetWorldInfo(),this._listenerPos[0]=e.GetX(),this._listenerPos[1]=e.GetY());for(t of this._lastAIState){var s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t.bufferOriginalUrl);s?(t.bufferUrl=s.url,t.bufferType=s.type):t.bufferUrl=null}for(r of Object.values(this._lastFxState))for(var a of r)a.hasOwnProperty("bufferOriginalUrl")&&(i=this._runtime.GetAssetManager().GetProjectAudioFileUrl(a.bufferOriginalUrl))&&(a.bufferUrl=i.url,a.bufferType=i.type);this.PostToDOM("load-state",{saveLoadMode:this._saveLoadMode,timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),listenerPos:this._listenerPos,listenerOrientation:[...this._listenerForwardVec,...this._listenerUpVec],isSilent:this._isSilent,masterVolume:this._masterVolume,playing:this._lastAIState.filter(e=>null!==e.bufferUrl),effects:this._lastFxState})}GetDebuggerProperties(){var e,t,r=[];for([e,t]of Object.entries(this._lastFxState))r.push({name:"$"+e,value:t.map(e=>e.type).join(", ")});var i="plugins.audio.debugger";return[{title:i+".tag-effects",properties:r},{title:i+".currently-playing",properties:[{name:i+".currently-playing-count",value:this._lastAIState.length},...this._lastAIState.map((e,t)=>({name:"$#"+t,value:`${e.bufferOriginalUrl} ("${e.tags}") ${Math.round(10*e.playbackTime)/10} / `+Math.round(10*e.duration)/10}))]}]}}}{let C33=self.C3;C33.Plugins.Audio.Cnds={OnEnded(e){return this._MatchTriggerTag(e)},OnFadeEnded(e){return this._MatchTriggerTag(e)},PreloadsComplete(){return this._preloadCount===this._preloadTotal},AdvancedAudioSupported(){return!0},IsSilent(){return this._IsSilent()},IsAnyPlaying(){for(var e of this._lastAIState)if(e.isPlaying)return!0;return!1},IsTagPlaying(e){return this._IsTagPlaying(e)}}}{let C33=self.C3,FILTER_TYPES=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];C33.Plugins.Audio.Acts={Play(e,t,r,i,s){e=C33.Plugins.Audio.Acts._DoPlay.call(this,e,t,r,i,s);return this._AddActionPromise(e),e},PlayFromTimeline(e,t,r,i){C33.Plugins.Audio.Acts._DoPlay.call(this,e,0,t,0,r,i)},async _DoPlay(e,t,r,i,s,a){if(!this._isSilent){var n=e[1],o=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(o){var l=this._nextPlayTime,h=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],s,n,0!==t,this.DbToLinear(r)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:o.url,type:o.type,isMusic:n,tags:this._SplitTags(s),isLooping:0!==t,vol:this.DbToLinear(r),stereoPan:C33.clamp(i/100,-1,1),pos:a||0,off:l,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{h&&(h.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPosition(e,t,r,i,s,a,n,o,l,h,u){if(!this._isSilent){var c=e[1],_=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(_){var d=this._nextPlayTime,p=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],u,c,0!==t,this.DbToLinear(r)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:_.url,type:_.type,isMusic:c,tags:this._SplitTags(u),isLooping:0!==t,vol:this.DbToLinear(r),pos:0,off:d,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:i,y:s,z:a,angle:C33.toRadians(n),innerAngle:C33.toRadians(o),outerAngle:C33.toRadians(l),outerGain:this.DbToLinear(h)}})}finally{p&&(p.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObject(e,t,r,i,s,a,n,o){if(!this._isSilent&&i){i=i.GetFirstPicked();if(i&&i.GetWorldInfo()){var l=i.GetWorldInfo(),h=l.GetLayer().GetAngle(),[u,c]=this.rotatePtAround(l.GetX(),l.GetY(),-h,this._listenerPos[0],this._listenerPos[1]),_=e[1],d=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(d){var p=this._nextPlayTime,m=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],o,_,0!==t,this.DbToLinear(r)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:d.url,type:d.type,isMusic:_,tags:this._SplitTags(o),isLooping:0!==t,vol:this.DbToLinear(r),pos:0,off:p,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:u,y:c,z:l.GetTotalZElevation(),angle:l.GetAngle()-h,innerAngle:C33.toRadians(s),outerAngle:C33.toRadians(a),outerGain:this.DbToLinear(n),uid:i.GetUID()}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}}},async PlayByName(e,t,r,i,s,a){if(!this._isSilent){var e=1===e,n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(n){var o=this._nextPlayTime,l=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,a,e,0!==r,this.DbToLinear(i)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:n.url,type:n.type,isMusic:e,tags:this._SplitTags(a),isLooping:0!==r,vol:this.DbToLinear(i),stereoPan:C33.clamp(s/100,-1,1),pos:0,off:o,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{l&&(l.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPositionByName(e,t,r,i,s,a,n,o,l,h,u,c){if(!this._isSilent){var e=1===e,_=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(_){var d=this._nextPlayTime,p=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,c,e,0!==r,this.DbToLinear(i)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:_.url,type:_.type,isMusic:e,tags:this._SplitTags(c),isLooping:0!==r,vol:this.DbToLinear(i),pos:0,off:d,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:s,y:a,z:n,angle:C33.toRadians(o),innerAngle:C33.toRadians(l),outerAngle:C33.toRadians(h),outerGain:this.DbToLinear(u)}})}finally{p&&(p.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObjectByName(e,t,r,i,s,a,n,o,l){if(!this._isSilent&&!this._isSilent&&s){s=s.GetFirstPicked();if(s&&s.GetWorldInfo()){var h=s.GetWorldInfo(),u=h.GetLayer().GetAngle(),[c,_]=this.rotatePtAround(h.GetX(),h.GetY(),-u,this._listenerPos[0],this._listenerPos[1]),e=1===e,d=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(d){var p=this._nextPlayTime,m=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,l,e,0!==r,this.DbToLinear(i)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:d.url,type:d.type,isMusic:e,tags:this._SplitTags(l),isLooping:0!==r,vol:this.DbToLinear(i),pos:0,off:p,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:c,y:_,z:h.GetTotalZElevation(),angle:h.GetAngle()-u,innerAngle:C33.toRadians(a),outerAngle:C33.toRadians(n),outerGain:this.DbToLinear(o),uid:s.GetUID()}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}}},SetLooping(e,t){this.PostToDOM("set-looping",{tags:this._SplitTags(e),isLooping:0===t})},SetMuted(e,t){this.PostToDOM("set-muted",{tags:this._SplitTags(e),isMuted:0===t})},SetVolume(e,t){this.PostToDOM("set-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t)})},FadeVolume(e,t,r,i){this.PostToDOM("fade-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t),duration:r,stopOnEnd:0===i})},SetStereoPan(e,t){this.PostToDOM("set-stereo-pan",{tags:this._SplitTags(e),p:C33.clamp(t/100,-1,1)})},async Preload(e){var t=e[1],r=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);r&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:e[0],url:r.url,type:r.type,isMusic:t}),this._preloadCount++)},async PreloadByName(e,t){var e=1===e,r=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());r&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:t,url:r.url,type:r.type,isMusic:e}),this._preloadCount++)},SetPlaybackRate(e,t){this.PostToDOM("set-playback-rate",{tags:this._SplitTags(e),rate:Math.max(t,0)})},Stop(e){this._MaybeMarkAsStopped(e),this.PostToDOM("stop",{tags:this._SplitTags(e)})},StopAll(){this._StopAll()},SetPaused(e,t){this.PostToDOM("set-paused",{tags:this._SplitTags(e),paused:0===t})},Seek(e,t){this.PostToDOM("seek",{tags:this._SplitTags(e),pos:t})},SetSilent(e){2===e&&(e=this._IsSilent()?1:0),this._SetSilent(0===e)},SetMasterVolume(e){e=this.DbToLinear(e);this._SetMasterVolume(e)},AddFilterEffect(e,t,r,i,s,a,n){t=FILTER_TYPES[t];this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"filter",tags:this._SplitTags(e),params:[t,r,i,s,a,C33.clamp(n/100,0,1)]})},AddDelayEffect(e,t,r,i){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"delay",tags:this._SplitTags(e),params:[t,this.DbToLinear(r),C33.clamp(i/100,0,1)]})},AddFlangerEffect(e,t,r,i,s,a){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"flanger",tags:this._SplitTags(e),params:[t/1e3,r/1e3,i,s/100,C33.clamp(a/100,0,1)]})},AddPhaserEffect(e,t,r,i,s,a,n){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"phaser",tags:this._SplitTags(e),params:[t,r,i,s,a,C33.clamp(n/100,0,1)]})},AddConvolutionEffect(e,t,r,i){var s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);s&&(this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"convolution",tags:this._SplitTags(e),bufferOriginalUrl:t[0],bufferUrl:s.url,bufferType:s.type,params:[0===r,C33.clamp(i/100,0,1)]}))},AddGainEffect(e,t){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[this.DbToLinear(t)]})},AddStereoPanEffect(e,t){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"stereopan",tags:this._SplitTags(e),params:[C33.clamp(t/100,-1,1)]})},AddMuteEffect(e){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[0]})},AddTremoloEffect(e,t,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"tremolo",tags:this._SplitTags(e),params:[t,C33.clamp(r/100,0,1)]})},AddRingModEffect(e,t,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"ringmod",tags:this._SplitTags(e),params:[t,C33.clamp(r/100,0,1)]})},AddDistortionEffect(e,t,r,i,s,a){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"distortion",tags:this._SplitTags(e),params:[this.DbToLinearNoCap(t),this.DbToLinearNoCap(r),i,this.DbToLinearNoCap(s),C33.clamp(a/100,0,1)]})},AddCompressorEffect(e,t,r,i,s,a){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"compressor",tags:this._SplitTags(e),params:[t,r,i,s/1e3,a/1e3]})},AddAnalyserEffect(e,t,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"analyser",tags:this._SplitTags(e),params:[t,r]})},RemoveEffects(e){var t,e=this._SplitTags(e);for(t of e)this._effectCount.set(t.toLowerCase(),0);this.PostToDOM("remove-effects",{tags:e}),this._lastFxState={}},SetEffectParameter(e,t,r,i,s,a){this.PostToDOM("set-effect-param",{tags:this._SplitTags(e),index:Math.floor(t),param:r,value:i,ramp:s,time:a})},SetListenerObject(e){e&&(e=e.GetFirstPicked())&&e.GetWorldInfo()&&(this._listenerInst=e)},SetListenerZ(e){this._listenerPos[2]=e},SetListenerOrientation(e,t,r,i,s,a){this._listenerForwardVec[0]=e,this._listenerForwardVec[1]=t,this._listenerForwardVec[2]=-r,this._listenerUpVec[0]=i,this._listenerUpVec[1]=s,this._listenerUpVec[2]=-a},ScheduleNextPlay(e){this._nextPlayTime=Math.max(e,0)},UnloadAudio(e){var t=e[1],e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);e&&this.PostToDOM("unload",{url:e.url,type:e.type,isMusic:t})},UnloadAudioByName(e,t){e=1===e,t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());t&&this.PostToDOM("unload",{url:t.url,type:t.type,isMusic:e})},UnloadAll(){this.PostToDOM("unload-all")},AddRemoteURL(e,t,r){this._remoteUrls.set(r.toLowerCase(),{url:e,type:t})}}}{let C33=self.C3;C33.Plugins.Audio.Exps={Duration(e){e=this._GetFirstAudioStateByTags(e);return e?e.duration:0},PlaybackTime(e){e=this._GetFirstAudioStateByTags(e);return e?e.playbackTime:0},PlaybackRate(e){e=this._GetFirstAudioStateByTags(e);return e?e.playbackRate:0},Volume(e){e=this._GetFirstAudioStateByTags(e);return e?this.LinearToDb(e.volume):0},MasterVolume(){return this.LinearToDb(this._GetMasterVolume())},EffectCount(e){return this._effectCount.get(e.toLowerCase())||0},AnalyserFreqBinCount(e,t){e=this.GetAnalyserData(e,Math.floor(t));return e?e.binCount:0},AnalyserFreqBinAt(e,t,r){e=this.GetAnalyserData(e,Math.floor(t));return!e||(r=Math.floor(r))<0||r>=e.binCount?0:e.freqBins[r]},AnalyserPeakLevel(e,t){e=this.GetAnalyserData(e,Math.floor(t));return e?e.peak:0},AnalyserRMSLevel(e,t){e=this.GetAnalyserData(e,Math.floor(t));return e?e.rms:0},SampleRate(){return this._sampleRate},CurrentTime(){return self.C3_GetAudioContextCurrentTime?self.C3_GetAudioContextCurrentTime():performance.now()/1e3},OutputLatency(){return this._outputLatency},NormalizedVolume(e,t){return 0===(e=C33.clamp(+e,0,100)/100)?-1/0:e<.1?this.LinearToDb(C33.lerp(0,this.DbToLinear(t),10*e)):C33.lerp(t,0,(e-.1)/.9)}}}{let C33=self.C3;C33.Plugins.AJAX=class AJAXPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.AJAX.Type=class AJAXType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3;C33.Plugins.AJAX.Instance=class AJAXInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._lastData="",this._lastStatusCode=0,this._curTag="",this._progress=0,this._timeout=-1,this._nextRequestHeaders=new Map,this._nextReponseBinaryData=null,this._nextRequestOverrideMimeType="",this._nextRequestWithCredentials=!1,this._nwjsFs=null,this._nwjsPath=null,this._nwjsAppFolder=null,this._isNWjs="nwjs"===this._runtime.GetExportType(),this._isNWjs&&(this._nwjsFs=__require("fs"),this._nwjsPath=__require("path"),e=self.process||nw.process,this._nwjsAppFolder=this._nwjsPath.dirname(e.execPath)+"\\")}Release(){super.Release()}async _TriggerError(e,t,r){console.error(`[Construct] AJAX request to '${t}' (tag '${e}') failed: `,r),this._curTag=e,await this.TriggerAsync(C33.Plugins.AJAX.Cnds.OnAnyError),this._curTag=e,await this.TriggerAsync(C33.Plugins.AJAX.Cnds.OnError)}async _TriggerComplete(e){this._curTag=e,await this.TriggerAsync(C33.Plugins.AJAX.Cnds.OnAnyComplete),this._curTag=e,await this.TriggerAsync(C33.Plugins.AJAX.Cnds.OnComplete)}async _OnProgress(e,t){t.lengthComputable&&(this._progress=t.loaded/t.total,this._curTag=e,await this.TriggerAsync(C33.Plugins.AJAX.Cnds.OnProgress))}_OnError(r,i,e){var t,s;this._isNWjs&&(t=this._nwjsFs,s=this._nwjsAppFolder+i,t.existsSync(s))?t.readFile(s,{encoding:"utf8"},(e,t)=>{e?this._TriggerError(r,i,e):(this._lastData=t.replace(/\r\n/g,"\n"),this._TriggerComplete(r))}):this._TriggerError(r,i,e)}async _DoCordovaRequest(t,r){var e,i,s=this._runtime.GetAssetManager(),a=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{a?(e=await s.CordovaFetchLocalFileAsArrayBuffer(r),a.SetArrayBufferTransfer(e),this._lastData=""):(i=await s.CordovaFetchLocalFileAsText(r),this._lastData=i.replace(/\r\n/g,"\n")),this._lastStatusCode=0,this._TriggerComplete(t)}catch(e){this._TriggerError(t,r,e)}}_DoRequest(o,l,e,h){return new Promise(r=>{var i=e=>{this._OnError(o,l,e),r()};let s=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{let t=new XMLHttpRequest;t.onreadystatechange=()=>{var e;4===t.readyState&&(s?this._lastData="":this._lastData=(t.responseText||"").replace(/\r\n/g,"\n"),this._lastStatusCode=t.status,400<=t.status?this._TriggerError(o,l,t.status+t.statusText):(e=this._lastData.length||s&&t.response instanceof ArrayBuffer,this._isNWjs&&!e||!this._isNWjs&&0===t.status&&!e||(s&&s.SetArrayBufferTransfer(t.response),this._TriggerComplete(o))),r())},t.onerror=i,t.ontimeout=i,t.onabort=i,t.onprogress=e=>this._OnProgress(o,e),t.open(e,l),0<=this._timeout&&void 0!==t.timeout&&(t.timeout=this._timeout),t.responseType=s?"arraybuffer":"text",h&&!this._nextRequestHeaders.has("Content-Type")&&("string"!=typeof h?t.setRequestHeader("Content-Type","application/octet-stream"):t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));for(var[a,n]of this._nextRequestHeaders)try{t.setRequestHeader(a,n)}catch(e){console.error(`[Construct] AJAX: Failed to set header '${a}: ${n}': `,e)}if(this._nextRequestHeaders.clear(),this._nextRequestOverrideMimeType){try{t.overrideMimeType(this._nextRequestOverrideMimeType)}catch(e){console.error("[Construct] AJAX: failed to override MIME type: ",e)}this._nextRequestOverrideMimeType=""}this._nextRequestWithCredentials&&(t.withCredentials=!0,this._nextRequestWithCredentials=!1),h?t.send(h):t.send()}catch(e){i(e)}})}GetDebuggerProperties(){var e="plugins.ajax.debugger";return[{title:e+".title",properties:[{name:e+".last-status-code",value:this._lastStatusCode},{name:e+".last-data",value:this._lastData}]}]}SaveToJson(){return{lastData:this._lastData,lastStatusCode:this._lastStatusCode}}LoadFromJson(e){this._lastData=e.lastData,this._lastStatusCode=e.hasOwnProperty("lastStatusCode")?e.lastStatusCode:0,this._curTag="",this._progress=0}}}{let C33=self.C3;C33.Plugins.AJAX.Cnds={OnComplete(e){return C33.equalsNoCase(this._curTag,e)},OnAnyComplete(){return!0},OnError(e){return C33.equalsNoCase(this._curTag,e)},OnAnyError(){return!0},OnProgress(e){return C33.equalsNoCase(this._curTag,e)}}}{let C33=self.C3;C33.Plugins.AJAX.Acts={async Request(e,t){this._runtime.IsCordova()&&C33.IsRelativeURL(t)&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(e,t):await this._DoRequest(e,t,"GET",null)},async RequestFile(e,t){this._runtime.IsCordova()&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(e,t):await this._DoRequest(e,t,"GET",null)},async Post(e,t,r,i){await this._DoRequest(e,t,i,r)},async PostBinary(e,t,r,i){r&&(r=r.GetFirstPicked(this._inst))&&(r=r.GetSdkInstance().GetArrayBufferReadOnly(),await this._DoRequest(e,t,i,r))},SetTimeout(e){this._timeout=1e3*e},SetHeader(e,t){this._nextRequestHeaders.set(e,t)},SetResponseBinary(e){e&&(e=e.GetFirstPicked(this._inst))&&(this._nextReponseBinaryData=e.GetSdkInstance())},OverrideMIMEType(e){this._nextRequestOverrideMimeType=e},SetWithCredentials(e){this._nextRequestWithCredentials=!!e}}}{let C33=self.C3;C33.Plugins.AJAX.Exps={LastData(){return this._lastData},LastStatusCode(){return this._lastStatusCode},Progress(){return this._progress},Tag(){return this._curTag}}}{let C33=self.C3;C33.Plugins.FileSystem=class FileSystemPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.FileSystem.Type=class FileSystemType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,DOM_COMPONENT_ID="filesystem";C33.Plugins.FileSystem.Instance=class FileSystemInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._isSupported=!1,this._pickerTag="",this._fileTag="",this._fileNames=[],this._folderNames=[],this._fileText="",this._acceptTypes=[],this._pickerTagSet=new Set,this._builtInPickerTags=new Set,this._pickerStorage=localforage.createInstance({name:"c3-filesystemhandles-"+this._runtime.GetProjectUniqueId(),description:this._runtime.GetProjectName()}),this.AddDOMMessageHandlers([["save-picker-map",e=>this._SavePickerMap(e)]]),this._runtime.AddLoadPromise(this._Init())}async _Init(){let t=null;try{(t=await this._pickerStorage.getItem("picker-map"))&&this._UpdatePickerTagSet(t)}catch(e){t=null,console.warn("[Construct] Unable to load picked file system handles: ",e)}var e,r,i=await this.PostToDOMAsync("init",{pickerMap:t});this._isSupported=i.isSupported;for(e of i.additionalPickerTags)this._pickerTagSet.add(e);for(r of i.builtInPickerTags)this._builtInPickerTags.add(r)}async _SavePickerMap(e){var t,r,e=e.pickerMap,i=(this._UpdatePickerTagSet(e),new Map);for([t,r]of e)this._builtInPickerTags.has(t)||i.set(t,r);try{await this._pickerStorage.setItem("picker-map",i)}catch(e){console.warn("[Construct] Unable to save picked file system handles: ",e)}}async _TriggerFileOperationResult(e,t){this._fileTag=t,e?(await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnAnyFileOperationComplete),this._fileTag=t,await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnFileOperationComplete)):(await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnAnyFileOperationError),this._fileTag=t,await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnFileOperationError)),this._fileTag=""}_UpdatePickerTagSet(e){this._pickerTagSet=new Set([...e.keys()])}_GetBinaryDataSdkInstance(e){return(e=e&&e.GetFirstPicked(this._inst))?e.GetSdkInstance():null}}}{let C33=self.C3;C33.Plugins.FileSystem.Cnds={IsSupported(){return this._isSupported},OnPickerComplete(e){return C33.equalsNoCase(this._pickerTag,e)},OnPickerError(e){return C33.equalsNoCase(this._pickerTag,e)},HasPickerTag(e){return this._pickerTagSet.has(e.toLowerCase())},OnFileOperationComplete(e){return C33.equalsNoCase(this._fileTag,e)},OnFileOperationError(e){return C33.equalsNoCase(this._fileTag,e)},OnAnyFileOperationComplete(){return!0},OnAnyFileOperationError(){return!0}}}{let C33=self.C3,START_IN_ITEMS=["default","desktop","documents","downloads","music","pictures","videos"];C33.Plugins.FileSystem.Acts={AddAcceptType(e,t,r){var i;this._isSupported&&(0<=(i=e.indexOf(";"))&&(e=e.substr(0,i)),this._acceptTypes.push({description:r,accept:{[e]:t.split(";")}}))},async ShowSaveFilePicker(e,t,r,i,s){this._isSupported&&(e=e.toLowerCase(),t={types:this._acceptTypes.slice(0),excludeAcceptAllOption:!t},r&&(t.suggestedName=r),i&&(t.id=i),1<=s&&(t.startIn=START_IN_ITEMS[s]),C33.clearArray(this._acceptTypes),r=await this.PostToDOMAsync("show-save-file-picker",{pickerTag:e,pickerOpts:t}),this._pickerTag=e,r.isOk?(this._fileNames=r.pickedFileNames,await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerComplete)):await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerError),this._pickerTag="")},async ShowOpenFilePicker(e,t,r,i,s){this._isSupported&&(e=e.toLowerCase(),t={types:this._acceptTypes.slice(0),excludeAcceptAllOption:!t,multiple:r},i&&(t.id=i),1<=s&&(t.startIn=START_IN_ITEMS[s]),C33.clearArray(this._acceptTypes),r=await this.PostToDOMAsync("show-open-file-picker",{pickerTag:e,pickerOpts:t}),this._pickerTag=e,r.isOk?(this._fileNames=r.pickedFileNames,await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerComplete)):await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerError),this._pickerTag="")},async ShowFolderPicker(e,t,r,i){this._isSupported&&(e=e.toLowerCase(),t={mode:0===t?"read":"readwrite"},r&&(t.id=r),1<=i&&(t.startIn=START_IN_ITEMS[i]),r=await this.PostToDOMAsync("show-folder-picker",{pickerTag:e,pickerOpts:t}),this._pickerTag=e,r.isOk?(this._folderNames=r.pickedFolderNames,await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerComplete)):await this.TriggerAsync(C33.Plugins.FileSystem.Cnds.OnPickerError),this._pickerTag="")},async WriteTextFile(e,t,r,i,s){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),e=await this.PostToDOMAsync("write-text-file",{pickerTag:e,folderPath:t,text:i,keepExisting:1===s}),await this._TriggerFileOperationResult(e.isOk,r))},async WriteBinaryFile(e,t,r,i){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),i=this._GetBinaryDataSdkInstance(i))&&(e=await this.PostToDOMAsync("write-binary-file",{pickerTag:e,folderPath:t,arrayBuffer:i.GetArrayBufferReadOnly()}),await this._TriggerFileOperationResult(e.isOk,r))},async ReadTextFile(e,t,r){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),(e=await this.PostToDOMAsync("read-text-file",{pickerTag:e,folderPath:t})).isOk&&(this._fileText=e.text),await this._TriggerFileOperationResult(e.isOk,r))},async ReadBinaryFile(e,t,r,i){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),i=this._GetBinaryDataSdkInstance(i))&&((e=await this.PostToDOMAsync("read-binary-file",{pickerTag:e,folderPath:t})).isOk&&i.SetArrayBufferTransfer(e.arrayBuffer),await this._TriggerFileOperationResult(e.isOk,r))},async CreateFolder(e,t,r){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),e=await this.PostToDOMAsync("create-folder",{pickerTag:e,folderPath:t}),await this._TriggerFileOperationResult(e.isOk,r))},async CopyFile(e,t,r,i){this._isSupported&&(e=e.toLowerCase(),i=i.toLowerCase(),e=await this.PostToDOMAsync("copy-file",{pickerTag:e,srcFolderPath:t,destFolderPath:r}),await this._TriggerFileOperationResult(e.isOk,i))},async Delete(e,t,r,i){this._isSupported&&(e=e.toLowerCase(),i=i.toLowerCase(),e=await this.PostToDOMAsync("delete",{pickerTag:e,folderPath:t,isRecursive:r}),await this._TriggerFileOperationResult(e.isOk,i))},async ListContent(e,t,r){this._isSupported&&(e=e.toLowerCase(),r=r.toLowerCase(),(e=await this.PostToDOMAsync("list-content",{pickerTag:e,folderPath:t})).isOk&&(this._fileNames=e.fileNames,this._folderNames=e.folderNames),await this._TriggerFileOperationResult(e.isOk,r))}}}{let C33=self.C3;C33.Plugins.FileSystem.Exps={FileNameAt(e){return(e=Math.floor(e))<0||e>=this._fileNames.length?"":this._fileNames[e]},FileCount(){return this._fileNames.length},FolderNameAt(e){return(e=Math.floor(e))<0||e>=this._folderNames.length?"":this._folderNames[e]},FolderCount(){return this._folderNames.length},FileText(){return this._fileText},FileTag(){return this._fileTag}}}{let C33=self.C3;C33.Plugins.Json=class JSONPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Json.Type=class JSONType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,C3X=self.C3X,IInstance=self.IInstance,map=(C33.Plugins.Json.Instance=class JSONInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._valueCache=[null,null],this._locationCache=[null,null],this._data={},this._path=[],this._currentKey="",this._currentValue=0}Release(){super.Release()}_InvalidateValueCache(){this._valueCache[0]=null,this._valueCache[1]=null}_HasValueCache(r,e){var i=this._valueCache[0];if(null!==r&&null!==i){if(i===r||C33.arraysEqual(i,r))return!0;if(e&&0<i.length){for(let e=0,t=Math.min(r.length,i.length);e<t;++e)if(r[e]!==i[e])return!1;return!0}}return!1}_GetValueCache(){return this._valueCache[1]}_UpdateValueCache(e,t){this._valueCache[0]=e,this._valueCache[1]=t}_InvalidateLocationCache(){this._locationCache[0]=null,this._locationCache[1]=null}_HasLocationCache(e){return this._locationCache[0]===e}_GetLocationCache(){return this._locationCache[1]}_UpdateLocationCache(e,t){this._locationCache[0]=e,this._locationCache[1]=t}_SetData(e){this._data=e,this._InvalidateValueCache(),this._SetPath("")}_GetData(){return this._data}_SetPath(e){this._path=this._ParsePathUnsafe(e),this._InvalidateLocationCache()}_ParsePath(e){return C33.cloneArray(this._ParsePathUnsafe(e))}_ParsePathUnsafe(e){var t,r=[];let i=!1,s;if(this._HasLocationCache(e))return this._GetLocationCache();"."===e[0]?(s=C33.cloneArray(this._path),e=e.slice(1)):s=[];for(t of e)i?(r.push(t),i=!1):"\\"===t?i=!0:"."===t?(s.push(r.join("")),C33.clearArray(r)):r.push(t);return 0!==r.length&&s.push(r.join("")),this._UpdateLocationCache(e,s),s}_GetValueAtFullPath(e,t){if(this._HasValueCache(e,!1))return this._GetValueCache();let r=this._data;for(var i of e)if(Array.isArray(r)){var s=parseInt(i,10);if(s<0||s>=r.length||!isFinite(s)){r=null;break}r=r[s]}else{if("object"!=typeof r||null===r){r=null;break}if(r.hasOwnProperty(i))r=r[i];else{if(!t){r=null;break}s={};r[i]=s,r=s}}return this._UpdateValueCache(e,r),r}_GetValue(e){var t,r,e=this._ParsePath(e);return e.length?(t=e.pop(),e=this._GetValueAtFullPath(e,!1),Array.isArray(e)?0<=(r=parseInt(t,10))&&r<e.length?e[r]:null:"object"==typeof e&&null!==e&&e.hasOwnProperty(t)?e[t]:null):this._data}_JSONTypeOf(e){return null===e?"null":Array.isArray(e)?"array":typeof e}_GetTypeOf(e){e=this._GetValue(e);return this._JSONTypeOf(e)}_ToSafeValue(e){var t=typeof e;return"number"==t||"string"==t?e:"boolean"==t&&e?1:0}_GetSafeValue(e){return this._ToSafeValue(this._GetValue(e))}_HasKey(e){var t,r,e=this._ParsePath(e);return!!e.length&&(t=e.pop(),e=this._GetValueAtFullPath(e,!1),Array.isArray(e)?0<=(r=parseInt(t,10))&&r<e.length:"object"==typeof e&&null!==e&&e.hasOwnProperty(t))}_SetValue(e,t){e=this._ParsePath(e);if(!e.length)return!1;this._HasValueCache(e,!0)&&this._InvalidateValueCache();var r,i=e.pop(),e=this._GetValueAtFullPath(e,!0);return Array.isArray(e)?(r=parseInt(i,10),!(!isFinite(r)||r<0||r>=e.length||(e[r]=t,0))):"object"==typeof e&&null!==e&&(e[i]=t,!0)}_DeleteKey(e){e=this._ParsePath(e);if(!e.length)return!1;this._HasValueCache(e,!0)&&this._InvalidateValueCache();var t=e.pop(),e=this._GetValueAtFullPath(e,!1);return!Array.isArray(e)&&"object"==typeof e&&null!==e&&(delete e[t],!0)}SaveToJson(){return{path:this._path,data:this._data}}LoadFromJson(e){this._InvalidateValueCache(),this._InvalidateLocationCache(),this._path=e.path,this._data=e.data}_SanitizeValue(e){return"number"==typeof e?isFinite(e)?e:0:"object"==typeof e?JSON.stringify(e):e+""}GetDebuggerProperties(){var e="plugins.json.debugger";let t;try{t=this._SanitizeValue(this._data)}catch(e){t='"invalid"'}return[{title:e+".title",properties:[{name:e+".data",value:t,onedit:e=>{try{var t=JSON.parse(e);this._SetData(t)}catch(e){}}},{name:e+".path",value:this._path.map(e=>e.replace(/\./g,"\\.")).join(".")}]}]}GetScriptInterfaceClass(){return self.IJSONInstance}},new WeakMap);self.IJSONInstance=class IJSONInstance extends IInstance{constructor(){super(),map.set(this,IInstance._GetInitInst().GetSdkInstance())}getJsonDataCopy(){var e=map.get(this)._GetData();return JSON.parse(JSON.stringify(e))}setJsonDataCopy(e){try{var t=JSON.parse(JSON.stringify(e));map.get(this)._SetData(t)}catch(e){throw console.error("[JSON plugin] setJsonData: object is not valid JSON: ",e),e}}setJsonString(e){C3X.RequireString(e);try{var t=JSON.parse(e);map.get(this)._SetData(t)}catch(e){throw console.error("[JSON plugin] setJsonString: string is not valid JSON: ",e),e}}toCompactString(){return JSON.stringify(map.get(this)._GetData())}toBeautifiedString(){return JSON.stringify(map.get(this)._GetData(),null,4)}}}{let C33=self.C3,JSON_TYPES=["null","boolean","number","string","object","array"];C33.Plugins.Json.Cnds={HasKey(e){return this._HasKey(e)},CompareType(e,t){return this._GetTypeOf(e)===JSON_TYPES[t]},CompareValue(e,t,r){return C33.compare(this._GetSafeValue(e),t,r)},IsBooleanSet(e){return!0===this._GetValue(e)},ForEach(e){var t=this._GetValue(e);if("object"==typeof t&&null!==t){var r,i,s=this._runtime,a=s.GetEventSheetManager(),n=s.GetCurrentEvent(),o=n.GetSolModifiers(),l=s.GetEventStack(),h=l.GetCurrentStackFrame(),u=l.Push(n),c=this._path,_=this._currentKey,d=this._currentValue,p=this._ParsePathUnsafe(e);s.SetDebuggingEnabled(!1);for([r,i]of Object.entries(t))this._path=C33.cloneArray(p),this._path.push(r),this._currentKey=r,this._currentValue=i,a.PushCopySol(o),this.GetObjectClass().GetCurrentSol().PickOne(this.GetInstance()),n.Retrigger(h,u),a.PopSol(o);s.SetDebuggingEnabled(!0),this._path=c,this._InvalidateLocationCache(),this._currentKey=_,this._currentValue=d,l.Pop()}return!1},OnParseError(){return!0}}}{let C33=self.C3;C33.Plugins.Json.Acts={Parse(e){try{this._SetData(JSON.parse(e))}catch(e){console.warn("[JSON plugin] Failed to parse JSON data: ",e),this._SetData({}),this.Trigger(C33.Plugins.Json.Cnds.OnParseError)}},SetPath(e){this._SetPath(e)},SetValue(e,t){this._SetValue(e,t)},SetArray(e,t){var r=this._GetValue(e);Array.isArray(r)?C33.resizeArray(r,t,0):(r=[],C33.extendArray(r,t,0),this._SetValue(e,r))},SetObject(e){this._SetValue(e,{})},SetJSON(e,t){let r=null;try{r=JSON.parse(t)}catch(e){console.warn("[JSON plugin] Failed to parse JSON data: ",e),this.Trigger(C33.Plugins.Json.Cnds.OnParseError)}this._SetValue(e,r)},SetNull(e){this._SetValue(e,null)},SetBoolean(e,t){this._SetValue(e,0!==t)},ToggleBoolean(e){var t=this._GetValue(e);"boolean"==typeof t&&this._SetValue(e,!t)},AddTo(e,t){var r=this._GetValue(e);"number"==typeof r&&this._SetValue(e,r+t)},SubtractFrom(e,t){var r=this._GetValue(e);"number"==typeof r&&this._SetValue(e,r-t)},DeleteKey(e){this._DeleteKey(e)},PushValue(e,t,r){t=this._GetValue(t);Array.isArray(t)&&(0===e?t.push(r):t.unshift(r),this._InvalidateValueCache())},PopValue(e,t){t=this._GetValue(t);Array.isArray(t)&&(0===e?t.pop():t.shift(),this._InvalidateValueCache())},InsertValue(e,t,r){t=this._GetValue(t);Array.isArray(t)&&(t.splice(r,0,e),this._InvalidateValueCache())},RemoveValues(e,t,r){t=this._GetValue(t);Array.isArray(t)&&0<e&&(t.splice(r,e),this._InvalidateValueCache())}}}{let C33=self.C3;C33.Plugins.Json.Exps={ToCompactString(){try{return JSON.stringify(this._data)}catch(e){return""}},ToBeautifiedString(){try{return JSON.stringify(this._data,null,4)}catch(e){return""}},Get(e){return this._GetSafeValue(e)},GetAsCompactString(e){e=this._GetValue(e);return JSON.stringify(e)},GetAsBeautifiedString(e){e=this._GetValue(e);return JSON.stringify(e,null,4)},Front(e){var e=this._GetValue(e);return Array.isArray(e)?(e=e[0],this._ToSafeValue(e)):-1},Back(e){var e=this._GetValue(e);return Array.isArray(e)?(e=e.at(-1),this._ToSafeValue(e)):-1},Type(e){return this._GetTypeOf(e)},ArraySize(e){e=this._GetValue(e);return Array.isArray(e)?e.length:-1},Path(){return this._path.map(e=>e.replace(/\./g,"\\.")).join(".")},CurrentKey(){return this._currentKey},CurrentValue(){return this._ToSafeValue(this._currentValue)},CurrentType(){return this._JSONTypeOf(this._currentValue)}}}{let C33=self.C3;C33.Plugins.Timeline=class TimelinePlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetTCInst2=function(){return tcObjectType.GetSingleGlobalInstance().GetSdkInstance()},GetTimelineParameter2=function(e){if("string"==typeof e){var t=timelineManager.GetTimelineByName(e);if(t)return t;throw new Error(`invalid timeline name '${e}'`)}if(e instanceof self.ITimelineState)return tcObjectType.GetRuntime()._UnwrapScriptInterface(e);throw new Error("invalid timeline parameter")},ValidateTags2=function(e,t=!1){if(!(t&&null==e||"string"==typeof e||Array.isArray(e)))throw new Error("invalid tags")},C33=(GetTCInst=GetTCInst2,GetTimelineParameter=GetTimelineParameter2,ValidateTags=ValidateTags2,self.C3),C3X=self.C3X,tcObjectType=(C33.Plugins.Timeline.Type=class TimelineType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITimelineControllerObjectType}},null),timelineManager=null;self.ITimelineControllerObjectType=class ITimelineControllerObjectType extends self.IObjectClass{constructor(e){super(e),tcObjectType=e,timelineManager=e.GetRuntime().GetTimelineManager(),e.GetRuntime()._GetCommonScriptInterfaces().timelineController=this}setInstances(e,t){let r=tcObjectType.GetRuntime(),i;if(e instanceof self.IWorldInstance)i=[r._UnwrapIWorldInstance(e)];else{if(!Array.isArray(e))throw new TypeError("invalid instances");i=e.map(e=>r._UnwrapIWorldInstance(e))}0!==i.length&&(C3X.RequireOptionalString(t),e=i[0].GetObjectClass(),GetTCInst2()._SetInstancesForNextPlay(e,i,t??""))}play(e,t){e=GetTimelineParameter2(e);return ValidateTags2(t,!0),GetTCInst2()._PlayTimeline(e,t??[]),e.GetITimelineState()}*allTimelines(){for(var e of timelineManager.GetTimelines())yield e.GetITimelineState()}*timelinesByTags(e){ValidateTags2(e);for(var t of timelineManager.GetTimelinesByTags(e))yield t.GetITimelineState()}}}{let C33=self.C3;C33.Plugins.Timeline.Instance=class TimelineInstance extends C33.SDKInstanceBase{constructor(e,t){super(e),this._nextTimelineObjectClasses=new Map,this.GetRuntime().GetTimelineManager().SetPluginInstance(e)}Release(){super.Release()}_SetTimelineInstanceObjects(e,t){for(var r of e)t.SetTrackInstance(r.trackId,r.instance)}_GetTimelineInstanceObjects(){var e,t=[];let s=(e,t,r)=>{var i=t.pickedInstances[t.startIndex];if(i)return t.startIndex++,e.usedObjectClassInstances.includes(i)?s(e,t,r):(e.usedObjectClassInstances.push(i),{trackId:r,instance:i})};for(e of this._nextTimelineObjectClasses.values())for(var[r,i]of e.trackIdPickedInstances.entries()){i=s(e,i,r);i&&t.push(i)}return t}_SetInstancesForNextPlay(e,t,r){var i,s;e.IsFamily()&&(e=e.GetFirstPicked().GetObjectClass()),this._nextTimelineObjectClasses.has(e)?(i=this._nextTimelineObjectClasses.get(e).trackIdPickedInstances).has(r)?(s=new Set([...i.get(r).pickedInstances,...t]),i.set(r,{startIndex:0,pickedInstances:Array.from(s)})):i.set(r,{startIndex:0,pickedInstances:t}):this._nextTimelineObjectClasses.set(e,{usedObjectClassInstances:[],trackIdPickedInstances:new Map([[r,{startIndex:0,pickedInstances:t}]])})}async _PlayTimeline(r,i,e){if(r){var s=this._runtime.GetTimelineManager();let t;var a=[];if(this._nextTimelineObjectClasses.size){let e=this._GetTimelineInstanceObjects();for(;e.length&&((t=s.GetTimelineOfTemplateForInstances(r,e))||((t=s.CreateFromTemplate(r)).ClearTrackInstances(),this._SetTimelineInstanceObjects(e,t)),t.SetTags(i),t.Play()&&a.push(t.GetPlayPromise()),e=this._GetTimelineInstanceObjects()),e.length;);}else r.SetTags(i),r.Play()&&a.push(r.GetPlayPromise());e||this._nextTimelineObjectClasses.clear(),await Promise.all(a)}else e||this._nextTimelineObjectClasses.clear()}}}{let C33=self.C3,triggerTimelines=[],triggerKeyframes=[];C33.Plugins.Timeline.Cnds={PushTriggerTimeline(e){triggerTimelines.push(e)},PopTriggerTimeline(){triggerTimelines.pop()},GetTriggerTimeline(){return triggerTimelines[triggerTimelines.length-1]},PushTriggerKeyframe(e){triggerKeyframes.push(e)},PopTriggerKeyframe(e){triggerKeyframes.pop()},GetTriggerKeyframe(){return triggerKeyframes[triggerKeyframes.length-1]},OnTimelineStarted(e){return C33.Plugins.Timeline.Cnds.GetTriggerTimeline()===e},OnTimelineStartedByName(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))if(C33.equalsNoCase(r.GetName(),t.GetName()))return!0;return!1},OnTimelineStartedByTags(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))if(t.HasTags(r.GetTags()))return!0;return!1},OnAnyTimelineStarted(){return!0},OnTimelineFinished(e){return C33.Plugins.Timeline.Cnds.GetTriggerTimeline()===e},OnTimelineFinishedByName(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))if(C33.equalsNoCase(r.GetName(),t.GetName()))return!0;return!1},OnTimelineFinishedByTags(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))if(t.HasTags(r.GetTags()))return!0;return!1},OnAnyTimelineFinished(){return!0},IsPlaying(e){return e.IsPlaying()},IsPlayingByName(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))if(t.IsPlaying())return!0;return!1},IsPlayingByTags(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))if(t.IsPlaying())return!0;return!1},IsAnyPlaying(){var e=[...this._runtime.GetTimelineManager().GetTimelines()];if(e)return e.some(e=>e.IsPlaying())},IsPaused(e){return e.IsPaused()},IsPausedByName(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))if(t.IsPaused())return!0;return!1},IsPausedByTags(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))if(t.IsPaused())return!0;return!1},IsAnyPaused(){var e=[...this._runtime.GetTimelineManager().GetTimelines()];if(e)return e.some(e=>e.IsPaused())},OnTimeSet(e){return C33.Plugins.Timeline.Cnds.GetTriggerTimeline()===e},OnTimeSetByName(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))if(r===t)return!0;return!1},OnTimeSetByTags(e){var t,r=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();if(r)for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))if(r===t)return!0;return!1},OnAnyKeyframeReached(){return!!C33.Plugins.Timeline.Cnds.GetTriggerKeyframe()},OnKeyframeReached(e,t){var r=C33.Plugins.Timeline.Cnds.GetTriggerKeyframe();if(!r)return!1;if(0===r.GetTags().length||!e)return!1;var i,e=e?e.split(" "):[];if(0===t){for(var s of e)if(r.HasTag(s))return!0;return!1}for(i of e)if(!r.HasTag(i))return!1;return!0}}}{let C33=self.C3;C33.Plugins.Timeline.Acts={PlayTimeline(e,t){return this._PlayTimeline(e,t,!1)},async PlayTimelineByName(e,t){var r,i=[];for(r of this._runtime.GetTimelineManager().GetTimelinesByName(e))i.push(this._PlayTimeline(r,t,!0));this._nextTimelineObjectClasses.clear(),await Promise.all(i)},async PlayAllTimelines(){var e,t=[];for(e of this._runtime.GetTimelineManager().GetTimelines())e.Play()&&t.push(e.GetPlayPromise());this._nextTimelineObjectClasses.clear(),await Promise.all(t)},PauseTimeline(e){e&&e.Stop()},PauseTimelineByName(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))C33.Plugins.Timeline.Acts.PauseTimeline.call(this,t)},PauseTimelineByTags(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))C33.Plugins.Timeline.Acts.PauseTimeline.call(this,t)},PauseAllTimelines(){var e;for(e of this._runtime.GetTimelineManager().GetTimelines())e.Stop()},ResumeTimeline(e){e&&e.Resume()},ResumeTimelineByName(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))C33.Plugins.Timeline.Acts.ResumeTimeline.call(this,t)},ResumeTimelineByTags(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))C33.Plugins.Timeline.Acts.ResumeTimeline.call(this,t)},ResumeAllTimelines(){var e;for(e of this._runtime.GetTimelineManager().GetTimelines())e.Resume()},StopTimeline(e){e&&e.Reset()},StopTimelineByName(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByName(e))C33.Plugins.Timeline.Acts.StopTimeline.call(this,t)},StopTimelineByTags(e){var t;for(t of this._runtime.GetTimelineManager().GetTimelinesByTags(e))C33.Plugins.Timeline.Acts.StopTimeline.call(this,t)},StopAllTimelines(){var e;for(e of this._runtime.GetTimelineManager().GetTimelines())e.Reset()},SetTimelineTime(e,t){var r;e&&(C33.IsFiniteNumber(t)?e.SetTime(t):C33.IsString(t)&&((r=e.GetKeyframeWithTags(t))?e.SetTime(r.GetTime()):C33.Plugins.Timeline.Acts.SetTimelineTime.call(this,e,Number(t))))},SetTimelineTimeByName(e,t){var r;for(r of this._runtime.GetTimelineManager().GetTimelinesByName(e))C33.Plugins.Timeline.Acts.SetTimelineTime.call(this,r,t)},SetTimelineTimeByTags(e,t){var r;for(r of this._runtime.GetTimelineManager().GetTimelinesByTags(e))C33.Plugins.Timeline.Acts.SetTimelineTime.call(this,r,t)},SetTimelinePlaybackRate(e,t){e&&e.SetPlaybackRate(t)},SetTimelinePlaybackRateByName(e,t){var r;for(r of this._runtime.GetTimelineManager().GetTimelinesByName(e))C33.Plugins.Timeline.Acts.SetTimelinePlaybackRate.call(this,r,t)},SetTimelinePlaybackRateByTags(e,t){var r;for(r of this._runtime.GetTimelineManager().GetTimelinesByTags(e))C33.Plugins.Timeline.Acts.SetTimelinePlaybackRate.call(this,r,t)},SetInstance(e,t){var r=[...e.GetCurrentSol().GetInstances()];this._SetInstancesForNextPlay(e,r,t)}}}{let C33=self.C3;C33.Plugins.Timeline.Exps={Time(e){var t,r,i=this._runtime.GetTimelineManager();for(t of i.GetTimelinesByName(e))return t.GetTime();for(r of i.GetTimelinesByTags(e))return r.GetTime();return 0},TotalTime(e){var t,r,i=this._runtime.GetTimelineManager();for(t of i.GetTimelinesByName(e))return t.GetTotalTime();for(r of i.GetTimelinesByTags(e))return r.GetTotalTime();return 0},Progress(e){var t,r,i=this._runtime.GetTimelineManager();for(t of i.GetTimelinesByName(e))return t.GetTime()/t.GetTotalTime();for(r of i.GetTimelinesByTags(e))return r.GetTime()/r.GetTotalTime();return 0},KeyframeTags(){var e=C33.Plugins.Timeline.Cnds.GetTriggerKeyframe();return e?e.GetTags().join(" "):""},TimelineName(){var e=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();return e?e.GetName():""},TimelineTags(){var e=C33.Plugins.Timeline.Cnds.GetTriggerTimeline();return e?e.GetStringTags():""},Value(e,t){var r,i,s=this._runtime.GetTimelineManager();for(r of s.GetTimelinesByName(e)){var a=r.GetTrackByName(t);if(a){a=a.GetPropertyTrack("value");if(a)return a.GetSourceAdapterValue()}else{a=r.GetTrackById(t);if(a){a=a.GetPropertyTrack("value");if(a)return a.GetSourceAdapterValue()}}}for(i of s.GetTimelinesByTags(e)){var n=i.GetTrackByName(t);if(n){n=n.GetPropertyTrack("value");if(n)return n.GetSourceAdapterValue()}else{n=i.GetTrackById(t);if(n){n=n.GetPropertyTrack("value");if(n)return n.GetSourceAdapterValue()}}}return 0},Ease(e,t){1<=(t=t<0?0:t)&&(t=1);var r=self.Ease.ToInternal(e);return r?self.Ease.GetRuntimeEase(r)(t,0,1,1):(r=self.Ease.GetRuntimeEase(e))?r(t,0,1,1):(console.warn("[TimelineController.Ease expression] no matching built-in or custom ease function found, returning 0"),0)}}}C3.Plugins.GD_SDK=class SingleGlobalPlugin extends C3.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}},C3.Plugins.GD_SDK.Type=class SingleGlobalType extends C3.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}},C3.Plugins.GD_SDK.Instance=class SingleGlobalInstance extends C3.SDKInstanceBase{constructor(e,t){var r;super(e),this._gameID="",this._sdkReady=!1,this._adPlaying=!1,this._adViewed=!1,this._giveReward=!1,this._preloadedAd=!1,this._available_adtypes=["interstitial","rewarded"],this._levelSID=null,this._scoreSID=null,t&&(this._gameID=t[0],this._levelSID=t[1],this._scoreSID=t[2]),window.GD_OPTIONS={gameId:this._gameID,advertisementSettings:{},onEvent:e=>{switch(e.name){case"SDK_GAME_START":this._adPlaying=!1;break;case"SDK_GAME_PAUSE":this._adPlaying=!0;break;case"SDK_GDPR_TRACKING":case"SDK_GDPR_TARGETING":break;case"SDK_REWARDED_WATCH_COMPLETE":this._giveReward=!0,setTimeout(()=>{this._giveReward=!1},5e3);break;case"COMPLETE":this._adViewed=!0,setTimeout(()=>{this._adViewed=!1},5e3);break;case"SDK_READY":this._sdkReady=!0}}},e=document,t="gamedistribution-jssdk",r=e.getElementsByTagName("script")[0],e.getElementById(t)||((e=e.createElement("script")).id=t,e.src="/main.min.js",r.parentNode.insertBefore(e,r))}Release(){super.Release()}SaveToJson(){return{}}LoadFromJson(e){}PreloadRewardedAd(){this._preloadedAd=!1;var e=window.gdsdk;"undefined"!==e&&"undefined"!==e.preloadAd&&e.preloadAd("rewarded").then(()=>{this._preloadedAd=!0}).catch(e=>{this._preloadedAd=!1})}ShowAd(e){var t=window.gdsdk;"undefined"!==t&&"undefined"!==t.showAd&&(t.showAd(e),"rewarded"===e)&&(this._preloadedAd=!1)}SendGameEvent(){try{var e,t,r=this._runtime.GetObjectClassBySID(this._scoreSID)?._iObjectClass.getFirstInstance()?.text,i=this._runtime.GetObjectClassBySID(this._levelSID)?._iObjectClass.getFirstInstance()?.text;"undefined"!==gdsdk&&"undefined"!==gdsdk.sendEvent&&"undefined"!==i&&"undefined"!==r&&(e=parseInt(r.trim().replace(/[^\d]/g,"")),t={eventName:"game_event",data:{level:parseInt(i.trim().replace(/[^\d]/g,"")),score:e}},gdsdk.sendEvent(t))}catch(e){console.log(e.message)}}},C3.Plugins.GD_SDK.Cnds={ResumeGame(){return!this._adPlaying},PauseGame(){return this._adPlaying},PreloadedAd(){return this._preloadedAd},AdViewed(){return this._adViewed},RewardPlayer(){return this._giveReward}},C3.Plugins.GD_SDK.Acts={ShowAd(){this.ShowAd()},PreloadRewardedAd(){this.PreloadRewardedAd()},ShowRewardedAd(){this.ShowAd("rewarded")},SendGameEvent(){this.SendGameEvent()}},C3.Plugins.GD_SDK.Exps={};{let C33=self.C3;C33.Plugins.TiledBg=class TiledBgPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let WrapModeToStr2=function(e){switch(e){case 0:return"clamp-to-edge";case 1:return"repeat";case 2:return"mirror-repeat"}return"repeat"},C33=(WrapModeToStr=WrapModeToStr2,self.C3);C33.Plugins.TiledBg.Type=class TiledBgType extends C33.SDKTypeBase{constructor(e,t){super(e),this._wrapX="repeat",this._wrapY="repeat",t&&(this._wrapX=WrapModeToStr2(t[0]),this._wrapY=WrapModeToStr2(t[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{let C33=self.C3,C3X=self.C3X,INITIALLY_VISIBLE=0,ORIGIN=1,IMAGE_OFFSET_X=4,IMAGE_OFFSET_Y=5,IMAGE_SCALE_X=6,IMAGE_SCALE_Y=7,IMAGE_ANGLE=8,ENABLE_TILE_RANDOMIZATION=9,TILE_XRANDOM=10,TILE_YRANDOM=11,TILE_ANGLERANDOM=12,TILE_BLENDMARGINX=13,TILE_BLENDMARGINY=14,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad),rcTex=C33.New(C33.Rect),qTex=C33.New(C33.Quad),map=(C33.Plugins.TiledBg.Instance=class TiledBgInstance extends C33.SDKWorldInstanceBase{constructor(e,t){super(e),this._imageOffsetX=0,this._imageOffsetY=0,this._imageScaleX=1,this._imageScaleY=1,this._imageAngle=0,this._enableTileRandomization=!1,this._tileXRandom=0,this._tileYRandom=0,this._tileAngleRandom=0,this._tileBlendMarginX=0,this._tileBlendMarginY=0,this._ownImageInfo=null,t&&(this.GetWorldInfo().SetVisible(!!t[INITIALLY_VISIBLE]),this._imageOffsetX=t[IMAGE_OFFSET_X],this._imageOffsetY=t[IMAGE_OFFSET_Y],this._imageScaleX=t[IMAGE_SCALE_X],this._imageScaleY=t[IMAGE_SCALE_Y],this._imageAngle=C33.toRadians(t[IMAGE_ANGLE]),this._enableTileRandomization=!!t[ENABLE_TILE_RANDOMIZATION],this._tileXRandom=t[TILE_XRANDOM],this._tileYRandom=t[TILE_YRANDOM],this._tileAngleRandom=t[TILE_ANGLERANDOM],this._tileBlendMarginX=t[TILE_BLENDMARGINX],this._tileBlendMarginY=t[TILE_BLENDMARGINY])}Release(){this._ReleaseOwnImage(),super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(e,t,r){var i=this.GetCurrentImageInfo(),s=i.GetWidth(),i=i.GetHeight(),a=this._imageOffsetX/s,n=this._imageOffsetY/i,o=this._imageAngle;rcTex.set(0,0,e/(s*this._imageScaleX),t/(i*this._imageScaleY)),rcTex.offset(-a,-n),0===o?r.setFromRect(rcTex):r.setFromRotatedRect(rcTex,-o)}SetTilingShaderProgram(e,t=!0){var r;this._enableTileRandomization?(r=this.GetCurrentImageInfo(),e.SetTileRandomizationMode(),e.SetTileRandomizationInfo(r.GetWidth()*this._imageScaleX,r.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY)):t&&e.SetTextureFillMode()}Draw(e){var t,r,i,s=this.GetCurrentImageInfo(),a=s.GetTexture();null!==a&&(this.SetTilingShaderProgram(e),e.SetTexture(a),a=s.GetWidth(),s=s.GetHeight(),t=this._imageOffsetX/a,r=this._imageOffsetY/s,i=this.GetWorldInfo(),rcTex.set(0,0,i.GetWidth()/(a*this._imageScaleX),i.GetHeight()/(s*this._imageScaleY)),rcTex.offset(-t,-r),i.HasMesh()?this._DrawMesh(i,e):this._DrawStandard(i,e))}_DrawStandard(e,t){let r=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(r=e.PixelRoundQuad(r)),0===this._imageAngle?t.Quad3(r,rcTex):(qTex.setFromRotatedRect(rcTex,-this._imageAngle),t.Quad4(r,qTex))}_DrawMesh(r,e){var i=r.GetTransformedMesh();if(r.IsMeshChanged()){r.CalculateBbox(tempRect,tempQuad,!1);let e=tempQuad,t=(this._runtime.IsPixelRoundingEnabled()&&(e=r.PixelRoundQuad(e)),rcTex);0!==this._imageAngle&&(qTex.setFromRotatedRect(rcTex,-this._imageAngle),t=qTex),i.CalculateTransformedMesh(r.GetSourceMesh(),e,t),r.SetMeshChanged(!1)}i.Draw(e)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(e){this._imageOffsetX!==e&&(this._imageOffsetX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(e){this._imageOffsetY!==e&&(this._imageOffsetY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(e){this._imageScaleX!==e&&(this._imageScaleX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(e){this._imageScaleY!==e&&(this._imageScaleY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(e){this._imageAngle!==e&&(this._imageAngle=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(e){this._enableTileRandomization!==(e=!!e)&&(this._enableTileRandomization=e,this._runtime.UpdateRender())}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(e){this._tileXRandom!==e&&(this._tileXRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(e){this._tileYRandom!==e&&(this._tileYRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(e){this._tileAngleRandom!==e&&(this._tileAngleRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(e){this._tileBlendMarginX!==e&&(this._tileBlendMarginX=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(e){this._tileBlendMarginY!==e&&(this._tileBlendMarginY=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileBlendMarginY(){return this._tileBlendMarginY}SaveToJson(){var e={};return 0!==this._imageOffsetX&&(e.iox=this._imageOffsetX),0!==this._imageOffsetY&&(e.ioy=this._imageOffsetY),1!==this._imageScaleX&&(e.isx=this._imageScaleX),1!==this._imageScaleY&&(e.isy=this._imageScaleY),0!==this._imageAngle&&(e.ia=this._imageAngle),this._enableTileRandomization&&(e.tr=!0),1!==this._tileXRandom&&(e.trx=this._tileXRandom),1!==this._tileYRandom&&(e.try=this._tileYRandom),1!==this._tileAngleRandom&&(e.tra=this._tileAngleRandom),.1!==this._tileBlendMarginX&&(e.trbmx=this._tileBlendMarginX),.1!==this._tileBlendMarginY&&(e.trbmy=this._tileBlendMarginY),e}LoadFromJson(e){this._imageOffsetX=e.iox||0,this._imageOffsetY=e.ioy||0,this._imageScaleX=e.hasOwnProperty("isx")?e.isx:1,this._imageScaleY=e.hasOwnProperty("isy")?e.isy:1,this._imageAngle=e.ia||0,this._enableTileRandomization=!!e.tr,this._tileXRandom=e.hasOwnProperty("trx")?e.trx:1,this._tileYRandom=e.hasOwnProperty("try")?e.try:1,this._tileAngleRandom=e.hasOwnProperty("tra")?e.tra:1,this._tileBlendMarginX=e.hasOwnProperty("trbmx")?e.trbmx:.1,this._tileBlendMarginY=e.hasOwnProperty("trbmy")?e.trbmy:.1}GetDebuggerProperties(){var e="plugins.tiledbg.properties";return[{title:e+".image-transform.name",properties:[{name:e+".image-offset-x.name",value:this._GetImageOffsetX(),onedit:e=>this._SetImageOffsetX(e)},{name:e+".image-offset-y.name",value:this._GetImageOffsetY(),onedit:e=>this._SetImageOffsetY(e)},{name:e+".image-scale-x.name",value:100*this._GetImageScaleX(),onedit:e=>this._SetImageScaleX(e/100)},{name:e+".image-scale-y.name",value:100*this._GetImageScaleY(),onedit:e=>this._SetImageScaleY(e/100)},{name:e+".image-angle.name",value:C33.toDegrees(this._GetImageAngle()),onedit:e=>this._SetImageAngle(C33.toRadians(e))}]},{title:e+".tile-randomization.name",properties:[{name:e+".enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:e=>this._SetTileRandomizationEnabled(e)},{name:e+".x-random.name",value:100*this._GetTileXRandom(),onedit:e=>this._SetTileXRandom(e/100)},{name:e+".y-random.name",value:100*this._GetTileYRandom(),onedit:e=>this._SetTileYRandom(e/100)},{name:e+".angle-random.name",value:100*this._GetTileAngleRandom(),onedit:e=>this._SetTileAngleRandom(e/100)},{name:e+".blend-margin-x.name",value:100*this._GetTileBlendMarginX(),onedit:e=>this._SetTileBlendMarginX(e/100)},{name:e+".blend-margin-y.name",value:100*this._GetTileBlendMarginY(),onedit:e=>this._SetTileBlendMarginY(e/100)}]}]}GetPropertyValueByIndex(e){switch(e){case IMAGE_OFFSET_X:return this._GetImageOffsetX();case IMAGE_OFFSET_Y:return this._GetImageOffsetY();case IMAGE_SCALE_X:return this._GetImageScaleX();case IMAGE_SCALE_Y:return this._GetImageScaleY();case IMAGE_ANGLE:return this._GetImageAngle();case ENABLE_TILE_RANDOMIZATION:return this._IsTileRandomizationEnabled();case TILE_XRANDOM:return this._GetTileXRandom();case TILE_YRANDOM:return this._GetTileYRandom();case TILE_ANGLERANDOM:return this._GetTileAngleRandom();case TILE_BLENDMARGINX:return this._GetTileBlendMarginX();case TILE_BLENDMARGINY:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(e,t){switch(e){case IMAGE_OFFSET_X:this._SetImageOffsetX(t);break;case IMAGE_OFFSET_Y:this._SetImageOffsetY(t);break;case IMAGE_SCALE_X:this._SetImageScaleX(t);break;case IMAGE_SCALE_Y:this._SetImageScaleY(t);break;case IMAGE_ANGLE:this._SetImageAngle(t);break;case ENABLE_TILE_RANDOMIZATION:this._SetTileRandomizationEnabled(!!t);break;case TILE_XRANDOM:this._SetTileXRandom(t);break;case TILE_YRANDOM:this._SetTileYRandom(t);break;case TILE_ANGLERANDOM:this._SetTileAngleRandom(t);break;case TILE_BLENDMARGINX:this._SetTileBlendMarginX(t);break;case TILE_BLENDMARGINY:this._SetTileBlendMarginY(t)}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}},new WeakMap);self.ITiledBackgroundInstance=class ITiledBackgroundInstance extends self.IWorldInstance{constructor(){super(),map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageOffsetX(e)}get imageOffsetX(){return map.get(this)._GetImageOffsetX()}set imageOffsetY(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageOffsetY(e)}get imageOffsetY(){return map.get(this)._GetImageOffsetY()}setImageOffset(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._SetImageOffsetX(e),r._SetImageOffsetY(t)}getImageOffset(){var e=map.get(this);return[e._GetImageOffsetX(),e._GetImageOffsetY()]}set imageScaleX(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageScaleX(e)}get imageScaleX(){return map.get(this)._GetImageScaleX()}set imageScaleY(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageScaleY(e)}get imageScaleY(){return map.get(this)._GetImageScaleY()}setImageScale(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._SetImageScaleX(e),r._SetImageScaleY(t)}getImageScale(){var e=map.get(this);return[e._GetImageScaleX(),e._GetImageScaleY()]}set imageAngle(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageAngle(e)}get imageAngle(){return map.get(this)._GetImageAngle()}set imageAngleDegrees(e){C3X.RequireFiniteNumber(e),map.get(this)._SetImageAngle(C33.toRadians(e))}get imageAngleDegrees(){return C33.toDegrees(map.get(this)._GetImageAngle())}get imageWidth(){return map.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){var e=map.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}set enableTileRandomization(e){map.get(this)._SetTileRandomizationEnabled(!!e)}get enableTileRandomization(){return map.get(this)._IsTileRandomizationEnabled()}set tileXRandom(e){C3X.RequireFiniteNumber(e),map.get(this)._SetTileXRandom(e)}get tileXRandom(){return map.get(this)._GetTileXRandom()}set tileYRandom(e){C3X.RequireFiniteNumber(e),map.get(this)._SetTileYRandom(e)}get tileYRandom(){return map.get(this)._GetTileYRandom()}setTileRandom(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._SetTileXRandom(e),r._SetTileYRandom(t)}getTileRandom(){var e=map.get(this);return[e._GetTileXRandom(),e._GetTileYRandom()]}set tileAngleRandom(e){C3X.RequireFiniteNumber(e),map.get(this)._SetTileAngleRandom(e)}get tileAngleRandom(){return map.get(this)._GetTileAngleRandom()}set tileBlendMarginX(e){C3X.RequireFiniteNumber(e),map.get(this)._SetTileBlendMarginX(e)}get tileBlendMarginX(){return map.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(e){C3X.RequireFiniteNumber(e),map.get(this)._SetTileBlendMarginY(e)}get tileBlendMarginY(){return map.get(this)._GetTileBlendMarginY()}setTileBlendMargin(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._SetTileBlendMarginX(e),r._SetTileBlendMarginY(t)}getTileBlendMargin(){var e=map.get(this);return[e._GetTileBlendMarginX(),e._GetTileBlendMarginY()]}async replaceImage(e){C3X.RequireInstanceOf(e,Blob);var t=map.get(this),r=t.GetRuntime(),i=C33.New(C33.ImageInfo);i.LoadDynamicBlobAsset(r,e),await i.LoadStaticTexture(r.GetRenderer(),{sampling:r.GetSampling(),wrapX:"repeat",wrapY:"repeat"}),t.WasReleased()?i.Release():(t._ReleaseOwnImage(),t._ownImageInfo=i,r.UpdateRender())}}}{let C33=self.C3;C33.Plugins.TiledBg.Cnds={OnURLLoaded(){return!0},OnURLFailed(){return!0},IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}}}{let C33=self.C3;C33.Plugins.TiledBg.Acts={SetImageOffsetX(e){this._SetImageOffsetX(e)},SetImageOffsetY(e){this._SetImageOffsetY(e)},SetImageScaleX(e){this._SetImageScaleX(e/100)},SetImageScaleY(e){this._SetImageScaleY(e/100)},SetImageAngle(e){this._SetImageAngle(C33.toRadians(e))},SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e)},SetTilePosRandom(e,t){this._SetTileXRandom(e/100),this._SetTileYRandom(t/100)},SetTileAngleRandom(e){this._SetTileAngleRandom(e/100)},SetTileBlendMargin(e,t){this._SetTileBlendMarginX(e/100),this._SetTileBlendMarginY(t/100)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},async LoadURL(e,t){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==e){var r=this._runtime,i=C33.New(C33.ImageInfo);try{if(await i.LoadDynamicAsset(r,e),!i.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return i.Release(),null;if(!await i.LoadStaticTexture(r.GetRenderer(),{sampling:r.GetSampling(),wrapX:"repeat",wrapY:"repeat"}))return}catch(e){return console.error("Load image from URL failed: ",e),void(this.WasReleased()||this.Trigger(C33.Plugins.TiledBg.Cnds.OnURLFailed))}this.WasReleased()?i.Release():(this._ReleaseOwnImage(),this._ownImageInfo=i,r.UpdateRender(),await this.TriggerAsync(C33.Plugins.TiledBg.Cnds.OnURLLoaded))}}}}{let C33=self.C3;C33.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return C33.toDegrees(this._imageAngle)},TileXRandom(){return 100*this._GetTileXRandom()},TileYRandom(){return 100*this._GetTileYRandom()},TileAngleRandom(){return 100*this._GetTileAngleRandom()},TileBlendMarginX(){return 100*this._GetTileBlendMarginX()},TileBlendMarginY(){return 100*this._GetTileBlendMarginY()}}}{let C33=self.C3;C33.Plugins.Particles=class ParticlesPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Plugins.Particles.Type=class ParticlesType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{let GetParticleEngine2=function(e){return map.get(e).GetParticleEngine()},C33=(GetParticleEngine=GetParticleEngine2,self.C3),C3X=self.C3X,RATE=0,SPRAY_CONE=1,TYPE=2,SPAWNOBJECTCLASS=3,INITIALLY_VISIBLE=4,SPEED=5,SIZE=6,OPACITY=7,GROW_RATE=8,X_RANDOMISER=9,Y_RANDOMISER=10,INITIAL_SPEED_RANDOMISER=11,SIZE_RANDOMISER=12,GROW_RATE_RANDOMISER=13,ACCELERATION=14,GRAVITY=15,ANGLE_RANDOMISER=16,LIFE_SPEED_RANDOMISER=17,OPACITY_RANDOMISER=18,DESTROY_MODE=19,TIMEOUT=20,CONTINUOUS=0,ONE_SHOT=1,tempRect=C33.New(C33.Rect),map=(C33.Plugins.Particles.Instance=class ParticlesInstance extends C33.SDKWorldInstanceBase{constructor(e,t){super(e),this._isFirstTick=!0;e=C33.New(self.ParticleEngine);(this._particleEngine=e).ononeshotfinish=()=>this._OnOneShotFinish(),this._spawnObjectClass=null,this._particleUpdateCallback=(e,t,r,i,s,a)=>this._OnParticleUpdate(e,t,r,i,s,a),this._particleDestroyCallback=e=>this._OnParticleDestroy(e);let r=this._hasAnyDefaultParticle=!0,i=(t&&(e.SetRate(t[RATE]),e.SetSprayCone(C33.toRadians(t[SPRAY_CONE])),e.SetSprayType(t[TYPE]?"one-shot":"continuous-spray"),this._SetParticleObjectClass(this._runtime.GetObjectClassBySID(t[SPAWNOBJECTCLASS])),r=t[INITIALLY_VISIBLE],e.SetInitSpeed(t[SPEED]),e.SetInitSize(t[SIZE]),e.SetInitOpacity(t[OPACITY]/100),e.SetGrowRate(t[GROW_RATE]),e.SetInitXRandom(t[X_RANDOMISER]),e.SetInitYRandom(t[Y_RANDOMISER]),e.SetInitSpeedRandom(t[INITIAL_SPEED_RANDOMISER]),e.SetInitSizeRandom(t[SIZE_RANDOMISER]),e.SetGrowRandom(t[GROW_RATE_RANDOMISER]),e.SetAcceleration(t[ACCELERATION]),e.SetGravity(t[GRAVITY]),e.SetLifeAngleRandom(t[ANGLE_RANDOMISER]),e.SetLifeSpeedRandom(t[LIFE_SPEED_RANDOMISER]),e.SetLifeOpacityRandom(t[OPACITY_RANDOMISER]),e.SetDestroyModeIndex(t[DESTROY_MODE]),e.SetTimeout(t[TIMEOUT])),this._UpdateEngineParameters(),this._spawnObjectClass&&(this._hasAnyDefaultParticle=!1),"one-shot"===e.GetSprayType()?e.CreateOneShotSpray():e.SetSpraying(!0),this.GetWorldInfo());i.SetVisible(r),i.SetBboxChangeEventEnabled(!0),this._inst.Dispatcher().addEventListener("bboxchange",()=>{i.OverwriteBoundingBox(this._particleEngine.GetBoundingBox())}),this.GetRuntime().GetRenderer().IsWebGPU()&&i.SetUsePointsShaderProgram(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad),this._StartTicking()}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._particleEngine.Release(),this._particleEngine=null,this._particleUpdateCallback=null,this._particleDestroyCallback=null,super.Release()}GetParticleEngine(){return this._particleEngine}_SetRate(e){this._particleEngine.SetRate(e),"one-shot"===this._particleEngine.GetSprayType()&&this._isFirstTick&&this._particleEngine.SetParticleCount(e)}_SetParticleObjectClass(e){(e=e===this.GetObjectClass()?null:e)===this._spawnObjectClass||(this._spawnObjectClass=e,this._particleEngine.onparticlecreate=e?e=>this._OnParticleCreate(e):null,this._spawnObjectClass)||(this._hasAnyDefaultParticle=!0)}_UpdateEngineParameters(){var e=this._particleEngine,t=this.GetWorldInfo();e.SetMasterOpacity(t.GetOpacity()),e.SetPixelRounding(this._runtime.IsPixelRoundingEnabled()),e.SetSpawnX(t.GetX()),e.SetSpawnY(t.GetY()),e.SetSpawnAngle(t.GetAngle()),e.SetInitSizeScale(Math.abs(t.GetSceneGraphScale()))}_OnOneShotFinish(){this._runtime.DestroyInstance(this._inst)}Draw(e){var t,r,i,s,a;this._hasAnyDefaultParticle&&(a=(t=this._objectClass.GetImageInfo()).GetTexture())&&(i=(r=this.GetWorldInfo()).GetLayer(),s=tempRect,this._runtime.GetCanvasManager().IsPastingToDrawingCanvas()?s.set(-1/0,-1/0,1/0,1/0):i.Has3DCamera()?i.CalculateViewport3D(r.GetTotalZElevation(),s):i.GetViewportForZ(r.GetTotalZElevation(),s),e.SetTexture(a),a=i.Get2DScaleFactorToZ(r.GetTotalZElevation()),this._particleEngine.SetParticleScale(i.GetRenderScale()*a),this._particleEngine.Draw(e,t.GetTexQuad(),s,i.Has3DCamera()))}SaveToJson(){var e=this._particleEngine;return{r:e.GetRate(),sc:e.GetSprayCone(),st:e.GetSprayType(),isp:e.GetInitSpeed(),isz:e.GetInitSize(),io:e.GetInitOpacity(),gr:e.GetGrowRate(),xr:e.GetInitXRandom(),yr:e.GetInitYRandom(),spr:e.GetInitSpeedRandom(),szr:e.GetInitSizeRandom(),grnd:e.GetGrowRandom(),acc:e.GetAcceleration(),g:e.GetGravity(),lar:e.GetLifeAngleRandom(),lsr:e.GetLifeSpeedRandom(),lor:e.GetLifeOpacityRandom(),dm:e.GetDestroyModeIndex(),to:e.GetTimeout(),s:e.IsSpraying(),pcc:e._GetCreateCounter(),ft:this._isFirstTick,soc:this._spawnObjectClass?this._spawnObjectClass.GetSID():null,p:e.GetParticles().map(e=>e.toJSON())}}LoadFromJson(e,t){var r,i=this._particleEngine,s=(i.SetRate(e.r),i.SetSprayCone(e.sc),i.SetSprayType(e.st),i.SetInitSpeed(e.isp),i.SetInitSize(e.isz),i.SetInitOpacity(e.io),i.SetGrowRate(e.gr),i.SetInitXRandom(e.xr),i.SetInitYRandom(e.yr),i.SetInitSpeedRandom(e.spr),i.SetInitSizeRandom(e.szr),i.SetGrowRandom(e.grnd),i.SetAcceleration(e.acc),i.SetGravity(e.g),i.SetLifeAngleRandom(e.lar),i.SetLifeSpeedRandom(e.lsr),i.SetLifeOpacityRandom(e.lor),i.SetDestroyModeIndex(e.dm),i.SetTimeout(e.to),i.SetSpraying(e.s),i._SetCreateCounter(e.pcc),this._isFirstTick=e.ft,e.hasOwnProperty("soc")&&(r=this.GetRuntime().GetObjectClassBySID(e.soc))&&this._SetParticleObjectClass(r),e.p),a=(i.SetParticleCount(s.length,!1),i.GetParticles());for(let e=0,t=a.length;e<t;++e)a[e].setFromJSON(s[e]);"state"===t&&this._spawnObjectClass&&(i.UpdateAllParticlesUserData(),i.ApplyParticleDataToUserData(this))}_OnAfterLoad(){var e=this._particleEngine,r=(e.UpdateAllParticlesUserData(),e.ApplyParticleDataToUserData(this),e.GetParticles());for(let e=0,t=r.length;e<t;++e){var i=r[e],s=i.GetUserData();s&&(s=s.GetWorldInfo())&&(s=s.GetInstance())&&(i=i.GetUserDataUID(),s=s.GetUID(),"number"==typeof i&&"number"==typeof s&&i===s||"number"==typeof i&&(i=(s=this.GetRuntime()).GetInstanceByUID(i))&&s.DestroyInstance(i))}}Tick(){var e=this._runtime.GetDt(this._inst);this._UpdateEngineParameters(),this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles(),this._particleEngine.Tick(e),this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_FastForward(e){for(this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles();0<e;)this._particleEngine.Tick(1/60),e-=1/60;this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_OnParticleCreate(e,t){let r;t=(r=(r=(r="number"==typeof t?this._runtime.GetInstanceByUID(t):r)&&r.GetObjectClass()!==this._spawnObjectClass?null:r)||this._runtime.CreateInstance(this._spawnObjectClass,this.GetWorldInfo().GetLayer(),e.GetX(),e.GetY())).GetWorldInfo();return t.SetSize(e.GetSize(),e.GetSize()),t.SetAngle(e.GetAngle()),t.SetOpacity(e.GetOpacity()),t.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()),t.SetBboxChanged(),t.ZOrderMoveAdjacentToInstance(this.GetInstance(),!0),r._TriggerOnCreated(),e.SetUpdateCallback(this._particleUpdateCallback),e.SetDestroyCallback(this._particleDestroyCallback),r}_OnParticleUpdate(e,t,r,i,s,a){e.IsDestroyed()||((e=e.GetWorldInfo()).OffsetXY(t,r),e.SetSize(e.GetWidth()+i,e.GetHeight()+i),e.SetAngle(e.GetAngle()+s),e.SetOpacity(e.GetOpacity()+a),e.SetBboxChanged())}_OnParticleDestroy(e){e.IsDestroyed()||this._runtime.DestroyInstance(e)}GetPropertyValueByIndex(e){var t=this._particleEngine;switch(e){case RATE:return t.GetRate();case SPRAY_CONE:return C33.toDegrees(t.GetSprayCone());case TYPE:return"one-shot"===t.GetSprayType()?ONE_SHOT:CONTINUOUS;case SPEED:return t.GetInitSpeed();case SIZE:return t.GetInitSize();case OPACITY:return 100*t.GetInitOpacity();case GROW_RATE:return t.GetGrowRate();case X_RANDOMISER:return t.GetInitXRandom();case Y_RANDOMISER:return t.GetInitYRandom();case INITIAL_SPEED_RANDOMISER:return t.GetInitSpeedRandom();case SIZE_RANDOMISER:return t.GetInitSizeRandom();case GROW_RATE_RANDOMISER:return t.GetGrowRandom();case ACCELERATION:return t.GetAcceleration();case GRAVITY:return t.GetGravity();case ANGLE_RANDOMISER:return t.GetLifeAngleRandom();case LIFE_SPEED_RANDOMISER:return t.GetLifeSpeedRandom();case OPACITY_RANDOMISER:return t.GetLifeOpacityRandom();case DESTROY_MODE:return t.GetDestroyModeIndex();case TIMEOUT:return t.GetTimeout()}}SetPropertyValueByIndex(e,t){var r=this._particleEngine;switch(e){case RATE:r.SetRate(t);break;case SPRAY_CONE:r.SetSprayCone(C33.toRadians(t));break;case TYPE:r.SetSprayType(t?"one-shot":"continuous-spray");break;case SPEED:r.SetInitSpeed(t);break;case SIZE:r.SetInitSize(t);break;case OPACITY:r.SetInitOpacity(t/100);break;case GROW_RATE:r.SetGrowRate(t);break;case X_RANDOMISER:r.SetInitXRandom(t);break;case Y_RANDOMISER:r.SetInitYRandom(t);break;case INITIAL_SPEED_RANDOMISER:r.SetInitSpeedRandom(t);break;case SIZE_RANDOMISER:r.SetInitSizeRandom(t);break;case GROW_RATE_RANDOMISER:r.SetGrowRandom(t);break;case ACCELERATION:r.SetAcceleration(t);break;case GRAVITY:r.SetGravity(t);break;case ANGLE_RANDOMISER:r.SetLifeAngleRandom(t);break;case LIFE_SPEED_RANDOMISER:r.SetLifeSpeedRandom(t);break;case OPACITY_RANDOMISER:r.SetLifeOpacityRandom(t);break;case DESTROY_MODE:r.SetDestroyModeIndex(t);break;case TIMEOUT:r.SetTimeout(t)}}GetDebuggerProperties(){var e="plugins.particles",t=e+".properties",r=e+".debugger";let i=this._particleEngine;return[{title:e+".name",properties:[{name:r+".particle-count",value:i.GetParticleCount()},{name:t+".type.name",value:[t+".type.items."+i.GetSprayType()]},{name:r+".is-spraying",value:i.IsSpraying(),onedit:e=>i.SetSpraying(e)},{name:t+".rate.name",value:i.GetRate(),onedit:e=>i.SetRate(e)},{name:t+".spray-cone.name",value:C33.toDegrees(i.GetSprayCone()),onedit:e=>i.SetSprayCone(C33.toRadians(e))},{name:t+".speed.name",value:i.GetInitSpeed(),onedit:e=>i.SetInitSpeed(e)},{name:t+".size.name",value:i.GetInitSize(),onedit:e=>i.SetInitSize(e)},{name:t+".opacity.name",value:i.GetInitOpacity(),onedit:e=>i.SetInitOpacity(e)},{name:t+".grow-rate.name",value:i.GetGrowRate(),onedit:e=>i.SetGrowRate(e)},{name:t+".x-randomiser.name",value:i.GetInitXRandom(),onedit:e=>i.SetInitXRandom(e)},{name:t+".y-randomiser.name",value:i.GetInitYRandom(),onedit:e=>i.SetInitYRandom(e)},{name:t+".initial-speed-randomiser.name",value:i.GetInitSpeedRandom(),onedit:e=>i.SetInitSpeedRandom(e)},{name:t+".size-randomiser.name",value:i.GetInitSizeRandom(),onedit:e=>i.SetInitSizeRandom(e)},{name:t+".grow-rate-randomiser.name",value:i.GetGrowRandom(),onedit:e=>i.SetGrowRandom(e)},{name:t+".acceleration.name",value:i.GetAcceleration(),onedit:e=>i.SetAcceleration(e)},{name:t+".gravity.name",value:i.GetGravity(),onedit:e=>i.SetGravity(e)},{name:t+".angle-randomiser.name",value:i.GetLifeAngleRandom(),onedit:e=>i.SetLifeAngleRandom(e)},{name:t+".life-speed-randomiser.name",value:i.GetLifeSpeedRandom(),onedit:e=>i.SetLifeSpeedRandom(e)},{name:t+".opacity-randomiser.name",value:i.GetLifeOpacityRandom(),onedit:e=>i.SetLifeOpacityRandom(e)},{name:t+".timeout.name",value:i.GetTimeout(),onedit:e=>i.SetTimeout(e)}]}]}GetScriptInterfaceClass(){return self.IParticlesInstance}},new WeakMap);self.IParticlesInstance=class IParticlesInstance extends self.IWorldInstance{constructor(){super(),map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set isSpraying(e){GetParticleEngine2(this).SetSpraying(!!e)}get isSpraying(){return GetParticleEngine2(this).IsSpraying()}set rate(e){C3X.RequireFiniteNumber(e),map.get(this)._SetRate(e)}get rate(){return GetParticleEngine2(this).GetRate()}set sprayCone(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetSprayCone(e)}get sprayCone(){return GetParticleEngine2(this).GetSprayCone()}set initSpeed(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSpeed(e)}get initSpeed(){return GetParticleEngine2(this).GetInitSpeed()}set initSize(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSize(e)}get initSize(){return GetParticleEngine2(this).GetInitSize()}set initOpacity(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitOpacity(e)}get initOpacity(){return GetParticleEngine2(this).GetInitOpacity()}set initXRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitXRandom(e)}get initXRandom(){return GetParticleEngine2(this).GetInitXRandom()}set initYRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitYRandom(e)}get initYRandom(){return GetParticleEngine2(this).GetInitYRandom()}set initSpeedRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSpeedRandom(e)}get initSpeedRandom(){return GetParticleEngine2(this).GetInitSpeedRandom()}set initSizeRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSizeRandom(e)}get initSizeRandom(){return GetParticleEngine2(this).GetInitSizeRandom()}set initGrowRate(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetGrowRate(e)}get initGrowRate(){return GetParticleEngine2(this).GetGrowRate()}set initGrowRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetGrowRandom(e)}get initGrowRandom(){return GetParticleEngine2(this).GetGrowRandom()}set acceleration(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetAcceleration(e)}get acceleration(){return GetParticleEngine2(this).GetAcceleration()}set gravity(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetGravity(e)}get gravity(){return GetParticleEngine2(this).GetGravity()}set lifeAngleRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeAngleRandom(e)}get lifeAngleRandom(){return GetParticleEngine2(this).GetLifeAngleRandom()}set lifeSpeedRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeSpeedRandom(e)}get lifeSpeedRandom(){return GetParticleEngine2(this).GetLifeSpeedRandom()}set lifeOpacityRandom(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeOpacityRandom(e)}get lifeOpacityRandom(){return GetParticleEngine2(this).GetLifeOpacityRandom()}set timeout(e){C3X.RequireFiniteNumber(e),GetParticleEngine2(this).SetTimeout(e)}get timeout(){return GetParticleEngine2(this).GetTimeout()}fastForward(e){C3X.RequireFiniteNumber(e),map.get(this)._FastForward(e)}setParticleObjectClass(e){var t=map.get(this);e?t._SetParticleObjectClass(t.GetRuntime()._UnwrapIObjectClass(e)):t._SetParticleObjectClass(null)}}}{let C33=self.C3;C33.Plugins.Particles.Cnds={IsSpraying(){return this._particleEngine.IsSpraying()}}}{let C33=self.C3;C33.Plugins.Particles.Acts={SetSpraying(e){this._particleEngine.SetSpraying(0!==e)},SetRate(e){this._SetRate(e)},SetParticleObject(e){this._SetParticleObjectClass(e)},UnsetParticleObject(){this._SetParticleObjectClass(null)},SetSprayCone(e){this._particleEngine.SetSprayCone(C33.toRadians(e))},SetInitSpeed(e){this._particleEngine.SetInitSpeed(e)},SetInitSize(e){this._particleEngine.SetInitSize(e)},SetInitOpacity(e){this._particleEngine.SetInitOpacity(e/100)},SetGrowRate(e){this._particleEngine.SetGrowRate(e)},SetXRandomiser(e){this._particleEngine.SetInitXRandom(e)},SetYRandomiser(e){this._particleEngine.SetInitYRandom(e)},SetSpeedRandomiser(e){this._particleEngine.SetInitSpeedRandom(e)},SetSizeRandomiser(e){this._particleEngine.SetInitSizeRandom(e)},SetGrowRateRandomiser(e){this._particleEngine.SetGrowRandom(e)},SetParticleAcc(e){this._particleEngine.SetAcceleration(e)},SetGravity(e){this._particleEngine.SetGravity(e)},SetAngleRandomiser(e){this._particleEngine.SetLifeAngleRandom(e)},SetLifeSpeedRandomiser(e){this._particleEngine.SetLifeSpeedRandom(e)},SetOpacityRandomiser(e){this._particleEngine.SetLifeOpacityRandom(e)},SetTimeout(e){this._particleEngine.SetTimeout(e)},FastForward(e){this._FastForward(e)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{let C33=self.C3;C33.Plugins.Particles.Exps={ParticleCount(){return this._particleEngine.GetParticleCount()},Rate(){return this._particleEngine.GetRate()},SprayCone(){return C33.toDegrees(this._particleEngine.GetSprayCone())},InitSpeed(){return this._particleEngine.GetInitSpeed()},InitSize(){return this._particleEngine.GetInitSize()},InitOpacity(){return 100*this._particleEngine.GetInitOpacity()},InitGrowRate(){return this._particleEngine.GetGrowRate()},XRandom(){return this._particleEngine.GetInitXRandom()},YRandom(){return this._particleEngine.GetInitYRandom()},InitSizeRandom(){return this._particleEngine.GetInitSizeRandom()},InitSpeedRandom(){return this._particleEngine.GetInitSpeedRandom()},InitGrowRandom(){return this._particleEngine.GetGrowRandom()},ParticleAcceleration(){return this._particleEngine.GetAcceleration()},Gravity(){return this._particleEngine.GetGravity()},ParticleAngleRandom(){return this._particleEngine.GetLifeAngleRandom()},ParticleSpeedRandom(){return this._particleEngine.GetLifeSpeedRandom()},ParticleOpacityRandom(){return this._particleEngine.GetLifeOpacityRandom()},Timeout(){return this._particleEngine.GetTimeout()}}}{let C33=self.C3,inactiveParticles=[],MAX_RECYCLE_PARTICLES=1e3,VALID_SPRAY_TYPES=new Set(["continuous-spray","one-shot"]),DESTROY_MODES=["fade-to-invisible","timeout-expired","particle-stopped"],tempRect=C33.New(C33.Rect);self.ParticleEngine=class ParticleEngine{constructor(){this._rate=0,this._sprayCone=0,this._sprayType="continuous-spray",this._isSpraying=!1,this._masterOpacity=0,this._isPixelRounding=!1,this._spawnX=0,this._spawnY=0,this._spawnAngle=0,this._initSpeed=0,this._initSize=0,this._initSizeScale=1,this._initOpacity=0,this._growRate=0,this._xRandom=0,this._yRandom=0,this._initSpeedRandom=0,this._initSizeRandom=0,this._growRandom=0,this._acceleration=0,this._gravity=0,this._lifeAngleRandom=0,this._lifeSpeedRandom=0,this._lifeOpacityRandom=0,this._destroyMode=0,this._timeout=0,this._createCounter=0,this._particleScale=1,this.ononeshotfinish=null,this.onparticlecreate=null,this._particles=[],this._boundingBox=new C33.Rect,this._color=new C33.Color}Release(){this.Cancel(),C33.clearArray(this._particles),this._particles=null,this.ononeshotfinish=null,this.onparticlecreate=null,this._boundingBox=null,this._color=null}Cancel(){var r=this._particles;for(let e=0,t=r.length;e<t;++e)r[e].Destroy();C33.appendArray(inactiveParticles,r),C33.clearArray(r),inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES),this._isSpraying=!1}CreateOneShotSpray(){for(let e=0,t=this._rate;e<t;++e)this._CreateParticle();this._particles.length&&(this._isSpraying=!0)}_CreateParticle(e=!0){let t=null;return inactiveParticles.length?(t=inactiveParticles.pop()).SetEngine(this):t=C33.New(self.Particle,this),this._particles.push(t),e?t.Init(this.onparticlecreate):t.Init(),t}ReInitAllParticles(){var r=this._particles,i=this.onparticlecreate;for(let e=0,t=r.length;e<t;++e)r[e].Init(i)}UpdateAllParticlesUserData(){var r=this._particles,i=this.onparticlecreate;for(let e=0,t=r.length;e<t;++e)r[e].UpdateUserData(i)}ApplyParticleDataToUserData(r){var i=this._particles;for(let e=0,t=i.length;e<t;++e){var s=i[e],a=s.GetUserData();a&&((a=a.GetWorldInfo()).SetX(s.GetX()),a.SetY(s.GetY()),a.SetSize(s.GetSize(),s.GetSize()),a.SetOpacity(s.GetOpacity()),a.SetAngle(s.GetAngle()),a.SetUnpremultipliedColor(r.GetWorldInfo().GetUnpremultipliedColor()),a.SetBboxChanged())}}SetParticleCount(e,t=!0){var r=this._particles;if(e<r.length){var i=r.length-e;for(let e=0;e<i;++e){var s=r.pop();s.Destroy(),inactiveParticles.push(s)}inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES)}else if(e>r.length){var a=e-r.length;for(let e=0;e<a;++e)this._CreateParticle(t)}}GetParticles(){return this._particles}GetParticleCount(){return this._particles.length}Tick(e){this._SpawnContinuous(e),this._TickParticles(e),this._MaybeFinishOneShot()}_SpawnContinuous(e){if("continuous-spray"===this._sprayType&&this._isSpraying){this._createCounter+=e*this._rate;var t=Math.floor(this._createCounter);this._createCounter-=t;for(let e=0;e<t;++e)this._CreateParticle()}}_SetCreateCounter(e){this._createCounter=e}_GetCreateCounter(){return this._createCounter}_TickParticles(r){var i=this._boundingBox,s=(i.set(this._spawnX,this._spawnY,this._spawnX,this._spawnY),this._particles);let a=0;for(let e=0,t=s.length;e<t;++e){var n=s[e];(s[a]=n).Tick(r),n.IsActive()?(++a,i.expandToContain(n.GetBoundingBox())):(n.Destroy(),inactiveParticles.push(n))}C33.truncateArray(s,a),inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES)}_MaybeFinishOneShot(){"one-shot"===this._sprayType&&0===this._particles.length&&this._isSpraying&&(this.ononeshotfinish&&this.ononeshotfinish(),this._isSpraying=!1)}Draw(r,i,s,a){tempRect.set(i.getTlx(),i.getTly(),i.getBrx(),i.getBry()),r.StartRenderingPoints(tempRect),this._color.copy(r.GetColor());var n=this._particles;for(let e=0,t=n.length;e<t;++e){var o=n[e];s.intersectsRect(o.GetBoundingBox())&&o.Draw(r,i,a)}r.FinishRenderingPoints()}GetColor(){return this._color}SetRate(e){this._rate=+e}GetRate(){return this._rate}SetSprayCone(e){this._sprayCone=+e}GetSprayCone(){return this._sprayCone}SetSprayType(e){if(!VALID_SPRAY_TYPES.has(e))throw new Error("invalid spray type");this._sprayType=e}GetSprayType(){return this._sprayType}SetSpraying(e){this._isSpraying=!!e}IsSpraying(){return this._isSpraying}SetMasterOpacity(e){this._masterOpacity=+e}GetMasterOpacity(){return this._masterOpacity}SetPixelRounding(e){this._isPixelRounding=!!e}IsPixelRounding(){return this._isPixelRounding}SetSpawnX(e){this._spawnX=+e}GetSpawnX(){return this._spawnX}SetSpawnY(e){this._spawnY=+e}GetSpawnY(){return this._spawnY}SetSpawnAngle(e){this._spawnAngle=+e}GetInitAngle(){return this._spawnAngle}SetInitSpeed(e){this._initSpeed=+e}GetInitSpeed(){return this._initSpeed}SetInitSize(e){this._initSize=+e}GetInitSize(){return this._initSize}SetInitSizeScale(e){this._initSizeScale=+e}GetInitSizeScale(){return this._initSizeScale}SetInitOpacity(e){this._initOpacity=+e}GetInitOpacity(){return this._initOpacity}SetGrowRate(e){this._growRate=+e}GetGrowRate(){return this._growRate}SetInitXRandom(e){this._xRandom=+e}GetInitXRandom(){return this._xRandom}SetInitYRandom(e){this._yRandom=+e}GetInitYRandom(){return this._yRandom}SetInitSpeedRandom(e){this._initSpeedRandom=+e}GetInitSpeedRandom(){return this._initSpeedRandom}SetInitSizeRandom(e){this._initSizeRandom=+e}GetInitSizeRandom(){return this._initSizeRandom}SetGrowRandom(e){this._growRandom=+e}GetGrowRandom(){return this._growRandom}SetAcceleration(e){this._acceleration=+e}GetAcceleration(){return this._acceleration}SetGravity(e){this._gravity=+e}GetGravity(){return this._gravity}SetLifeAngleRandom(e){this._lifeAngleRandom=+e}GetLifeAngleRandom(){return this._lifeAngleRandom}SetLifeSpeedRandom(e){this._lifeSpeedRandom=+e}GetLifeSpeedRandom(){return this._lifeSpeedRandom}SetLifeOpacityRandom(e){this._lifeOpacityRandom=+e}GetLifeOpacityRandom(){return this._lifeOpacityRandom}SetDestroyMode(e){e=DESTROY_MODES.indexOf(e);if(-1===e)throw new Error("invalid destroy mode");this._destroyMode=e}SetDestroyModeIndex(e){this.SetDestroyMode(DESTROY_MODES[e])}GetDestroyMode(){return DESTROY_MODES[this._destroyMode]}GetDestroyModeIndex(){return this._destroyMode}SetTimeout(e){this._timeout=+e}GetTimeout(){return this._timeout}SetParticleScale(e){this._particleScale=+e}GetParticleScale(){return this._particleScale}GetBoundingBox(){return this._boundingBox}}}{let randomOffset2=function(e){return Math.random()*e-e/2},C33=(randomOffset=randomOffset2,self.C3),ParticleEngine=self.ParticleEngine,tmpQuad=new C33.Quad,tmpColor=new C33.Color,DPR=self.devicePixelRatio||1,didChangeColor=!1;self.Particle=class Particle{constructor(e){this._engine=e,this._isActive=!1,this._x=0,this._y=0,this._speed=0,this._angle=0,this._opacity=1,this._lastOpacity=0,this._grow=0,this._size=0,this._halfSize=0,this._gs=0,this._age=0,this._bbox=new C33.Rect,this._userData=null,this._userDataUid=NaN,this._updateCallback=null,this._destroyCallback=null}SetEngine(e){this._engine=e}Init(e){var t=this._engine;this._isActive=!0,this._x=t.GetSpawnX()+randomOffset2(t.GetInitXRandom()),this._y=t.GetSpawnY()+randomOffset2(t.GetInitYRandom()),this._speed=t.GetInitSpeed()+randomOffset2(t.GetInitSpeedRandom()),this._angle=t.GetInitAngle()+randomOffset2(t.GetSprayCone()),this._opacity=t.GetInitOpacity(),this._lastOpacity=this._opacity,this._size=(t.GetInitSize()+randomOffset2(t.GetInitSizeRandom()))*t.GetInitSizeScale(),this._halfSize=this._size/2,this._grow=t.GetGrowRate()+randomOffset2(t.GetGrowRandom()),this._gs=0,this._age=0,this._UpdateBoundingBox(),e?this._userData||(this._userData=e(this)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}UpdateUserData(e){e?this._userData&&!this._userData.IsDestroyed()||(this._userData=e(this,this._userDataUid)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}SetUpdateCallback(e){this._updateCallback=e}SetDestroyCallback(e){this._destroyCallback=e}Destroy(){var e=this._destroyCallback;e&&e(this._userData),this._userData=null,this._updateCallback=null,this._destroyCallback=null}toJSON(){let e;return this._userData&&this._userData.GetWorldInfo()&&(e=this._userData.GetWorldInfo().GetInstance().GetUID()),[this._x,this._y,this._speed,this._angle,this._opacity,this._grow,this._size,this._gs,this._age,e]}setFromJSON(e){this._x=e[0],this._y=e[1],this._speed=e[2],this._angle=e[3],this._opacity=e[4],this._lastOpacity=this._opacity,this._grow=e[5],this._size=e[6],this._gs=e[7],this._age=e[8],this._userDataUid=e[9],this._halfSize=this._size/2,this._UpdateBoundingBox()}Tick(e){var t=this._engine,r=this._speed*e,i=this._angle,s=Math.cos(i)*r,i=Math.sin(i)*r+this._gs*e,r=(this._x+=s,this._y+=i,this._grow*e),a=(this._size+=r,this._halfSize=this._size/2,this._speed+=t.GetAcceleration()*e,this._gs+=t.GetGravity()*e,this._age+=e,this._UpdateBoundingBox(),t.GetLifeAngleRandom()),n=t.GetLifeSpeedRandom(),o=t.GetLifeOpacityRandom();let l=0;0!==a&&(l=randomOffset2(a*e),this._angle+=l),0!==n&&(this._speed+=randomOffset2(n*e)),0!==o&&(this._opacity=C33.clamp(this._opacity+randomOffset2(o*e),0,1));a=1<=this._size&&(2===t.GetDestroyModeIndex()?0<this._speed:this._age<t.GetTimeout()),n=this._updateCallback;if(n&&a){let e=t.GetMasterOpacity()*this._opacity;0===t.GetDestroyModeIndex()&&(e*=1-this._age/t.GetTimeout());o=e-this._lastOpacity;this._lastOpacity=e,n(this._userData,s,i,r,l,o)}this._isActive=a}IsActive(){return this._isActive}GetBoundingBox(){return this._bbox}_UpdateBoundingBox(){var e=this._x,t=this._y,r=this._halfSize;this._bbox.set(e-r,t-r,e+r,t+r)}Draw(i,s,a){if(!this._userData){var n=this._engine;let r=n.GetMasterOpacity()*this._opacity;if(0===n.GetDestroyModeIndex()&&(r*=1-this._age/n.GetTimeout()),!(r<=0)){var o=this._size,l=o*n.GetParticleScale()*DPR;if(!(l<1)){let e=this._x,t=this._y;n.IsPixelRounding()&&(e=e+.5|0,t=t+.5|0),i.IsWebGPU()?i.Point(e,t,o,r):a||l>i.GetMaxPointSize()||l<i.GetMinPointSize()?(tmpColor.copy(n.GetColor()),tmpColor.multiplyAlpha(r),i.SetColor(tmpColor),didChangeColor=!0,tmpQuad.setFromRect(this._bbox),i.Quad4(tmpQuad,s)):(didChangeColor&&(i.SetColor(n.GetColor()),didChangeColor=!1),i.Point(e,t,l,r))}}}}GetUserData(){return this._userData}GetUserDataUID(){return this._userDataUid}GetX(){return this._x}GetY(){return this._y}GetSize(){return this._size}GetAngle(){return this._angle}GetOpacity(){return this._opacity}}}{let C33=self.C3;C33.Behaviors.Tween=class TweenBehavior extends C33.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Behaviors.Tween.Type=class TweenType extends C33.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,NAMESPACE=C33.Behaviors.Tween,ENABLED=0;NAMESPACE.Instance=class TweenInstance extends C33.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._allowMultiple=!1,this._enabled=!0,t&&(this._allowMultiple=!1,this._enabled=!!t[ENABLED]),this._activeTweens=new Map,this._disabledTweens=[],this._waitingForReleaseTweens=new Map,this._finishingTween=null,this._activeTweensJson=null,this._disabledTweensJson=null,this._waitingForReleaseTweensJson=null,this._finishingTweenName="",this._triggerTweens=[],this._afterLoad=e=>this._OnAfterLoad(),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad)}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._finishingTween&&(this.ReleaseAndCompleteTween(this._finishingTween),this._finishingTween=null),this.ReleaseAndCompleteTweens(),this._tweens=null,this.ClearDisabledList(),this._disabledTweens=null,this._ReleaseWaitingTweens(),this._waitingForReleaseTweens=null,this._triggerTweens=null,super.Release()}PushTriggerTween(e){this._triggerTweens.push(e)}PopTriggerTween(){this._triggerTweens.pop()}GetTriggerTween(){return this._triggerTweens[this._triggerTweens.length-1]}SetEnabled(e){this._enabled=!!e,e?this._waitingForReleaseTweens&&this._waitingForReleaseTweens.size&&this._StartTicking2():this._StopTicking2();for(var t of this.AllTweens())e?this.IsInDisabledList(t)&&t.Resume():((t.IsPlaying()||t.IsScheduled())&&this.AddToDisabledList(t),t.Stop());e&&this.ClearDisabledList()}IsEnabled(){return this._enabled}AddToDisabledList(e){this._disabledTweens.push(e)}IsInDisabledList(e){return this._disabledTweens.includes(e)}ClearDisabledList(){C33.clearArray(this._disabledTweens)}GetFinishingTween(){return this._finishingTween}IsInstanceValid(){var e=this.GetObjectInstance();return!!e&&!e.IsDestroyed()}GetTween(e,t,r=!1){t=t?this.PropertyTweens(t,r):this.AllTweens(r);if(t&&t.length)for(var i of t)if(i.HasTags(e))return i}CheckTweensWithTags(e,t){for(var r of this._activeTweens.values())for(var i of r)if(!i.IsReleased()&&i.HasTags(e)&&t(i))return!0;for(var s of this._waitingForReleaseTweens.values())for(var a of s)if(!a.IsReleased()&&a.HasTags(e)&&t(a))return!0;return!1}CheckTweens(e){for(var t of this._activeTweens.values())for(var r of t)if(!r.IsReleased()&&e(r))return!0;for(var i of this._waitingForReleaseTweens.values())for(var s of i)if(!s.IsReleased()&&e(s))return!0;return!1}GetTweenIncludingWaitingForRelease(e,t){return this.GetTween(e,t,!0)}*GetTweens(e,t,r=!1){t=t?this.PropertyTweens(t,r):this.AllTweens(r);if(t&&t.length)for(var i of t)i.HasTags(e)&&(yield i)}*GetTweensIncludingWaitingForRelease(e,t){yield*this.GetTweens(e,t,!0)}PropertyTweens(r,e){if(e){let e=this._activeTweens.get(r),t=this._waitingForReleaseTweens.get(r);return e=e||[],t=t||[],e.concat(t).filter(e=>e).filter(e=>!e.IsReleased())}{let e=this._activeTweens.get(r);return(e=e||[]).filter(e=>e).filter(e=>!e.IsReleased())}}AllTweens(e){var t;return e?(e=[...this._activeTweens.values()].flat(),t=[...this._waitingForReleaseTweens.values()].flat(),e.concat(t).filter(e=>e).filter(e=>!e.IsReleased())):[...this._activeTweens.values()].flat().filter(e=>e).filter(e=>!e.IsReleased())}AllTweensIncludingWaitingForRelease(){return this.AllTweens(!0)}SaveToJson(e=0){return{s:!1,e:!!this._enabled,at:this._SaveActiveTweensToJson(),dt:this._SaveDisabledTweensToJson(),wt:this._SaveWaitingForReleaseTweensToJson(),ft:this._SaveFinishingTweenToJson()}}LoadFromJson(e,t="full"){e&&(this._activeTweensJson=e.at,this._disabledTweensJson=e.dt,this._waitingForReleaseTweensJson=e.wt,this._finishingTweenName=e.ft,this._allowMultiple=!1,this._enabled=!!e.e,"state"===t)&&this._OnAfterLoad()}_OnAfterLoad(){var e=this.GetRuntime().GetTimelineManager();if(this._PopulateTweenMap(this._activeTweensJson,this._activeTweens,e),this._disabledTweensJson){C33.clearArray(this._disabledTweens);for(var t of this._disabledTweensJson)this._PopulateTweenArray(this._disabledTweens,t,e)}this._PopulateTweenMap(this._waitingForReleaseTweensJson,this._waitingForReleaseTweens,e),this._finishingTween=this._GetTween(this._finishingTweenName,e),this._enabled?this._waitingForReleaseTweens&&this._waitingForReleaseTweens.size&&this._StartTicking2():this._StopTicking2()}_PopulateTweenMap(t,r,i){if(t)for(var s in t){let e=r.get(s);var a,n;e?C33.clearArray(e):e=[];for(a of t[s])this._PopulateTweenArray(e,a.name,i)?this._LoadTweenFromJson(a.name,a,i):(n=C33.TweenState.Build({runtime:this.GetRuntime(),json:a}),C33.TweenState.SetInstanceUID(n,this.GetObjectInstance().GetUID()),n.AddCompletedCallback(e=>this._FinishTriggers(e)),i.AddScheduledTimeline(n),this._PopulateTweenArray(e,n,i));r.set(s,e)}}_GetTween(e,t){return t.GetScheduledOrPlayingTimelineByName(e)}_PopulateTweenArray(e,t,r){return!("string"==typeof t&&!(t=this._GetTween(t,r))||!e.push(t))}_LoadTweenFromJson(e,t,r){"string"==typeof e?(r=this._GetTween(e,r))&&(r._LoadFromJson(t),C33.TweenState.SetInstanceUID(r,this.GetObjectInstance().GetUID())):(e._LoadFromJson(t),C33.TweenState.SetInstanceUID(e,this.GetObjectInstance().GetUID()))}_SaveActiveTweensToJson(){var e,t,r={};for([e,t]of this._activeTweens)r[e]=t.filter(e=>!e.IsReleased()).map(e=>e._SaveToJson());return r}_SaveDisabledTweensToJson(){return this._disabledTweens.filter(e=>!e.IsReleased()).map(e=>e.GetName())}_SaveWaitingForReleaseTweensToJson(){var e,t,r={};for([e,t]of this._waitingForReleaseTweens)r[e]=t.map(e=>e._SaveToJson());return r}_SaveFinishingTweenToJson(){return this._finishingTween?this._finishingTween.GetName():""}Tick2(){this._ReleaseWaitingTweens()}CreateTween(e){var t=NAMESPACE.Config.GetPropertyTracksConfig(e.property,e.startValue,e.endValue,e.ease,e.resultMode,this.GetObjectInstance()),r=NAMESPACE.Maps.GetPropertyFromIndex(e.property),r=(NAMESPACE.Maps.IsValueId(r)||this.ReleaseTweens(e.property),C33.TweenState.Build({runtime:this.GetRuntime(),id:r,tags:e.tags,time:e.time,instance:this.GetObjectInstance(),releaseOnComplete:!!e.releaseOnComplete,loop:!!e.loop,pingPong:!!e.pingPong,repeatCount:e.repeatCount,initialValueMode:e.initialValueMode,propertyTracksConfig:t}));return r.AddCompletedCallback(e=>this._FinishTriggers(e)),this._AddTween(r,e.property),r}_MaybeRemoveFromActiveTweenMap(e){var t=e.GetId();this._activeTweens.has(t)&&(t=this._activeTweens.get(t))&&-1!==(e=t.indexOf(e))&&t.splice(e,1)}ReleaseTween(e,t=!1){this._MaybeRemoveFromActiveTweenMap(e),e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(t),this._AddToWaitingList(e))}ReleaseTweens(e,t=!1){if(C33.IsFiniteNumber(e)){e=NAMESPACE.Maps.GetPropertyFromIndex(e);if(this._activeTweens.has(e)){var r,e=this._activeTweens.get(e),i=this.GetFinishingTween();for(r of e)r===i||r.IsReleased()||this._IsInWaitingList(r)||(r.Stop(t),r.Release());C33.clearArray(e)}}else{var s,a,n=this.GetFinishingTween();for(s of this.AllTweens())s===n||s.IsReleased()||this._IsInWaitingList(s)||(s.Stop(t),s.Release());for(a of this._activeTweens.keys())C33.clearArray(this._activeTweens.get(a)),this._activeTweens.delete(a);this._activeTweens.clear()}}ReleaseAndCompleteTween(e){this.ReleaseTween(e,!0)}ReleaseAndCompleteTweens(){this.ReleaseTweens(NaN,!0)}GetPropertyValueByIndex(e){if(e===ENABLED)return this._enabled}SetPropertyValueByIndex(e,t){e===ENABLED&&(this._enabled=!!t)}_GetBehaviorType(e){var t;for(t of e.GetInstance().GetBehaviorInstances()){var r=t.GetBehaviorType();if(r.GetInstanceSdkCtor()===this.constructor)return r}}Trigger(e,t,r,i){return this._runtime?super.Trigger(e):t.Trigger(e,r,i)}_FinishTriggers(e){this._finishingTween=e,NAMESPACE.Cnds.SetFinishingTween(e);let t,r;if(this.GetRuntime())t=this._inst,r=this._runtime,this.Trigger(NAMESPACE.Cnds.OnTweensFinished),this.Trigger(NAMESPACE.Cnds.OnAnyTweensFinished),this.ReleaseTween(e);else{if(!(t=e.GetInstance()))return;if(t&&t.IsDestroyed())return;r=t.GetRuntime();var i=this._GetBehaviorType(e);this.Trigger(NAMESPACE.Cnds.OnTweensFinished,r,t,i),this.Trigger(NAMESPACE.Cnds.OnAnyTweensFinished,r,t,i),e.Stop()}this._finishingTween=null,NAMESPACE.Cnds.SetFinishingTween(null),e.GetDestroyInstanceOnComplete()&&r.DestroyInstance(t)}_AddTween(e,t){t=NAMESPACE.Maps.GetPropertyFromIndex(t);this._activeTweens.has(t)||this._activeTweens.set(t,[]),this._activeTweens.get(t).push(e)}_AddToWaitingList(e){var t=e.GetId();this._waitingForReleaseTweens.has(t)||this._waitingForReleaseTweens.set(t,[]),this._waitingForReleaseTweens.get(t).push(e),this.IsTicking2()||this._StartTicking2()}_IsInWaitingList(e){var t=e.GetId();return!!this._waitingForReleaseTweens.has(t)&&this._waitingForReleaseTweens.get(t).includes(e)}_ReleaseWaitingTweens(){if(this._waitingForReleaseTweens.size){for(var e of this._waitingForReleaseTweens.values()){for(var t of e)t.IsReleased()||t.Release();C33.clearArray(e)}this._waitingForReleaseTweens.clear(),this.IsTicking2()&&this._StopTicking2()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.tween.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.ITweenBehaviorInstance}}}{let C33=self.C3,finishingTween=null;C33.Behaviors.Tween.Cnds={OnAnyTweenLoop(){return!0},OnTweensLoop(e){var t=this.GetTriggerTween();return!!t&&t.HasTags(e)},OnAnyTweenPingPong(e){var t=this.GetTriggerTween();return!!t&&(t.GetPingPongState()===e||2===e)},OnTweensPingPong(e,t){var r=this.GetTriggerTween();return!!r&&(r.GetPingPongState()===t||2===t)&&r.HasTags(e)},SetFinishingTween(e){finishingTween=e},OnTweensFinished(e){return finishingTween.HasTags(e)},OnAnyTweensFinished(){return!0},IsPlaying(e){return this.CheckTweensWithTags(e,C33.TweenState.IsPlaying)},IsAnyPlaying(){return this.CheckTweens(C33.TweenState.IsPlaying)},IsPaused(e){return this.CheckTweensWithTags(e,C33.TweenState.IsPaused)},IsAnyPaused(){return this.CheckTweens(C33.TweenState.IsPaused)},IsPingPong(e,t){return 0===t?this.CheckTweensWithTags(e,C33.TweenState.IsPing):1===t&&this.CheckTweensWithTags(e,C33.TweenState.IsPong)},IsAnyPingPong(e){return 0===e?this.CheckTweens(C33.TweenState.IsPing):1===e&&this.CheckTweens(C33.TweenState.IsPong)}}}{let C33=self.C3,Ease=self.Ease,NAMESPACE=C33.Behaviors.Tween;NAMESPACE.Acts={SetEnabled(e){this.SetEnabled(!!e)},async TweenOneProperty(...e){this.IsEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(NAMESPACE.TweenArguments.OneProperty(this,...e))).Play()&&await e.GetPlayPromise()},async TweenTwoProperties(...e){this.IsEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(NAMESPACE.TweenArguments.TwoProperties(this,...e))).Play()&&await e.GetPlayPromise()},async TweenValue(...e){this.IsEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(NAMESPACE.TweenArguments.ValueProperty(this,...e))).Play()&&await e.GetPlayPromise()},PauseTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.GetTweens(e))t.Stop()},PauseAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(var e of this.AllTweens())e.Stop()},ResumeTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.GetTweens(e))t.Resume()},ResumeAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(var e of this.AllTweens())e.Resume()},StopTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.GetTweens(e))this.ReleaseTween(t)},StopAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(var e of this.AllTweens())this.ReleaseTween(e)},SetOnePropertyTweensEndValue(e,t,r){if(this.IsEnabled()&&this.IsInstanceValid()){var i,s=C33.Behaviors.Tween.Maps.GetSinglePropertyFromIndex(t);for(i of this.GetTweens(e))i.BeforeSetEndValues([s]),i.SetEndValue(r,s)}},SetTwoPropertiesTweensEndValue(e,t,r,i){if(this.IsEnabled()&&this.IsInstanceValid()){var s,a=C33.Behaviors.Tween.Maps.GetRealProperties(t);for(s of this.GetTweens(e))s.BeforeSetEndValues(a),s.SetEndValue(r,a[0]),s.SetEndValue(i,a[1])}},SetValuePropertyTweensStartValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(var r of this.GetTweens(e,"value"))r.SetStartValue(t,"value")},SetValuePropertyTweensEndValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(var r of this.GetTweens(e,"value"))r.BeforeSetEndValues(["value"]),r.SetEndValue(t,"value")},SetTweensEase(e,t){if(this.IsEnabled()&&this.IsInstanceValid()){var r,i=Ease.GetEaseFromIndex(t);for(r of this.GetTweens(e))r.SetEase(i)}},SetAllTweensEase(e){if(this.IsEnabled()&&this.IsInstanceValid()){var t,r=Ease.GetEaseFromIndex(e);for(t of this.AllTweens())t.SetEase(r)}},SetTweensTime(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(var r of this.GetTweens(e))r.SetTime(t)},SetAllTweensTime(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.AllTweens())t.SetTime(e)},SetTweensPlaybackRate(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(var r of this.GetTweens(e))r.SetPlaybackRate(t)},SetAllTweensPlaybackRate(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.AllTweens())t.SetPlaybackRate(e)},SetTweensDestroyOnComplete(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(var r of this.GetTweens(e))r.SetDestroyInstanceOnComplete(!!t)},SetAllTweensDestroyOnComplete(e){if(this.IsEnabled()&&this.IsInstanceValid())for(var t of this.AllTweens())t.SetDestroyInstanceOnComplete(!!e)}}}{let C33=self.C3;C33.Behaviors.Tween.Exps={Time(e){e=this.GetTweenIncludingWaitingForRelease(e);return e?e.GetTime():0},Progress(e){e=this.GetTweenIncludingWaitingForRelease(e);return e?e.GetTime()/e.GetTotalTime():0},PlaybackRate(e){e=this.GetTweenIncludingWaitingForRelease(e);return e?e.GetPlaybackRate():0},Value(e){e=this.GetTweenIncludingWaitingForRelease(e,"value");return e?e.GetPropertyTrack("value").GetSourceAdapterValue():0},Tags(){let e=this.GetFinishingTween();return(e=e||this.GetTriggerTween())?e.GetStringTags():""}}}{let C33=self.C3,Ease=self.Ease,PAIR_PROPERTIES=["position","size","scale"],SINGLE_PROPERTIES=["offsetX","offsetY","offsetWidth","offsetHeight","offsetAngle","offsetOpacity","offsetColor","offsetZElevation","offsetScaleX","offsetScaleY"],VALUE_PROPERTIES=["value"],PROPERTY_INDEX_TO_NAME=[].concat(PAIR_PROPERTIES).concat(SINGLE_PROPERTIES).concat(VALUE_PROPERTIES),PROPERTY_PAIR_TO_REAL_PROPERTIES={position:["offsetX","offsetY"],size:["offsetWidth","offsetHeight"],scale:["offsetScaleX","offsetScaleY"]},ALL_REAL_PROPERTIES=Object.assign({},PROPERTY_INDEX_TO_NAME.reduce((e,t)=>Object.assign({},e,{[t]:[t]}),{}),PROPERTY_PAIR_TO_REAL_PROPERTIES);C33.Behaviors.Tween.Maps=class Maps{constructor(){}static GetEases(){return[...Ease.GetRuntimeEaseNames()]}static GetEaseFromIndex(e){return[...Ease.GetRuntimeEaseNames()][e]}static GetPropertyFromIndex(e){return PROPERTY_INDEX_TO_NAME[e]}static GetPropertyIndexFromName(e){return PROPERTY_INDEX_TO_NAME.indexOf(e)}static GetPairPropertyFromIndex(e){return PAIR_PROPERTIES[e]}static GetSinglePropertyFromIndex(e){return SINGLE_PROPERTIES[e]}static GetValuePropertyFromIndex(e){return VALUE_PROPERTIES[e]}static GetPairProperties(e){return PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static GetRealProperties(e){return C33.IsString(e)?ALL_REAL_PROPERTIES[e]:ALL_REAL_PROPERTIES[PROPERTY_INDEX_TO_NAME[e]]}static IsPairId(e){return!!PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static IsColorId(e){return"offsetColor"===e}static IsAngleId(e){return"offsetAngle"===e}static IsOpacityId(e){return"offsetOpacity"===e}static IsValueId(e){return"value"===e}}}{let C33=self.C3,NAMESPACE=C33.Behaviors.Tween,TWEEN_CONFIGURATIONS=new Map;NAMESPACE.Config=class Config{constructor(){}static GetPropertyTracksConfig(e,t,r,i,s,a){0===TWEEN_CONFIGURATIONS.size&&this._CreateConfigObjects();var n=NAMESPACE.PropertyTypes.Pick(e),n=TWEEN_CONFIGURATIONS.get(n);return C33.IsFiniteNumber(e)&&(e=NAMESPACE.Maps.GetPropertyFromIndex(e)),this._GetConfig(n,e,t,r,i,s,a)}static TransformValue(e,t){return C33.Behaviors.Tween.GetPropertyTracksConfig(e).valueGetter(t)}static _CreateConfigObjects(){var e=NAMESPACE.PropertyTypes,t=NAMESPACE.ValueGetters;this._AddConfigObject(e.PAIR,this._GetPairConfig,t._GetPropertyValue),this._AddConfigObject(e.COLOR,this._GetColorConfig,t._GetColorPropertyValue),this._AddConfigObject(e.ANGLE,this._GetAngleConfig,t._GetPropertyAngleValue),this._AddConfigObject(e.VALUE,this._GetValueConfig,t._GetPropertyValue),this._AddConfigObject(e.OTHER,this._GetCommonConfig,t._GetPropertyValue)}static _AddConfigObject(e,t,r){TWEEN_CONFIGURATIONS.set(e,this._CreateConfigObject(e,t,r))}static _CreateConfigObject(e,t,r){return{name:e,configFunc:t,valueGetter:r}}static _GetConfig(e,t,r,i,s,a,n){return e.configFunc(t,e.valueGetter(r),e.valueGetter(i),s,a,n)}static _GetPairConfig(e,r,i,s,a,t){return NAMESPACE.Maps.GetPairProperties(e).map((e,t)=>({sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:r[t],endValue:i[t],ease:NAMESPACE.Maps.GetEaseFromIndex(s),resultMode:a}))}static _GetColorConfig(e,t,r,i,s,a){return C33.Plugins.Text&&a.GetPlugin()instanceof C33.Plugins.Text?{sourceId:"plugin",sourceArgs:[7],property:"color",type:"color",valueType:"color",startValue:t,endValue:r,ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:s}:{sourceId:"world-instance",property:e,type:"color",valueType:"color",startValue:t,endValue:r,ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:s}}static _GetAngleConfig(e,t,r,i,s,a){return{sourceId:"world-instance",property:e,type:"angle",valueType:"angle",startValue:t,endValue:r,ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:s}}static _GetCommonConfig(e,t,r,i,s,a){return{sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:t,endValue:r,ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:s}}static _GetValueConfig(e,t,r,i,s,a){return{sourceId:"value",property:e,type:"float",valueType:"numeric",startValue:t,endValue:r,ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:s}}}}{let C33=self.C3,NAMESPACE=C33.Behaviors.Tween,COMMON_FIXED_ARGS={resultMode:"absolute"},COMMON_VARIABLE_ARGS=Object.assign({},COMMON_FIXED_ARGS,{tags:"",property:"",time:0,ease:0,releaseOnComplete:0,loop:!1,pingPong:!1,repeatCount:1}),ONE_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:0,endValue:0}),TWO_PROPERTIES_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0],endValue:[0,0]}),COLOR_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0,0],endValue:[0,0,0]}),VALUE_PROPERTY_ARGS=Object.assign({},ONE_PROPERTY_ARGS,{initialValueMode:"start-value"}),X=0,Y=1,R=0,G=1,B=2;NAMESPACE.TweenArguments=class TweenArguments{constructor(){}static _SetCommonProperties(e,t,r,i,s,a,n,o){e.tags=t,e.time=r,e.ease=i,e.releaseOnComplete=s,e.loop=a,e.pingPong=n,e.repeatCount=o}static OneProperty(e,t,r,i,s,a,n,o,l,h){var r="string"==typeof r?r:NAMESPACE.Maps.GetSinglePropertyFromIndex(r),u=NAMESPACE.Maps.IsColorId(r)?COLOR_PROPERTY_ARGS:ONE_PROPERTY_ARGS;return this._SetCommonProperties(u,t,s,a,n,o,l,h),NAMESPACE.Maps.IsColorId(r)?(COLOR_PROPERTY_ARGS.endValue[R]=C33.GetRValue(i),COLOR_PROPERTY_ARGS.endValue[G]=C33.GetGValue(i),COLOR_PROPERTY_ARGS.endValue[B]=C33.GetBValue(i),COLOR_PROPERTY_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName(r)):NAMESPACE.Maps.IsOpacityId(r)?ONE_PROPERTY_ARGS.endValue=i/100:ONE_PROPERTY_ARGS.endValue=i,u.property=NAMESPACE.Maps.GetPropertyIndexFromName(r),u}static TwoProperties(e,t,r,i,s,a,n,o,l,h,u){this._SetCommonProperties(TWO_PROPERTIES_ARGS,t,a,n,o,l,h,u);t="string"==typeof r?r:NAMESPACE.Maps.GetPairPropertyFromIndex(r);return TWO_PROPERTIES_ARGS.endValue[X]=i,TWO_PROPERTIES_ARGS.endValue[Y]=s,TWO_PROPERTIES_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName(t),TWO_PROPERTIES_ARGS}static ValueProperty(e,t,r,i,s,a,n,o,l,h){return this._SetCommonProperties(VALUE_PROPERTY_ARGS,t,s,a,n,o,l,h),VALUE_PROPERTY_ARGS.startValue=r,VALUE_PROPERTY_ARGS.endValue=i,VALUE_PROPERTY_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName("value"),VALUE_PROPERTY_ARGS}}}{let C33=self.C3,NAMESPACE=C33.Behaviors.Tween,TYPE_CHECK_OBJECTS=[];NAMESPACE.PropertyTypes=class PropertyTypes{constructor(){}static Pick(e){var t,r;0===TYPE_CHECK_OBJECTS.length&&((t=TYPE_CHECK_OBJECTS).push({checkFunc:NAMESPACE.Maps.IsPairId,result:this.PAIR}),t.push({checkFunc:NAMESPACE.Maps.IsColorId,result:this.COLOR}),t.push({checkFunc:NAMESPACE.Maps.IsAngleId,result:this.ANGLE}),t.push({checkFunc:NAMESPACE.Maps.IsValueId,result:this.VALUE}),t.push({checkFunc:()=>!0,result:this.OTHER})),C33.IsFiniteNumber(e)&&(e=C33.Behaviors.Tween.Maps.GetPropertyFromIndex(e));for(r of TYPE_CHECK_OBJECTS)if(r.checkFunc(e))return r.result}static get PAIR(){return"pair"}static get COLOR(){return"color"}static get ANGLE(){return"angle"}static get VALUE(){return"value"}static get OTHER(){return"other"}}}{let C33=self.C3,NAMESPACE=C33.Behaviors.Tween;NAMESPACE.ValueGetters=class ValueGetters{constructor(){}static _GetPropertyAngleValue(e){e=C33.toRadians(parseFloat(e));return C33.clampAngle(e)}static _GetColorPropertyValue(e){return e.slice(0)}static _GetPropertyValue(e){return e}}}{let getIndexForEase2=function(e){C3X.RequireString(e);var t=Ease.ToInternal(e);let r;if(-1===(r=t?Ease.GetIndexForEase(t,null):Ease.GetIndexForEase(e,null)))throw new Error(`invalid ease name '${e}'`);return r},ValidateTags2=function(e,t=!1){if(!(t&&null==e||"string"==typeof e||Array.isArray(e)))throw new Error("invalid tags")},C33=(getIndexForEase=getIndexForEase2,ValidateTags=ValidateTags2,self.C3),C3X=self.C3X,IBehaviorInstance=self.IBehaviorInstance,Ease=self.Ease,NAMESPACE=C33.Behaviors.Tween,map=new WeakMap,TWEEN_PROPERTIES=new Map([["x",{name:"offsetX",type:"one"}],["y",{name:"offsetY",type:"one"}],["width",{name:"offsetWidth",type:"one"}],["height",{name:"offsetHeight",type:"one"}],["angle",{name:"offsetAngle",type:"one"}],["opacity",{name:"offsetOpacity",type:"one"}],["color",{name:"offsetColor",type:"color"}],["z-elevation",{name:"offsetZElevation",type:"one"}],["x-scale",{name:"offsetScaleX",type:"one"}],["y-scale",{name:"offsetScaleY",type:"one"}],["position",{name:"position",type:"two"}],["size",{name:"size",type:"two"}],["scale",{name:"scale",type:"two"}],["value",{name:"value",type:"value"}]]),TWEEN_OPTS={tags:"",destroyOnComplete:!1,loop:!1,pingPong:!1,repeatCount:1,startValue:0},I_TWEEN_OPTS={easeToIndexFunc:getIndexForEase2};self.ITweenBehaviorInstance=class ITweenBehaviorInstance extends IBehaviorInstance{constructor(){super(),map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}startTween(e,t,r,i,s){var a=map.get(this);if(!a.IsEnabled()||!a.IsInstanceValid())return null;var n=TWEEN_PROPERTIES.get(e);if(!n)throw new Error("invalid tween property");"one"===n.type||"value"===n.type?C3X.RequireNumber(t):(C3X.RequireArray(t),"two"===n.type?(C3X.RequireNumber(t[0]),C3X.RequireNumber(t[1])):"color"===n.type&&(C3X.RequireNumber(t[0]),C3X.RequireNumber(t[1]),C3X.RequireNumber(t[2]))),"angle"===e?t=C33.toDegrees(t):"opacity"===e?t*=100:"color"===e&&(t=C33.PackRGBEx(t[0],t[1],t[2]));e=getIndexForEase2(i);C3X.RequireFiniteNumber(r),s=Object.assign({},TWEEN_OPTS,s),"value"===n.type&&C3X.RequireNumber(s.startValue),ValidateTags2(s.tags,!0);let o;if("one"===n.type||"color"===n.type?o=a.CreateTween(NAMESPACE.TweenArguments.OneProperty(a,s.tags,n.name,t,r,e,!!s.destroyOnComplete,!!s.loop,!!s.pingPong,s.repeatCount)):"two"===n.type?o=a.CreateTween(NAMESPACE.TweenArguments.TwoProperties(a,s.tags,n.name,t[0],t[1],r,e,!!s.destroyOnComplete,!!s.loop,!!s.pingPong,s.repeatCount)):"value"===n.type&&(o=a.CreateTween(NAMESPACE.TweenArguments.ValueProperty(a,s.tags,s.startValue,t,r,e,!!s.destroyOnComplete,!!s.loop,!!s.pingPong,s.repeatCount))),o.Play())return o.GetITweenState(a,I_TWEEN_OPTS);throw new Error("failed to start tween")}*allTweens(){var e,t=map.get(this);for(e of t.AllTweens())yield e.GetITweenState(t,I_TWEEN_OPTS)}*tweensByTags(e){ValidateTags2(e);var t,r=map.get(this);for(t of r.GetTweens(e))yield t.GetITweenState(r,I_TWEEN_OPTS)}get isEnabled(){return map.get(this).IsEnabled()}set isEnabled(e){map.get(this).SetEnabled(e)}}}{let C33=self.C3;C33.Behaviors.Sin=class SinBehavior extends C33.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Behaviors.Sin.Type=class SinType extends C33.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let C33=self.C3,C3X=self.C3X,IBehaviorInstance=self.IBehaviorInstance,MOVEMENT=0,WAVE=1,PERIOD=2,PERIOD_RANDOM=3,PERIOD_OFFSET=4,PERIOD_OFFSET_RANDOM=5,MAGNITUDE=6,MAGNITUDE_RANDOM=7,ENABLE=8,HORIZONTAL=0,VERTICAL=1,SIZE=2,WIDTH=3,HEIGHT=4,ANGLE=5,OPACITY=6,VALUE=7,FORWARDS_BACKWARDS=8,ZELEVATION=9,SINE=0,TRIANGLE=1,SAWTOOTH=2,REVERSE_SAWTOOTH=3,SQUARE=4,_2pi=2*Math.PI,_pi_2=Math.PI/2,_3pi_2=3*Math.PI/2,MOVEMENT_LOOKUP=[0,1,8,3,4,2,5,6,9,7],map=(C33.Behaviors.Sin.Instance=class SinInstance extends C33.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._i=0,this._movement=0,this._wave=0,this._period=0,this._mag=0,this._isEnabled=!0,this._basePeriod=0,this._basePeriodOffset=0,this._baseMag=0,this._periodRandom=0,this._periodOffsetRandom=0,this._magnitudeRandom=0,this._initialValue=0,this._initialValue2=0,this._lastKnownValue=0,this._lastKnownValue2=0,this._ratio=0,t&&(this._movement=MOVEMENT_LOOKUP[t[MOVEMENT]],this._wave=t[WAVE],this._periodRandom=this._runtime.Random()*t[PERIOD_RANDOM],this._basePeriod=t[PERIOD],this._period=t[PERIOD],this._period+=this._periodRandom,this._basePeriodOffset=t[PERIOD_OFFSET],0!==this._period&&(this._periodOffsetRandom=this._runtime.Random()*t[PERIOD_OFFSET_RANDOM],this._i=t[PERIOD_OFFSET]/this._period*_2pi,this._i+=this._periodOffsetRandom/this._period*_2pi),this._magnitudeRandom=this._runtime.Random()*t[MAGNITUDE_RANDOM],this._baseMag=t[MAGNITUDE],this._mag=t[MAGNITUDE],this._mag+=this._magnitudeRandom,this._isEnabled=!!t[ENABLE]),this._movement===ANGLE&&(this._mag=C33.toRadians(this._mag)),this.Init(),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{i:this._i,e:this._isEnabled,mv:this._movement,w:this._wave,p:this._period,mag:this._mag,iv:this._initialValue,iv2:this._initialValue2,r:this._ratio,lkv:this._lastKnownValue,lkv2:this._lastKnownValue2}}LoadFromJson(e){this._i=e.i,this._SetEnabled(e.e),this._movement=e.mv,this._wave=e.w,this._period=e.p,this._mag=e.mag,this._initialValue=e.iv,this._initialValue2=e.iv2,this._ratio=e.r,this._lastKnownValue=e.lkv,this._lastKnownValue2=e.lkv2}Init(){var e=this._inst.GetWorldInfo();switch(this._movement){case HORIZONTAL:this._initialValue=e.GetX();break;case VERTICAL:this._initialValue=e.GetY();break;case SIZE:this._initialValue=e.GetWidth(),this._ratio=e.GetHeight()/e.GetWidth();break;case WIDTH:this._initialValue=e.GetWidth();break;case HEIGHT:this._initialValue=e.GetHeight();break;case ANGLE:this._initialValue=e.GetAngle();break;case OPACITY:this._initialValue=e.GetOpacity();break;case VALUE:this._initialValue=0;break;case FORWARDS_BACKWARDS:this._initialValue=e.GetX(),this._initialValue2=e.GetY();break;case ZELEVATION:this._initialValue=e.GetZElevation()}this._lastKnownValue=this._initialValue,this._lastKnownValue2=this._initialValue2}WaveFunc(e){switch(e%=_2pi,this._wave){case SINE:return Math.sin(e);case TRIANGLE:return e<=_pi_2?e/_pi_2:e<=_3pi_2?1-2*(e-_pi_2)/Math.PI:(e-_3pi_2)/_pi_2-1;case SAWTOOTH:return 2*e/_2pi-1;case REVERSE_SAWTOOTH:return-2*e/_2pi+1;case SQUARE:return e<Math.PI?-1:1}return 0}Tick(){var e=this._runtime.GetDt(this._inst);this._isEnabled&&0!==e&&(0===this._period?this._i=0:this._i=(this._i+e/this._period*_2pi)%_2pi,this._UpdateFromPhase())}_UpdateFromPhase(){var e=this._inst.GetWorldInfo();switch(this._movement){case HORIZONTAL:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.SetX(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX();break;case VERTICAL:e.GetY()!==this._lastKnownValue&&(this._initialValue+=e.GetY()-this._lastKnownValue),e.SetY(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetY();break;case SIZE:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag),e.SetHeight(e.GetWidth()*this._ratio);break;case WIDTH:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case HEIGHT:e.SetHeight(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case ANGLE:e.GetAngle()!==this._lastKnownValue&&(this._initialValue=C33.clampAngle(this._initialValue+(e.GetAngle()-this._lastKnownValue))),e.SetAngle(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetAngle();break;case OPACITY:e.SetOpacity(this._initialValue+this.WaveFunc(this._i)*this._mag/100);break;case FORWARDS_BACKWARDS:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.GetY()!==this._lastKnownValue2&&(this._initialValue2+=e.GetY()-this._lastKnownValue2),e.SetX(this._initialValue+Math.cos(e.GetAngle())*this.WaveFunc(this._i)*this._mag),e.SetY(this._initialValue2+Math.sin(e.GetAngle())*this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX(),this._lastKnownValue2=e.GetY();break;case ZELEVATION:e.SetZElevation(this._initialValue+this.WaveFunc(this._i)*this._mag)}e.SetBboxChanged()}_OnSpriteFrameChanged(e,t){}_SetPeriod(e){this._period=e}_GetPeriod(){return this._period}_SetMagnitude(e){this._mag=e}_SetMagnitude_ConvertAngle(e){5===this._movement&&(e=C33.toRadians(e)),this._SetMagnitude(e)}_GetMagnitude(){return this._mag}_GetMagnitude_ConvertAngle(){let e=this._GetMagnitude();return e=5===this._movement?C33.toDegrees(e):e}_SetMovement(e){5===this._movement&&5!==e&&(this._mag=C33.toDegrees(this._mag)),this._movement=e,this.Init()}_GetMovement(){return this._movement}_SetWave(e){this._wave=e}_GetWave(){return this._wave}_SetPhase(e){this._i=C33.clamp(e,0,2*Math.PI),this._UpdateFromPhase()}_GetPhase(){return this._i}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case MOVEMENT:return this._movement;case WAVE:return this._wave;case PERIOD:return this._basePeriod;case MAGNITUDE:return this._baseMag;case ENABLE:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case MOVEMENT:this._movement=MOVEMENT_LOOKUP[t],this.Init();break;case WAVE:this._wave=t;break;case PERIOD:this._basePeriod=t,this._period=this._basePeriod+this._periodRandom,this._isEnabled||(0!==this._period?(this._i=this._basePeriodOffset/this._period*_2pi,this._i+=this._periodOffsetRandom/this._period*_2pi):this._i=0);break;case MAGNITUDE:this._baseMag=t,this._mag=this._baseMag+this._magnitudeRandom,this._movement===ANGLE&&(this._mag=C33.toRadians(this._mag));break;case ENABLE:this._isEnabled=!!t}}GetDebuggerProperties(){var e="behaviors.sin";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:e+".properties.period.name",value:this._GetPeriod(),onedit:e=>this._SetPeriod(e)},{name:e+".properties.magnitude.name",value:this._GetMagnitude_ConvertAngle(),onedit:e=>this._SetMagnitude_ConvertAngle(e)},{name:e+".debugger.value",value:this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}]}]}GetScriptInterfaceClass(){return self.ISineBehaviorInstance}},new WeakMap),VALID_MOVEMENTS=["horizontal","vertical","size","width","height","angle","opacity","value-only","forwards-backwards","z-elevation"],VALID_WAVES=["sine","triangle","sawtooth","reverse-sawtooth","square"];self.ISineBehaviorInstance=class ISineBehaviorInstance extends IBehaviorInstance{constructor(){super(),map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}set period(e){C3X.RequireFiniteNumber(e),map.get(this)._SetPeriod(e)}get period(){return map.get(this)._GetPeriod()}set magnitude(e){C3X.RequireFiniteNumber(e),map.get(this)._SetMagnitude(e)}get magnitude(){return map.get(this)._GetMagnitude()}set phase(e){map.get(this)._SetPhase(e)}get phase(){return map.get(this)._GetPhase()}set movement(e){C3X.RequireString(e);e=VALID_MOVEMENTS.indexOf(e);if(-1===e)throw new Error("invalid movement");map.get(this)._SetMovement(e)}get movement(){return VALID_MOVEMENTS[map.get(this)._GetMovement()]}set wave(e){C3X.RequireString(e);e=VALID_WAVES.indexOf(e);if(-1===e)throw new Error("invalid wave");map.get(this)._SetWave(e)}get wave(){return VALID_WAVES[map.get(this)._GetWave()]}get value(){var e=map.get(this);return e.WaveFunc(e._GetPhase())*e._GetMagnitude()}updateInitialState(){map.get(this).Init()}set isEnabled(e){map.get(this)._SetEnabled(!!e)}get isEnabled(){return map.get(this)._IsEnabled()}}}{let C33=self.C3;C33.Behaviors.Sin.Cnds={IsEnabled(){return this._IsEnabled()},CompareMovement(e){return this._GetMovement()===e},ComparePeriod(e,t){return C33.compare(this._GetPeriod(),e,t)},CompareMagnitude(e,t){return C33.compare(this._GetMagnitude_ConvertAngle(),e,t)},CompareWave(e){return this._GetWave()===e}}}{let C33=self.C3;C33.Behaviors.Sin.Acts={SetEnabled(e){this._SetEnabled(0!==e)},SetPeriod(e){this._SetPeriod(e)},SetMagnitude(e){this._SetMagnitude_ConvertAngle(e)},SetMovement(e){this._SetMovement(e)},SetWave(e){this._wave=e},SetPhase(e){var t=2*Math.PI;this._SetPhase(e*t%t)},UpdateInitialState(){this.Init()}}}{let C33=self.C3;C33.Behaviors.Sin.Exps={CyclePosition(){return this._GetPhase()/(2*Math.PI)},Period(){return this._GetPeriod()},Magnitude(){return this._GetMagnitude_ConvertAngle()},Value(){return this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}}}{let C33=self.C3;C33.Behaviors.Platform=class PlatformBehavior extends C33.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{let C33=self.C3;C33.Behaviors.Platform.Type=class PlatformType extends C33.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let accelerate2=function(e,t,r,i,s){t*=s,r*=s;return C33.clamp(e*s+.5*i*s*s,t,r)},C33=(accelerate=accelerate2,self.C3),C3X=self.C3X,IBehaviorInstance=self.IBehaviorInstance,MAX_SPEED=0,ACCELERATION=1,DECELERATION=2,JUMP_STRENGTH=3,GRAVITY=4,MAX_FALL_SPEED=5,DOUBLE_JUMP=6,JUMP_SUSTAIN=7,DEFAULT_CONTROLS=8,ENABLE=9,FALLTHROUGH_TIMEOUT=.05,map=(C33.Behaviors.Platform.Instance=class PlatformInstance extends C33.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._keyboardDisposables=null,this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1,this._doubleJumped=!1,this._canDoubleJump=!1,this._ignoreInput=!1,this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._lastFloorObject=null,this._loadFloorUid=-1,this._lastFloorX=0,this._lastFloorY=0,this._floorIsJumpthru=!1,this._wasOnFloor=!1,this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst),this._loadJumpthruUid=-1,this._animMode="stopped",this._fallThroughTime=-1,this._isFirstTick=!0,this._dx=0,this._dy=0,this._downX=0,this._downY=0,this._rightX=0,this._rightY=0,this._g=1500,this._g1=1500,this._ga=C33.toRadians(90),this._maxSpeed=330,this._acc=1500,this._dec=1500,this._jumpStrength=650,this._maxFall=1e3,this._enableDoubleJump=!1,this._jumpSustain=0,this._sustainTime=0,this._defaultControls=!0,this._ceilingCollisionMode=0,this._isEnabled=!0,t&&(this._maxSpeed=t[MAX_SPEED],this._acc=t[ACCELERATION],this._dec=t[DECELERATION],this._jumpStrength=t[JUMP_STRENGTH],this._g=t[GRAVITY],this._maxFall=t[MAX_FALL_SPEED],this._enableDoubleJump=!!t[DOUBLE_JUMP],this._jumpSustain=t[JUMP_SUSTAIN]/1e3,this._defaultControls=!!t[DEFAULT_CONTROLS],this._isEnabled=!!t[ENABLE]);e=this._runtime.Dispatcher();this._disposables=new C33.CompositeDisposable(C33.Disposable.From(e,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),C33.Disposable.From(e,"afterload",e=>this._OnAfterLoad())),this._defaultControls&&this._BindEvents(),this._isEnabled&&this._StartPostTicking(),this._UpdateGravity()}Release(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null),this._lastFloorObject=null,this._wasOverJumpthru=null,super.Release()}_BindEvents(){var e;this._keyboardDisposables||(e=this._runtime.Dispatcher(),this._keyboardDisposables=new C33.CompositeDisposable(C33.Disposable.From(e,"keydown",e=>this._OnKeyDown(e.data)),C33.Disposable.From(e,"keyup",e=>this._OnKeyUp(e.data)),C33.Disposable.From(e,"window-blur",()=>this._OnWindowOrKeyboardBlur()),C33.Disposable.From(e,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur())))}_UnBindEvents(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null)}_OnInstanceDestroyed(e){this._lastFloorObject===e&&(this._lastFloorObject=null),this._wasOverJumpthru===e&&(this._wasOverJumpthru=null)}_OnKeyDown(e){switch(e.key){case"ArrowLeft":this._leftKey=!0;break;case"ArrowRight":this._rightKey=!0;break;case"ArrowUp":this._jumpKey=!0}}_OnKeyUp(e){switch(e.key){case"ArrowLeft":this._leftKey=!1;break;case"ArrowRight":this._rightKey=!1;break;case"ArrowUp":this._jumpKey=!1,this._jumped=!1}}_OnWindowOrKeyboardBlur(){this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1}SaveToJson(){return{ii:this._ignoreInput,lfx:this._lastFloorX,lfy:this._lastFloorY,lfo:this._lastFloorObject?this._lastFloorObject.GetUID():-1,am:this._animMode,en:this._isEnabled,fallt:this._fallThroughTime,ft:this._isFirstTick,dx:this._dx,dy:this._dy,ms:this._maxSpeed,acc:this._acc,dec:this._dec,js:this._jumpStrength,g:this._g,g1:this._g1,mf:this._maxFall,wof:this._wasOnFloor,woj:this._wasOverJumpthru?this._wasOverJumpthru.GetUID():-1,ga:this._ga,edj:this._enableDoubleJump,cdj:this._canDoubleJump,dj:this._doubleJumped,sus:this._jumpSustain,dc:this._defaultControls,cc:this._ceilingCollisionMode}}LoadFromJson(e){this._ignoreInput=e.ii,this._lastFloorX=e.lfx,this._lastFloorY=e.lfy,this._loadFloorUid=e.lfo,this._animMode=e.am;var t=e.en;this._fallThroughTime=e.fallt||-1,this._isFirstTick=e.ft,this._dx=e.dx,this._dy=e.dy,this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._jumpStrength=e.js,this._g=e.g,this._g1=e.g1,this._maxFall=e.mf,this._wasOnFloor=e.wof,this._loadJumpthruUid=e.woj,this._ga=e.ga,this._enableDoubleJump=e.edj,this._canDoubleJump=e.cdj,this._doubleJumped=e.dj,this._jumpSustain=e.sus,this._defaultControls=e.dc,this._ceilingCollisionMode=e.cc||0,this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1,this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._sustainTime=0,this._defaultControls?this._BindEvents():this._UnBindEvents(),this._SetEnabled(t),this._UpdateGravity()}_OnAfterLoad(){-1===this._loadFloorUid?this._lastFloorObject=null:this._lastFloorObject=this._runtime.GetInstanceByUID(this._loadFloorUid),-1===this._loadJumpthruUid?this._wasOverJumpthru=null:this._wasOverJumpthru=this._runtime.GetInstanceByUID(this._loadJumpthruUid)}_SetLastFloorObject(e){(this._lastFloorObject=e)&&(e=e.GetWorldInfo(),this._lastFloorX=e.GetX(),this._lastFloorY=e.GetY())}_IsFallThroughEnabled(){return this._runtime.GetGameTime()>this._fallThroughTime+FALLTHROUGH_TIMEOUT}_UpdateGravity(){this._downX=Math.cos(this._ga),this._downY=Math.sin(this._ga),this._rightX=Math.cos(this._ga-Math.PI/2),this._rightY=Math.sin(this._ga-Math.PI/2),this._downX=C33.roundToDp(this._downX,6),this._downY=C33.roundToDp(this._downY,6),this._rightX=C33.roundToDp(this._rightX,6),this._rightY=C33.roundToDp(this._rightY,6),this._g1=this._g,this._g<0&&(this._downX*=-1,this._downY*=-1,this._g=Math.abs(this._g))}_GetGDir(){return this._g<0?-1:1}_IsOnFloor(){var e=this._inst.GetWorldInfo(),s=this._runtime.GetCollisionEngine(),a=this._inst,t=this._lastFloorObject,r=e.GetX(),n=e.GetY();if(e.OffsetXY(this._downX,this._downY),e.SetBboxChanged(),!t||!s.TestOverlap(a,t)||t.GetObjectClass().HasSolidBehavior()&&!s.IsSolidCollisionAllowed(t,a)||t.GetObjectClass().HasJumpthruBehavior()&&!t._IsJumpthruEnabled()){var o=s.TestOverlapSolid(a);let i=null;if(!o&&this._IsFallThroughEnabled()&&(i=s.TestOverlapJumpthru(a,!0)),e.SetXY(r,n),e.SetBboxChanged(),o)return s.TestOverlap(a,o)?null:(this._floorIsJumpthru=!1,o);if(i&&i.length){let r=0;for(let e=0,t=i.length;e<t;++e)i[r]=i[e],s.TestOverlap(a,i[e])||++r;if(1<=r)return this._floorIsJumpthru=!0,i[0]}return null}return e.SetXY(r,n),e.SetBboxChanged(),t}PostTick(){if(this._isEnabled){var o=this._runtime.GetDt(this._inst);this._jumpKey||this._simJump||(this._jumped=!1);let r=this._leftKey||this._simLeft,i=this._rightKey||this._simRight,s=this._jumpKey||this._simJump,a=s&&!this._jumped;this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._ignoreInput&&(r=!1,i=!1,s=!1,a=!1),s||(this._sustainTime=0),this._HandleFirstTick();var[l,,h]=this._TrackMovingPlatform();let n=this._IsOnFloor();var u=n&&!this._wasOnFloor,c=!1;if([c,n]=this._MaybePushOutSolid(n),!c){this._TrackFloor(n,h,l,s),a=this._HandleJump(n,a,s),n||this._HandleAirTime(a,s,o),this._wasOnFloor=!!n;c=this._CalculateHorizontalAcceleration(r,i);let e=!1,t=0;0!==this._dx&&([e,n]=this._HandleHorizontalMovement(o,c,n,a)),0!==this._dy&&([h,l]=this._HandleVerticalMovement(o,n),e=e||h,t=l),!e&&u&&this._dy<0&&0<t&&(this._dy=0,e=!0),this._ApplyHorizontalAcceleration(r,i,c,o),n&&!a||e||(this._dy=Math.min(this._dy+this._g*o,this._maxFall)),this._HandleAnimationTriggers(n,e,a),this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst)}}}_HandleFirstTick(){var e,t;this._isFirstTick&&(e=this._inst,((t=this._runtime.GetCollisionEngine()).TestOverlapSolid(e)||t.TestOverlapJumpthru(e))&&t.PushOutSolid(e,-this._downX,-this._downY,4,!0),this._isFirstTick=!1)}_TrackMovingPlatform(){var e,t,r,i=this._lastFloorObject,s=i?i.GetWorldInfo():null;let a=0,n=0,o=!1;return i&&0===this._dy&&(s.GetY()!==this._lastFloorY||s.GetX()!==this._lastFloorX)&&(r=(i=this._inst).GetWorldInfo(),e=this._runtime.GetCollisionEngine(),t=s.GetX(),s=s.GetY(),a=t-this._lastFloorX,n=s-this._lastFloorY,r.OffsetXY(a,n),r.SetBboxChanged(),this._lastFloorX=t,this._lastFloorY=s,o=!0,r=e.TestOverlapSolid(i))&&(e.RegisterCollision(i,r),e.PushOutSolid(i,-a,-n,2.5*Math.hypot(a,n))),[a,n,o]}_MaybePushOutSolid(e){let t=!1;var r,i=this._inst,s=i.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),n=a.TestOverlapSolid(i);return n?(r=Math.abs(s.GetWidth()),s=Math.abs(s.GetHeight()),a.PushOutSolid(i,-this._downX,-this._downY,s/8)?(a.RegisterCollision(i,n),this._SetLastFloorObject(e=n),this._floorIsJumpthru=!1,this._dy=0):a.PushOutSolidAxis(i,this._rightX,this._rightY,r/2)||a.PushOutSolidAxis(i,this._downX,this._downY,s/2)||a.PushOutSolidNearest(i,Math.max(r,s)/2)?a.RegisterCollision(i,n):t=!0,[t,e]):[!1,e]}_TrackFloor(e,t,r,i){var s,a,n,o,l=this._inst,h=this._runtime.GetCollisionEngine();e?(s=this._downX,a=this._downY,n=this._rightX,o=this._rightY,this._doubleJumped=!1,this._canDoubleJump=!1,0<this._dy&&(this._wasOnFloor||(h.PushInFractional(l,-s,-a,e,16),this._wasOnFloor=!0),this._dy=0),this._lastFloorObject!==e?(this._SetLastFloorObject(e),h.RegisterCollision(l,e)):t&&(e=h.TestOverlapSolid(l))&&(h.RegisterCollision(l,e),0!==r&&(0<r?h.PushOutSolid(l,-n,-o):h.PushOutSolid(l,n,o)),h.PushOutSolid(l,-s,-a))):i||(this._canDoubleJump=!0)}_HandleJump(e,t,r){var i,s,a,n;return(e&&t||!e&&this._enableDoubleJump&&r&&this._canDoubleJump&&!this._doubleJumped)&&(i=(r=this._inst).GetWorldInfo(),s=this._runtime.GetCollisionEngine(),a=i.GetX(),n=i.GetY(),i.OffsetXY(-this._downX,-this._downY),i.SetBboxChanged(),s.TestOverlapSolid(r)?t=!1:(this._sustainTime=this._jumpSustain,this.Trigger(C33.Behaviors.Platform.Cnds.OnJump),this._animMode="jumping",this._dy=-this._jumpStrength,t=!0,e?this._jumped=!0:this._doubleJumped=!0),i.SetXY(a,n),i.SetBboxChanged()),t}_HandleAirTime(e,t,r){t&&0<this._sustainTime?(this._dy=-this._jumpStrength,this._sustainTime-=r):this._lastFloorObject=null,e&&(this._jumped=!0)}_CalculateHorizontalAcceleration(e,t){let r=0;var i=this._acc,s=this._dec;return e&&!t&&(r=0<this._dx?-(i+s):-i),r=t&&!e?this._dx<0?i+s:i:r}_ApplyHorizontalAcceleration(e,t,r,i){var s=this._dec,e=(e===t&&(this._dx<0?this._dx=Math.min(this._dx+s*i,0):0<this._dx&&(this._dx=Math.max(this._dx-s*i,0))),this._dx=C33.clamp(this._dx+r*i,-this._maxSpeed,this._maxSpeed),this._runtime.GetCollisionEngine()),t=this._dx<0?this._GetWallObstacle(0,1,1):null;t?(this._dx=0,e.RegisterCollision(this._inst,t)):(s=0<this._dx?this._GetWallObstacle(1,1,1):null)&&(this._dx=0,e.RegisterCollision(this._inst,s))}_HandleHorizontalMovement(t,e,r,i){var s=this._inst,a=s.GetWorldInfo(),n=this._runtime.GetCollisionEngine(),o=this._downX,l=this._downY,h=this._rightX,u=this._rightY,c=this._maxSpeed;let _=!1;var d=new Set(n.TestOverlapJumpthru(s,!0));let p=a.GetX(),m=a.GetY();var g=accelerate2(this._dx,-c,c,e,t)*h,c=accelerate2(this._dx,-c,c,e,t)*u;a.OffsetXY(h*(1<this._dx?1:-1)-o,u*(1<this._dx?1:-1)-l),a.SetBboxChanged();let f=!1;e=n.TestOverlapSolid(s);a.SetXY(p+g,m+c),a.SetBboxChanged();let S=n.TestOverlapSolid(s);if(!S&&r&&this._floorIsJumpthru&&(S=n.TestOverlapJumpthru(s),d.has(S)?S=null:f=!0),S){g=Math.abs(this._dx*t)+2;e||!n.PushOutSolid(s,-o,-l,g,f,S)?(n.RegisterCollision(s,S),g=Math.max(Math.abs(this._dx*t*2.5),Math.floor(a.GetWidth())),n.PushOutSolid(s,h*(this._dx<0?1:-1),u*(this._dx<0?1:-1),g,!1)&&(!r||f||this._floorIsJumpthru||(p=a.GetX(),m=a.GetY(),a.OffsetXY(o,l),n.TestOverlapSolid(s)&&n.PushOutSolid(s,-o,-l,3,!1)))||(a.SetXY(p,m),a.SetBboxChanged()),f||(this._dx=0)):!e&&!i&&Math.abs(this._dy)<Math.abs(this._jumpStrength/4)&&(this._dy=0,r||(_=!0))}else{c=this._IsOnFloor();if(r&&!c){h=Math.ceil(Math.abs(this._dx*t))+2,u=(p=a.GetX(),m=a.GetY(),a.OffsetXY(o*h,l*h),a.SetBboxChanged(),n.TestOverlapJumpthru(s));let e=!1;u&&!d.has(u)&&n.PushOutSolid(s,-o,-l,h+2,!0,u)&&(this._SetLastFloorObject(r=u),this._floorIsJumpthru=!0,e=!0),e||(n.TestOverlapSolid(s)?n.PushOutSolid(s,-o,-l,h+2,!1):(a.SetXY(p,m),a.SetBboxChanged()))}else c&&(!r&&this._floorIsJumpthru&&(this._SetLastFloorObject(c),this._dy=0,_=!0),0===this._dy)&&n.PushInFractional(s,-o,-l,c,16)}return[_,r]}_HandleVerticalMovement(t,r){var i=this._inst,s=i.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),n=this._downX,o=this._downY;let l=!1;var h=s.GetX(),u=s.GetY(),e=accelerate2(this._dy,-1/0,this._maxFall,this._g,t),c=(s.OffsetXY(e*n,e*o),s.GetX()),_=s.GetY();s.SetBboxChanged();let d=a.TestOverlapSolid(i),p=!1;if(!d&&0<this._dy&&!r){var m=this._IsFallThroughEnabled()?a.TestOverlapJumpthru(i,!0):null;if(m&&m.length){if(this._wasOverJumpthru){s.SetXY(h,u),s.SetBboxChanged();let r=0;for(let e=0,t=m.length;e<t;++e)m[r]=m[e],a.TestOverlap(i,m[e])||++r;C33.truncateArray(m,r),s.SetXY(c,_),s.SetBboxChanged()}1<=m.length&&(d=m[0])}p=!!d}if(d){a.RegisterCollision(i,d),this._sustainTime=0;let e=1.1;p&&!this._wasOverJumpthru&&(e=2);r=Math.max(Math.abs(this._dy*t*e),2);a.PushOutSolid(i,n*(this._dy<0?1:-1),o*(this._dy<0?1:-1),r,p,d)?(this._SetLastFloorObject(d),this._floorIsJumpthru=p,0<this._dy&&(l=!0),(0<this._dy||0===this._ceilingCollisionMode)&&(this._dy=0),this._dy<0&&1===this._ceilingCollisionMode&&a.PushInFractional(i,n,o,d,32)):(s.SetXY(h,u),s.SetBboxChanged(),this._wasOnFloor=!0,p||(this._dy=0))}return[l,e]}_HandleAnimationTriggers(e,t,r){"falling"!==this._animMode&&0<this._dy&&!e&&(this.Trigger(C33.Behaviors.Platform.Cnds.OnFall),this._animMode="falling"),(e||t)&&0<=this._dy&&("falling"===this._animMode||t||r&&0===this._dy?(this.Trigger(C33.Behaviors.Platform.Cnds.OnLand),0===this._dx&&0===this._dy?this._animMode="stopped":this._animMode="moving"):("stopped"!==this._animMode&&0===this._dx&&0===this._dy&&(this.Trigger(C33.Behaviors.Platform.Cnds.OnStop),this._animMode="stopped"),"moving"===this._animMode||0===this._dx&&0===this._dy||r||(this.Trigger(C33.Behaviors.Platform.Cnds.OnMove),this._animMode="moving")))}_IsMoving(){return 0!==this._GetVectorX()||0!==this._GetVectorY()}_CheckIfStandingOnFloor(){if(0===this._dy){var s=this._inst,e=this.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),t=e.GetX(),r=e.GetY(),n=(e.OffsetXY(this._downX,this._downY),e.SetBboxChanged(),a.TestOverlapSolid(s));let i=null;if(!n&&this._IsFallThroughEnabled()&&(i=a.TestOverlapJumpthru(s,!0)),e.SetXY(t,r),e.SetBboxChanged(),n)return!a.TestOverlap(s,n);if(i&&i.length){let r=0;for(let e=0,t=i.length;e<t;++e)i[r]=i[e],a.TestOverlap(s,i[e])||r++;if(1<=r)return!0}}return!1}_IsByWall(e,t=2,r=3){return!!this._GetWallObstacle(e,t,r)}_GetWallObstacle(e,t=2,r=3){var i=this._inst,s=this.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),n=s.GetX(),o=s.GetY();if(0===e?s.OffsetXY(-this._rightX*t,-this._rightY*t):s.OffsetXY(this._rightX*t,this._rightY*t),s.SetBboxChanged(),!a.TestOverlapSolid(i))return s.SetXY(n,o),s.SetBboxChanged(),null;s.OffsetXY(-this._downX*r,-this._downY*r),s.SetBboxChanged();e=a.TestOverlapSolid(i);return s.SetXY(n,o),s.SetBboxChanged(),e}_FallThroughJumpThru(){var e=this.GetWorldInfo(),t=e.GetX(),r=e.GetY(),i=(e.OffsetXY(this._downX,this._downY),e.SetBboxChanged(),this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst,!1));e.SetXY(t,r),e.SetBboxChanged(),i&&(this._fallThroughTime=this._runtime.GetGameTime(),this._lastFloorObject=null)}_ResetDoubleJump(e){this._doubleJumped=!e}_GetSpeed(){return Math.hypot(this._dx,this._dy)}_GetMovingAngle(){return Math.atan2(this._dy,this._dx)}_IsJumping(){return this._dy<0}_IsFalling(){return 0<this._dy}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0)}_GetMaxSpeed(){return this._maxSpeed}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_SetJumpStrength(e){this._jumpStrength=Math.max(e,0)}_GetJumpStrength(){return this._jumpStrength}_SetMaxFallSpeed(e){this._maxFall=Math.max(e,0)}_GetMaxFallSpeed(){return this._maxFall}_SetGravity(e){var t;this._g1!==e&&(this._g=e,this._UpdateGravity(),e=this._runtime.GetCollisionEngine(),t=this.GetWorldInfo(),e.TestOverlapSolid(this._inst)&&(e.PushOutSolid(this._inst,this._downX,this._downY,10),t.OffsetXY(2*this._downX,2*this._downY),t.SetBboxChanged()),this._lastFloorObject=null)}_GetGravity(){return this._g}_SetGravityAngle(e){e=C33.clampAngle(e),this._ga!==e&&(this._ga=e,this._UpdateGravity(),this._lastFloorObject=null)}_GetGravityAngle(){return this._ga}_SetDoubleJumpEnabled(e){this._enableDoubleJump=!!e}_IsDoubleJumpEnabled(){return this._enableDoubleJump}_SetJumpSustain(e){this._jumpSustain=e}_GetJumpSustain(){return this._jumpSustain}_SetCeilingCollisionMode(e){this._ceilingCollisionMode=e}_GetCeilingCollisionMode(){return this._ceilingCollisionMode}_SetVectorX(e){this._dx=e}_GetVectorX(){return this._dx}_SetVectorY(e){this._dy=e}_GetVectorY(){return this._dy}_SimulateControl(e){if(this._isEnabled)switch(e){case 0:this._simLeft=!0;break;case 1:this._simRight=!0;break;case 2:this._simJump=!0}}_SetDefaultControls(e){this._defaultControls!==(e=!!e)&&(this._defaultControls=e,this._defaultControls?this._BindEvents():(this._UnBindEvents(),this._OnWindowOrKeyboardBlur()))}_IsDefaultControls(){return this._defaultControls}_SetIgnoreInput(e){this._ignoreInput=!!e}_IsIgnoreInput(){return this._ignoreInput}_SetEnabled(e){this._isEnabled!==(e=!!e)&&(this._isEnabled=e,this._isEnabled?this._StartPostTicking():(this._StopPostTicking(),this._lastFloorObject=null,this._simLeft=!1,this._simRight=!1,this._simJump=!1))}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case MAX_SPEED:return this._GetMaxSpeed();case ACCELERATION:return this._GetAcceleration();case DECELERATION:return this._GetDeceleration();case JUMP_STRENGTH:return this._GetJumpStrength();case GRAVITY:return this._GetGravity();case MAX_FALL_SPEED:return this._GetMaxFallSpeed();case DOUBLE_JUMP:return this._IsDoubleJumpEnabled();case JUMP_SUSTAIN:return 1e3*this._GetJumpSustain();case DEFAULT_CONTROLS:return this._IsDefaultControls();case ENABLE:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case MAX_SPEED:this._SetMaxSpeed(t);break;case ACCELERATION:this._SetAcceleration(t);break;case DECELERATION:this._SetDeceleration(t);break;case JUMP_STRENGTH:this._SetJumpStrength(t);break;case GRAVITY:this._SetGravity(t);break;case MAX_FALL_SPEED:this._SetMaxFallSpeed(t);break;case DOUBLE_JUMP:this._SetDoubleJumpEnabled(!!t);break;case JUMP_SUSTAIN:this._SetJumpSustain(t/1e3);break;case DEFAULT_CONTROLS:this._SetDefaultControls(!!t);break;case ENABLE:this._SetEnabled(!!t)}}GetDebuggerProperties(){var e="behaviors.platform";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".debugger.vector-x",value:this._GetVectorX(),onedit:e=>this._SetVectorX(e)},{name:e+".debugger.vector-y",value:this._GetVectorY(),onedit:e=>this._SetVectorY(e)},{name:e+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:e+".properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:e+".properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:e+".properties.jump-strength.name",value:this._GetJumpStrength(),onedit:e=>this._SetJumpStrength(e)},{name:e+".properties.gravity.name",value:this._GetGravity(),onedit:e=>this._SetGravity(e)},{name:e+".debugger.gravity-angle",value:C33.toDegrees(this._GetGravityAngle()),onedit:e=>this._SetGravityAngle(C33.toRadians(e))},{name:e+".properties.max-fall-speed.name",value:this._GetMaxFallSpeed(),onedit:e=>this._SetMaxFallSpeed(e)},{name:e+".properties.double-jump.name",value:this._IsDoubleJumpEnabled(),onedit:e=>this._SetDoubleJumpEnabled(e)},{name:e+".properties.jump-sustain.name",value:1e3*this._GetJumpSustain(),onedit:e=>this._SetJumpSustain(e/1e3)},{name:e+".debugger.animation-mode",value:[e+".debugger.anim-"+this._animMode]},{name:e+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IPlatformBehaviorInstance}},new WeakMap),SIMULATE_CONTROL_MAP=new Map([["left",0],["right",1],["jump",2]]);self.IPlatformBehaviorInstance=class IPlatformBehaviorInstance extends IBehaviorInstance{constructor(){super(),map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}fallThrough(){map.get(this)._FallThroughJumpThru()}resetDoubleJump(e){map.get(this)._ResetDoubleJump(!!e)}simulateControl(e){C3X.RequireString(e);e=SIMULATE_CONTROL_MAP.get(e);if("number"!=typeof e)throw new Error("invalid control");map.get(this)._SimulateControl(e)}get speed(){return map.get(this)._GetSpeed()}get maxSpeed(){return map.get(this)._GetMaxSpeed()}set maxSpeed(e){C3X.RequireFiniteNumber(e),map.get(this)._SetMaxSpeed(e)}get acceleration(){return map.get(this)._GetAcceleration()}set acceleration(e){C3X.RequireFiniteNumber(e),map.get(this)._SetAcceleration(e)}get deceleration(){return map.get(this)._GetDeceleration()}set deceleration(e){C3X.RequireFiniteNumber(e),map.get(this)._SetDeceleration(e)}get jumpStrength(){return map.get(this)._GetJumpStrength()}set jumpStrength(e){C3X.RequireFiniteNumber(e),map.get(this)._SetJumpStrength(e)}get maxFallSpeed(){return map.get(this)._GetMaxFallSpeed()}set maxFallSpeed(e){C3X.RequireFiniteNumber(e),map.get(this)._SetMaxFallSpeed(e)}get gravity(){return map.get(this)._GetGravity()}set gravity(e){C3X.RequireFiniteNumber(e),map.get(this)._SetGravity(e)}get gravityAngle(){return map.get(this)._GetGravityAngle()}set gravityAngle(e){C3X.RequireFiniteNumber(e),map.get(this)._SetGravityAngle(e)}get isDoubleJumpEnabled(){return map.get(this)._IsDoubleJumpEnabled()}set isDoubleJumpEnabled(e){map.get(this)._SetDoubleJumpEnabled(!!e)}get jumpSustain(){return map.get(this)._GetJumpSustain()}set jumpSustain(e){C3X.RequireFiniteNumber(e),map.get(this)._SetJumpSustain(e)}get ceilingCollisionMode(){return 0===map.get(this)._GetCeilingCollisionMode()?"stop":"preserve-momentum"}set ceilingCollisionMode(e){C3X.RequireString(e);var t=map.get(this);if("stop"===e)t._SetCeilingCollisionMode(0);else{if("preserve-momentum"!==e)throw new Error("invalid mode");t._SetCeilingCollisionMode(1)}}get isOnFloor(){return map.get(this)._CheckIfStandingOnFloor()}isByWall(e){C3X.RequireString(e);var t=map.get(this);if("left"===e)return t._IsByWall(0);if("right"===e)return t._IsByWall(1);throw new Error("invalid side")}get isMoving(){return map.get(this)._IsMoving()}get isJumping(){return map.get(this)._IsJumping()}get isFalling(){return map.get(this)._IsFalling()}get vectorX(){return map.get(this)._GetVectorX()}set vectorX(e){C3X.RequireFiniteNumber(e),map.get(this)._SetVectorX(e)}get vectorY(){return map.get(this)._GetVectorY()}set vectorY(e){C3X.RequireFiniteNumber(e),map.get(this)._SetVectorY(e)}setVector(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);var r=map.get(this);r._SetVectorX(e),r._SetVectorY(t)}getVector(){var e=map.get(this);return[e._GetVectorX(),e._GetVectorY()]}get isDefaultControls(){return map.get(this)._IsDefaultControls()}set isDefaultControls(e){map.get(this)._SetDefaultControls(!!e)}get isIgnoringInput(){return map.get(this)._IsIgnoreInput()}set isIgnoringInput(e){map.get(this)._SetIgnoreInput(!!e)}get isEnabled(){return map.get(this)._IsEnabled()}set isEnabled(e){map.get(this)._SetEnabled(!!e)}}}{let C33=self.C3;C33.Behaviors.Platform.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(e,t){return C33.compare(this._GetSpeed(),e,t)},IsOnFloor(){return this._CheckIfStandingOnFloor()},IsByWall(e){return this._IsByWall(e)},IsJumping(){return this._IsJumping()},IsFalling(){return this._IsFalling()},IsDoubleJumpEnabled(){return this._IsDoubleJumpEnabled()},OnJump(){return!0},OnFall(){return!0},OnStop(){return!0},OnMove(){return!0},OnLand(){return!0},IsEnabled(){return this._IsEnabled()}}}{let C33=self.C3;C33.Behaviors.Platform.Acts={SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SetJumpStrength(e){this._SetJumpStrength(e)},SetMaxFallSpeed(e){this._SetMaxFallSpeed(e)},SetGravity(e){this._SetGravity(e)},SimulateControl(e){this._SimulateControl(e)},SetIgnoreInput(e){this._SetIgnoreInput(!!e)},SetVectorX(e){this._SetVectorX(e)},SetVectorY(e){this._SetVectorY(e)},SetGravityAngle(e){this._SetGravityAngle(C33.toRadians(e))},SetEnabled(e){this._SetEnabled(0!==e)},FallThrough(){this._FallThroughJumpThru()},SetDoubleJumpEnabled(e){this._SetDoubleJumpEnabled(0!==e)},SetJumpSustain(e){this._SetJumpSustain(e/1e3)},SetCeilingCollision(e){this._SetCeilingCollisionMode(e)},SetDefaultControls(e){this._SetDefaultControls(e)},ResetDoubleJump(e){this._ResetDoubleJump(e)}}}{let C33=self.C3;C33.Behaviors.Platform.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},JumpStrength(){return this._GetJumpStrength()},Gravity(){return this._GetGravity()},GravityAngle(){return C33.toDegrees(this._GetGravityAngle())},MaxFallSpeed(){return this._GetMaxFallSpeed()},MovingAngle(){return C33.toDegrees(this._GetMovingAngle())},VectorX(){return this._GetVectorX()},VectorY(){return this._GetVectorY()},JumpSustain(){return 1e3*this._GetJumpSustain()}}}{let unaryminus2=function(e){return"number"==typeof e?-e:e},bothNumbers2=function(e,t){return"number"==typeof e&&"number"==typeof t},add2=function(e,t){return bothNumbers2(e,t)?e+t:e},subtract2=function(e,t){return bothNumbers2(e,t)?e-t:e},multiply2=function(e,t){return bothNumbers2(e,t)?e*t:e},divide2=function(e,t){return bothNumbers2(e,t)?e/t:e},mod2=function(e,t){return bothNumbers2(e,t)?e%t:e},pow2=function(e,t){return bothNumbers2(e,t)?Math.pow(e,t):e},and2=function(r,i){if("string"!=typeof r&&"string"!=typeof i)return r&&i?1:0;{let e,t;return e="number"==typeof r?(Math.round(1e10*r)/1e10).toString():r,t="number"==typeof i?(Math.round(1e10*i)/1e10).toString():i,e+t}},or2=function(e,t){return bothNumbers2(e,t)?e||t?1:0:e},C33=(unaryminus=unaryminus2,bothNumbers=bothNumbers2,add=add2,subtract=subtract2,multiply=multiply2,divide=divide2,mod=mod2,pow=pow2,and=and2,or=or2,self.C3);self.C3_ExpressionFuncs=[()=>"Game Initialize...",()=>"Load Game Data Completed",()=>"Checking Save Data",e=>{let t=e._GetNode(0).GetVar();return()=>t.GetValue()},()=>"SAVEDATA_LOADED",e=>{let t=e._GetNode(0);return()=>and2("Load Save Data v",t.ExpObject("SAVE_VERSION"))},()=>"GAMEINIT_LOADED",()=>"Highscore",()=>0,()=>"OperatorAddition",()=>1,()=>"OperatorSubtraction",()=>"OperatorMultiplication",()=>"EnemyHealth",()=>"PlayerSpeed",()=>"QuestionAddition",()=>"QuestionSubtraction",()=>"QuestionMultiplication",()=>"Function Helper Inputs",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>and2("touch_",t())},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3).GetBoundMethod();return()=>and2(and2(t(r()),","),i(s()))},e=>{let t=e._GetNode(0).GetVar();return()=>and2("touch_",t.GetValue())},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetVar();return()=>t(r.ExpObject(and2("touch_",i.GetValue())),0,",")},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetVar();return()=>t(r.ExpObject(and2("touch_",i.GetValue())),1,",")},e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3).GetVar(),a=e._GetNode(4).GetBoundMethod(),n=e._GetNode(5).GetVar();return()=>C33.distanceTo(t.GetValue(),r.GetValue(),i(s.GetValue()),a(n.GetValue()))},e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3).GetVar(),a=e._GetNode(4).GetBoundMethod(),n=e._GetNode(5).GetVar();return()=>C33.toDegrees(C33.angleTo(t.GetValue(),r.GetValue(),i(s.GetValue()),a(n.GetValue())))},()=>-45,()=>45,()=>"RIGHT",()=>135,()=>"DOWN",()=>225,()=>"LEFT",()=>"UP",()=>"",e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar();return()=>t.ExpObject(and2("touch_",r.GetValue()))},e=>{let t=e._GetNode(0).GetBoundMethod();return()=>"SaveData_"+t()},()=>"Sound",()=>"Global Functions",()=>"STRING EMPTY\nCheck if it cast a number, make sure to convert to string",()=>"Score",e=>{let t=e._GetNode(0);return()=>t.ExpObject("Highscore")},e=>{let t=e._GetNode(0);return()=>t.ExpObject("Score")},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1);return()=>t(r.ExpObject("Score"))},()=>-1,()=>"sfx",()=>"bgm",e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar();return()=>subtract2(t.ExpObject(r.GetValue()),1)},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar(),i=e._GetNode(2).GetVar();return()=>t.ExpObject(r.GetValue()+".defaultEffect."+i.GetValue())},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar(),i=e._GetNode(2),s=e._GetNode(3).GetVar(),a=e._GetNode(4).GetVar(),n=e._GetNode(5).GetVar();return()=>t.ExpObject(and2(r.GetValue()+".effects.",add2(i.ExpObject(s.GetValue()),a.GetValue()?0:-1))+"."+n.GetValue())},()=>"Tutorial",e=>{let t=e._GetNode(0);return()=>1===t.ExpObject("Tutorial")?0:1},()=>"Save System",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t()},e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>t.ExpObject(r.ExpObject())},e=>{let t=e._GetNode(0).GetVar();return()=>"Save Data for ["+t.GetValue()+"] Found"},e=>{let t=e._GetNode(0);return()=>t.ExpObject()},()=>"Game Saved",()=>"Local Storage Cleared",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>"Create Default Data [v"+t()+"]"},()=>"SAVE_VERSION",()=>"UI Update",()=>"PLAY",e=>{let t=e._GetNode(0),r=e._GetNode(1),i=e._GetNode(2);return()=>" [outlineback=#733c03][lineThickness=5]"+t.ExpInstVar()+" [/lineThickness][/outlineback][outlineback=#913f2d][lineThickness=5]"+(""===r.ExpInstVar()?"?":i.ExpInstVar())+"[/lineThickness][/outlineback]"},e=>{let t=e._GetNode(0);return()=>t.ExpInstVar()},()=>"UI Inputs",()=>.8,()=>"[outlineback=#733c03][lineThickness=5]0[/lineThickness][/outlineback]",e=>{let t=e._GetNode(0);return()=>t.ExpInstVar()-1},()=>"UI",()=>44,()=>541,e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()+r()*i.ExpObject()},e=>{let t=e._GetNode(0);return()=>and2("[outlineback=#733c03][lineThickness=5]",t.ExpInstVar())+"[/lineThickness][/outlineback]"},e=>{let t=e._GetNode(0);return()=>t.ExpInstVar()/2},()=>"scale",e=>{let t=e._GetNode(0);return()=>t.ExpInstVar()+200},()=>.3,e=>{let t=e._GetNode(0);return()=>t.ExpInstVar()-200},()=>100,()=>.5,()=>2,()=>.6,e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()+(r()+1)*i.ExpObject()},e=>{let t=e._GetNode(0);return()=>t.ExpBehavior("scale")},()=>"Transition Update",()=>"TRANSITION",()=>"transitionIn",()=>"Transition",e=>{let t=e._GetNode(0);return()=>t.ExpBehavior("transitionIn")},()=>"transitionOut",e=>{let t=e._GetNode(0);return()=>t.ExpBehavior("transitionOut")},()=>"TRANSITION_DONE",e=>{let t=e._GetNode(0);return()=>-t.ExpObject()-10},()=>"transition",e=>{let t=e._GetNode(0);return()=>t.ExpObject()+10},()=>"Result Inputs",()=>"GAMEOVER",()=>.9,()=>"Result",()=>"result",e=>{let t=e._GetNode(0);return()=>and2("[outlineback=#733c03][lineThickness=5] ",t.ExpInstVar()-1)+" x [/lineThickness][/outlineback]"},()=>70,e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3).GetBoundMethod();return()=>t(r(100),i(100),s(100))},e=>{let t=e._GetNode(0);return()=>t.ExpInstVar_Family()},()=>"Idle",()=>"Attack",()=>"FamEnemyAttack",()=>"Attacked",()=>"Dead",()=>"Medic",()=>"enemydead",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t(.9,1.1)},()=>4,()=>"enemyattack",e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1);return()=>t()+r.ExpObject()+10},()=>"Loading Style 1",e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>t.ExpInstVar()-r.ExpObject()},()=>.95,e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpInstVar()-(1-r())*i.ExpObject()},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod();return()=>and2(t(100*r()),"%")},e=>{let t=e._GetNode(0);return()=>and2(t.ExpInstVar(),"")},()=>"Title",()=>"Loading Inputs",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t()/2},()=>1.5,()=>"Title Inputs",()=>"TITLE",e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1);return()=>t()*r.ExpInstVar()},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()-r()*i.ExpInstVar()*.25},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()-r()*i.ExpInstVar()*.06},()=>.16,()=>1.3,()=>"Main",e=>{let t=e._GetNode(0);return()=>"On"===t.ExpObject()?"Off":"On"},()=>.4,()=>"INIT_DONE",()=>"menu",()=>"On",()=>"Off",e=>{let t=e._GetNode(0).GetVar();return()=>"On"===t.GetValue()?1:0},()=>"Main Update",e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2),s=e._GetNode(3),a=e._GetNode(4);return()=>t.ExpObject()-r()*((i.ExpInstVar_Family()?s.ExpInstVar_Family():0)+a.ExpInstVar())},()=>"Main Inputs",()=>"Default",()=>"Pressed",()=>"INIT",e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>t.ExpInstVar()+(1===r.ExpObject("OperatorAddition")?",+":"")},e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>t.ExpInstVar()+(1===r.ExpObject("OperatorSubtraction")?",-":"")},e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>t.ExpInstVar()+(1===r.ExpObject("OperatorMultiplication")?",*":"")},()=>"+",e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3),a=e._GetNode(4);return()=>","===t(r.ExpInstVar(),1)?i(s.ExpInstVar(),1,-1):a.ExpInstVar()},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod();return()=>add2(t.ExpObject(),multiply2(r(1,5),i(-1,1)))},()=>.2,e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1);return()=>t(4,6-r.ExpInstVar()/10)},e=>{let t=e._GetNode(0).GetVar();return()=>"0"!==t.GetValue()?1:0},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetVar();return()=>0===t(r.GetValue())?1:0},e=>{let t=e._GetNode(0).GetVar();return()=>"typed string : "+t.GetValue()},e=>{let t=e._GetNode(0).GetVar();return()=>"Backspace"===t.GetValue()?1:0},e=>{let t=e._GetNode(0).GetVar();return()=>"Enter"===t.GetValue()?1:0},e=>{let t=e._GetNode(0).GetVar();return()=>"."===t.GetValue()?1:0},()=>"typing",e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t(.8,1.2)},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar();return()=>t.ExpInstVar()+r.GetValue()},e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t(.6)},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3);return()=>t(r.ExpInstVar(),i(s.ExpInstVar())-1)},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar();return()=>10+Math.ceil(t.ExpInstVar()/10*10)+Math.ceil(.5*r.GetValue())},e=>{let t=e._GetNode(0);return()=>t.ExpObject()-1},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject(0,r())},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetBoundMethod();return()=>t(r.ExpObject(1,i()))},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2),s=e._GetNode(3).GetBoundMethod();return()=>and2(and2("Level [",t.ExpInstVar())+"] Speed Increased by :",r(i.ExpObject(1,s())))},e=>{let t=e._GetNode(0);return()=>"Wrong... answer :"+t.ExpInstVar()},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3).GetBoundMethod(),a=e._GetNode(4).GetBoundMethod(),n=e._GetNode(5);return()=>t(r.ExpInstVar(),i(s(0,a(n.ExpInstVar(),","))),",")},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()-1-r()},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3),a=e._GetNode(4).GetVar(),n=e._GetNode(5).GetBoundMethod(),o=e._GetNode(6),l=e._GetNode(7).GetVar();return()=>t(r(i(s.ExpObject(1,a.GetValue())),n(o.ExpObject(2,l.GetValue()))+1))},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3),a=e._GetNode(4).GetVar(),n=e._GetNode(5).GetBoundMethod(),o=e._GetNode(6),l=e._GetNode(7).GetVar();return()=>t(r(i(s.ExpObject(3,a.GetValue())),n(o.ExpObject(4,l.GetValue()))+1))},e=>{let t=e._GetNode(0),r=e._GetNode(1).GetVar();return()=>t.ExpObject(0,r.GetValue())},e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar();return()=>t.GetValue()+r.GetValue()},()=>"-",e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod(),s=e._GetNode(3),a=e._GetNode(4).GetVar(),n=e._GetNode(5),o=e._GetNode(6).GetVar(),l=e._GetNode(7).GetVar(),h=e._GetNode(8).GetBoundMethod(),u=e._GetNode(9),c=e._GetNode(10).GetVar();return()=>t(r(i(s.ExpObject(3,a.GetValue())),"-"===n.ExpObject(4,o.GetValue())?l.GetValue():h(u.ExpObject(4,c.GetValue()))+1))},e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar();return()=>t.GetValue()-r.GetValue()},()=>"*",e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar();return()=>t.GetValue()*r.GetValue()},()=>"x",e=>{let t=e._GetNode(0).GetVar(),r=e._GetNode(1).GetVar(),i=e._GetNode(2).GetVar();return()=>and2(and2(t.GetValue()," ")+r.GetValue()+" ",i.GetValue())+"  = "},e=>{let t=e._GetNode(0),r=e._GetNode(1);return()=>"Generate Question \nQuestion: "+t.ExpInstVar()+"\nAnswer : "+r.ExpInstVar()},e=>{let t=e._GetNode(0).GetBoundMethod();return()=>t(0,1)},e=>{let t=e._GetNode(0).GetBoundMethod(),r=e._GetNode(1).GetBoundMethod();return()=>t(r(0,2))},()=>.15,()=>935,()=>415,()=>931,()=>394,e=>{let t=e._GetNode(0);return()=>and2("[lineThickness=4][outlineback=#651f32]",t.ExpInstVar_Family())+"[/outlineback][/lineThickness]"},()=>"Run",()=>"playerrun",e=>{let t=e._GetNode(0);return()=>t.ExpObject()%3},e=>{let t=e._GetNode(0).GetBoundMethod();return()=>and2("walk_grass_",t(1,2))},()=>-18]}}}),import_c3runtime=__toESM(require_c3runtime()),C32=self.C3,scriptsInEvents=(self.C3_GetObjectRefTable=function(){return[C32.Plugins.Sprite,C32.Behaviors.Tween,C32.Behaviors.Sin,C32.Plugins.Text,C32.Plugins.Browser,C32.Plugins.Arr,C32.Plugins.Keyboard,C32.Plugins.Touch,C32.Plugins.LocalStorage,C32.Plugins.Dictionary,C32.Plugins.Audio,C32.Plugins.AJAX,C32.Plugins.FileSystem,C32.Plugins.Json,C32.Plugins.Timeline,C32.Plugins.GD_SDK,C32.Plugins.TiledBg,C32.Behaviors.Platform,C32.Plugins.Particles,C32.Plugins.System.Acts.WaitForPreviousActions,C32.Plugins.LocalStorage.Acts.CheckItemExists,C32.Plugins.System.Acts.WaitForSignal,C32.Plugins.Dictionary.Exps.Get,C32.Plugins.System.Acts.Signal,C32.Plugins.System.Acts.SetBoolVar,C32.Plugins.Dictionary.Acts.AddKey,C32.Plugins.AJAX.Acts.RequestFile,C32.Plugins.System.Cnds.OnLayoutStart,C32.Plugins.System.Cnds.IsGroupActive,C32.Plugins.Touch.Cnds.OnTouchStart,C32.Plugins.Touch.Exps.TouchID,C32.Plugins.Touch.Exps.XForID,C32.Plugins.Touch.Exps.YForID,C32.Plugins.Dictionary.Cnds.HasKey,C32.Plugins.System.Acts.SetVar,C32.Plugins.System.Exps.tokenat,C32.Plugins.System.Cnds.CompareVar,C32.Plugins.System.Cnds.IsBetweenAngles,C32.Plugins.System.Acts.SetFunctionReturnValue,C32.Plugins.System.Cnds.Else,C32.Plugins.System.Cnds.CompareBoolVar,C32.Plugins.System.Exps.projectname,C32.Plugins.Dictionary.Cnds.CompareValue,C32.Plugins.System.Cnds.TriggerOnce,C32.Plugins.Browser.Acts.ConsoleLog,C32.Plugins.System.Exps.int,C32.Plugins.Browser.Acts.RequestFullScreen,C32.Plugins.Browser.Acts.CancelFullScreen,C32.Plugins.Audio.Acts.Stop,C32.Plugins.Audio.Acts.SetSilent,C32.Plugins.Audio.Acts.SetPaused,C32.Plugins.System.Cnds.Compare,C32.Plugins.Json.Exps.Get,C32.Plugins.Dictionary.Acts.SetKey,C32.Plugins.LocalStorage.Cnds.OnItemMissing,C32.Plugins.LocalStorage.Cnds.OnItemExists,C32.Plugins.LocalStorage.Acts.GetItem,C32.Plugins.LocalStorage.Cnds.OnItemGet,C32.Plugins.Json.Acts.Parse,C32.Plugins.LocalStorage.Exps.ItemValue,C32.Plugins.Dictionary.Acts.JSONLoad,C32.Plugins.Dictionary.Exps.ObjectTypeName,C32.Plugins.Json.Exps.ToBeautifiedString,C32.Plugins.Json.Acts.SetValue,C32.Plugins.Dictionary.Exps.AsJSON,C32.Plugins.LocalStorage.Acts.SetItem,C32.Plugins.Json.Exps.ToCompactString,C32.Plugins.LocalStorage.Acts.ClearStorage,C32.Plugins.System.Exps.projectversion,C32.Plugins.AJAX.Cnds.OnComplete,C32.Plugins.Arr.Acts.JSONLoad,C32.Plugins.AJAX.Exps.LastData,C32.Plugins.GD_SDK.Cnds.PauseGame,C32.Plugins.GD_SDK.Cnds.ResumeGame,C32.Plugins.Audio.Cnds.IsSilent,C32.Plugins.Keyboard.Cnds.OnKeyReleased,C32.Plugins.Sprite.Cnds.CompareInstanceVar,C32.Plugins.Text.Acts.SetText,C32.Plugins.Sprite.Cnds.IsBoolInstanceVarSet,C32.Plugins.Sprite.Acts.SetVisible,C32.Plugins.Touch.Cnds.OnTapGestureObject,C32.Plugins.Browser.Cnds.IsFullscreen,C32.Plugins.Audio.Acts.Play,C32.Plugins.Audio.Acts.SetPlaybackRate,C32.Plugins.Text.Acts.SetInstanceVar,C32.Plugins.Text.Exps.FaceSize,C32.Plugins.Text.Exps.X,C32.Plugins.System.Cnds.For,C32.Plugins.System.Acts.CreateObject,C32.Plugins.Sprite.Acts.SetX,C32.Plugins.Sprite.Exps.X,C32.Plugins.System.Exps.loopindex,C32.Plugins.Sprite.Exps.Width,C32.Plugins.Text.Acts.SetFontSize,C32.Behaviors.Tween.Acts.StopTweens,C32.Behaviors.Tween.Acts.TweenValue,C32.Behaviors.Tween.Acts.TweenOneProperty,C32.Plugins.Text.Acts.SetX,C32.Plugins.Text.Acts.SetOpacity,C32.Plugins.System.Cnds.ForEachOrdered,C32.Behaviors.Tween.Acts.TweenTwoProperties,C32.Plugins.Sprite.Acts.SetScale,C32.Behaviors.Tween.Cnds.IsPlaying,C32.Behaviors.Tween.Exps.Value,C32.Behaviors.Tween.Cnds.OnTweensFinished,C32.Plugins.System.Acts.SetLayerVisible,C32.Plugins.System.Acts.GoToLayoutByName,C32.Plugins.System.Acts.SetLayerOpacity,C32.ScriptsInEvents.Etransition_Event9_Act1,C32.ScriptsInEvents.Etransition_Event13_Act1,C32.Plugins.System.Acts.SetLayerTransparent,C32.Plugins.TiledBg.Acts.SetSize,C32.Plugins.System.Exps.originalviewportwidth,C32.Plugins.System.Exps.originalviewportheight,C32.Plugins.TiledBg.Acts.SetPos,C32.Plugins.TiledBg.Exps.Height,C32.Plugins.Particles.Acts.SetSpraying,C32.Plugins.Timeline.Acts.PlayTimeline,C32.Plugins.Particles.Acts.SetRate,C32.Plugins.System.Acts.Wait,C32.Plugins.Sprite.Cnds.OnCreated,C32.Plugins.Sprite.Acts.SetDefaultColor,C32.Plugins.System.Exps.rgbex,C32.Plugins.System.Exps.random,C32.Plugins.Timeline.Cnds.OnTimelineFinishedByTags,C32.Plugins.GD_SDK.Acts.ShowAd,C32.Plugins.Sprite.Cnds.OnCollision,C32.Plugins.Sprite.Acts.SetCollisions,C32.Plugins.Sprite.Exps.UID,C32.Plugins.Sprite.Cnds.PickByUID,C32.Plugins.Sprite.Acts.SetBoolInstanceVar,C32.Plugins.Sprite.Acts.SetAnim,C32.Plugins.Sprite.Acts.SubInstanceVar,C32.Plugins.Sprite.Cnds.PickChildren,C32.Plugins.Sprite.Cnds.OnAnimFinished,C32.Plugins.Sprite.Cnds.IsAnimPlaying,C32.Plugins.Sprite.Cnds.CompareFrame,C32.Plugins.Sprite.Acts.SetY,C32.Plugins.Sprite.Exps.Height,C32.Plugins.Sprite.Acts.Destroy,C32.Plugins.Sprite.Acts.SetInstanceVar,C32.Plugins.System.Cnds.EveryTick,C32.Plugins.System.Exps.loadingprogress,C32.Plugins.System.Cnds.OnLoadFinished,C32.Plugins.Audio.Cnds.IsTagPlaying,C32.Plugins.Audio.Acts.PlayByName,C32.Plugins.TiledBg.Acts.SubInstanceVar,C32.Plugins.System.Exps.dt,C32.Plugins.TiledBg.Acts.SetImageOffsetX,C32.Plugins.TiledBg.Exps.ImageOffsetX,C32.Plugins.Sprite.Exps.AnimationName,C32.Behaviors.Tween.Acts.StopAllTweens,C32.Plugins.Sprite.Acts.SetAnimFrame,C32.Plugins.System.Cnds.ForEach,C32.Plugins.Keyboard.Cnds.OnAnyKeyReleased,C32.Plugins.Keyboard.Exps.TypedKey,C32.Plugins.Keyboard.Cnds.OnAnyKey,C32.Plugins.Touch.Cnds.OnTouchObject,C32.Plugins.Touch.Cnds.IsTouchingObject,C32.Plugins.Touch.Cnds.OnTouchEnd,C32.Plugins.System.Exps.left,C32.Plugins.System.Exps.mid,C32.Plugins.System.Acts.RestartLayout,C32.Plugins.System.Exps.choose,C32.Plugins.Sprite.Exps.Y,C32.Plugins.System.Exps.max,C32.Plugins.System.Cnds.EvaluateExpression,C32.Plugins.System.Exps.len,C32.Plugins.Sprite.Acts.AddInstanceVar,C32.Plugins.Arr.Exps.Height,C32.Plugins.Arr.Exps.At,C32.Plugins.System.Exps.tokencount,C32.Plugins.System.Acts.StopLoop,C32.Plugins.Sprite.Exps.AnimationFrame]},self.C3_JsPropNameTable=[{Tween:0},{spriteTitle:0},{Sine:0},{spriteTitleBtnPlay:0},{spriteBtnFullscreen:0},{spriteBtnSound:0},{spriteLoadingBorder:0},{spriteLoadingBg:0},{targetX:0},{spriteLoadingProgress:0},{textLoading:0},{spriteTutorialFinger:0},{spriteTutorialFinger2:0},{spriteResultBtnMenu:0},{spriteResultBtnRestart:0},{Browser:0},{Array:0},{Keyboard:0},{Touch:0},{LocalStorage:0},{GameData:0},{Audio:0},{TouchData:0},{AJAX:0},{FileSystem:0},{JSON:0},{DictInventory:0},{JsonShop:0},{TimelineController:0},{GameDistributionSDK:0},{DefaultFontSize:0},{textScore:0},{textResultScore:0},{textResultHighscore:0},{textEnemyHealth:0},{textPlayerHealth:0},{textResultLevel:0},{textTitleHighscore:0},{textAttackPower:0},{textPlayerInput:0},{defaultX:0},{textQuestion:0},{spriteBtnMenu:0},{MainBackground1:0},{MainBackground2:0},{MainBackground3:0},{SpriteBackground:0},{operatorValue:0},{spriteBtnMenuOperator:0},{IsKilled:0},{Spawn:0},{Invisible:0},{ChasePlayer:0},{TextUID:0},{WordIndex:0},{Walk:0},{WalkSpeed:0},{Type:0},{Health:0},{Attack:0},{Air:0},{spriteEnemy:0},{spriteEnemyAir:0},{spriteEnemyHealth:0},{spriteEnemyMedic:0},{spriteLock:0},{key:0},{spriteNumber:0},{spritePlayerCharacter:0},{spritePlayerHealth:0},{spriteQuestionBg:0},{spriteResultEnemy:0},{spriteResultHighscoreBg:0},{spriteResultScoreBg:0},{spriteScoreBg:0},{spriteStatusBg:0},{objectTransitionController:0},{STATE:0},{Level:0},{Highscore:0},{Score:0},{InputText:0},{Question:0},{Answer:0},{GlobalSpeed:0},{GlobalMove:0},{SpawnEnemyTime:0},{TypeLock:0},{TypeLockTime:0},{TypeLockTimeDefault:0},{LastTouchUID:0},{SelectedOperator:0},{GCMain:0},{GCTitle:0},{ArrayEnemyHealth:0},{ArrayPlayerSpeed:0},{ArrayQuestionAddition:0},{ArrayQuestionSubtraction:0},{ArrayQuestionMultiplication:0},{DefaultHealth:0},{State:0},{LastAnimation:0},{Platform:0},{objectPlayerCharacter:0},{objectPlayerColEnemy:0},{tileBlackscreen:0},{tileTransition:0},{tileWhitescreen:0},{offsetX:0},{tilePlatform:0},{particleConfetti:0},{particleSpriteconfetti:0},{FamEnemy:0},{ConfigTransitionType:0},{ConfigTransitionDuration:0},{ConfigLoadingAddTapToContinue:0},{ConfigBgmName:0},{touchX:0},{touchY:0},{distanceTouch:0},{angleTouch:0},{touchSpeed:0},{touchId:0},{toucid:0},{DEBUGMODE:0},{SAVEINIT:0},{LOADCOMPLETED:0},{GlobalSaveDataName:0},{GlobalSoundSilent:0},{message:0},{fullscreen:0},{silent:0},{skillid:0},{keyid:0},{getNextUpgrade:0},{amount:0},{TransitionIsTransition:0},{TransitionTargetLayout:0},{TransitionTargetFunction:0},{GAMETRANSITION:0},{targetLayout:0},{targetFunction:0},{enemyUID:0},{famEnemyUID:0},{operator:0},{setTo:0},{GameLockControl:0},{keyString:0},{enemyHealth:0},{val1:0},{operators:0},{val2:0},{index:0},{enemyStyle:0},{enemyType:0}],self.InstanceType={spriteTitle:class extends self.ISpriteInstance{},spriteTitleBtnPlay:class extends self.ISpriteInstance{},spriteBtnFullscreen:class extends self.ISpriteInstance{},spriteBtnSound:class extends self.ISpriteInstance{},spriteLoadingBorder:class extends self.ISpriteInstance{},spriteLoadingBg:class extends self.ISpriteInstance{},spriteLoadingProgress:class extends self.ISpriteInstance{},textLoading:class extends self.ITextInstance{},spriteTutorialFinger:class extends self.ISpriteInstance{},spriteTutorialFinger2:class extends self.ISpriteInstance{},spriteResultBtnMenu:class extends self.ISpriteInstance{},spriteResultBtnRestart:class extends self.ISpriteInstance{},Browser:class extends self.IInstance{},Array:class extends self.IArrayInstance{},Keyboard:class extends self.IInstance{},Touch:class extends self.IInstance{},LocalStorage:class extends self.IInstance{},GameData:class extends self.IDictionaryInstance{},Audio:class extends self.IInstance{},TouchData:class extends self.IDictionaryInstance{},AJAX:class extends self.IInstance{},FileSystem:class extends self.IInstance{},JSON:class extends self.IJSONInstance{},DictInventory:class extends self.IDictionaryInstance{},JsonShop:class extends self.IJSONInstance{},TimelineController:class extends self.IInstance{},GameDistributionSDK:class extends self.IInstance{},textScore:class extends self.ITextInstance{},textResultScore:class extends self.ITextInstance{},textResultHighscore:class extends self.ITextInstance{},textEnemyHealth:class extends self.ITextInstance{},textPlayerHealth:class extends self.ITextInstance{},textResultLevel:class extends self.ITextInstance{},textTitleHighscore:class extends self.ITextInstance{},textAttackPower:class extends self.ITextInstance{},textPlayerInput:class extends self.ITextInstance{},textQuestion:class extends self.ITextInstance{},spriteBtnMenu:class extends self.ISpriteInstance{},MainBackground1:class extends self.ITiledBackgroundInstance{},MainBackground2:class extends self.ITiledBackgroundInstance{},MainBackground3:class extends self.ITiledBackgroundInstance{},SpriteBackground:class extends self.ISpriteInstance{},spriteBtnMenuOperator:class extends self.ISpriteInstance{},spriteEnemy:class extends self.ISpriteInstance{},spriteEnemyAir:class extends self.ISpriteInstance{},spriteEnemyHealth:class extends self.ISpriteInstance{},spriteEnemyMedic:class extends self.ISpriteInstance{},spriteLock:class extends self.ISpriteInstance{},spriteNumber:class extends self.ISpriteInstance{},spritePlayerCharacter:class extends self.ISpriteInstance{},spritePlayerHealth:class extends self.ISpriteInstance{},spriteQuestionBg:class extends self.ISpriteInstance{},spriteResultEnemy:class extends self.ISpriteInstance{},spriteResultHighscoreBg:class extends self.ISpriteInstance{},spriteResultScoreBg:class extends self.ISpriteInstance{},spriteScoreBg:class extends self.ISpriteInstance{},spriteStatusBg:class extends self.ISpriteInstance{},objectTransitionController:class extends self.ISpriteInstance{},GCMain:class extends self.ISpriteInstance{},GCTitle:class extends self.ISpriteInstance{},ArrayEnemyHealth:class extends self.IArrayInstance{},ArrayPlayerSpeed:class extends self.IArrayInstance{},ArrayQuestionAddition:class extends self.IArrayInstance{},ArrayQuestionSubtraction:class extends self.IArrayInstance{},ArrayQuestionMultiplication:class extends self.IArrayInstance{},objectPlayerCharacter:class extends self.ISpriteInstance{},objectPlayerColEnemy:class extends self.ISpriteInstance{},tileBlackscreen:class extends self.ITiledBackgroundInstance{},tileTransition:class extends self.ITiledBackgroundInstance{},tileWhitescreen:class extends self.ITiledBackgroundInstance{},tilePlatform:class extends self.ITiledBackgroundInstance{},particleConfetti:class extends self.IParticlesInstance{},particleSpriteconfetti:class extends self.ISpriteInstance{},FamEnemy:class extends self.ISpriteInstance{}},{async Etransition_Event9_Act1(e,t){e.callFunction(e.globalVars.TransitionTargetFunction)},async Etransition_Event13_Act1(e,t){e.callFunction(e.globalVars.TransitionTargetFunction)}});self.C3.ScriptsInEvents=scriptsInEvents;